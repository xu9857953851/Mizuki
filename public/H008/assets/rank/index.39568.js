window.__require=function e(t,n,c){function o(a,r){if(!n[a]){if(!t[a]){var s=a.split("/");if(s=s[s.length-1],!t[s]){var p="function"==typeof __require&&__require;if(!r&&p)return p(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+a+"'")}a=s}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return o(t[a][1][e]||e)},u,u.exports,e,t,n,c)}return n[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<c.length;a++)o(c[a]);return o}({UIAuthorize:[function(e,t){"use strict";cc._RF.push(t,"859412P85BAzItu5YiMYV68","UIAuthorize"),cc.Class({extends:cc.Component,properties:{uidLabel:cc.Label,root1:cc.Node,root2:cc.Node,rewardNode:cc.Node,wxNode:cc.Node},initBy:function(e){var t=this;this.onCloseCB=e,this.preAuth=cc.player.auth,this.uidLabel.string=cc.pvz.cloud.uid,this.root1.active=!1,this.root2.active=!1,this.rewardNode.active=1!=cc.player.auth,cc.sys.platform==cc.sys.WECHAT_GAME?wx.getSetting({success:function(e){!0===e.authSetting["scope.userInfo"]?t.root2.active=!0:t.root1.active=!0}}):(this.root1.active=this.rewardNode.active,this.root2.active=!this.rewardNode.active)},onClickClose:function(){this.wxNode.destroy(),cc.popupManager.removePopup(this),this.onCloseCB&&this.onCloseCB(1!=this.preAuth&&1==cc.player.auth)},onAuthorizeSucc:function(){if(this.root1.active=!1,this.root2.active=!0,this.rewardNode.active=!1,1!=cc.player.auth){cc.player.auth=1;var e=cc.pvz.GameConfig.ItemType["\u94bb\u77f3"];cc.pvz.PlayerData.changeItemNum(e,100),cc.popupManager.showEffectFly(e,cc.MainControl.getItemEffectPos(e),cc.math.randomRangeInt(1,4)),cc.MainControl.updateItemInfo()}},onWxAuthorize:function(e){var t=this;console.log("xxxxxxxxxxxxxxxxxxxxxxxxx"),console.log(e),e.userInfo&&e.userInfo.avatarUrl&&e.userInfo.nickName&&cc.pvz.cloud.setAvatar(e.userInfo.nickName,e.userInfo.avatarUrl,function(e){e?t.onAuthorizeSucc():cc.popupManager.showToast("\u6388\u6743\u5931\u8d25,\u7a0d\u540e\u518d\u8bd5")})}}),cc._RF.pop()},{}],UIRankEnd:[function(e,t){"use strict";cc._RF.push(t,"9ce5fmAf/JJ5KQSuT5TuFDx","UIRankEnd"),cc.Class({extends:cc.Component,properties:{bgSpine:sp.Skeleton,tiSpine:sp.Skeleton,waveLabel:cc.Label,batterWaveTip:cc.Node,coinCountLabel:cc.Label,bgNode:cc.Node,infoPanel:cc.Node},initBy:function(e){var t=this;this.scene=e,this.bgNode.active=!1,this.infoPanel.active=!1,this.bgSpine.setAnimation(0,"",!1),cc.pvz.utils.spineFromTo(this.bgSpine,"jieshu1_2","jieshu2_2"),cc.pvz.utils.spineFromTo(this.tiSpine,"jieshu1_1","jieshu2_1",!0,function(){t.bgNode.active=!0,t.infoPanel.active=!0});var n=cc.pvz.runtimeData.wave;if(this.waveLabel.string=""+n,this.coinCountLabel.string="x"+50*n,cc.pvz.runtimeData.wave>0&&cc.pvz.runtimeData.wave>cc.tmpScore){cc.tmpScore=cc.pvz.runtimeData.wave,cc.tmpNewRecord=!0,this.batterWaveTip.active=!0;var c=-1,o=[],i=[];cc.pvz.runtimeData.items.forEach(function(e){99!=e.id&&(e.lv>c&&(c=e.lv,o.length=0),o.push(e.id),i.push(e.id),i.push(e.lv))});var a=""+o[cc.math.randomRangeInt(0,o.length)];cc.pvz.cloud.uploadScore(n,a,i,function(){})}else this.batterWaveTip.active=!1;cc.butler.resumeDirector(1),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5173\u5361\u7ed3\u7b97"])},addCoinAndClose:function(e){var t;if(t=e?100*cc.pvz.runtimeData.wave:50*cc.pvz.runtimeData.wave,cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],t),e){cc.popupManager.removePopup(this);var n=cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],t);cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},[n],cc.pvz.GameConfig.UIFromType["\u53cc\u500d\u7ed3\u7b97"],function(){cc.popupManager.removeAllPopups(),cc.pvz.runtimeData.removeData(),cc.director.loadScene("mainUI")})}else cc.butler.playEffectAsync("game","sound/getCoin"),cc.popupManager.removeAllPopups(),cc.pvz.runtimeData.removeData(),cc.director.loadScene("mainUI")},onClickClose:function(){this.addCoinAndClose(!1)},onClickAd:function(){var e=this;this.isLookAd||(this.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5173\u5361\u7ed3\u7b97"],function(t){e.isLookAd=!1,t&&e.addCoinAndClose(!0)}))}}),cc._RF.pop()},{}],UIRankList:[function(e,t){"use strict";cc._RF.push(t,"7e668v3Iv1KNrC3lKjau9id","UIRankList"),cc.Class({extends:cc.Component,properties:{top123Nodes:[cc.Node],rank1234Nodes:[cc.Node],emptyTip:cc.Node,rankMeNode:cc.Node,boxJsonFile:cc.JsonAsset,boxPopupRoot:cc.Node},getBoxIDByRank:function(e){for(var t=e+1,n=0;n<this.boxJsonFile.json.length;n++){var c=this.boxJsonFile.json[n];if(t>=c.rank1&&t<=c.rank2)return c.ID}return this.boxJsonFile.json[this.boxJsonFile.json.length-1].ID},fillRankNode:function(e,t){var n,c=-1!=t.rank,o=null;e?(o=this.rankMeNode,t.uInfo=t.info):t.rank<3?o=this.rank1234Nodes[t.rank]:(o=cc.instantiate(this.rank1234Nodes[3])).parent=this.rank1234Nodes[3].parent,n=t.uInfo.name&&"NONAME"!=t.uInfo.name?t.uInfo.name:"\u7528\u6237"+t.uInfo.uid,cc.find("ranknum",o).getComponent(cc.Label).string=c?t.rank+1:"\u65e0",cc.find("name",o).getComponent(cc.Label).string=n,cc.find("wavenum",o).getComponent(cc.Label).string=t.uInfo.score+"\u6ce2";var i=cc.find("icon",o).getComponent(cc.Sprite);t.uInfo.avatarUrl&&t.uInfo.avatarUrl.length>0&&cc.assetManager.loadRemote(t.uInfo.avatarUrl,{ext:".jpg"},function(e,t){var n=new cc.SpriteFrame;n.setTexture(t),i.spriteFrame=n});var a=cc.find("box",o).getComponent(cc.Sprite);if(c){var r=this.getBoxIDByRank(t.rank);cc.pvz.utils.setSpriteFrame(a,"rank","img/bx"+r),a.getComponent(cc.Button).clickEvents[0].customEventData=r}else a.node.active=!1;if(c&&t.rank<3){var s,p=this.top123Nodes[t.rank];cc.find("name",p).getComponent(cc.Label).string=n,cc.find("wavenum",p).getComponent(cc.Label).string=t.uInfo.score+"\u6ce2",s=t.uInfo.exInfo.length>0?t.uInfo.exInfo:"1",cc.pvz.utils.useBundleAsset("actors","kapi/hero"+s,sp.SkeletonData,function(e){var t=cc.find("spine",p).getComponent(sp.Skeleton);t.skeletonData=e,t.setAnimation(0,"stand1",!0)}),p.active=!0}o.active=!0},initBy:function(e){var t=this;this.uiNode=e,this.top123Nodes.forEach(function(e){return e.active=!1}),this.rank1234Nodes.forEach(function(e){return e.active=!1}),this.emptyTip.active=!0,this.boxPopupRoot.active=!1,this.pageCount=0,cc.pvz.cloud.rankList(0,function(e,n){e&&n.length>0&&(n.forEach(function(e){t.fillRankNode(!1,e)}),t.pageCount=1,t.emptyTip.active=!1)}),this.updateMyRank()},updateMyRank:function(){var e=this;cc.pvz.cloud.myRank(function(t,n){t&&(-1!=n.rank&&n.rank<cc.tmpRank&&e.showRankUp(cc.tmpRank+1,n.rank+1),cc.tmpRank=n.rank,cc.tmpScore=n.info.score,e.fillRankNode(!0,n))})},showFinish:function(){this.uiNode.active=!1},onScrollEvent:function(e,t){var n=this;if(t!=cc.ScrollView.EventType.SCROLL_BEGAN){if(t==cc.ScrollView.EventType.SCROLL_TO_BOTTOM&&this.pageCount<5){if(this.isFetching)return;this.isFetching=!0,cc.pvz.cloud.rankList(20*this.pageCount,function(e,t){n.isFetching=!1,e&&t.length>0&&(t.forEach(function(e){n.fillRankNode(!1,e)}),n.pageCount++)})}}else this.hideBoxPopup()},showRankUp:function(e,t){var n=this;cc.pvz.utils.useBundleAsset("rank","RankUpEffect",cc.Prefab,function(c){var o=cc.instantiate(c);o.getComponent("UIRankUpEffect").initBy(e,t),o.parent=n.node})},onClickClose:function(){this.uiNode.active=!0,cc.popupManager.removePopup(this)},onClickAuthorize:function(){var e=this;cc.popupManager.popup("rank","shouquanUI","UIAuthorize",{ad:!1,scale:!1},function(t){t&&e.updateMyRank()})},onClickShare:function(){var e;e=cc.tmpRank>=0?"\u6211\u83b7\u5f97\u4e86\u7b2c"+(cc.tmpRank+1)+"\u540d\uff0c\u4f60\u4e5f\u6765\u8bd5\u8bd5\u5427":"\u65e0\u5c3d\u6392\u4f4d\u8d5b\uff0c\u4f60\u4e5f\u6765\u8bd5\u8bd5\u5427",cc.pvz.TAUtils.shareCurrent(e,function(){cc.popupManager.showToast("\u5206\u4eab\u6210\u529f")})},onClickBox:function(e,t){var n=parseInt(t),c=this.boxJsonFile.json.find(function(e){return e.ID==n});cc.find("num1",this.boxPopupRoot).getComponent(cc.Label).string="x"+c.reward[1],cc.find("num2",this.boxPopupRoot).getComponent(cc.Label).string="x"+c.reward[3];var o=e.target.convertToWorldSpaceAR(cc.Vec2.ZERO),i=this.boxPopupRoot.parent.convertToNodeSpaceAR(o);this.boxPopupRoot.position=i,this.boxPopupRoot.active=!0},onClickBg:function(){this.hideBoxPopup()},hideBoxPopup:function(){this.boxPopupRoot.active=!1},onClickUpload:function(){cc.pvz.cloud.uploadScore(13,function(){}),cc.pvz.cloud.myRank(function(){}),cc.pvz.cloud.rankList(0,function(){}),cc.pvz.cloud.rankList(20,function(){})}}),cc._RF.pop()},{}],UIRankReward:[function(e,t){"use strict";cc._RF.push(t,"833eet/5MNBR65qIt/ctXxr","UIRankReward"),cc.Class({extends:cc.Component,properties:{coinLabel:cc.Label,diamondLabel:cc.Label,rankLabel:cc.Label,boxJsonFile:cc.JsonAsset},initBy:function(e,t){var n=this.getBoxIDByRank(e),c=this.boxJsonFile.json.find(function(e){return e.ID==n});this.coinLabel.string="x"+c.reward[1],this.diamondLabel.string="x"+c.reward[3],this.rankLabel.string=e+1,cc.player.rankWeek=cc.pvz.utils.getStartOfWeek(),cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],c.reward[1]),cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],c.reward[3]),this.closeCb=t},getBoxIDByRank:function(e){for(var t=e+1,n=0;n<this.boxJsonFile.json.length;n++){var c=this.boxJsonFile.json[n];if(t>=c.rank1&&t<=c.rank2)return c.ID}return this.boxJsonFile.json[this.boxJsonFile.json.length-1].ID},onClickClose:function(){this.closeCb(),cc.popupManager.showEffectFly(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],cc.MainControl.getItemEffectPos(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"]),1),cc.popupManager.showEffectFly(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],cc.MainControl.getItemEffectPos(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"]),2),cc.MainControl.updateItemInfo(),cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIRankTip:[function(e,t){"use strict";cc._RF.push(t,"91286xsaANBJa1IVDzihybZ","UIRankTip"),cc.Class({extends:cc.Component,properties:{},onClickClose:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIRankUpEffect:[function(e,t){"use strict";cc._RF.push(t,"252e2aY3UFO9ZlBbrR+wKoE","UIRankUpEffect"),cc.Class({extends:cc.Component,properties:{fromLabel:cc.Label,toLabel:cc.Label},initBy:function(e,t){this.fromLabel.string=e,this.toLabel.string=t}}),cc._RF.pop()},{}],WxUserInfoBtn:[function(e,t){"use strict";cc._RF.push(t,"b3fc9ZlaY9N9ppUaExNv6GZ","WxUserInfoBtn"),cc.Class({extends:cc.Component,properties:{onTap:cc.Component.EventHandler},start:function(){cc.sys.platform==cc.sys.WECHAT_GAME&&this.createBtn()},createBtn:function(){var e=this;if(cc.sys.platform==cc.sys.WECHAT_GAME)if(this.wxBtn)this.setVisible(!0);else{var t;t=wx.getWindowInfo?wx.getWindowInfo():wx.getSystemInfoSync();var n=cc.view.getViewportRect(),c=this.node.getBoundingBoxToWorld(),o=cc.view.getScaleX();c.x+=n.x/o,c.y+=n.y/o;var i=cc.view.getDevicePixelRatio(),a=o/i,r=cc.view.getScaleY()/i,s={type:"text",text:"",style:{left:c.x*a,top:t.windowHeight-(c.y+c.height)*r,width:c.width*a,height:c.height*r,backgroundColor:"#80ff0000",withCredentials:!1}},p=wx.createUserInfoButton(s);this.onTap&&p.onTap(function(t){e.onTap.emit([t])}),this.wxBtn=p}else console.log("create wechat userinfo btn")},onDestroy:function(){this.wxBtn&&(this.wxBtn.destroy(),this.wxBtn=null)},setVisible:function(e){e?this.wxBtn?this.wxBtn.show():this.createBtn():this.wxBtn&&this.wxBtn.hide()}}),cc._RF.pop()},{}]},{},["UIAuthorize","UIRankEnd","UIRankList","UIRankReward","UIRankTip","UIRankUpEffect","WxUserInfoBtn"]);