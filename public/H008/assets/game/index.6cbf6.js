window.__require=function t(e,i,n){function o(c,a){if(!i[c]){if(!e[c]){var r=c.split("/");if(r=r[r.length-1],!e[r]){var h="function"==typeof __require&&__require;if(!a&&h)return h(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+c+"'")}c=r}var d=i[c]={exports:{}};e[c][0].call(d.exports,function(t){return o(e[c][1][t]||t)},d,d.exports,t,e,i,n)}return i[c].exports}for(var s="function"==typeof __require&&__require,c=0;c<n.length;c++)o(n[c]);return o}({BlockRoot:[function(t,e){"use strict";cc._RF.push(e,"d3155iemZ5AcLN3wHulrG+6","BlockRoot");var i=t("../../scripts/PrefabInfo"),n=t("./Block");cc.Class({extends:cc.Component,properties:{ui1:cc.Node,ui2:cc.Node,itemRootNode:cc.Node,blockPrefab:i,extendModeBg:cc.Node,boardsRoot:cc.Node,boardItemBgsRoot:cc.Node,boardItemsRoot:cc.Node,blockSpfs:[cc.SpriteFrame],stashEnable:!0,stashRoot:cc.Node,stashBlock:n,stashRectNode:cc.Node},onLoad:function(){this.itemRoot=this.itemRootNode.getComponent("ItemRoot")},onEvents:function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onClickBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onClickMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onClickEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onClickEnded,this)},offEvents:function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onClickBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onClickMoved,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onClickEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onClickEnded,this)},startLogic:function(){var t=this;this.datas=new Array(35).fill(-1),cc.pvz.runtimeData.blocks.forEach(function(e){t.datas[e]=0}),113==cc.pvz.runtimeData.actBuff2&&[0,1,3,4,5,9,25,29,30,31,33,34].forEach(function(e){t.datas[e]=1}),this.blocks=new Array(35).fill(null),this.poses=[],this.extendModeBg.children.map(function(t){return t}).forEach(function(e,i){if(1==t.datas[i])return t.poses.push(null),void(e.parent=null);var n=e.getComponent("Pos");n.setRoot(t),n.i=i,t.poses.push(n)}),this.toPutArr=[],this.createBlocks(),cc.pvz.runtimeData.items.forEach(function(e){var i=e.bs.map(function(e){return t.blocks[e]}),n=t.scene.newEquipItem(e.lv,e.id,i);n.node.parent=t.boardItemsRoot,n.setBgSpParent(!1)}),this.setExtendMode(!1),this.onEvents()},backFromGame:function(){this.poses.forEach(function(t){t&&t.setPreview(-1)}),this.blocks.forEach(function(t){t&&(t.setPreview(-1),t.item&&t.item.hideUnderBuffEffect())}),this.setExtendMode(!1)},onClickBegan:function(t){if(4!=cc.pvz.runtimeData.guide)if(this.dragBoard=!1,this.clickedItem=null,this.isExtendMode)this.onBoardClickBegan(t);else{var e=this.boardsRoot.convertToNodeSpaceAR(t.getLocation()),i=Math.floor(e.x/106+.5),n=5*Math.floor(-e.y/106+.5)+i;-1!=this.datas[n]&&this.blocks[n]&&this.blocks[n].item&&(this.clickedItem=this.blocks[n].item,this.clickedItem.pickupFromBoard(t.getLocation()))}else cc.guideManager.onStepFinished()},onClickMoved:function(t){this.dragBoard?this.onBoardClickMoved(t.getDelta()):this.clickedItem&&this.clickedItem.onClickMoved(t)},onClickEnded:function(t){this.dragBoard?this.onBoardClickEnded():this.clickedItem&&(this.clickedItem.onClickEnded(t),this.clickedItem=null)},onBoardClickBegan:function(t){var e=this,i=this.boardsRoot.convertToNodeSpaceAR(t.getLocation()),n=Math.floor(i.x/106+.5),o=5*Math.floor(-i.y/106+.5)+n;-1!=this.datas[o]?(this.dragBoard=!0,this.dragBoardMoved=cc.Vec2.ZERO,this.poses.forEach(function(t){t&&(t.node.active=!0)})):this.toPutArr.forEach(function(i){i.myBlocks.some(function(t){return t.i==o})&&(e.clickedItem=i,e.clickedItem.pickupFromBoard(t.getLocation()))})},onBoardClickMoved:function(t){var e=this;this.boardsRoot.position=this.boardsRoot.position.add(t),this.boardItemBgsRoot.position=this.boardItemsRoot.position.add(t),this.boardItemsRoot.position=this.boardItemsRoot.position.add(t),this.dragBoardMoved.addSelf(t),this.poses.forEach(function(t){t&&t.setPreview(-1)});var i=[],n=this.getBlocksToPut(i);i.forEach(function(t){e.poses[t]&&e.poses[t].setPreview(n?0:1)})},onBoardClickEnded:function(){var t=this,e=[],i=this.getBlocksToPut(e);if(e.forEach(function(e){t.poses[e].setPreview(-1)}),i){var n=Math.floor(this.dragBoardMoved.x/106+.5),o=Math.floor(-this.dragBoardMoved.y/106+.5),s=cc.v2(106*n,106*-o),c=5*o+n;this.datas.fill(-1),this.blocks.fill(null),e.forEach(function(e){t.datas[e]=0});var a=this.boardsRoot.children.map(function(t){return t});a.sort(function(t,e){return t.i-e.i}),a.forEach(function(e){e.position=e.position.add(s);var i=e.getComponent("Block");i.i+=c,t.blocks[i.i]=i}),this.boardItemBgsRoot.children.forEach(function(t){t.position=t.position.add(s)}),this.boardItemsRoot.children.forEach(function(t){t.position=t.position.add(s)})}this.dragBoard=!1,this.boardsRoot.position=cc.Vec2.ZERO,this.boardItemBgsRoot.position=cc.Vec2.ZERO,this.boardItemsRoot.position=cc.Vec2.ZERO,this.poses.forEach(function(e,i){e&&(e.node.active=-1==t.datas[i])})},onStashClickBegan:function(){this.dragBoard=!1,this.clickedItem=null},onStashClickMoved:function(t){this.dragBoard||this.clickedItem&&this.clickedItem.onClickMoved(t)},onStashClickEnded:function(t){this.dragBoard||this.clickedItem&&(this.clickedItem.onClickEnded(t),this.clickedItem=null)},findPosForBlock:function(t){for(var e=this,i=function(){var i=n%5,o=(n-i)/5,s=t.xys.map(function(t){return{x:Math.floor(i+t.x),y:Math.floor(o+t.y)}}),c=[],a=!0;if(s.forEach(function(t){var i=t.x,n=t.y;if(!(i<0||n<0||i>4||n>6)){var o=5*n+i;return e.blocks[o]?void(a=!1):(c.push(o),-1==e.datas[o])}a=!1}),a&&!s.every(function(t){return e.testCantPlace(5*t.y+t.x)}))return{v:c[0]}},n=0;n<35;n++){var o=i();if("object"==typeof o)return o.v}return-1},findBlockForItem:function(t){var e=this;if(0==t.id)return this.findPosForBlock(t);for(var i=function(){var i=n%5,o=(n-i)/5,s=[],c=!0;if(t.xys.forEach(function(t){var n=Math.floor(i+t.x),a=Math.floor(o+t.y);if(!(n<0||a<0||n>4||a>6)){var r=5*a+n;return e.blocks[r]?e.blocks[r].item?void(c=!1):(s.push(r),0==e.datas[r]):void(c=!1)}c=!1}),c)return{v:s[0]}},n=0;n<35;n++){var o=i();if("object"==typeof o)return o.v}return-1},testItem:function(t,e,i){var n=this;void 0===i&&(i=null);var o=[];this.blocks.forEach(function(t){t&&(t.setPreview(-1),t.item&&t.item.hideUnderBuffEffect())});var s=this.boardsRoot.convertToNodeSpaceAR(e),c=s.x/106+.5,a=-s.y/106+.5,r=!0;if(t.xys.forEach(function(t){var e=Math.floor(c+t.x),i=Math.floor(a+t.y);if(!(e<0||i<0||e>4||i>6)){var s=5*i+e;return n.blocks[s]?(o.push(s),0==n.datas[s]):void(r=!1)}r=!1}),o.forEach(function(t){i&&i.push(n.blocks[t]),n.blocks[t].setPreview(r?0:1)}),6==t.id){var h=Math.floor(c+t.xys[0].x),d=Math.floor(a+t.xys[0].y);this.getCrossItems(t.id,5*d+h,function(e){e.showUnderBuffEffect(t.id)})}return r},testBlock:function(t,e,i){var n=this;void 0===i&&(i=null);var o=this.extendModeBg.convertToNodeSpaceAR(e),s=o.x/106+.5,c=-o.y/106+.5,a=[],r=!0;return t.xys.forEach(function(t){var e=Math.floor(s+t.x),i=Math.floor(c+t.y);if(!(e<0||i<0||e>4||i>6)){var o=5*i+e;return n.poses[o]?n.blocks[o]?void(r=!1):(a.push(o),-1==n.datas[o]):void(r=!1)}r=!1}),this.poses.forEach(function(t){t&&t.setPreview(-1)}),a.forEach(function(t){i&&i.push(n.poses[t]),n.poses[t].setPreview(r?0:1)}),r},getBlocksToPut:function(t){var e=this,i=Math.floor(this.dragBoardMoved.x/106+.5),n=Math.floor(-this.dragBoardMoved.y/106+.5),o=!0;return this.datas.forEach(function(s,c){if(0==s){var a=c%5,r=a+i,h=(c-a)/5+n;if(r<0||h<0||r>4||h>6)o=!1;else{var d=5*h+r;e.poses[d]?e.hasTryPlace(d)?o=!1:t.push(d):o=!1}}}),o},debug:function(){this.blocks.forEach(function(t){t&&t.item&&t.item.myBlocks.every(function(e){return e.i!=t.i})&&cc.warn("sync 1")}),this.boardItemsRoot.children.forEach(function(t){var e=t.getComponent("Item");e.myBlocks.length!=e.xys.length&&cc.warn("sync 2"),e.myBlocks.some(function(t){return t.item!=e})&&cc.warn("sync 3");var i=t.x/106,n=t.y/106;console.log("("+i+","+n+")")})},getBlockPos:function(t){var e=t%5,i=(t-e)/5;return cc.v2(106*e,106*-i)},createBlock:function(t){var e=this.blockPrefab.addNode(this.getBlockPos(t)).getComponent("Block");e.setRoot(this),e.i=t,this.blocks[t]=e,this.poses[t].node.active=!1,this.poses[t].item=null},createBlocks:function(){var t=this;this.datas.forEach(function(e,i){0==e&&t.createBlock(i)})},setExtendMode:function(t){this.extendModeBg.active=t,this.ui1.active=!t,this.ui2.active=t,t&&(this.isExtendMode||(this.toPutArr.length=0)),this.isExtendMode=t},resetBlocksPreview:function(){this.blocks.forEach(function(t){t&&(t.setPreview(-1),t.item&&(t.item.hideUnderBuffEffect(),t.item.updateLv5Effect()))})},resetPosesPreview:function(){this.poses.forEach(function(t){t&&t.node.active&&t.setPreview(-1)})},tryPlace:function(t){-1==this.toPutArr.findIndex(function(e){return e==t})&&this.toPutArr.push(t)},undoTryPlace:function(t){var e=this.toPutArr.findIndex(function(e){return e==t});-1!=e&&this.toPutArr.splice(e,1)},hasTryPlace:function(t){return this.toPutArr.some(function(e){return e.myBlocks.some(function(e){return e.i==t})})},testCantPlace:function(t){var e=this,i=t%5,n=(t-i)/5;return[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0}].every(function(t){var o=t.x+i,s=t.y+n;if(o<0||s<0||o>4||s>6)return!0;var c=5*s+o;return-1==e.datas[c]})},onClickPlaceEnd:function(){var t=this,e=function(e){for(var i=0;i<e.length;i++){var n=e[i],o=n.myBlocks.map(function(t){return t.i});if(!o.every(function(e){return t.testCantPlace(e)}))return o.forEach(function(e){t.blocks[e]&&cc.warn("xxx"),t.datas[e]=0,t.createBlock(e)}),n.removeFromBlock(),n.node.parent=null,!0}return!1},i=[];do{i=this.toPutArr.map(function(t){return t})}while(e(i));i.forEach(function(t){t.removeFromBlock(),t.itemRoot.putdown(t,t.node.convertToWorldSpaceAR(cc.Vec2.ZERO))}),this.setExtendMode(!1),this.itemRoot.setCanDrag(!0)},getCrossItems:function(t,e,i){var n=this;if(6==t){var o=new Set,s=e%5,c=(e-s)/5;[[-1,0],[1,0],[0,-1],[0,1]].forEach(function(t){var e=s+t[0],i=c+t[1];if(!(e<0||i<0||e>4||i>6)){var a=5*i+e;n.blocks[a]&&n.blocks[a].item&&o.add(n.blocks[a].item)}}),o.forEach(function(t){i(t)})}},isFull:function(){return this.blocks.every(function(t){return null==t||null!=t.item})}}),cc._RF.pop()},{"../../scripts/PrefabInfo":void 0,"./Block":"Block"}],Block:[function(t,e){"use strict";cc._RF.push(e,"00faatx11FNLqqpay0AO1Mg","Block"),cc.Class({extends:cc.Component,properties:{iLabel:cc.Label},onLoad:function(){var t=cc.find("bg",this.node);this.bgSp=t?t.getComponent(cc.Sprite):null},setRoot:function(t){this.blockRoot=t},setPreview:function(t){this.bgSp.spriteFrame=this.blockRoot.blockSpfs[t+1],this.bgSp.node.active=-1!=t||!this.item},put:function(t){this.setPreview(-1),this.bgSp.node.active=!1,this.item&&cc.warn("1"),this.item=t},pick:function(){this.bgSp.node.active=!0,this.bgSp.node.opacity=125,this.item=null},update:function(){this.iLabel&&(this.iLabel.string=this.i)}}),cc._RF.pop()},{}],BuffItem:[function(t,e){"use strict";cc._RF.push(e,"57fc8765X5GFb+AjDK/zM1O","BuffItem"),cc.Class({extends:cc.Component,properties:{qualitySp:cc.Sprite,iconSp:cc.Sprite},initBuffItem:function(t,e,i){this.index=t,this.buffJson=e,this.callBack=i,cc.pvz.utils.setSpriteFrame(this.qualitySp,"uiImage","item/pz_"+this.buffJson.quality),cc.pvz.utils.setSpriteFrame(this.iconSp,"uiImage","skill/skill"+this.buffJson.icon)},onClickBuff:function(){var t=this.node.parent.parent.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(cc.v2()));this.callBack&&this.callBack(this.index,t,this.buffJson.desc)}}),cc._RF.pop()},{}],Bullet:[function(t,e){"use strict";cc._RF.push(e,"61c0c6w9SxHAaqoxrMyiAta","Bullet"),cc.Class({extends:cc.Component,properties:{sprite:cc.Sprite,spriteBundle:"",spritePath:"",spine:sp.Skeleton,spinePre:"",aoeHitEffect:!1,life:{default:-1,tooltip:"\u6beb\u79d2\uff0c-1\u4e3a\u51fa\u5c4f\u6d88\u5931"},dieOutScreen:!0,speed:500,buffSlow:!1,buffIce:!1,buffPoison:!1,dieKeepFrame:0,hitCount:{default:1,tooltip:"\u653b\u51fb\u6b21\u6570\uff0c\u9ed8\u8ba41\u6b21\u653b\u51fb\u540e\u6d88\u5931\uff0c\u586b2\u5c31\u7a7f\u900f1\u6b21"},hitChangeAngle:!1,jsEffExclusive:!1,canReturn:!1},initBy:function(t,e){this.scene=t,this.lv=e,this.dieTimer=-1,this.hitCounter=this.hitCount,this.lifeTimer=-1,this.canReturn&&(this.returnTimer=this.scene.setTimeout(this.doReturnLogic.bind(this),this.life),this.life+=this.life),this.life>0&&(this.lifeTimer=this.scene.setTimeout(this.onLifeEnd.bind(this),this.life))},moveByAngle:function(t){if(this.speed>0){var e=this.speed/60,i=t*Math.PI/180;this.moveDelta=cc.v2(e*Math.cos(i),e*Math.sin(i))}this.node.angle=t},doReturnLogic:function(){this.moveDelta=cc.v2(-this.moveDelta.x,-this.moveDelta.y)},onLifeEnd:function(){this.node.parent=null},onMoveEnded:function(){-1!=this.lifeTimer&&(this.scene.clearTimeout(this.lifeTimer),this.lifeTimer=-1),this.node.parent=null},update:function(){if(!this.scene.timePaused&&this.moveDelta){var t=this.moveDelta.mul(cc.director.getScheduler().getTimeScale());this.node.position=this.node.position.add(t)}},onHitEnemy:function(t){var e=this;if(this.hitCounter--,this.hitCounter<=0)t.enabled=!1,-1!=this.lifeTimer&&(this.scene.clearTimeout(this.lifeTimer),this.lifeTimer=-1),this.dieKeepFrame>0?-1==this.dieTimer&&(this.dieTimer=this.scene.setTimeout(function(){e.node.parent=null},1e3*this.dieKeepFrame/60)):this.node.parent=null;else if(this.hitChangeAngle){var i=this.scene.chooseEnemyByBullet(this);if(i){var n=this.node.position,o=i.node.position.add(cc.v2(0,i.centerY)).sub(n),s=Math.atan2(o.y,o.x);this.moveByAngle(180*s/Math.PI)}}},doCollisionLogic:function(t,e){if(1!=t.tag){var i=t.getComponent("Enemy");i&&i.hp>0&&i!=this.excludeEnemy&&(this.a.doBulletAttLogic(this,i),this.onHitEnemy(e))}else this.dieOutScreen&&this.onMoveEnded()},onCollisionEnter:function(t,e){e.enabled&&this.doCollisionLogic(t,e)},onRangePoisonEnter:function(t){var e=t.getComponent("Enemy");e&&e.hp>0&&e.addBuffPoison(this.a,5e3,this.att)},onAoeCollisionEnter:function(t){var e=t.getComponent("Enemy");e&&e.hp>0&&this.a.doBulletAttLogic(this,e)}}),cc._RF.pop()},{}],ColliderProxy:[function(t,e){"use strict";cc._RF.push(e,"741ceQCQalF7I4qJREFAbhj","ColliderProxy"),cc.Class({extends:cc.Component,properties:{onEnter:cc.Component.EventHandler,onStay:cc.Component.EventHandler,onExit:cc.Component.EventHandler},onCollisionEnter:function(t,e){this.onEnter&&this.onEnter.emit([t,e])},onCollisionStay:function(t,e){this.onStay&&this.onStay.emit([t,e])},onCollisionExit:function(t,e){this.onExit&&this.onExit.emit([t,e])}}),cc._RF.pop()},{}],Enemy12:[function(t,e){"use strict";cc._RF.push(e,"4a5346YF8NGpovlq5z/Ex8k","Enemy12");var i=t("./Enemy");cc.Class({extends:i,properties:{groundNode:cc.Node},initBy:function(t,e,n,o){i.prototype.initBy.call(this,t,e,n,o),this.groundNode.parent=this.scene.ground,this.groundNode.position=this.node.position},update:function(t){i.prototype.update.call(this,t),this.groundNode&&(this.groundNode.position=this.node.position)},hurtBy:function(t,e){this.hp<=0||(i.prototype.hurtBy.call(this,t,e),this.hp<=0&&this.groundNode&&(this.groundNode.parent=null,this.groundNode=null))}}),cc._RF.pop()},{"./Enemy":"Enemy"}],Enemy:[function(t,e){"use strict";cc._RF.push(e,"20a16L8s8pME6XnH8oWgU2f","Enemy");var i=cc.Class({name:"SubEnemyConfig",properties:{subNode:cc.Node,opAni:"qishen",hpRate:1,atkRate:1}});cc.Class({extends:cc.Component,properties:{spine:sp.Skeleton,spinePre:"",spineEx:"",showChuChang:!0,speed:{default:80,tooltip:"\u6bcf\u79d2\u79fb\u52a8\u8ddd\u79bb: y"},attRange:{default:100,tooltip:"\u653b\u51fb\u8ddd\u79bb: x"},attCD:{default:2e3,tooltip:"\u653b\u51fb\u95f4\u9694: \u6beb\u79d2"},centerY:50,exp:10,zdSpine:sp.Skeleton,zdIsIKMode:!1,subEnemys:[i],hpBarPos:cc.Vec2},onLoad:function(){this.moveSpeed=cc.v2(-this.speed,0),this.zdSpine&&(this.zdSpine.node.active=!1),this.subEnemys.forEach(function(t){return t.subNode.active=!1})},start:function(){},initBy:function(t,e,i,n){switch(this.scene=t,this.bulletsRoot=e,this.hp=this.maxHp=i,this.atk=n,this.hpBar=null,this.inBuff12=!1,this.slowTimer=-1,this.slowNode=null,this.poisonNode=null,this.poisonInfos=[],this.iceTimer=-1,this.iceNode1=null,this.iceNode2=null,this.weakTimer=-1,this.weakNode=null,this.attRangeRR=this.attRange*this.attRange,cc.pvz.runtimeData.actBuff2){case 104:case 105:case 106:this.attCD/=[1.3,1.4,1.5][cc.pvz.runtimeData.actBuff2-104]}this.showChuChang?this.setStatus(3):this.setStatus(0)},setAnimation:function(t,e,i,n){void 0===n&&(n=null);var o=this.spine.setAnimation(t,this.aniName(e),i);return n&&this.spine.setTrackCompleteListener(o,n),o},aniName:function(t){return this.spinePre+t+this.spineEx},getAtk:function(){return this.inBuff12?1.2*this.atk:this.atk},setStatus:function(t){var e=this;switch(t){case 3:this.setAnimation(0,"chuchang",!1,function(){e.setStatus(0),e.setAnimation(0,"walk",!0)}),this.node.zIndex=-this.node.y;break;case 0:this.moveSpeed=cc.v2(-this.speed,0),this.setAnimation(0,"walk",!0);break;case 1:var i=this.scene.chooseHero(this.node.position);if(i)if(this.target=i,this.checkInAttRange(i))this.setStatus(2),this.setAnimation(0,"stand",!0);else{var n;n=this.zdSpine?cc.v2(0,0):cc.v2(this.attRange+cc.math.randomRange(-20,0),cc.math.randomRange(-5,5));var o=i.node.position.add(n).sub(this.node.position),s=Math.atan2(o.y,o.x);this.moveSpeed=cc.v2(this.speed*Math.cos(s),this.speed*Math.sin(s))}else this.target=null,cc.pvz.TAUtils.track("error",{message:"Enemy",stack:"setStatus, id:"+this.id+",hp:"+this.hp+",hasEnded:"+this.scene.hasEnded+",enemyCount:"+this.scene.enemyCount+",heroCount:"+(this.scene.heroes?this.scene.heroes.length:0)});break;case 2:this.attTime=-1,this.spine.setEventListener(function(){e.zdSpine?e.zdIsIKMode?e.newBulletIKMode():e.newBullet():e.doAttLogic(e.target,0)})}this.status=t},newBulletIKMode:function(){var t=this,e=this.scene.chooseHero(this.node.position);if(e){var i=cc.instantiate(this.zdSpine.node);i.parent=this.scene.bulletsRoot,i.active=!0,this.GPBone||(this.GPBone=this.spine.findBone("GP")),i.position=this.node.position.add(cc.v2(this.GPBone.worldX,this.GPBone.worldY));var n=e.node.position.add(cc.v2(0,50)),o=i.getComponent(sp.Skeleton),s=o.findBone("zhadan");s.x=n.x-i.x,s.y=n.y-i.y,o.setAnimation(0,this.aniName("zd"),!0),o.setCompleteListener(function(){t.doAttLogic(e,1),i.position=n,o.setAnimation(0,t.aniName("bz"),!1),o.setCompleteListener(null)})}},newBullet:function(){var t=this,e=this.scene.chooseHero(this.node.position);if(e){var i=cc.instantiate(this.zdSpine.node);i.parent=this.scene.bulletsRoot,i.active=!0,this.GPBone||(this.GPBone=this.spine.findBone("GP")),i.position=this.node.position.add(cc.v2(this.GPBone.worldX,this.GPBone.worldY));var n=e.node.position.add(cc.v2(0,50)).sub(i.position),o=n.len()/800;i.angle=180*Math.atan2(n.y,n.x)/Math.PI+180,i.runAction(cc.sequence(cc.moveBy(o,n),cc.callFunc(function(){t.doAttLogic(e,1),s.setAnimation(0,t.aniName("zd2"),!1),s.setCompleteListener(function(){i.parent=null,s.setCompleteListener(null)})})));var s=i.getComponent(sp.Skeleton);s.setAnimation(0,this.aniName("zd1"),!0),s.setCompleteListener(null)}},repulse:function(t){var e=this;if(!(this.hp<=0||this.id>=100)){var i=this.node.position.sub(t),n=Math.atan2(i.y,i.x),o=cc.v2(10*Math.cos(n),10*Math.sin(n));o.x<0&&(o.x=0);var s=cc.v2(Math.max(this.node.x+o.x,this.scene.groundAreaLB.x),cc.math.clamp(this.node.y+o.y,this.scene.groundAreaLB.y,this.scene.groundAreaTR.y));this.node.x<=this.scene.groundAreaTR.x&&s.x>this.scene.groundAreaTR.x&&(s.x=this.scene.groundAreaTR.x),this.enabled=!1,this.node.runAction(cc.sequence(cc.moveTo(.1,s),cc.callFunc(function(){e.hp>0&&(e.enabled=!0,e.setStatus(0))})))}},update:function(t){if(!this.scene.timePaused&&!(this.scene.hasEnded||this.hp<=0)){var e=t*cc.director.getScheduler().getTimeScale()*this.spine.timeScale,i=cc.pvz.runtimeData.getBuffValue(4);switch(i>0&&(e*=1-.01*i),cc.pvz.runtimeData.actBuff2){case 110:case 111:case 112:e*=[1.2,1.3,1.4][cc.pvz.runtimeData.actBuff2-110]}this.doLogic(e),this.hpBar&&(this.hpBar.node.position=this.node.position)}},checkInAttRange:function(t){var e=t.position2||t.node.position;return this.zdSpine?this.node.position.sub(e).lengthSqr()<this.attRangeRR:this.node.x-e.x<=this.attRange},doAttLogic:function(t,e){var i=this.getAtk();0==e&&cc.pvz.runtimeData.hasEnableBuff(1103)&&Math.random()<.2&&(i*=.5),1==e&&cc.pvz.runtimeData.hasEnableBuff(1104)&&Math.random()<.2&&(i*=.5),i*=cc.math.randomRange(.95,1.05),this.scene.showHeroHurtNum(t.node.position,i),t.hurtBy(this,e,i)},doLogic:function(t){var e=this;switch(this.status){case 0:this.node.position=this.node.position.add(this.moveSpeed.mul(t)),this.node.zIndex=-this.node.y,this.node.x<250&&this.setStatus(1);break;case 1:this.target&&this.target.hp>0?(this.node.position=this.node.position.add(this.moveSpeed.mul(t)),this.node.zIndex=-this.node.y,this.checkInAttRange(this.target)&&(this.setStatus(2),this.setAnimation(0,"stand",!0))):(this.setStatus(1),this.setAnimation(0,"walk",!0));break;case 2:cc.pvz.time>this.attTime&&(this.setAnimation(0,"attack",!1,function(){!e.target||e.target.hp<=0?(e.setStatus(1),e.target&&1==e.status?e.setAnimation(0,"walk",!0):e.setAnimation(0,"stand",!0)):e.setAnimation(0,"stand",!0)}),this.attTime=cc.pvz.time+this.attCD)}},doDieLogic:function(){var t=this;-1!=this.slowTimer&&(this.slowNode.parent=null,this.slowNode=null,this.scene.clearTimeout(this.slowTimer),this.slowTimer=-1),this.poisonNode&&(this.poisonNode.parent=null,this.poisonNode=null),this.poisonInfos.forEach(function(e){t.scene.clearInterval(e.t1),t.scene.clearTimeout(e.timer)}),this.poisonInfos.length=0,-1!=this.iceTimer&&(this.iceNode1.parent=null,this.iceNode1=null,this.iceNode2.parent=null,this.iceNode2=null,this.scene.clearTimeout(this.iceTimer),this.iceTimer=-1),-1!=this.weakTimer&&(this.weakNode.parent=null,this.weakNode=null,this.scene.clearTimeout(this.weakTimer),this.weakTimer=-1),this.hpBar&&(this.hpBar.node.parent=null,this.hpBar=null),this.subEnemys.forEach(function(e){var i=t.node.position.add(e.subNode.position);e.subNode.active=!0,t.scene.addEnemyIn(-1,e.subNode,i.x,i.y,t.maxHp*e.hpRate,Math.max(1,t.atk*e.atkRate))}),this.scene.enemyCount+=this.subEnemys.length,this.scene.delEnemy(this)},hurtBy:function(t,e){var i=this;this.hp<=0||(this.hp-=e,this.hp<=0?(-1!=this.iceTimer&&(this.scene.clearTimeout(this.iceTimer),this.removeIceBuff()),this.setAnimation(0,"die",!1,function(){i.doDieLogic()}),this.scene.eDiePrefab.addNode(this.node.position).getComponent(sp.Skeleton).setAnimation(0,this.id>99?"die_BOSS":"die"+cc.math.randomRangeInt(1,4),!1)):(this.scene.addEnemyHpBar(this),this.hpBar&&(this.hpBar.progress=this.hp/this.maxHp),this.setAnimation(1,"hit",!1)))},onBuffCollisionEnter:function(t){1!=t.tag&&(t.getComponent("Enemy").inBuff12=!0)},onBuffCollisionExit:function(t){1!=t.tag&&(t.getComponent("Enemy").inBuff12=!1)},addBuffSlow:function(){var t=this;-1==this.slowTimer&&(this.slowNode=this.scene.eSlowPrefab.addNodeTo(this.node,cc.Vec2.ZERO),this.slowNode.zIndex=cc.macro.MIN_ZINDEX),this.spine.timeScale=.75,this.slowTimer=this.scene.setTimeout(function(){t.spine.timeScale=1,t.slowNode.parent=null,t.slowNode=null,t.slowTimer=-1},5e3,this.slowTimer)},addBuffPoison:function(t,e,i){var n=this,o=this.poisonInfos.find(function(e){return e.a==t});if(!o){this.poisonNode||(this.poisonNode=this.scene.ePoisonPrefab.addNodeTo(this.node,cc.Vec2.ZERO));var s=.1*i;(o={a:t}).t1=this.scene.setInterval(function(){n.hurtBy(t,s),n.scene.showEnemyHurtNum(0,n.node.position,s)},1e3),this.poisonInfos.push(o)}o.timer=this.scene.setTimeout(function(){var e=n.poisonInfos.findIndex(function(e){return e.a==t});n.scene.clearInterval(n.poisonInfos[e].t1),n.poisonInfos.splice(e,1),0==n.poisonInfos.length&&(n.poisonNode.parent=null,n.poisonNode=null)},e,o.timer)},addBuffIce:function(){if(!(this.hp<=0)){if(-1==this.iceTimer){this.iceNode1=this.scene.eIcePrefab.addNodeTo(this.node,this.hpBarPos);var t=this.iceNode1.children[0].getComponent(sp.Skeleton);t.setAnimation(0,"stun",!0),t.setCompleteListener(null),this.iceNode1.zIndex=cc.macro.MAX_ZINDEX}this.spine.paused=!0,this.enabled=!1,this.iceTimer=this.scene.setTimeout(this.removeIceBuff.bind(this),3e3,this.iceTimer)}},removeIceBuff:function(){this.spine.paused=!1,this.enabled=!0,this.iceNode1.parent=null,this.iceNode1=null,this.iceTimer=-1},addBuffWeak:function(){var t=this;-1==this.weakTimer&&(this.weakNode=this.scene.eWeakPrefab.addNodeTo(this.node,cc.Vec2.ZERO)),this.weakTimer=this.scene.setTimeout(function(){t.weakNode.parent=null,t.weakNode=null,t.weakTimer=-1},3e3,this.weakTimer)}}),cc._RF.pop()},{}],EventCollider:[function(t,e){"use strict";cc._RF.push(e,"9db9bEvNslK+4vmMmw/JrC8","EventCollider"),cc.Class({extends:cc.Component,properties:{spine:sp.Skeleton,event:"fire",collider:cc.Collider},onLoad:function(){var t=this;this.collider.enabled=!1,this.spine.setEventListener(function(e,i){i.data.name==t.event&&cc.pvz.utils.manuallyCheckCollider(t.collider)})}}),cc._RF.pop()},{}],GameHub:[function(t,e){"use strict";cc._RF.push(e,"2c42cev+JZCEbLE3R/JF/EL","GameHub");var i=t("../../scripts/PrefabInfo");cc.Class({extends:cc.Component,properties:{bagRoot:cc.Node,gameRoot:cc.Node,ani:cc.Animation,actBuffPanel:cc.Node,moneyLabel:cc.Label,waveLabel:cc.Label,lvLabel:cc.Label,expBar:cc.ProgressBar,lvupEffect:i,lvupAudio:cc.AudioClip,levelsJsonFile:cc.JsonAsset,lvupJsonFile:cc.JsonAsset},onLoad:function(){this.bagRoot.active=!0,this.bag=this.bagRoot.getComponent("game1"),this.gameRoot.active=!1,this.game=this.gameRoot.getComponent("game"),this.game.enabled=!1,this.bag.hub=this,this.bag.game=this.game,this.game.hub=this,this.game.bag=this.bag},start:function(){this.actBuffPanel.active=1==cc.pvz.runtimeData.mode,this.actBuffPanel.active&&this.actBuffPanel.getComponent("ActBuffPanel").initActBuffInfo();var t=null;switch(cc.pvz.runtimeData.mode){case 0:t=this.levelsJsonFile.json[cc.pvz.runtimeData.level-1];break;case 1:t=cc.JsonControl.ActLevelJson[cc.pvz.runtimeData.level-1];break;case 2:t=cc.JsonControl.rankLevelJsonFile.json[0]}this.levelData=t,this.updateLevel(),this.updateExp(),this.updateMoney(),cc.butler.node.on("money",this.onGetMoney,this)},onPopup1st:function(){this.bag.onPopup1st&&this.bag.onPopup1st(),this.game.onPopup1st&&this.game.onPopup1st()},onAllClosed:function(){this.bag.onAllClosed&&this.bag.onAllClosed(),this.game.onAllClosed&&this.game.onAllClosed()},onGetMoney:function(){this.updateMoney()},updateLevel:function(){2==cc.pvz.runtimeData.mode?this.waveLabel.string="\u7b2c"+(cc.pvz.runtimeData.wave+1)+"\u6ce2":(this.waveLabel.node.active=this.levelData.wave>0,this.waveLabel.node.active&&(this.waveLabel.string="\u7b2c"+(cc.pvz.runtimeData.wave+1)+"/"+this.levelData.wave+"\u6ce2"))},updateMoney:function(){this.moneyLabel.string=cc.pvz.runtimeData.money},updateExp:function(){var t=this.lvupJsonFile.json[cc.pvz.runtimeData.lv].exp;this.lvLabel.string=cc.pvz.runtimeData.lv+1,this.expBar.progress=cc.pvz.runtimeData.exp/t},showLvupEffect:function(t){this.lvupEffect.addNodeByWorldPos(t),cc.butler.playEffect(this.lvupAudio)},onClickStart:function(){var t=this;this.bag.checkStartGame(this.onClickStart)&&(this.ani.play("bag-to-game").wrapMode=cc.WrapMode.Normal,this.ani.once("finished",function(){t.game.cbs=[],t.bag.onClickStart(t.game),t.game.startLogic(t.bag)}))},backToBag:function(){var t=this;this.game.onBackFromGame(),this.bag.onBackFromGame(),this.updateLevel(),this.ani.play("bag-to-game").wrapMode=cc.WrapMode.Reverse,this.ani.once("finished",function(){cc.pvz.runtimeData.autoTimes>0&&(cc.pvz.runtimeData.autoTimes--,t.bag.doRefreshLogic(!0),t.bag.saveRuntimeData())})},onClickPause:function(){cc.popupManager.popup("game","fightset","UIGamePause",{scale:!1})}}),cc._RF.pop()},{"../../scripts/PrefabInfo":void 0}],Hero:[function(t,e){"use strict";cc._RF.push(e,"c10aaYp4v9JQa5O0YxpAt/C","Hero");var i=t("./Bullet");cc.Class({extends:cc.Component,properties:{spine:sp.Skeleton,zd:i,zd2:i,landMineNode:cc.Node},onLoad:function(){this.zd&&(this.zd.node.active=!1),this.zd2&&(this.zd2.node.active=!1),this.landMineNode&&(this.landMineNode.active=!1)},start:function(){},initBy:function(t,e,i){var n=this;this.scene=t,this.info=i,this.item=e,this.spine=this.item.spine;var o=this.info.json.range;this.atkRR=o*o,this.lvs=[],this.hp=this.item.maxHp,this.shieldValue=0,this.hasDie=!1,this.setAnimation(0,"stand",!0,null),this.isPhy=!0,this.isMagic=!0,this.is3gz=[2,5,9,10].some(function(t){return t==n.item.id}),this.is2gz=[2,4,8].some(function(t){return t==n.item.id}),cc.butler.node.on("lvup",this.onLvup,this)},onLvup:function(t){this.item.index==t&&(this.item.lvup(!1),this.scene.hub.showLvupEffect(this.node.convertToWorldSpaceAR(cc.Vec2.ZERO)))},setAnimation:function(t,e,i,n){this.spine.setAnimation(t,e+(this.item.lv+1),i),this.spine.setCompleteListener(n)},getAtk:function(t){var e=Math.min(this.info.lv1,this.info.json.attribute2.length-1),i=this.info.json.attribute2[e];t>0&&(i*=this.info.json.fightlvup2[t-1]/100);var n=cc.pvz.runtimeData.getBuffValue(2),o=cc.pvz.runtimeData.getBuffValue(10);return o>0&&(n+=o*cc.pvz.runtimeData.items.length),n>0&&(i*=1+.01*n),i},getShield:function(t){var e=Math.min(this.info.lv1,this.info.json.attribute2.length-1),i=this.info.json.attribute2[e];return t>0&&(i*=this.info.json.fightlvup2[t-1]/100),i},pushLvAndAtk:function(t){var e=this.getAtk(t.lv);this.lvs.push({lv:t.lv,atk:e})},playAttAndDo:function(t,e){var i=this;this.setAnimation(0,"attack",!1,function(){i.item.checkToStartReloadTimer(),i.setAnimation(0,"stand",!0,null),e&&e()}),this.spine.setEventListener(function(){t&&t()})},playSound:function(){switch(this.info.id){case 3:case 12:break;case 6:cc.butler.playEffectAsync("game","sound/dun");break;case 8:cc.butler.playEffectAsync("game","sound/hp");break;case 9:cc.butler.playEffectAsync("game","sound/jiguang");break;case 10:cc.butler.playEffectAsync("game","sound/getSunShine");break;default:cc.butler.playEffectAsync("game","sound/shoot")}},tryShoot:function(t,e){var i=this;switch(this.info.id){case 3:return this.playAttAndDo(function(){var t=Math.floor(i.getAtk(i.item.lv));i.checkBuff(302)&&(t+=1),i.checkBuff(304)&&Math.random()<.25&&(t*=2),cc.pvz.runtimeData.addMoney(t),i.scene.showBuffEffect("money",i.node.position,i.scene.getMoneyWPos())}),!0;case 6:return this.playAttAndDo(function(){var t=i.getAtk(i.item.lv)/100,e=0;cc.pvz.runtimeData.hasEnableBuff(601)&&(e=.15),cc.pvz.runtimeData.hasEnableBuff(602)&&(e+=.3),e>0&&(t*=1+e),i.item.crossItems.forEach(function(e){e.hero&&e.hero.hp>0&&(e.hero.addShield(e.maxHp*t),i.scene.showBuffEffect("shield",e.hero.node.position))})}),!0;case 8:var n=this.scene.chooseMinHpHero();return!!n&&(this.playAttAndDo(function(){var t=i.getAtk(i.item.lv);i.checkBuff(802)&&(t*=1.2),n.addHp(t),i.scene.showBuffEffect("HP",n.node.position)}),!0);case 10:return this.playAttAndDo(function(){var t=i.getAtk(i.item.lv),e=0;cc.pvz.runtimeData.hasEnableBuff(1001)&&(e=.1),cc.pvz.runtimeData.hasEnableBuff(1002)&&(e+=.2),e>0&&(t*=1+e),i.scene.showBuffEffect("music",i.node.position.add(cc.v2(0,50)),i.scene.getAngerBarWPos(),function(){cc.pvz.runtimeData.anger+=t,i.scene.updateAnger()})}),!0;case 11:return this.playAttAndDo(function(){var t=1;cc.pvz.runtimeData.hasEnableBuff(1104)&&(i.lastBulletCount&&(t=1==i.lastBulletCount?2:1),i.lastBulletCount=t);for(var e=function(){var t=cc.instantiate(i.landMineNode),e=cc.v2(i.scene.getHeroesMaxMarginX()+cc.math.randomRange(0,150),cc.math.randomRange(i.scene.groundAreaLB.y+120,i.scene.groundAreaTR.y-120));t.position=i.node.position,t.active=!0,t.parent=i.scene.objsRoot,t.zIndex=-t.y;var n=t.getComponent(cc.Collider);n.enabled=!1;var o=t.getComponent(sp.Skeleton),s=o.findBone("IK");s.x=(e.x-t.x)/t.scale,s.y=(e.y-t.y)/t.scale,s.x=Math.max(0,s.x),o.setAnimation(0,"zd11_1",!0),o.setCompleteListener(function(){t.position=e,n.enabled=!0,o.setAnimation(0,"zd11_2",!1),o.setCompleteListener(null)})},n=0;n<t;n++)e()}),!0;case 12:var o=this.checkBuff(1204)?2:1,s=this.scene.chooseEnemys(this,this.atkRR,o);if(0==s.length)return!1;var c=this.scene.getHeroesMaxMarginX(),a=0;return this.playAttAndDo(function(){if(1!=a||i.checkBuff(1204)){var t=s[Math.min(s.length-1,a)],e=t.node.position.add(cc.v2(0,t.centerY)),n=cc.v2(Math.min(c,e.x),e.y),o=i.scene.objsRoot.convertToWorldSpaceAR(n),r=cc.instantiate(i.zd.node),h=r.getComponent("Bullet");r.parent=i.scene.bulletsRoot,r.active=!0,r.position=i.node.position,h.spine.setAnimation(0,h.spine.defaultAnimation,!0);var d=h.spine.findBone("IK"),u=h.spine.node.convertToNodeSpaceAR(o);d.x=u.x,d.y=u.y,h.initBy(i.scene,i.item.lv),h.a=i,h.att=i.getAtk(i.item.lv);for(var p=function(t){i.scene.setTimeout(function(){i.scene.showJsEffect(cc.v2(n.x+100*t,n.y),i.info.id)},48*t)},l=1;l<5;l++)p(l);cc.butler.playEffectAsync("game","sound/gunzi"),a++}}),!0}var r=e||this.scene.chooseEnemy(this,this.atkRR);return!!r&&(this.pushLvAndAtk(t),!this.isAttacking&&(this.isAttacking=!0,this.playAttAndDo(function(){r.isValid&&(i.isAttacking=!1,i.checkToShoot(r))},function(){i.item.bulletCount<=0&&cc.tween(i.IKBone).to(.064,{x:150,y:50}).start()}),this.IKBone||(this.IKBone=this.spine.findBone("IK")),cc.tween(this.IKBone).to(.064,{x:(r.node.x-this.node.x)/.76,y:(r.node.y+r.centerY-this.node.y)/.76}).start(),!0))},checkToShoot:function(t){if(0!=this.lvs.length){if(this.zd){var e=this.lvs.shift(),i=t||this.scene.chooseEnemy(this,this.atkRR);i&&this.shoot(i,this.item.lv,e.atk)}this.lvs.length>0&&this.scene.setTimeout(this.checkToShoot.bind(this),80)}},getShootAPos:function(){this.GPBone||(this.GPBone=this.spine.findBone("GP"));var t=cc.v2(this.GPBone.worldX,this.GPBone.worldY);return this.spine.node.convertToWorldSpaceAR(t)},shoot:function(t,e,i){var n;return 4==this.info.id?(n=this.checkBuff(401)?9:5,this.shootN(n,t,e,i)):this.checkBuff(904)?this.shootN(3,t,e,i):7==this.info.id?this.shootIK(t,e,i):void this.shoot1(t,e,i)},shoot1:function(t,e,i){var n=this.getShootAPos(),o=this.scene.bulletsRoot.convertToNodeSpaceAR(n),s=t.node.position.add(cc.v2(0,t.centerY)).sub(o);s.x<0&&(s.x=0);var c=Math.atan2(s.y,s.x),a=this.zd,r=cc.instantiate(a.node);r.parent=this.scene.bulletsRoot,r.active=!0,r.position=o;var h=r.getComponent("Bullet");this.checkBuff(104)&&(h.hitCount=2),this.checkBuff(503)&&(h.hitCount=2),h.initBy(this.scene,e),h.a=this,13==this.info.id&&2==cc.pvz.runtimeData.mode?h.att=i/2:h.att=i,h.moveByAngle(180*c/Math.PI)},shootN:function(t,e,i,n){var o=this.getShootAPos(),s=this.scene.bulletsRoot.convertToNodeSpaceAR(o),c=e.node.position.add(cc.v2(0,e.centerY)).sub(s);c.x<0&&(c.x=0);var a,r=180*Math.atan2(c.y,c.x)/Math.PI;a=t>5?[0,-10,-20,-30,40,10,20,30,40]:[0,-15,15,-30,30];for(var h=0;h<t;h++){var d=cc.instantiate(this.zd.node);d.parent=this.scene.bulletsRoot,d.active=!0,d.position=s;var u=d.getComponent("Bullet");u.initBy(this.scene,i),u.a=this,u.att=n,u.moveByAngle(r+a[h])}},shootIK:function(t,e,i){var n=this,o=this.getShootAPos(),s=this.scene.bulletsRoot.convertToNodeSpaceAR(o),c=t.node.convertToWorldSpaceAR(cc.v2(0,t.centerY)),a=cc.instantiate(this.zd.node),r=a.getComponent("Bullet");a.parent=this.scene.bulletsRoot,a.active=!0,a.position=s,this.checkBuff(702)&&(a.getComponent("EventCollider").collider.radius*=1.3);var h=r.spine.setAnimation(0,r.spine.defaultAnimation,!0);r.spine.setTrackEventListener(h,function(){n.scene.showJsEffect(t.node.position,n.info.id)});var d=r.spine.findBone("IK"),u=r.spine.node.convertToNodeSpaceAR(c);d.x=u.x,d.y=u.y,d.x=Math.max(0,d.x),r.initBy(this.scene,e),r.a=this,r.att=i},checkHeroBuff:function(){return!1},checkBuff:function(t){var e=(t-t%100)/100;return this.info.id==e&&cc.pvz.runtimeData.hasEnableBuff(t)},doBulletAttLogic:function(t,e){var i=t.att;switch(this.checkBuff(101)&&(i*=1.25),this.checkBuff(201)&&(i*=1.25),this.checkBuff(504)&&(i*=1.5),this.checkBuff(701)&&(i*=1.25),this.checkBuff(901)&&(i*=1.25),this.checkBuff(1101)&&(i*=1.25),this.checkBuff(1201)&&(i*=1.25),e.weakNode&&this.isPhy&&(i*=1.2),cc.pvz.runtimeData.actBuff1){case 1:case 2:case 3:this.isPhy&&(i*=[1.3,1.4,1.5][cc.pvz.runtimeData.actBuff1-1]);break;case 4:case 5:case 6:this.is3gz&&(i*=[1.3,1.4,1.5][cc.pvz.runtimeData.actBuff1-4]);break;case 10:case 11:case 12:this.is2gz&&(i*=[1.3,1.4,1.5][cc.pvz.runtimeData.actBuff1-10])}var n=0;this.checkCrit(t,e)&&(n=1,i*=this.getCritPlus(t,e)),i*=cc.math.randomRange(.95,1.05),e.hurtBy(this,i),this.scene.showEnemyHurtNum(n,e.node.position,i),t.jsEffExclusive||this.scene.showJsEffect(e.node.position,this.info.id),cc.pvz.runtimeData.stats[this.info.id]+=i,t.buffSlow&&e.addBuffSlow(),t.buffIce&&this.checkBuff(1203)&&Math.random()<.2&&e.addBuffIce(),this.checkBuff(704)&&Math.random()<.5&&e.addBuffWeak(),this.checkBuff(204)&&e.repulse(this.node.position),this.checkBuff(403)&&e.repulse(this.node.position),this.checkBuff(1102)&&e.repulse(this.node.position)},checkCrit:function(){var t;if(this.checkBuff(501)&&(this.attCounter?this.attCounter=this.attCounter+1:this.attCounter=1,t=this.checkBuff(502)?2:3,this.attCounter>=t))return this.attCounter=0,!0;var e=0;return this.checkBuff(102)&&(e+=.25),this.checkBuff(404)&&(e+=.25),this.checkBuff(903)&&(e+=.1),Math.random()<e},getCritPlus:function(){var t=1.5;return this.checkBuff(103)&&(t+=.5),t},doLandMinesLogic:function(t){var e=t.getComponent("Enemy");e&&e.hp>0&&this.doBulletAttLogic({att:this.getAtk(this.item.lv),lv:this.item.lv,jsEffExclusive:!0},e)},onLandminesCollision:function(t,e){if(e.enabled){var i=t.getComponent("Enemy");if(i&&i.hp>0){e.enabled=!1;var n=e.node.getComponent(sp.Skeleton),o=cc.find("range",e.node).getComponent(cc.Collider);cc.pvz.utils.manuallyCheckCollider(o),this.scene.showJsEffect(e.node.position,this.info.id),n.node.destroy()}}},addHp:function(t){this.hp=Math.min(this.item.maxHp,this.hp+t),this.item.updateHp(this.hp/this.item.maxHp),this.scene.updateHp(!0)},delHp:function(t){this.hp=Math.max(0,this.hp-t),this.item.updateHp(this.hp/this.item.maxHp),this.scene.updateHp(!0)},addShield:function(t){this.shieldValue=Math.min(this.item.maxHp,this.shieldValue+t),this.item.updateShield(this.shieldValue/this.item.maxHp),this.scene.updateShield()},hurtBy:function(t,e,i){var n=this;if(!(this.hasEnded||this.hp<=0)){if(this.shieldValue>0){var o=Math.min(this.shieldValue,i);i-=o,this.shieldValue-=o,this.item.updateShield(this.shieldValue/this.item.maxHp)}if(i>0&&(this.delHp(i),this.hp<=0)){var s=!cc.pvz.runtimeData.hasUseReborn&&(8==this.info.id||this.scene.hasHero(8))&&cc.pvz.runtimeData.hasEnableBuff(803);s?cc.pvz.runtimeData.hasUseReborn=!0:this.item.barNode.active=!1,this.setAnimation(0,"die",!1,function(){s?(n.reborn(cc.pvz.runtimeData.hasEnableBuff(804)?1:.3),n.showBuffEffect("revive",!1)):(n.hasDie=!0,n.scene.checkIsFail(),n.spine.setCompleteListener(null))})}}},reborn:function(t){var e=this;this.setAnimation(0,"fuhuo",!1,function(){e.hp=e.item.maxHp*t,e.item.updateHp(),e.hasDie=!1,e.setAnimation(0,"stand",!0,null)})},showBuffEffect:function(t,e){void 0===e&&(e=!1),e?this.scene.addBuffPrefab.addNodeTo(this.item.spine.node,cc.Vec2.ZERO).getComponent(sp.Skeleton).setAnimation(0,t,!1):this.scene.showBuffEffect(t,this.node.position)}}),cc._RF.pop()},{"./Bullet":"Bullet"}],ItemRoot:[function(t,e){"use strict";cc._RF.push(e,"b30f2pf6gZJBa/s5d8JifOH","ItemRoot");var i=t("../../scripts/PrefabInfo");cc.Class({extends:cc.Component,properties:{dragingRoot:cc.Node,blockRootNode:cc.Node,blockItemsRootNode:cc.Node,buffEffect:i,barPrefab:i,linePrefab:i},onLoad:function(){this.blockRoot=this.blockRootNode.getComponent("BlockRoot"),this.blockItemsRootNode.zIndex=cc.macro.MAX_ZINDEX-1},layoutChildren:function(){var t=this.node.getComponent(cc.Layout);if(t.spacingX=-1,this.node.childrenCount>1){var e=this.node.children.reduce(function(t,e){return t+e.width},0);if(e>720){var i=Math.max(.8,720/e);this.node.children.forEach(function(t){return t.scale=i}),t.spacingX=0}else t.spacingX=Math.min(30,(720-e)/(this.node.childrenCount-1))}else t.spacingX=15;t.updateLayout()},setCanDrag:function(t){this.node.children.forEach(function(e){var i=e.getComponent("Item");i&&0!=i.id&&i.setCanDrag(t)}),this.blockItemsRootNode.children.forEach(function(e){var i=e.getComponent("Item");i&&0!=i.id&&i.setCanDrag(t)})},pickupFromBoard:function(t,e){var i=this.dragingRoot,n=i.convertToNodeSpaceAR(e);t.node.position=n,t.node.angle=0,t.node.parent=i,cc.Tween.stopAllByTarget(t.node),t.initSameIDLvLine()},pickup:function(t,e){var i=this.dragingRoot,n=i.convertToNodeSpaceAR(e);t.node.position=n,t.node.angle=0,t.node.parent=i,t.node.scale=1,cc.Tween.stopAllByTarget(t.node);var o=0==t.id;this.blockRoot.setExtendMode(o),o&&this.setCanDrag(!1)},putdown:function(t,e){var i=this.node.convertToNodeSpaceAR(e);if(t.setBgSpParent(!0),t.canUse&&0!=t.id&&t.lv<3&&i.y<100)for(var n=0;n<this.node.childrenCount;n++){var o=this.node.children[n];if(i.x>o.x-o.width/2&&i.x<o.x+o.width/2){var s=o.getComponent("Item");if(s.canUse&&s.id==t.id&&s.lv==t.lv)return t.node.parent=null,this.layoutChildren(),void s.lvup()}}t.node.parent=this.node,t.node.position=i,t.setSelfListenEvent(!0);var c=this.node.children.findIndex(function(e){return e.x>t.node.x});c=-1==c?this.node.childrenCount:c;for(var a=0;a<c;a++)this.node.children[a].zIndex=-1;for(var r=c;r<this.node.childrenCount;r++)this.node.children[r].zIndex=1;t.node.zIndex=0,this.node.sortAllChildren(),this.layoutChildren(),cc.tween(t.node).to(.16,{y:0}).start()}}),cc._RF.pop()},{"../../scripts/PrefabInfo":void 0}],Item:[function(t,e){"use strict";cc._RF.push(e,"19e1fvPWshIYLVJzpb6WDTc","Item");var i=["bai_","lv_","lan_","zi_","cheng_"];cc.Class({extends:cc.Component,properties:{xys:[cc.Vec2],offset:cc.Vec2,id:1,id0Type:0,lv:0,lvSp:cc.Sprite,bgSp:cc.Sprite,hasAd:!1,adAni:"",adSupOffset:cc.Vec2,spine:sp.Skeleton,righMargin:53,barPos:{default:cc.v2(0,120)},attOffset:cc.Vec2},onLoad:function(){this.enabled=!1},setSelfListenEvent:function(t){t?(this.node.on(cc.Node.EventType.TOUCH_START,this.onClickBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onClickMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onClickEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onClickEnded,this)):(this.node.off(cc.Node.EventType.TOUCH_START,this.onClickBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onClickMoved,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onClickEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onClickEnded,this))},updateLvBlocks:function(){if(this.bgSp&&cc.pvz.utils.setSpriteFrame(this.bgSp,"uiImage","gezi/"+i[this.lv]+this.json.lattice2),this.lvSp&&cc.pvz.utils.setSpriteFrame(this.lvSp,"uiImage","item/"+(this.lv+1)),this.spine){var t=(this.cantDrag?"black_":"stand")+(this.lv+1);this.spine.defaultAnimation=t,this.spine.setAnimation(0,t,!0)}},lvup:function(t){void 0===t&&(t=!0),this.lv++,this.updateLvBlocks(),this.checkToUpdateMaxHp(),t&&this.showLvupEffect()},showLvupEffect:function(){var t=this.node.convertToWorldSpaceAR(cc.Vec2.ZERO);this.itemRoot.scene.hub.showLvupEffect(t)},initBy:function(t,e,i){var n=this;if(this.itemRoot=t,this.json=this.itemRoot.scene.heroJsonFile.json[this.id-1],this.near6=!1,this.lv=e,this.updateLvBlocks(),i){i.forEach(function(t){t.put(n)}),this.myBlocks=i;var o=i[0].node.position.add(this.offset);this.node.position=o,this.node.zIndex=-(o.y+this.spine.node.y),this.canUse=!0}else this.myBlocks=[],this.canUse=!this.hasAd,this.setSelfListenEvent(!0),this.setBgSpParent(!0);this.hero=null,this.angerEff=null,this.lineIKBones=[]},getMaxLv:function(){return cc.pvz.PlayerData.getToolData(this.id).lv>=5?4:3},showUnderBuffEffect:function(){if(this.buffNode)this.buffNode.active=!0;else{var t=this.itemRoot.buffEffect.addNodeTo(this.node,this.spine.position);this.buffNode=t}},hideUnderBuffEffect:function(){this.buffNode&&(this.buffNode.active=!1)},updateLv5Effect:function(){this.lv},hideLv5Effect:function(){this.lv5FlagNode&&(this.lv5FlagNode.active=!1)},setCanDrag:function(t){this.spine?this.spine.setAnimation(0,(t?"stand":"black_")+(this.lv+1),!0):this.node.opacity=t?255:100,this.cantDrag=!t},updatePreviewByPos:function(t,e){return 0==this.id?this.itemRoot.blockRoot.testBlock(this,t,e):this.itemRoot.blockRoot.testItem(this,t,e)},lockByAd:function(t){var e=t.addNodeTo(this.node);e.getComponent(sp.Skeleton).setAnimation(0,this.adAni,!0),cc.find("ad",e).position=this.adSupOffset,this.hasAd=!0,this.canUse=!1},unlockAd:function(){if(this.isValid){var t=cc.find("ad",this.node);t?(t.active=!1,this.canUse=!0):cc.pvz.TAUtils.track("error",{message:"unlockAd",stack:"noAdNode, id:"+this.id+",lv:"+this.lv})}},pickupFromBoard:function(t){this.cantDrag||(this.hasMoved=!1,this.clickWPos=t,this.removeFromBlock(),this.itemRoot.pickupFromBoard(this,t),this.updatePreviewByPos(t))},onClickBegan:function(t){if(!this.cantDrag){var e=t.getLocation();this.hasMoved=!1,this.clickWPos=e,this.itemRoot.pickup(this,e),this.updatePreviewByPos(e),this.initSameIDLvLine()}},onClickMoved:function(t){this.cantDrag||(this.hasMoved=!0,this.node.position=this.node.parent.convertToNodeSpaceAR(t.getLocation()),this.updatePreviewByPos(t.getLocation()),this.updateLineIKBones())},removeFromBlock:function(){this.myBlocks.forEach(function(t){return t.pick()}),this.myBlocks.length=0,0==this.id?this.itemRoot.blockRoot.undoTryPlace(this):this.hideUnderBuffEffect(),this.checkToUpdateMaxHp()},onClickEnded:function(t){var e=this;if(!this.cantDrag)if(this.canUse){var i=[];if(this.updatePreviewByPos(t.getLocation(),i)){var n=i[0].node.position.add(this.offset),o=new Set;i.forEach(function(t){t.item&&o.add(t.item)});var s=!1;if(0!=this.id&&this.lv<this.getMaxLv()&&1==o.size){var c=o.values().next().value;c.id==this.id&&c.lv==this.lv&&i.every(function(t){return t.item==c})&&(s=!0,c.lvup(),this.setBgSpParent(!0),this.node.parent=null,this.itemRoot.blockRoot.resetBlocksPreview())}if(!s){if(o.forEach(function(t){t!=e&&(t.hideLv5Effect(),t.removeFromBlock(),t.itemRoot.putdown(t,t.node.convertToWorldSpaceAR(cc.Vec2.ZERO)))}),i.forEach(function(t){t.put(e)}),this.myBlocks=i,0==this.id){this.itemRoot.blockRoot.tryPlace(this);var a=this.itemRoot.blockItemsRootNode.convertToWorldSpaceAR(n);this.node.position=this.node.parent.convertToNodeSpaceAR(a)}else-1==i[0].i?(this.node.parent=i[0].node,this.node.position=cc.Vec2.ZERO):(this.node.parent=this.itemRoot.blockItemsRootNode,this.node.position=n,this.node.zIndex=-(n.y+this.spine.node.y));this.setSelfListenEvent(!1),this.checkToUpdateMaxHp(),0==this.id?(this.itemRoot.blockRoot.resetPosesPreview(),6==cc.pvz.runtimeData.guide&&this.itemRoot.scene.startGuide6()):this.itemRoot.blockRoot.resetBlocksPreview()}1==cc.pvz.runtimeData.guide&&(0==this.itemRoot.node.childrenCount?this.itemRoot.scene.startGuide2():this.itemRoot.scene.updateMoveFinger()),3==cc.pvz.runtimeData.guide&&(0==this.itemRoot.node.childrenCount?this.itemRoot.scene.startGuide4():this.itemRoot.scene.updateMoveFinger()),6==cc.pvz.runtimeData.guide&&(0==this.id?this.itemRoot.scene.hideMoveFinger():this.itemRoot.scene.updateMoveFinger()),7==cc.pvz.runtimeData.guide&&(0==this.itemRoot.node.childrenCount?this.itemRoot.scene.startGuide8():this.itemRoot.scene.updateMoveFinger())}else this.hideLv5Effect(),this.removeFromBlock(),this.itemRoot.putdown(this,t.getLocation()),0==this.id?this.itemRoot.blockRoot.resetPosesPreview():this.itemRoot.blockRoot.resetBlocksPreview(),1==cc.pvz.runtimeData.guide&&this.itemRoot.scene.updateMoveFinger(),3==cc.pvz.runtimeData.guide&&this.itemRoot.scene.updateMoveFinger(),6==cc.pvz.runtimeData.guide&&this.itemRoot.scene.updateMoveFinger(),7==cc.pvz.runtimeData.guide&&this.itemRoot.scene.updateMoveFinger();if(0!=this.id){var r=t.getLocation().sub(this.clickWPos);Math.abs(r.x)<16&&Math.abs(r.y)<16&&cc.popupManager.popup("game","plantInfo2","UIGameToolInfo",{scale:!1},this.id,this.lv)}this.hideLines(),this.itemRoot.layoutChildren()}else cc.pvz.TAUtils.getSwitchAd()?(this.hideLines(),cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5e7f\u544a\u683c\u5b50"],function(i){i?(e.unlockAd(),e.onClickEnded(t),e.itemRoot.scene.saveRuntimeData()):(e.removeFromBlock(),e.itemRoot.putdown(e,t.getLocation()),0==e.id?e.itemRoot.blockRoot.resetPosesPreview():e.itemRoot.blockRoot.resetBlocksPreview())})):cc.popupManager.popup("game","bagbuyUI","UIBuyBlock",{scale:!1},this)},checkToUpdateMaxHp:function(){this.itemRoot.scene.onItemChanged()},initHeroNodes:function(){var t=this.hero.node.position.add(this.barPos.mul(.82));this.barNode||(this.barNode=this.barPrefab.addNode(t),this.hpBar=cc.find("hp",this.barNode).getComponent(cc.ProgressBar),this.cdBar=cc.find("cd",this.barNode).getComponent(cc.ProgressBar),this.shieldBar=cc.find("dun",this.barNode).getComponent(cc.ProgressBar)),this.barNode.active=!0,this.barNode.position=t,this.hpBar.progress=1,this.shieldBar.progress=0,this.angerEff=null,this.lv1=cc.pvz.PlayerData.getToolData(this.id).lv-1,this.cdMs=1e3*this.json.cd,this.reloadMs=1e3*(Array.isArray(this.json.bulletcd)?this.json.bulletcd[this.lv1]:this.json.bulletcd),this.near10&&cc.pvz.runtimeData.hasEnableBuff(1004)&&(this.cdMs*=.8),this.hpBar.progress=1,this.shieldBar.progress=0,this.enabled=!0,3==this.id||6==this.id||8==this.id||10==this.id?(this.inCoolDown=!0,this.bulletCount=0,this.cdBar.progress=0,this.startReloadTimer()):this.onReloadReady()},startHeroLogic:function(t,e){var i=this;if(this.barPrefab=t,this.scene=e,6==this.id){var n=this.myBlocks[0].i;this.crossItems=[],this.itemRoot.blockRoot.getCrossItems(this.id,n,function(t){i.crossItems.push(t)})}},onReloadReady:function(){this.inCoolDown=!1,this.cdBar.progress=1,this.reloadT1=-1,this.reloadT2=-1,this.bulletCount=this.json.bullet,2==this.id&&cc.pvz.runtimeData.hasEnableBuff(203)&&(this.bulletCount+=this.json.bullet/2)},onCDReady:function(){this.inCoolDown=!1},stopHeroLogic:function(){this.barNode&&(this.barNode.parent=null,this.barNode=null),this.enabled=!1,this.hero.hp<=0?(this.hero.reborn(),this.hero.showBuffEffect("revive",!0)):this.hero.hp<this.maxHp&&this.hero.showBuffEffect("HP",!0),this.hero.setAnimation(0,"stand",!0,null),this.hero.destroy(),this.hero=null},checkToStartReloadTimer:function(){this.bulletCount<=0&&this.startReloadTimer()},startReloadTimer:function(){var t=this.reloadMs;this.checkBuff(202)&&(t/=2),this.checkBuff(301)&&(t*=.8),this.checkBuff(603)&&(t*=.8),this.checkBuff(801)&&(t*=.8),this.checkBuff(1003)&&(t*=.8),this.checkBuff(703)&&(t*=.7),this.checkBuff(902)&&(t*=.8),this.checkBuff(1103)&&(t*=.8),this.checkBuff(1202)&&(t*=.8),this.reloadT1=cc.pvz.time,this.reloadT2=cc.pvz.time+t},startAngerMode:function(){if(this.spine.timeScale=2,-1!=this.reloadT1){var t=cc.pvz.time-this.reloadT1;this.reloadT1+=t/2,this.reloadT2+=t/2}if(this.hero.hp>0)if(this.angerEff)this.angerEff.node.position=this.hero.node.position,this.angerEff.node.active=!0;else{var e=this.scene.accBuffPrefab.addNode(this.hero.node.position);this.angerEff=e.getComponent(sp.Skeleton),this.angerEff.setAnimation(0,"accelerate",!0)}},stopAngerMode:function(){if(this.spine.timeScale=1,-1!=this.reloadT1){var t=cc.pvz.time-this.reloadT1;this.reloadT1-=t,this.reloadT2-=t}this.angerEff&&(this.angerEff.node.active=!1)},update:function(){if(this.hero&&!this.hero.scene.timePaused&&!this.hero.scene.hasEnded&&!(this.hasDie||this.hero.hp<=0)){var t=this.hero.scene.isAngerPressed;if(this.inCoolDown){if(-1!=this.reloadT1){var e=cc.pvz.time-this.reloadT1;t&&(e*=2),this.reloadT1+e>=this.reloadT2?this.onReloadReady():this.cdBar.progress=e/(this.reloadT2-this.reloadT1)}}else if(this.hero.tryShoot({lv:this.lv})&&(this.hero.playSound(),this.inCoolDown=!0,t&&1!=this.json.bullet||(this.bulletCount--,this.cdBar.progress=this.bulletCount/this.json.bullet),this.bulletCount>0)){var i;i=t?this.cdMs/2:this.cdMs,this.scene.setTimeout(this.onCDReady.bind(this),i)}}},getMaxHp:function(){var t=cc.pvz.PlayerData.getToolData(this.id).lv,e=this.json.attribute1[t-1];return this.lv>0&&(e*=this.json.fightlvup1[this.lv-1]/100),e*=1+.01*cc.pvz.runtimeData.getBuffValue(1),this.near6&&cc.pvz.runtimeData.hasEnableBuff(604)&&(e*=1.1),this.checkBuff(402)&&(e*=1.3),e},updateMaxHp:function(){var t=this.getMaxHp(),e=t-this.maxHp;this.maxHp=t,this.hero&&(this.hero.hp+=e)},updateHp:function(t){this.hpBar.progress=t},updateShield:function(t){this.shieldBar.progress=t,this.scene.updateShield()},checkBuff:function(t){var e=(t-t%100)/100;return this.id==e&&cc.pvz.runtimeData.hasEnableBuff(t)},initSameIDLvLine:function(){var t=this;if(this.setBgSpParent(!0),0!=this.id&&this.lv<this.getMaxLv()){var e=function(e){var i=e.getComponent("Item");if(i&&i!=t&&i.id==t.id&&i.lv==t.lv){var n=t.itemRoot.linePrefab.addNodeTo(t.node,t.spine.node.position.add(cc.v2(0,45))).getComponent(sp.Skeleton),o=n.findBone("IK"),s=i.spine.node.convertToWorldSpaceAR(cc.v2(0,45));t.lineIKBones.push({spine:n,IKBone:o,wPos:s})}};this.lineIKBones.length=0,this.itemRoot.blockItemsRootNode.children.forEach(function(t){return e(t)}),this.itemRoot.node.children.forEach(function(t){return e(t)}),this.updateLineIKBones()}},updateLineIKBones:function(){0!=this.id&&this.lineIKBones.forEach(function(t){var e=t.spine.node.convertToNodeSpaceAR(t.wPos);t.IKBone.x=e.x,t.IKBone.y=e.y})},hideLines:function(){this.setBgSpParent(!(this.myBlocks.length>0)),0!=this.id&&(this.lineIKBones.forEach(function(t){t.spine.node.parent=null}),this.lineIKBones.length=0)},setBgSpParent:function(t){if(this.bgSp)if(t)this.bgSp.node.parent!=this.node&&(this.bgSp.node.zIndex=-1,this.bgSp.node.position=cc.Vec2.ZERO,this.bgSp.node.parent=this.node);else if(this.node.parent&&this.bgSp.node.parent==this.node){var e=this.bgSp.node.convertToWorldSpaceAR(cc.Vec2.ZERO);this.bgSp.node.parent=this.itemRoot.blockRoot.boardItemBgsRoot,this.bgSp.node.position=this.bgSp.node.parent.convertToNodeSpaceAR(e)}}}),cc._RF.pop()},{}],Pos:[function(t,e){"use strict";cc._RF.push(e,"c4626bbnFNOPY4pJvpt4nyB","Pos"),cc.Class({extends:cc.Component,properties:{i:0,dashNode:cc.Node},onLoad:function(){this.bgSp=cc.find("bg",this.node).getComponent(cc.Sprite),this.dashNode=cc.find("pos",this.node)},setRoot:function(t){this.blockRoot=t},setPreview:function(t){this.bgSp.node.active=-1!=t||this.item,this.bgSp.node.active&&(this.bgSp.spriteFrame=this.blockRoot.blockSpfs[t+1])},put:function(t){this.setPreview(-1),this.bgSp.node.active=!1,this.item&&cc.warn("2"),this.item=t},pick:function(){this.bgSp.node.active=!0,this.item=null}}),cc._RF.pop()},{}],UIBackMainTip:[function(t,e){"use strict";cc._RF.push(e,"908acqYridGR4EbhnPE4eGC","UIBackMainTip"),cc.Class({extends:cc.Component,properties:{},initBy:function(){},onCloseUI:function(){cc.popupManager.removePopup(this)},onClickBackToMain:function(){cc.popupManager.removeAllPopups(),cc.pvz.runtimeData.removeData(),cc.director.loadScene("mainUI")}}),cc._RF.pop()},{}],UIBuyBlock:[function(t,e){"use strict";cc._RF.push(e,"1f40bhWJZBDaLMYMeNwL7mO","UIBuyBlock"),cc.Class({extends:cc.Component,properties:{blockRoot:cc.Node},initBy:function(t){this.item=t;var e=cc.instantiate(t.node);e.position=cc.Vec2.ZERO,e.parent=this.blockRoot},onClickClose:function(){cc.popupManager.removePopup(this)},onClickAd:function(){var t=this;cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5e7f\u544a\u683c\u5b50"],function(e){e&&(t.item.unlockAd(),cc.popupManager.removePopup(t))})}}),cc._RF.pop()},{}],UIGameBuff:[function(t,e){"use strict";cc._RF.push(e,"3c3e3QNLFFGdJGkC8r81WVP","UIGameBuff");var i=cc.Class({name:"BuffNode",properties:{bgSp:cc.Sprite,qualitySp:cc.Sprite,iconSp:cc.Sprite,nameLabel:cc.Label,descLabel:cc.RichText}});cc.Class({extends:cc.Component,properties:{heroJsonFile:cc.JsonAsset,buffJsonFile:cc.JsonAsset,buffNodes:[i],refreshNode:cc.Node,refreshTimesLabel:cc.Label,getAllNode:cc.Node,getAllTimesLabel:cc.Label,btnsLayout:cc.Layout},onLoad:function(){this.buffNodes.forEach(function(t){return t.descLabel.enabled=!1})},initBy:function(t){var e=this;this.scene=t,this.buffPool=[],this.buffJsonFile.json.forEach(function(t){if(!(cc.pvz.runtimeData.buffs.filter(function(e){return e==t.id}).length>=t.gettimes))if(t.id<100)e.buffPool.push(t.id);else{var i=Math.floor(t.id/100),n=cc.pvz.PlayerData.getToolData(i);if(n.pos>=0&&n.lv>=t.locklevel){var o=parseInt(t.frontskill);(""==t.frontskill||cc.pvz.runtimeData.buffs.some(function(t){return t==o}))&&e.buffPool.push(t.id)}}});var i=[];1==cc.pvz.PlayerData.getStageLevel()&&cc.pvz.runtimeData.guide<9&&i.push(24),2==cc.pvz.runtimeData.mode&&i.push(13,14,15,16,17,18,22,23,24,31),i.forEach(function(t){var i=e.buffPool.findIndex(function(e){return e==t});-1!=i&&e.buffPool.splice(i,1)}),this.refresh(!0),cc.pvz.PlayerData.checkAndResetAdData(),this.getAllNode.active=this.getAdCount(1)>0,this.getAllTimesLabel.string=this.getAdCount(1)+"/"+this.getAdMaxCount(1),this.updateRefreshTimes(),this.getAllNode.active&&cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["buff\u5168\u90e8"])},getAdMaxCount:function(t){return 2==cc.pvz.runtimeData.mode?0==t?3:1:0==t?10:3},getAdCount:function(t){return 2==cc.pvz.runtimeData.mode?0==t?cc.pvz.runtimeData.buffRefreshCount:cc.pvz.runtimeData.buffAllCount:cc.pvz.PlayerData.getAdBuffTimes(t)},useAdCount:function(t){2==cc.pvz.runtimeData.mode?0==t?cc.pvz.runtimeData.buffRefreshCount--:cc.pvz.runtimeData.buffAllCount--:cc.pvz.PlayerData.updateAdBuffTimes(t)},updateRefreshTimes:function(){this.refreshNode.active=this.getAdCount(0)>0,this.refreshTimesLabel.string=this.getAdCount(0)+"/"+this.getAdMaxCount(0),this.btnsLayout.updateLayout(),this.refreshNode.active&&cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["buff\u5237\u65b0"])},refresh:function(t){var e=this;this.buffs=[],t&&cc.pvz.runtimeData.showGame1st&&[301,501,801].forEach(function(t){cc.pvz.runtimeData.hasEnableBuff(t)||e.buffs.push(t)});var i=t&&5==cc.pvz.runtimeData.guide;i&&this.buffs.push(201);for(var n=function(){for(var t=e.buffPool[cc.math.randomRangeInt(0,e.buffPool.length)];e.buffs.some(function(e){return e==t});)t=e.buffPool[cc.math.randomRangeInt(0,e.buffPool.length)];e.buffs.push(t)},o=this.buffs.length;o<this.buffNodes.length;o++)n();for(var s=function(){var t=e.buffs[c],i=e.buffJsonFile.json.find(function(e){return e.id==t}),n=e.buffNodes[c];cc.pvz.utils.setSpriteFrame(n.bgSp,"uiImage","game/buff_di"+i.quality),cc.pvz.utils.setSpriteFrame(n.qualitySp,"uiImage","item/pz_"+i.quality),cc.pvz.utils.setSpriteFrame(n.iconSp,"uiImage","skill/skill"+i.icon),n.nameLabel.string=i.name,n.descLabel.string=i.desc,n.descLabel.enabled=!0},c=0;c<this.buffNodes.length;c++)s();if(i){var a=this.scene;a.timePaused=!0,cc.butler.resumeDirector(1);var r=this.buffNodes[0].bgSp.node.parent;cc.guideManager.showGuide(0,[{tip:"\u51fb\u8d25\u602a\u7269\u63d0\u5347\u7b49\u7ea7\uff0c\u80fd\u83b7\u5f97\u5361\u76ae\u5df4\u62c9\u7684\u5f3a\u5316",focus:r,btn:r.name,y:-450},{hideFinger:!0,tip:"\u5c3d\u91cf\u51fb\u8d25\u602a\u7269\u4eec\u53d8\u5f97\u66f4\u5f3a\u5427\uff01"}],function(t){t&&(a.timePaused=!1)})}},onClickClose:function(){cc.popupManager.removePopup(this),this.scene.checkIsSucc()},onClickBuff:function(t,e){var i=this.buffs[parseInt(e)];cc.pvz.runtimeData.addBuff(i,this.heroJsonFile.json),this.onClickClose()},onClickRefresh:function(){var t=this;this.getAdCount(0)<=0||cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["buff\u5237\u65b0"],function(e){e&&(t.useAdCount(0),t.updateRefreshTimes(),t.refresh(!1))})},onClickGetAll:function(){var t=this;this.getAdCount(1)<=0||cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["buff\u5168\u90e8"],function(e){e&&(t.useAdCount(1),t.buffs.forEach(function(e){cc.pvz.runtimeData.addBuff(e,t.heroJsonFile.json)}),t.onClickClose())})}}),cc._RF.pop()},{}],UIGameEnd:[function(t,e){"use strict";cc._RF.push(e,"39fb4cjzNNDVpgqwKsJePsb","UIGameEnd"),cc.Class({extends:cc.Component,properties:{waveLabel:cc.Label,levelLabel:cc.Label,bgNodes:[cc.Node],batterWaveTip:cc.Node,bgSpine:sp.Skeleton,tiSpine:sp.Skeleton,baseItemNode:cc.Node,rewardParent:cc.Node,infoPanel:cc.Node,sweepTip:cc.Node,actGameTip:cc.Node,btnPanel:cc.Node,adBtn:cc.Node},initBy:function(t,e){var i=this;void 0===e&&(e=!0),this.scene=t,this.isInGame=e,this.isLookAd=!1,this.rewardParent.active=!1,this.btnPanel.active=!1,this.infoPanel.active=!1,this.actGameTip.active=!1,this.levelLabel.node.active=!1,this.sweepTip.active=!1,this.bgNodes[0].active=!1,this.bgNodes[1].active=!1,this.isInGame?(this.bgSpine.setAnimation(0,"",!1),this.scene.isSucc?(cc.pvz.utils.spineFromTo(this.bgSpine,"shengli1_2","shengli2_2"),cc.pvz.utils.spineFromTo(this.tiSpine,"shengli1_1","shengli2_1",!0,function(){i.onGameSpineEnd()})):(cc.pvz.utils.spineFromTo(this.bgSpine,"shibai1_2","shibai2_2"),cc.pvz.utils.spineFromTo(this.tiSpine,"shibai1_1","shibai2_1",!0,function(){i.onGameSpineEnd()})),this.levelLabel.string=""+cc.pvz.runtimeData.level,this.waveLabel.string=cc.pvz.runtimeData.wave,cc.pvz.runtimeData.level==cc.pvz.PlayerData.getStageLevel()&&this.scene.isSucc&&cc.pvz.PlayerData.updateStageLevel(1),cc.pvz.runtimeData.level==cc.pvz.PlayerData.getStageLevel()&&cc.pvz.runtimeData.wave>cc.pvz.PlayerData.getMaxLevelWave()?(this.batterWaveTip.active=!0,cc.pvz.PlayerData.updateMaxLevelWave(cc.pvz.runtimeData.wave)):this.batterWaveTip.active=!1,this.scene.isSucc&&(0==cc.pvz.runtimeData.mode?cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u901a\u5173\u4e3b\u7ebf\u526f\u672cn\u6b21"],1):cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u901a\u5173\u6311\u6218\u5173\u5361n\u6b21"],1)),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5173\u5361\u7ed3\u7b97"]),cc.pvz.PlayerData.getStageLevel()>1&&cc.pvz.PlayerData.saveDataToLocalOnline()):(this.levelLabel.string=""+this.scene.stageLevel,cc.pvz.utils.spineFromTo(this.bgSpine,"shengli1_2","shengli2_2"),cc.pvz.utils.spineFromTo(this.tiSpine,"shengli1_1","shengli2_1",!0,function(){i.levelLabel.node.active=!0,i.sweepTip.active=!0,i.bgNodes[0].active=!0;var t=cc.JsonControl.getLevelData(i.scene.stageLevel);i.initRewardData(t.reward,1)})),this.isInGame&&cc.butler.resumeDirector(1)},onGameSpineEnd:function(){this.infoPanel.active=!0,this.levelLabel.node.active=0==cc.pvz.runtimeData.mode,this.actGameTip.active=0!=cc.pvz.runtimeData.mode,this.bgNodes[this.scene.isSucc?0:1].active=!0,this.initInGameReward()},initInGameReward:function(){var t;t=this.scene.isSucc?1:Math.max(1,cc.pvz.runtimeData.wave)/this.scene.maxWave;var e=this.scene.hub.levelData;switch(cc.pvz.runtimeData.mode){case 0:this.adBtn.active=!0,this.initRewardData(e.reward,t);break;case 1:this.adBtn.active=!1,this.initRewardData(e.reward,t)}},initRewardData:function(t,e){var i=this,n=e;this.isInGame&&0==cc.pvz.runtimeData.mode&&(n*=1+.01*cc.pvz.runtimeData.getBuffValue(7));for(var o=Math.floor(t.length/2),s=0,c=[],a=0;a<o;a++){var r=Math.floor(n*t[s+1]),h=cc.pvz.utils.getRewardItem(t[s],r);c.push(h),s+=2}this.rewardData=[];for(var d=0;d<c.length;d++){var u=c[d];u.itemId>=5&&u.itemId<=7?cc.pvz.utils.onCheckRandomTool(u,this.rewardData):this.rewardData.push(u)}this.rewardParent.active=!0;var p=this.rewardData.length;if(this.baseItemNode.active=!0,this.isInGame||cc.pvz.utils.fadeInBtn(this.baseItemNode),this.baseItemNode.getComponent("RewardItem").initRewardItem(this.rewardData[0],!0),this.isInGame){for(var l=1;l<p;l++){var f=cc.instantiate(this.baseItemNode);f.parent=this.rewardParent,cc.pvz.utils.fadeInBtn(f),f.getComponent("RewardItem").initRewardItem(this.rewardData[l],!0)}this.btnPanel.active=!0}else for(var m=function(t){setTimeout(function(){var e=cc.instantiate(i.baseItemNode);e.parent=i.rewardParent,cc.pvz.utils.fadeInBtn(e),e.getComponent("RewardItem").initRewardItem(i.rewardData[t],!1),t==p-1&&(i.onSaveLogic(),cc.pvz.utils.fadeInBtn(i.btnPanel))},40*(t-1)+120)},v=1;v<p;v++)m(v)},onSaveLogic:function(){console.log(" save ");for(var t=1;t<this.rewardData.length;t++)this.rewardParent.children[t].getComponent("RewardItem").onSaveReward()},onClickAd:function(){var t=this;this.isLookAd||(this.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5173\u5361\u7ed3\u7b97"],function(e){t.onAdClose(e)}))},onAdClose:function(t){this.isLookAd=!1,t&&this.onShowDoubleReward()},onShowDoubleReward:function(){var t=this;this.onGetDoubleReward(),cc.popupManager.removePopup(this),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},this.rewardData,cc.pvz.GameConfig.UIFromType["\u53cc\u500d\u7ed3\u7b97"],function(){t.onClickClose()})},onGetDoubleReward:function(){for(var t=0;t<this.rewardData.length;t++)this.rewardParent.children[t].getComponent("RewardItem").onSaveReward(),this.rewardData[t].count*=2},onClickShare:function(){this.isLookAd||(cc.popupManager.showToast("\u5206\u4eab\u6210\u529f\u4e86\u54df\uff01"),this.onShowDoubleReward())},onClickClose:function(){this.isLookAd||(cc.butler.playEffectAsync("game","sound/getCoin"),this.isInGame?(cc.popupManager.removeAllPopups(),1==cc.pvz.PlayerData.getStageLevel()?(cc.pvz.runtimeData.init(0,1),cc.director.loadScene("game1"),cc.pvz.TAUtils.trackBackpack(1)):(cc.pvz.runtimeData.removeData(),cc.director.loadScene("mainUI"))):(cc.popupManager.removePopup(this),cc.MainControl.updateItemInfo(),cc.RedControl.refreshAllRedTip()))}}),cc._RF.pop()},{}],UIGameLv5Info:[function(t,e){"use strict";cc._RF.push(e,"ab5bd7tHkNLfqIwEVEZuzpJ","UIGameLv5Info");var i=[{id1:2,id2:8,id3:102,lv1:1},{id1:5,id2:1,id3:105,lv1:3},{id1:9,id2:10,id3:109,lv1:5},{id1:12,id2:4,id3:112,lv1:7},{id1:13,id2:6,id3:113,lv1:7}];cc.Class({extends:cc.Component,properties:{itemNode:cc.Node,unlockLine:cc.Node,heroJsonFile:cc.JsonAsset},initBy:function(){var t=this;this.unlockLine.zIndex=2,this.itemNode.active=!0;var e=!1;i.forEach(function(i){var n=cc.instantiate(t.itemNode),o=t.heroJsonFile.json.find(function(t){return t.id==i.id1}),s=t.heroJsonFile.json.find(function(t){return t.id==i.id2}),c=t.heroJsonFile.json.find(function(t){return t.id==i.id3}),a=cc.find("q1",n).getComponent(cc.Sprite),r=cc.find("i1",n).getComponent(cc.Sprite),h=cc.find("q2",n).getComponent(cc.Sprite),d=cc.find("i2",n).getComponent(cc.Sprite);cc.pvz.utils.setSpriteFrame(a,"uiImage","item/pz_"+o.quality),cc.pvz.utils.setSpriteFrame(r,"uiImage","plant/wq/zw_"+i.id1+"_4"),cc.pvz.utils.setSpriteFrame(h,"uiImage","item/pz_"+s.quality),cc.pvz.utils.setSpriteFrame(d,"uiImage","plant/wq/zw_"+i.id2+"_4"),cc.pvz.utils.setSpriteFrame(cc.find("i3",n).getComponent(cc.Sprite),"uiImage","plant/wq/zw_"+i.id1+"_5"),cc.find("name",n).getComponent(cc.Label).string=c.name;var u=cc.pvz.PlayerData.getToolData(i.id1).lv,p=u>=i.lv1,l=cc.pvz.PlayerData.getToolData(i.id2).lv>=1;p?cc.find("lock1",n).active=!1:(cc.find("lock1",n).getComponent(cc.Label).string=u>=1?"\u7b49\u7ea7"+i.lv1+"\u89e3\u9501":cc.pvz.GameConfig.ToolLockTip.replace("$",cc.pvz.GameConfig.ToolLockLevel[i.id1-1]),cc.JsonControl.setSpriteGray(a,!0),cc.JsonControl.setSpriteGray(r,!0),e=!0),l?cc.find("lock2",n).active=!1:(cc.find("lock2",n).getComponent(cc.Label).string=cc.pvz.GameConfig.ToolLockTip.replace("$",cc.pvz.GameConfig.ToolLockLevel[i.id2-1]),cc.JsonControl.setSpriteGray(h,!0),cc.JsonControl.setSpriteGray(d,!0)),n.zIndex=p&&l?1:3,n.parent=t.itemNode.parent}),this.unlockLine.active=e,this.itemNode.active=!1},onClickClose:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIGameMoney:[function(t,e){"use strict";cc._RF.push(e,"ea057X0oDxGZKg8kPGNFr9r","UIGameMoney"),cc.Class({extends:cc.Component,properties:{addCount:30,countTipNode:cc.Node,countLabel:cc.Label},initBy:function(t){cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u9633\u5149"]),this.countTipNode.active=2==cc.pvz.runtimeData.mode,this.countTipNode.active&&(this.countLabel.string=cc.pvz.runtimeData.buyCoinCount),this.cb=t},onClickClose:function(){cc.popupManager.removePopup(this)},onClickAd:function(){var t=this;cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u9633\u5149"],function(e){e&&(2==cc.pvz.runtimeData.mode&&cc.pvz.runtimeData.buyCoinCount--,cc.pvz.runtimeData.addMoney(t.addCount),t.cb&&t.cb(),cc.popupManager.removePopup(t))})}}),cc._RF.pop()},{}],UIGamePause:[function(t,e){"use strict";cc._RF.push(e,"b691eTesltE4Ivu8gARF7SF","UIGamePause"),cc.Class({extends:cc.Component,properties:{buffJsonFile:cc.JsonAsset,buffItemNode:cc.Node,buffPanel:cc.Node,buffTipPanel:cc.Node,buffDescLabel:cc.RichText},initBy:function(){this.buffJson=this.buffJsonFile.json,this.buffTipPanel.active=!1,this.buffList=cc.pvz.runtimeData.buffs,this.tipBuffId=-1,0==this.buffList.length?this.buffItemNode.active=!1:this.initBuffShow()},getBuffJson:function(t){return this.buffJson.find(function(e){return e.id==t})},initBuffShow:function(){var t=this;this.buffItemNode.active=!0,this.buffItemNode.getComponent("BuffItem").initBuffItem(0,this.getBuffJson(this.buffList[0]),function(e,i,n){t.onShowTipPanel(e,i,n)});for(var e=1;e<this.buffList.length;e++){var i=cc.instantiate(this.buffItemNode);i.parent=this.buffPanel,i.getComponent("BuffItem").initBuffItem(e,this.getBuffJson(this.buffList[e]),function(e,i,n){t.onShowTipPanel(e,i,n)})}this.buffPanel.getComponent(cc.Layout).updateLayout()},onShowTipPanel:function(t,e,i){this.tipBuffId!=t?(this.tipBuffId=t,this.buffTipPanel.active=!0,this.buffTipPanel.position=cc.v2(e.x,e.y+130+this.buffPanel.parent.position.y),this.buffDescLabel.string=i):this.buffTipPanel.active=!this.buffTipPanel.active},onClickHideTip:function(){this.buffTipPanel.active=!1},onClickSet:function(){this.buffTipPanel.active=!1,cc.popupManager.popup("mainUI","set","UISet",{ad:!1,scale:!1},1)},onClickBackToMain:function(){this.buffTipPanel.active=!1,cc.popupManager.popup("game","tipUI","UIBackMainTip",{ad:!1,scale:!1})},onClickClose:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIGameReborn:[function(t,e){"use strict";cc._RF.push(e,"73dc0QM6WhCaKWq62D5pk42","UIGameReborn"),cc.Class({extends:cc.Component,properties:{},initBy:function(t){this.cb=t,cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u6b7b\u4ea1\u590d\u6d3b"])},onClickClose:function(){this.cb(!1),cc.popupManager.removePopup(this)},onClickAd:function(){var t=this;cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u6b7b\u4ea1\u590d\u6d3b"],function(e){e&&(t.cb(!0),cc.popupManager.removePopup(t))})}}),cc._RF.pop()},{}],UIGameStastics:[function(t,e){"use strict";cc._RF.push(e,"ddaa9QTMd5DeKon7DptrxXl","UIGameStastics");var i=t("../../scripts/PrefabInfo");cc.Class({extends:cc.Component,properties:{prefab:i},initBy:function(t){var e=this,i=1;cc.pvz.runtimeData.stats.forEach(function(t){i+=t}),t.heroes.map(function(t){return t}).sort(function(t,e){return cc.pvz.runtimeData.stats[e.info.id]-cc.pvz.runtimeData.stats[t.info.id]}).forEach(function(t){if(3!=t.info.id&&7!=t.info.id&&11!=t.info.id){var n=cc.pvz.runtimeData.stats[t.info.id],o=t.info.json,s=e.prefab.addNode();cc.pvz.utils.setSpriteFrame(cc.find("quality",s).getComponent(cc.Sprite),"uiImage","item/pz_"+o.quality),cc.pvz.utils.setSpriteFrame(cc.find("icon",s).getComponent(cc.Sprite),"uiImage","plant/wq/zw_"+t.info.id+"_"+(t.info.maxLv+1)),cc.find("name",s).getComponent(cc.Label).string=o.name,cc.find("num",s).getComponent(cc.Label).string=Math.round(n);var c=n/i;cc.find("num2",s).getComponent(cc.Label).string=(100*c).toFixed(2)+"%",cc.find("bar",s).getComponent(cc.ProgressBar).progress=c}}),this.timer=-1,cc.director.isPaused()&&this.prefab.root.getComponent(cc.Layout).updateLayout()},onClickClose:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{"../../scripts/PrefabInfo":void 0}],UIGameToolInfo:[function(t,e){"use strict";cc._RF.push(e,"422a7XlnftNMJN+tNEKeA6A","UIGameToolInfo"),cc.Class({extends:cc.Component,properties:{nameLabel:cc.Label,lvLabel:cc.Label,iconSpine:sp.Skeleton,attrbibuteIcons:[cc.Sprite],attrNumLabels:[cc.Label],attrNameLabels:[cc.Label],arrti4Panel:cc.Node},initBy:function(t,e){var i=this;if(this.toolId=t,this.fakeToolId=t>100?t-100:t,99==this.toolId)this.toolLv=1,this.arrti4Panel.active=!1;else{var n=cc.pvz.PlayerData.getToolData(this.fakeToolId);0==n.lv?this.toolLv=1:this.toolLv=n.lv}var o=cc.JsonControl.getToolJson(this.toolId);this.nameLabel.string=o.name,this.gameToolLv=e+1,cc.pvz.utils.useBundleAsset("actors","kapi/hero"+this.toolId,sp.SkeletonData,function(t){i.iconSpine.skeletonData=t;var e=i.gameToolLv;i.iconSpine.setAnimation(0,"stand"+e,!0)}),this.lvLabel.string="\u5408\u6210\u7b49\u7ea7"+this.gameToolLv,this.toolJson=cc.JsonControl.getToolJson(this.fakeToolId),this.initAttributeInfo(),cc.butler.resumeDirector(1)},initAttributeInfo:function(){if(99==this.toolId){var t=this.toolJson.attributetype1;cc.JsonControl.getToolAttriIcon(this.attrbibuteIcons[0],t),this.attrNameLabels[0].string=cc.pvz.GameConfig.ToolAttriNameList[t-1];for(var e=0;e<3;e++)this.attrNumLabels[e].string=this.getAttributeNums(e)}else{for(var i=0;i<this.attrbibuteIcons.length;i++){var n=this.toolJson["attributetype"+(i+1)];cc.JsonControl.getToolAttriIcon(this.attrbibuteIcons[i],n),this.attrNameLabels[i].string=cc.pvz.GameConfig.ToolAttriNameList[n-1]}for(var o=0;o<this.attrNumLabels.length;o++)this.attrNumLabels[o].string=this.getAttributeNums(o)}},getAttributeNums:function(t){var e="";switch(t){case 0:e=""+this.toolJson.Atk;break;case 1:e=3==this.toolId||10==this.toolId?this.toolJson.cdtxt[this.toolLv-1]+"\u79d2":this.toolJson.cdtxt+(8==this.toolId||6==this.toolId?"\u79d2":"");break;case 2:case 3:var i=0,n=this.toolJson["attributetype"+(t-1)],o=this.toolJson["attribute"+(t-1)],s=this.toolJson["fighttype"+(t-1)];i=1==o.length?o[0]:o[this.toolLv-1],this.gameToolLv>1&&""!=s&&(i*=this.toolJson["fightlvup"+(t-1)][this.gameToolLv-2]/100,9==n?10*i%10!=0&&(i=i.toFixed(1)):i=Math.floor(i)),e=i+(9==n?"%":"")}return e},onCloseUI:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UISpeed:[function(t,e){"use strict";cc._RF.push(e,"466f1rHpOpOMrU6iIInQpJP","UISpeed"),cc.Class({extends:cc.Component,initBy:function(t){this.scene=t,this.isLookAd=!1,cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u53cc\u500d\u901f\u5ea6"])},onClickShare:function(){var t=this;this.isLookAd||(this.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u53cc\u500d\u901f\u5ea6"],function(e){t.onAdClose(e)}))},onAdClose:function(t){this.isLookAd=!1,t&&(cc.popupManager.removePopup(this),cc.pvz.runtimeData.openSpeed=!0,1==cc.pvz.runtimeData.speed?cc.pvz.runtimeData.speed=2:cc.pvz.runtimeData.speed=1,this.scene.updateSpeed())},onClickClose:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIStashTip:[function(t,e){"use strict";cc._RF.push(e,"0c5c3NiQZpF45h2kDMgbSQn","UIStashTip"),cc.Class({extends:cc.Component,properties:{},initBy:function(t){this.cb=t},onClickClose:function(){this.cb(!1),cc.popupManager.removePopup(this)},onClickStart:function(){this.cb(!0),cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],game1:[function(t,e){"use strict";cc._RF.push(e,"487ddT1mbRK4quxyYqSXMJE","game1");var i=t("./BlockRoot"),n=t("./ItemRoot"),o=t("../../scripts/PrefabInfo"),s=[3,6,8,10],c=[1,2,4,5,7,9,11,12];cc.Class({extends:cc.Component,properties:{adBlockBtnNode:cc.Node,adBlockCountLabel:cc.Label,refreshFree:cc.Node,refreshCoin:cc.Node,refreshCoinLabel:cc.Label,refreshLv2Node:cc.Node,blockRoot:i,itemRoot:n,itemPrefabs:[cc.Node],item3Preabs:[cc.Node],blockPrefabs:[cc.Node],adSupPrefab:o,setBtnNode:cc.Node,lv5btnNode:cc.Node,bagBottomUIRoot:cc.Node,startBtnNode:cc.Node,refreshBtnNode:cc.Node,placeBtnNode:cc.Node,stashNode:cc.Node,hpBar:cc.ProgressBar,hpLabel:cc.Label,heroJsonFile:cc.JsonAsset,buffJsonFile:cc.JsonAsset,moneyIconNode:cc.Node,bgMusic:cc.AudioClip,fingerSpine:sp.Skeleton},onLoad:function(){this.itemPrefabs.forEach(function(t){return t.active=!1}),this.blockPrefabs.forEach(function(t){return t.active=!1}),this.fingerSpine.node.active=!1},start:function(){var t=this;this.adBlockBtnNode.active=cc.pvz.runtimeData.adBlockCount>0,this.items=[],this.attItems=[],this.itemPrefabs.forEach(function(e,i){var n=i+1;cc.pvz.PlayerData.getToolData(n).pos>=0&&(t.items.push(n),c.some(function(t){return t==n})&&t.attItems.push(n))}),cc.pvz.runtimeData.loadJsonData(this.buffJsonFile.json),this.blockRoot.scene=this,this.itemRoot.scene=this,this.logicEveryWave(),this.refreshLv2Node.active=cc.pvz.runtimeData.lv2Count>0,this.refreshLv2Node.active&&cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5237\u65b02\u7ea7"]),this.blockRoot.startLogic(),this.updateHp(),this.itemRoot.node.removeAllChildren(),cc.pvz.runtimeData.autoTimes>0?(this.doRefreshLogic(!0),cc.pvz.runtimeData.autoTimes--,this.saveRuntimeData()):(cc.pvz.runtimeData.bagItems.forEach(function(e){if(0==e.id){var i=t.blockPrefabs[e.id0Type],n=t.addItemByPrefab(i,-1,null);n.hasAd&&!e.hasAd&&n.unlockAd()}else{var o=t.newEquipItem(e.lv,e.id,null);e.hasAd&&o.lockByAd(t.adSupPrefab)}}),this.itemRoot.layoutChildren()),this.blockRoot.resetBlocksPreview(),this.updateMoney(),cc.butler.node.on("money",this.updateMoney,this),1==cc.pvz.PlayerData.getStageLevel()&&(this.setBtnNode.active=!1,this.blockRoot.stashEnable=!1,0==cc.pvz.runtimeData.guide&&(cc.pvz.runtimeData.showGame1st?(this.bagBottomUIRoot.active=!1,cc.guideManager.showGuide(0,[{hideFinger:!0,tip:"\u3010\u80cc\u5305\u3011\u80fd\u5f3a\u5316\u4e0a\u9635\u690d\u7269\u7684\u80fd\u529b\u3002"},{hideFinger:!0,tip:"\u5c06\u5237\u65b0\u51fa\u7684\u3010\u5de5\u5177\u3011\u5168\u90e8\u653e\u5165\u80cc\u5305\u4e2d\u5f3a\u5316\u690d\u7269!"}],function(e){e&&(t.bagBottomUIRoot.active=!0,t.startBtnNode.active=!1,t.refreshBtnNode.active=!1,t.refreshLv2Node.active=!1,cc.pvz.runtimeData.guide=3,t.updateMoveFinger())}),this.adBlockBtnNode.active=!1):(this.bagBottomUIRoot.active=!1,cc.guideManager.showGuide(0,[{hideFinger:!0,tip:"\u6b22\u8fce\u6765\u5230\u5361\u76ae\u5df4\u62c9\u7684\u4e16\u754c\uff01"},{hideFinger:!0,tip:"\u5c06\u5237\u65b0\u51fa\u7684\u5361\u76ae\u5df4\u62c9\u653e\u5165\u6e38\u4e50\u573a\uff01"}],function(e){e&&(cc.pvz.runtimeData.guide=1,t.updateMoveFinger())}),this.adBlockBtnNode.active=!1))),this.adBlockBtnNode.active&&(this.adBlockCountLabel.string=cc.pvz.runtimeData.adBlockCount,cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5237\u65b0\u5e7f\u544a\u683c\u5b50"]))},logicEveryWave:function(){cc.butler.playMusic(this.bgMusic);var t=cc.pvz.runtimeData.getBuffValue(13);this.refreshCost=t>0?Math.round(15*(1-.01*t)):15,this.updateRefreshBtns()},updateRuntimeData:function(){var t=this;cc.pvz.runtimeData.blocks=[],this.blockRoot.datas.forEach(function(t,e){-1!=t&&cc.pvz.runtimeData.blocks.push(e)}),this.blockRoot.boardItemsRoot.children.forEach(function(t){t.getComponent("Item").near10=!1}),this.blockRoot.boardItemsRoot.children.forEach(function(e){var i=e.getComponent("Item");if(10==i.id){var n=i.myBlocks[0].i;t.blockRoot.getCrossItems(i.id,n,function(t){t.near10=!0})}}),cc.pvz.runtimeData.items=[],this.blockRoot.boardItemsRoot.children.forEach(function(t,e){var i=t.getComponent("Item");cc.pvz.runtimeData.items.push({id:i.id,lv:i.lv,bs:i.myBlocks.map(function(t){return t.i})}),i.index=e}),cc.pvz.runtimeData.bagItems=[];var e=function(t){cc.pvz.runtimeData.bagItems.push({id:t.id,lv:t.lv,hasAd:t.hasAd&&!t.canUse,id0Type:t.id0Type})};this.itemRoot.node.children.forEach(function(t){var i=t.getComponent("Item");e(i)}),this.itemRoot.dragingRoot.children.forEach(function(t){var i=t.getComponent("Item");e(i)})},saveRuntimeData:function(){this.updateRuntimeData(),cc.pvz.runtimeData.saveData()},updateMoveFinger:function(t){if(void 0===t&&(t=!1),0!=this.itemRoot.node.childrenCount){var e;e=!t&&this.itemRoot.dragingRoot.childrenCount>0?this.itemRoot.dragingRoot.children[0].getComponent("Item"):null;var i=this.prePosA;if(!e){var n=this.itemRoot.node.children.findIndex(function(t){return 0==t.getComponent("Item").id});if(-1==n&&(n=0),(e=this.itemRoot.node.children[n].getComponent("Item")).node.y>5){var o=e.node.y;e.node.y=0,i=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO),e.node.y=o}else i=e.node.convertToWorldSpaceAR(cc.Vec2.ZERO);this.prePosA=i}var s=null,c=this.blockRoot.boardItemsRoot.children.find(function(t){var i=t.getComponent("Item");return i.id==e.id&&i.lv==e.lv});if(c)s=c.convertToWorldSpaceAR(cc.v2(15,-30));else{var a,r,h=0==e.id||this.blockRoot.isExtendMode;-1!=(r=h?this.blockRoot.findPosForBlock(e):this.blockRoot.findBlockForItem(e))?(a=h?this.blockRoot.poses[r].node.position.add(e.offset):this.blockRoot.blocks[r].node.position.add(e.offset),s=this.itemRoot.blockItemsRootNode.convertToWorldSpaceAR(a).add(cc.v2(15,-30))):s=this.blockRoot.node.convertToWorldSpaceAR(cc.v2(270,0))}this.showMoveFinger(i,s)}},showMoveFinger:function(t,e){var i=this,n=this.fingerSpine.node.parent.convertToNodeSpaceAR(t),o=this.fingerSpine.node.parent.convertToNodeSpaceAR(e);this.fingerSpine.node.active=!0,this.fingerSpine.node.stopAllActions(),function t(){i.fingerSpine.node.position=n,i.fingerSpine.setAnimation(0,"1",!1),i.fingerSpine.setCompleteListener(function(){i.fingerSpine.node.runAction(cc.sequence(cc.moveTo(.75,o),cc.callFunc(function(){i.fingerSpine.setAnimation(0,"3",!1),i.fingerSpine.setCompleteListener(function(){0==i.itemRoot.node.childrenCount?t():i.updateMoveFinger()})}))),i.fingerSpine.setAnimation(0,"2",!0),i.fingerSpine.setCompleteListener(null)})}()},hideMoveFinger:function(){this.fingerSpine.node.active=!1,this.fingerSpine.node.stopAllActions()},startGuide2:function(){var t=this;this.hideMoveFinger(),cc.pvz.runtimeData.guide=2,this.bagBottomUIRoot.active=!0,this.startBtnNode.active=!1,this.refreshLv2Node.active=!1;var e=this.refreshBtnNode;cc.guideManager.showGuide(0,[{tip:"\u3010\u5237\u65b0\u3011\u83b7\u5f97\u66f4\u591a\u5361\u76ae\u5df4\u62c9",focus:e,btn:e.name}],function(i){i&&(e.y=-1e3,cc.pvz.runtimeData.guide=3,setTimeout(function(){t.updateMoveFinger()}))})},startGuide4:function(){this.hideMoveFinger(),cc.pvz.runtimeData.guide=4;var t=this.blockRoot.boardItemsRoot.children.find(function(t){return 3==t.getComponent("Item").id});this.refreshBtnNode.y=90;var e=this.startBtnNode;e.active=!0,cc.guideManager.showGuide(0,[{hideFinger:!0,tip:"\u6218\u6597\u4e2d\uff0c\u3010\u8759\u8760\u5361\u76ae\u3011\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u4f1a\u4ea7\u51fa\u66f4\u591a\u94b1\u5e01",focus:cc.find("gezi",t),y:-400},{tip:"\u51c6\u5907\u5c31\u7eea\uff0c\u53bb\u5bf9\u6297\u5165\u4fb5\u4e50\u56ed\u7684\u602a\u517d\u4eec\u5427\uff01",focus:e,btn:e.name}],function(t){t&&(cc.pvz.runtimeData.guide=5)})},startGuide6:function(){var t=this;this.hideMoveFinger(),this.bagBottomUIRoot.active=!0,this.startBtnNode.active=!1,this.refreshLv2Node.active=!1,this.refreshBtnNode.active=!1,cc.guideManager.showGuide(0,[{tip:"\u786e\u8ba4\u653e\u7f6e\u4f4d\u7f6e",focus:this.placeBtnNode,btn:this.placeBtnNode.name}],function(e){e&&(cc.pvz.runtimeData.guide=7,0==t.itemRoot.node.childrenCount?t.itemRoot.scene.startGuide8():setTimeout(function(){t.updateMoveFinger(!0)}))})},startGuide8:function(){var t=this;this.hideMoveFinger(),cc.pvz.runtimeData.guide=8,this.blockRoot.stashEnable=!0;var e=this.refreshBtnNode;e.active=!0,e.parent.getComponent(cc.Layout).updateLayout(),cc.guideManager.showGuide(0,[{tip:"\u4f7f\u7528\u3010\u5237\u65b0\u3011\uff0c\u80fd\u83b7\u5f97\u66f4\u591a\u5361\u76ae\u5df4\u62c9",focus:e,btn:e.name},{hideFinger:!0,tip:"\u5145\u5206\u5229\u7528\u6e38\u4e50\u573a\u7a7a\u95f4\uff0c\u505a\u4e2a\u80cc\u5305\u6574\u7406\u8fbe\u4eba\u5427"}],function(e){e&&(cc.pvz.runtimeData.guide=9,t.startBtnNode.active=!0,t.refreshLv2Node.active=!0,t.adBlockBtnNode.active=!0,t.adBlockCountLabel.string=cc.pvz.runtimeData.adBlockCount,cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5237\u65b0\u5e7f\u544a\u683c\u5b50"]))})},checkStartGame:function(){return 0!=this.blockRoot.boardItemsRoot.childrenCount||(cc.popupManager.showToast("\u4e0a\u9635\u5361\u76ae\u8fce\u6218\u654c\u4eba"),!1)},onClickStart:function(t){var e=this;this.checkStartGame(this.onClickStart)&&(this.saveRuntimeData(),this.blockRoot.boardItemsRoot.children.forEach(function(i){i.getComponent("Item").startHeroLogic(e.itemRoot.barPrefab,t)}),cc.pvz.TAUtils.trackLevel(cc.pvz.runtimeData.level,cc.pvz.runtimeData.wave))},onBackFromGame:function(){this.blockRoot.boardItemsRoot.children.forEach(function(t){t.getComponent("Item").stopHeroLogic()}),this.blockRoot.backFromGame(),this.itemRoot.node.removeAllChildren(),this.logicEveryWave()},addItemByPrefab:function(t,e,i){var n=cc.instantiate(t);n.position=cc.Vec2.ZERO;var o=n.getComponent("Item");return o.initBy(this.itemRoot,e,i),n.active=!0,i||(n.parent=this.itemRoot.node,this.itemRoot.layoutChildren()),o},newEquipItem:function(t,e,i){var n;return void 0===e&&(e=-1),void 0===i&&(i=null),-1==e&&(e=this.items[cc.math.randomRangeInt(0,this.items.length)]),n=e>100?this.item3Preabs.find(function(t){return t.getComponent("Item").id==e}):this.itemPrefabs.find(function(t){return t.getComponent("Item").id==e}),this.addItemByPrefab(n,t,i)},doRefreshLogic:function(t){var e,i=this;e=t?3+cc.pvz.runtimeData.getBuffValue(9):3,this.itemRoot.node.removeAllChildren();var n=cc.pvz.runtimeData.wave>=cc.pvz.runtimeData.forceAdWave;if(0==cc.pvz.runtimeData.mode&&1==cc.player.level){if(0==cc.pvz.runtimeData.guide)return cc.pvz.runtimeData.showGame1st?(this.newEquipItem(0,5),this.newEquipItem(0,8),this.newEquipItem(0,3)):(this.newEquipItem(0,5),this.newEquipItem(0,4),this.newEquipItem(0,6)),void this.itemRoot.layoutChildren();if(3==cc.pvz.runtimeData.guide)return this.newEquipItem(0,4),this.newEquipItem(0,2),this.newEquipItem(0,3),void this.itemRoot.layoutChildren();if(5==cc.pvz.runtimeData.guide){var o=this.blockPrefabs[1];return this.addItemByPrefab(o,-1),this.newEquipItem(0,1),this.newEquipItem(0,3),this.itemRoot.layoutChildren(),this.bagBottomUIRoot.active=!1,cc.guideManager.showGuide(0,[{hideFinger:!0,tip:"\u51fa\u73b0\u65b0\u7684\u683c\u5b50\uff0c\u8d76\u7d27\u628a\u6e38\u4e50\u573a\u7a7a\u95f4\u6269\u5927\u5427\uff01"}],function(t){t&&(cc.pvz.runtimeData.guide=6,i.updateMoveFinger())}),void(this.adBlockBtnNode.active=!1)}if(t&&6==cc.pvz.runtimeData.wave){this.newEquipItem(3,2).lockByAd(this.adSupPrefab),this.newEquipItem(0,6);var c=this.blockPrefabs[3];this.addItemByPrefab(c,-1);var a=this.itemRoot.getComponent(cc.Layout);a.paddingLeft=100,a.paddingRight=100,this.itemRoot.layoutChildren();var r=cc.find("guide7",this.node);return r.active=!0,void cc.guideManager.showGuide(0,[{hideFinger:!0,focus:r,tip:"\u524d\u65b9\u6709\u9996\u9886\u602a\u7269\uff0c\u8d76\u7d27\u4e0a\u9635\u5f3a\u529b\u5361\u76ae\u5df4\u62c9\uff01"}],function(t){t&&(r.active=!1)})}}var h=.87,d=.97,u=cc.pvz.runtimeData.getBuffValue(8);u>0&&(h-=.01*u,d-=.01*u);var p=[];this.blockRoot.boardItemsRoot.children.forEach(function(t){var e=t.getComponent("Item");0==e.id||2!=e.lv&&3!=e.lv||p.push(e.id)});for(var l=Math.min(.2,.06+.02*p.length),f=!1,m=!1,v=[-1,-1,-1],g=0;g<e;g++){var b=0,k=-1,B=-1;if(n)b=1,k=cc.math.randomRangeInt(3,this.blockPrefabs.length);else if(!m&&Math.random()<l)b=3,B=this.items[cc.math.randomRangeInt(0,this.items.length)];else if(!f){var C=Math.random();b=C<h?0:C<d?1:2}if(2==g&&1!=b&&v[0]==v[1])do{B=this.items[cc.math.randomRangeInt(0,this.items.length)]}while(B==v[0]);if(3==b)for(;3==B;)B=this.items[cc.math.randomRangeInt(0,this.items.length)];switch(0==b&&v.some(function(t){return s.some(function(e){return e==t})})&&(B=this.attItems[cc.math.randomRangeInt(0,this.attItems.length)]),b){case 0:v[g]=this.newEquipItem(0,B).id;break;case 1:-1==k&&(k=cc.math.randomRangeInt(0,this.blockPrefabs.length));var y=this.blockPrefabs[k];v[g]=this.addItemByPrefab(y,-1).id,k>2&&(f=!0,n&&(cc.pvz.runtimeData.forceAdWave+=5,n=!1),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5e7f\u544a\u683c\u5b50"]));break;case 2:v[g]=this.newEquipItem(1,B).id;break;case 3:var R=this.newEquipItem(2,B);R.lockByAd(this.adSupPrefab),v[g]=R.id,m=!0}}this.itemRoot.layoutChildren()},onClickWave7Guide:function(){cc.guideManager.onStepFinished()},onClickRefresh:function(){var t=this;if(cc.pvz.runtimeData.freeTimes>0)cc.pvz.runtimeData.freeTimes--,this.updateRefreshBtns();else{if(cc.pvz.runtimeData.money<this.refreshCost)return 2==cc.pvz.runtimeData.mode&&cc.pvz.runtimeData.buyCoinCount<=0?void cc.popupManager.showToast("\u9633\u5149\u4e0d\u8db3"):void cc.popupManager.popup("game","YgbuyUI","UIGameMoney",{scale:!1},function(){t.saveRuntimeData()});cc.pvz.runtimeData.addMoney(-this.refreshCost),this.updateMoney()}this.doRefreshLogic(!1),this.saveRuntimeData()},onClickAd3:function(){var t=this;cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5237\u65b0\u5e7f\u544a\u683c\u5b50"],function(e){if(e){var i=cc.math.randomRangeInt(1,3),n=t.blockPrefabs[i];t.addItemByPrefab(n,-1),cc.pvz.runtimeData.adBlockCount--,t.adBlockBtnNode.active=cc.pvz.runtimeData.adBlockCount>0,t.adBlockBtnNode.active&&(t.adBlockCountLabel.string=cc.pvz.runtimeData.adBlockCount,cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5237\u65b0\u5e7f\u544a\u683c\u5b50"])),t.saveRuntimeData()}})},onClickAdRefresh:function(){var t=this;cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5237\u65b02\u7ea7"],function(e){e&&(cc.pvz.runtimeData.lv2Count=0,t.refreshLv2Node.active=!1,t.doRefreshLogic(!1),t.newEquipItem(1),t.saveRuntimeData())})},updateRefreshBtns:function(){this.refreshFree.active=cc.pvz.runtimeData.freeTimes>0,this.refreshCoin.active=cc.pvz.runtimeData.freeTimes<=0,this.refreshCoinLabel.string=this.refreshCost,cc.pvz.runtimeData.money<this.refreshCost?this.refreshCoinLabel.node.color=cc.Color.RED:this.refreshCoinLabel.node.color=cc.Color.WHITE},updateMoney:function(){cc.pvz.runtimeData.money<this.refreshCost?this.refreshCoinLabel.node.color=cc.Color.RED:this.refreshCoinLabel.node.color=cc.Color.WHITE},updateHp:function(){var t=this;this.blockRoot.boardItemsRoot.children.forEach(function(t){t.getComponent("Item").near6=!1}),this.blockRoot.boardItemsRoot.children.forEach(function(e){var i=e.getComponent("Item");if(6==i.id&&i.myBlocks.length>0){var n=i.myBlocks[0].i;t.blockRoot.getCrossItems(i.id,n,function(t){t.near6=!0})}});var e=this.blockRoot.boardItemsRoot.children.reduce(function(t,e){var i=e.getComponent("Item");return i.updateMaxHp(),t+i.maxHp},0);this.hpLabel.string=Math.round(e)},onItemChanged:function(){this.updateHp()},showLv5UI:function(){cc.popupManager.popup("game","HechengUI","UIGameLv5Info",{scale:!1},this)}}),cc._RF.pop()},{"../../scripts/PrefabInfo":void 0,"./BlockRoot":"BlockRoot","./ItemRoot":"ItemRoot"}],game:[function(t,e){"use strict";cc._RF.push(e,"8230aOHPrNHQZMa4tDLZgoZ","game");var i=t("../../scripts/PrefabInfo");cc.Class({extends:cc.Component,properties:{bg2Sp:cc.Sprite,groundAreaNode:cc.Node,bgMusic2:cc.AudioClip,shieldBar:cc.ProgressBar,shieldLabel:cc.Label,hpBar:cc.ProgressBar,hpLabel:cc.Label,pauseNode:cc.Node,speedNode:cc.Node,speedLabel:cc.Label,statsBtnNode:cc.Node,levelsJsonFile:cc.JsonAsset,ground:cc.Node,objsRoot:cc.Node,bulletsRoot:cc.Node,fightNodes:[cc.Node],heroJsonFile:cc.JsonAsset,eHurtNum:i,eHurtCritNum:i,eDiePrefab:i,ePoisonPrefab:i,eSlowPrefab:i,eIcePrefab:i,eWeakPrefab:i,eHpPrefab:i,eBossHpPrefab:i,eHitPrefab:i,eHitGroundPrefab:i,pHurtNum:i,pFireEffect:i,addBuffPrefab:i,accBuffPrefab:i,waveEndAniSpine:sp.Skeleton,moneyIconNode:cc.Node,tryPlantNode:cc.Node,tryPlantIcon:cc.Sprite,statsPanel:cc.Node,statsItemPrefab:i,angerBar:cc.ProgressBar,angerBarSp:cc.Sprite,angerBarSpfs:[cc.SpriteFrame],angerEmptyTip:cc.Node,angerBarNode:cc.Node,angerModeNode:cc.Node},onLoad:function(){this.waveEndAniSpine.node.active=!1,this.statsPanel&&(this.statsPanel.active=!1),this.angerEmptyTip.active=!1},startLogic:function(t){var e=this,i=this.hub.levelData;this.levelData=i;var n=this.groundAreaNode.getBoundingBoxToWorld();this.groundAreaLB=this.objsRoot.convertToNodeSpaceAR(cc.v2(n.xMin,n.yMin)),this.groundAreaTR=this.objsRoot.convertToNodeSpaceAR(cc.v2(n.xMax,n.yMax)),this.timePaused=!1,this.t=0,this.msIndex=0,this.frameActions=[],this.cbs2=[],this.cbId=1,this.pausedCbs=[],this.pausedCbs2=[],this.hasEnded=!1,this.statsBtnNode.active=!0,2==cc.pvz.runtimeData.mode?this.maxWave=99999:this.maxWave=i.wave,this.isLastWave=2!=cc.pvz.runtimeData.mode&&cc.pvz.runtimeData.wave==i.wave-1,this.enemys=[],this.taskEnemyCount1=0,this.taskEnemyCount2=0,cc.butler.node.on("maxHp",this.onGetHpBuff,this),this.initHeroes(t),this.updateHp(!1),this.updateShield(),this.updateSpeed(),this.isAngerPressed=!1,this.angerBarNode.on(cc.Node.EventType.TOUCH_START,function(){e.startAngerMode()},this),this.angerBarNode.on(cc.Node.EventType.TOUCH_END,function(){e.stopAngerMode(),e.angerEmptyTip.active=!1},this),this.angerBarNode.on(cc.Node.EventType.TOUCH_CANCEL,function(){e.stopAngerMode(),e.angerEmptyTip.active=!1},this),this.updateAnger(),cc.director.getCollisionManager().enabled=!0,cc.pvz.runtimeData.mode,cc.pvz.runtimeData.showGame1st&&0==cc.pvz.runtimeData.wave?cc.guideManager.showGuide(0,[{hideFinger:!0,tip:"\u50f5\u5c38\u6b63\u5728\u8fdb\u653b\u6211\u4eec\u7684\u82b1\u56ed\uff0c\u8d76\u7d27\u6d88\u706d\u4ed6\u4eec!"}],function(t){t&&e.beginEmitEnemys()}):this.beginEmitEnemys(),this.enabled=!0,cc.director.on(cc.Director.EVENT_BEFORE_SCENE_LOADING,this.resetSpeed,this)},onBackFromGame:function(){this.stopAngerMode(),this.fightNodes.forEach(function(t){return t.removeAllChildren()}),cc.butler.node.off("maxHp",this.onGetHpBuff,this),this.enabled=!1,cc.director.off(cc.Director.EVENT_BEFORE_SCENE_LOADING,this.resetSpeed,this),cc.director.getCollisionManager().enabled=!1,this.heroes.forEach(function(t){t.IKBone&&cc.tween(t.IKBone).to(.064,{x:150,y:50}).start()})},beginEmitEnemys:function(){var t=this,e=null,i=null;switch(cc.pvz.runtimeData.mode){case 0:e="game",i="config/Level"+this.levelData.level,cc.pvz.runtimeData.showGame1st&&(i+="B");break;case 1:e="game",i="config/"+this.levelData.level;break;case 2:e="rank",i="config/"+this.levelData.level,cc.popupManager.showToast("\u7b2c"+(cc.pvz.runtimeData.wave+1)+"\u6ce2\u5f00\u59cb")}cc.pvz.utils.useBundleAsset(e,i,cc.JsonAsset,function(e){t.emitEnemys(e.json)})},resetSpeed:function(){this.setSpeedLogic(1)},updateAnger:function(){this.angerBar.progress=cc.pvz.runtimeData.anger/1e3,this.angerBar.node.width>10?this.angerBar.node.opacity=255:this.angerBar.node.opacity=0},getMoneyWPos:function(){return this.moneyIconNode.convertToWorldSpaceAR(cc.Vec2.ZERO)},getAngerBarWPos:function(){return this.angerBar.node.convertToWorldSpaceAR(cc.v2(this.angerBar.node.width,0))},showBuffEffect:function(t,e,i,n){var o=this.addBuffPrefab.addNode(e),s=o.getComponent(sp.Skeleton),c=s.setAnimation(0,t,!1);if(i){var a=o.convertToNodeSpaceAR(i),r=s.findBone("IK");r.x=a.x,r.y=a.y}n&&s.setTrackCompleteListener(c,n)},onGetHpBuff:function(){this.bag.updateHp(),this.updateHp()},updateHp:function(t){var e=this.heroes.reduce(function(t,e){return t+e.hp},0),i=this.heroes.reduce(function(t,e){return t+e.item.maxHp},0);0!=i&&(this.hpLabel.string=Math.round(e),t?cc.tween(this.hpBar).to(.1,{progress:e/i}).start():this.hpBar.progress=e/i)},updateShield:function(){var t=this.heroes.reduce(function(t,e){return t+e.shieldValue},0),e=this.heroes.reduce(function(t,e){return t+e.item.maxHp},0),i=t>0;this.shieldBar.node.active=i,this.shieldLabel.node.parent.active=i,i&&(this.shieldLabel.string=Math.floor(t),this.shieldBar.progress=t/e)},insertFrameAction:function(t,e){var i=this.frameActions.find(function(e){return e.ms==t});i?i.cbs.push(e):this.frameActions.push({ms:t,cbs:[e]})},insertFrameCB:function(t,e){var i,n=this.cbId,o=this.cbs.findIndex(function(e){return e.ms>t});return i=-1==o?this.cbs.length:o,this.cbs.splice(i,0,{ms:t,cb:e,id:n}),this.cbId++,n},setTimeout:function(t,e,i){i&&this.clearTimeout(i);var n=Math.floor(cc.pvz.time)+e;return this.insertFrameCB(n,t)},clearTimeout:function(t){var e=this.cbs.findIndex(function(e){return e.id==t});-1!=e&&this.cbs.splice(e,1)},updateTimeout:function(t,e,i){var n=this.cbs.find(function(t){return t.id==i});return n?(n.ms+=e,i):this.setTimeout(t,e,i)},setInterval:function(t,e){var i=this.cbId;return this.cbs2.push({id:i,cb:t,ms:Math.floor(cc.pvz.time)+e,inteval:e}),this.cbId++,i},clearInterval:function(t){var e=this.cbs2.findIndex(function(e){return e.id==t});-1!=e&&this.cbs2.splice(e,1)},update:function(t){var e=this;if(!this.timePaused){this.t+=t,this.t;var i=1e3*this.t;this.msIndex<this.frameActions.length&&i>=this.frameActions[this.msIndex].ms&&(this.frameActions[this.msIndex].cbs.forEach(function(t){return t.call(e)}),this.msIndex++),this.isAngerPressed&&(cc.pvz.runtimeData.anger-=125*t,cc.pvz.runtimeData.anger<=0&&(this.angerEmptyTip.active=!0,this.stopAngerMode())),cc.pvz.runtimeData.anger=Math.min(1e3,cc.pvz.runtimeData.anger+5*t),this.updateAnger()}for(;this.cbs.length>0&&cc.pvz.time>this.cbs[0].ms;)this.cbs.shift().cb.call(this);this.cbs2.forEach(function(t){cc.pvz.time>=t.ms&&(t.cb.call(e),t.ms+=t.inteval)})},startAngerMode:function(){this.isAngerPressed||this.hasEnded||cc.pvz.runtimeData.anger>0&&(cc.butler.playMusic(this.bgMusic2),this.isAngerPressed=!0,this.angerBarSp.spriteFrame=this.angerBarSpfs[1],this.angerModeNode.active=!0,this.heroes.forEach(function(t){return t.item.startAngerMode()}))},stopAngerMode:function(){this.isAngerPressed&&(cc.butler.playMusic(this.bag.bgMusic),this.isAngerPressed=!1,this.angerBarSp.spriteFrame=this.angerBarSpfs[0],this.angerModeNode.active=!1,this.heroes.forEach(function(t){return t.item.stopAngerMode()}))},startTween:function(t){var e=t._union();this.node.runAction(cc.targetedAction(t._target,e))},pauseGame:function(){cc.butler.pauseDirector(1)},resumeGame:function(){cc.butler.resumeDirector(1)},onPopup1st:function(){this.hasEnded||(this.timePaused=!0)},onAllClosed:function(){this.timePaused=!1},initHeroes:function(t){var e=this;this.heroes=[],t.blockRoot.boardItemsRoot.children.forEach(function(t,i){var n=t.getComponent("Item");cc.pvz.utils.useBundleAsset("actors","plant/plant"+n.id,cc.Prefab,function(t){var o=cc.instantiate(t),s=o.getComponent("Hero");o.position=e.objsRoot.convertToNodeSpaceAR(n.spine.node.convertToWorldSpaceAR(cc.Vec2.ZERO)),o.parent=e.objsRoot,s.initBy(e,n,{json:n.json,index:i,id:n.id,lv1:cc.pvz.PlayerData.getToolData(n.id).lv-1,maxLv:0}),s.position2=o.position.add(n.attOffset),n.hero=s,n.initHeroNodes(),e.heroes.push(s),e.updateHp(!1)})})},hasHero:function(t){return this.heroes.some(function(e){return e.info.id==t&&e.hp>0})},emitEnemys:function(t){var e=this,i=cc.pvz.runtimeData.wave+1;2==cc.pvz.runtimeData.mode&&(this.wavePlusHp=0,this.wavePlusAtk=0,i>10&&(this.wavePlusHp=(i-10)*this.levelData.hpwave,this.wavePlusAtk=(i-10)*this.levelData.atkwave),i>18&&(i=(i-19)%5+14)),this.enemyCount=0,t.filter(function(t){return t.wave==i}).forEach(function(t){for(var i=e.t+t.time,n=0;n<t.EnemyNum;n++){var o=1e3*(i+n*t.Space);e.insertFrameAction(o,function(){e.executeEvent2(t)})}e.enemyCount+=t.EnemyNum}),this.frameActions.sort(function(t,e){return t.ms-e.ms})},executeEvent2:function(t){var e=this;cc.pvz.utils.useBundleAsset("actors","Zombie/Enemy"+t.EnemyId,cc.Prefab,function(i){e.executeEventNewEnemy(i,t)})},executeEventNewEnemy:function(t,e){var i=cc.instantiate(t),n=cc.math.randomRange(this.groundAreaLB.y,this.groundAreaTR.y),o=e.hp,s=e.atk;switch(cc.pvz.runtimeData.actBuff2){case 101:case 102:case 103:o*=[1.3,1.4,1.5][cc.pvz.runtimeData.actBuff2-101];break;case 107:case 108:case 109:s*=[1.3,1.4,1.5][cc.pvz.runtimeData.actBuff2-107]}switch(cc.pvz.runtimeData.mode){case 0:o*=this.levelData.hpadd/100,s*=this.levelData.atkadd/100;break;case 1:o*=1+(cc.pvz.PlayerData.getStageLevel()-9)*this.levelData.hpadd,s*=1+(cc.pvz.PlayerData.getStageLevel()-9)*this.levelData.atkadd;break;case 2:o*=1+(cc.pvz.PlayerData.getStageLevel()-5)*this.levelData.hpadd+this.wavePlusHp,s*=1+(cc.pvz.PlayerData.getStageLevel()-5)*this.levelData.atkadd+this.wavePlusAtk}var c=this.addEnemyIn(e.EnemyId,i,360,n,o,s);2==cc.pvz.runtimeData.mode&&(c.exp=.6*c.exp)},addEnemyIn:function(t,e,i,n,o,s){e.parent=this.objsRoot,e.x=i,e.y=n;var c=e.getComponent("Enemy");return c.initBy(this,this.bulletsRoot,o,s),c.id=t,c.showHpBar=t>100,this.addEnemy(c),c},addEnemy:function(t){this.enemys.push(t)},delEnemy:function(t){var e=this.enemys.findIndex(function(e){return e==t});if(-1!=e&&this.enemys.splice(e,1),t.node.parent=null,this.enemyCount--,t.id>100?this.taskEnemyCount1++:this.taskEnemyCount2++,(!this.isLastWave||this.enemyCount>0)&&t.exp>0){var i=t.exp,n=cc.pvz.runtimeData.getBuffValue(11);n>0&&(i=Math.round(i*(1+.01*n))),cc.pvz.runtimeData.exp+=i;var o=this.hub.lvupJsonFile.json[cc.pvz.runtimeData.lv].exp;cc.pvz.runtimeData.exp>=o?(cc.pvz.runtimeData.exp-=o,cc.pvz.runtimeData.lv++,cc.butler.playEffectAsync("game","sound/playerlevelup"),cc.popupManager.popup("game","BuffUI","UIGameBuff",{scale:!1},this)):this.checkIsSucc(),this.hub.updateExp()}else this.checkIsSucc()},addEnemyHpBar:function(t){if(!t.hpBar){var e=(t.showHpBar?this.eBossHpPrefab:this.eHpPrefab).addNode(t.node.position);cc.find("node",e).position=t.hpBarPos,t.hpBar=e.getComponent(cc.ProgressBar)}},checkIsSucc:function(){var t=this;if(!this.hasEnded&&0==this.enemyCount){if(cc.pvz.runtimeData.wave++,this.taskEnemyCount1>0&&cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u51fb\u8d25\u9996\u9886n\u4e2a"],this.taskEnemyCount1),this.taskEnemyCount2>0&&cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u51fb\u8d25\u50f5\u5c38n\u4e2a"],this.taskEnemyCount2),cc.pvz.runtimeData.addMoney(10+cc.pvz.runtimeData.getBuffValue(5)),this.isLastWave)this.isSucc=!0,this.hasEnded=!0,this.enabled=!1,this.setSpeedLogic(1),cc.popupManager.popup("game","win","UIGameEnd",{scale:!1},this),cc.butler.playEffectAsync("game","sound/win");else{this.waveEndAniSpine.node.active=!0;var e=this.moneyIconNode.convertToWorldSpaceAR(cc.Vec2.ZERO),i=this.waveEndAniSpine.node.convertToNodeSpaceAR(e),n=this.waveEndAniSpine.findBone("IK");n.x=i.x,n.y=i.y,this.waveEndAniSpine.setCompleteListener(function(){cc.pvz.runtimeData.autoTimes++,cc.pvz.runtimeData.lv2Count=1,t.hub.backToBag(),t.waveEndAniSpine.node.active=!1,t.waveEndAniSpine.setCompleteListener(null)})}0==cc.pvz.runtimeData.mode&&cc.pvz.TAUtils.trackEndLevel(cc.pvz.runtimeData.level,cc.pvz.runtimeData.wave-1,!0)}},chooseEnemy:function(t,e){if(this.hasEnded)return null;var i,n=this.enemys.filter(function(t){return t.hp>0});i=this.isAngerPressed?1e6:e;var o=null;return n.forEach(function(e){var n=e.node.position.sub(t.node.position).lengthSqr();n<i&&(i=n,o=e)}),o},chooseEnemys:function(t,e,i){var n=this;if(this.hasEnded)return null;var o=this.enemys.filter(function(i){return i.hp>0&&n.isAngerPressed||i.node.position.sub(t.node.position).lengthSqr()<e});if(i>=o.length)return o;for(var s=[],c=0;c<i;c++){var a=cc.math.randomRangeInt(0,o.length);s.push(o.splice(a,1)[0])}return s},chooseEnemyByBullet:function(){if(this.hasEnded)return null;var t=this.enemys.filter(function(t){return t.hp>0});return t[cc.math.randomRangeInt(0,t.length)]},chooseHero:function(t){if(this.hasEnded)return null;for(var e=this.heroes.filter(function(t){return t.hp>0}),i=1600,n=e[0],o=0;o<e.length;o++){var s;s=e[o].position2?e[o].position2.x:e[o].node.x;var c=Math.abs(s-t.x);c<i&&(i=c,n=e[o])}return n},chooseMinHpHero:function(){for(var t=1,e=null,i=0;i<this.heroes.length;i++)if(this.heroes[i].hp>0){var n=this.heroes[i].hp/this.heroes[i].item.maxHp;n<t&&(t=n,e=this.heroes[i])}return e},getHeroesMaxMarginX:function(){return this.heroes.filter(function(t){return t.hp>0}).reduce(function(t,e){return Math.max(t,e.node.x+e.item.righMargin)},-360)},checkIsFail:function(){var t=this;this.heroes.some(function(t){return!t.hasDie})||(this.isSucc=!1,this.hasEnded=!0,cc.butler.playEffectAsync("game","sound/fail"),2==cc.pvz.runtimeData.mode?(this.setSpeedLogic(1),cc.popupManager.popup("rank","Rankwin","UIRankEnd",{scale:!1},this)):cc.pvz.runtimeData.hasReborn?(this.setSpeedLogic(1),cc.popupManager.popup("game","win","UIGameEnd",{scale:!1},this),0==cc.pvz.runtimeData.mode&&cc.pvz.TAUtils.trackEndLevel(cc.pvz.runtimeData.level,cc.pvz.runtimeData.wave,!1)):cc.popupManager.popup("game","fuhuoUI","UIGameReborn",{scale:!1},function(e){e?(cc.pvz.runtimeData.addMoney(30),cc.pvz.runtimeData.anger=1e3,cc.pvz.runtimeData.hasReborn=!0,cc.pvz.runtimeData.autoTimes++,cc.pvz.runtimeData.lv2Count=1,cc.director.loadScene("game1")):cc.popupManager.popup("game","win","UIGameEnd",{scale:!1},t)}))},showEnemyHurtNum:function(t,e,i){var n=(1==t?this.eHurtCritNum:this.eHurtNum).addNode(e);n.x+=cc.math.randomRange(-40,40),n.y+=50+cc.math.randomRange(-10,40),cc.find("num",n).getComponent(cc.Label).string="-"+Math.max(1,Math.floor(i)),n.getComponent(cc.Animation).play(),n.getComponent(cc.Animation).on("finished",function(){n.parent=null})},showJsEffect:function(t,e){12!=e&&this.eHitPrefab.addNode(t).getComponent(sp.Skeleton).setAnimation(0,"zd"+e+"_hit"+cc.math.randomRangeInt(1,4),!1),this.eHitGroundPrefab.addNode(t).getComponent(sp.Skeleton).setAnimation(0,"zd"+e+"_js"+cc.math.randomRangeInt(1,4),!1)},showHeroHurtNum:function(t,e){var i=this.pHurtNum.addNode(t);i.x+=cc.math.randomRange(-40,40),i.y+=cc.math.randomRange(10,70),cc.find("num",i).getComponent(cc.Label).string="-"+Math.floor(e),i.getComponent(cc.Animation).play(),i.getComponent(cc.Animation).on("finished",function(){i.parent=null})},onClickSpeed:function(){cc.pvz.runtimeData.openSpeed?(1==cc.pvz.runtimeData.speed?cc.pvz.runtimeData.speed=2:cc.pvz.runtimeData.speed=1,this.updateSpeed()):cc.popupManager.popup("game","2speedUI","UISpeed",{scale:!1},this)},updateSpeed:function(){this.setSpeedLogic(cc.pvz.runtimeData.speed)},setSpeedLogic:function(t){sp.timeScale=t,cc.director.getScheduler().setTimeScale(t)},onClickStats:function(){this.isStatsShown?this.hideStats():(this.statsPanel.active=!0,this.isStatsShown=!0,this.updateStats(),this.statsPanel.getComponent(cc.Animation).play().wrapMode=cc.WrapMode.Normal,this.statsPanel.getComponent(cc.Animation).off("finished"))},updateStats:function(){var t=this;if(this.isStatsShown){var e=Math.max(1,cc.pvz.runtimeData.stats.reduce(function(t,e){return t+e},0));this.heroes.sort(function(t,e){return cc.pvz.runtimeData.stats[e.info.id]-cc.pvz.runtimeData.stats[t.info.id]}).forEach(function(i,n){if(i.zd){var o=t.statsItemPrefab.root.children.find(function(t){return t.__id==i.info.id});o||((o=t.statsItemPrefab.addNode()).__id=i.info.id),o.zIndex=n;var s=cc.pvz.runtimeData.stats[i.info.id],c=i.info.json;cc.pvz.utils.setSpriteFrame(cc.find("quality",o).getComponent(cc.Sprite),"uiImage","item/pz_"+c.quality);var a=cc.find("icon",o).getComponent(sp.Skeleton);a.skeletonData=i.spine.skeletonData,a.setAnimation(0,"stand"+(i.item.lv+1),!0),cc.find("name",o).getComponent(cc.Label).string=c.name;var r=s/e;cc.find("num2",o).getComponent(cc.Label).string=(100*r).toFixed(2)+"%",cc.find("bar",o).getComponent(cc.ProgressBar).progress=r}})}},hideStats:function(){var t=this;this.isStatsShown=!1,this.statsPanel.getComponent(cc.Animation).play().wrapMode=cc.WrapMode.Reverse,this.statsPanel.getComponent(cc.Animation).once("finished",function(){t.statsPanel.active=!1})}}),cc._RF.pop()},{"../../scripts/PrefabInfo":void 0}]},{},["Block","BlockRoot","BuffItem","Bullet","ColliderProxy","Enemy","Enemy12","EventCollider","GameHub","Hero","Item","ItemRoot","Pos","UIBackMainTip","UIBuyBlock","UIGameBuff","UIGameEnd","UIGameLv5Info","UIGameMoney","UIGamePause","UIGameReborn","UIGameStastics","UIGameToolInfo","UISpeed","UIStashTip","game","game1"]);