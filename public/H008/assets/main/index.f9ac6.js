window.__require=function e(t,o,a){function n(c,s){if(!o[c]){if(!t[c]){var r=c.split("/");if(r=r[r.length-1],!t[r]){var l="function"==typeof __require&&__require;if(!s&&l)return l(r,!0);if(i)return i(r,!0);throw new Error("Cannot find module '"+c+"'")}c=r}var u=o[c]={exports:{}};t[c][0].call(u.exports,function(e){return n(t[c][1][e]||e)},u,u.exports,e,t,o,a)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<a.length;c++)n(a[c]);return n}({ActBuffPanel:[function(e,t){"use strict";cc._RF.push(t,"e5547P+Ga5PVrk3ZsoBv0e2","ActBuffPanel"),cc.Class({extends:cc.Component,properties:{buffIconList:[cc.Sprite],buffTipPanel:cc.Node,buffDescLabel:cc.RichText},onLoad:function(){this.buffDescLabel.enabled=!1},onHideActBuffPanel:function(){this.node.active=!1},onHideActBuffTip:function(){this.buffTipPanel.active=!1},initActBuffInfo:function(){this.buffTipPanel.active=!1,this.ActLevelData=cc.pvz.PlayerData.getActLevelData(),this.ActLevelBuffJson=cc.JsonControl.ActLevelBuffJson;for(var e=0;e<2;e++){var t=this.ActLevelData.buffList[e];-1==t&&(t=this.getRandomBuff(0==e),cc.pvz.PlayerData.updateActLevelBuff(e+1,t));var o=cc.JsonControl.getActBuffJson(t);cc.pvz.utils.setSpriteFrame(this.buffIconList[e],"uiImage","tiaozhan/buff"+o.icon)}},getRandomBuff:function(e){void 0===e&&(e=!0);for(var t=[],o=0;o<this.ActLevelBuffJson.length;o++){var a=this.ActLevelBuffJson[o];e?a.id<100&&t.push(a.id):a.id>100&&t.push(a.id)}return t[cc.math.randomRangeInt(0,t.length)]},onClickBuff:function(e,t){var o=parseInt(t);if(o!=this.curBuffIndex){this.curBuffIndex=o;var a=this.ActLevelData.buffList[o-1],n=cc.JsonControl.getActBuffJson(a);this.buffTipPanel.active=!0,this.buffDescLabel.string=n.desc,this.buffDescLabel.enabled=!0,this.buffTipPanel.position=cc.v2(this.buffIconList[o-1].node.parent.position.x,this.buffTipPanel.position.y)}else this.buffTipPanel.active=!this.buffTipPanel.active}}),cc._RF.pop()},{}],AdBtn:[function(e,t){"use strict";cc._RF.push(t,"97ad5KR+XZP4aJ98jEr2o7l","AdBtn"),cc.Class({extends:cc.Component,properties:{icon:cc.Sprite},start:function(){cc.butler.node.on("ad",this.onAdTimes,this),this.updateIcon()},onAdTimes:function(){this.updateIcon()},updateIcon:function(){var e=10==cc.player.adTimes;cc.pvz.utils.setSpriteFrame(this.icon,"uiImage",e?"public/ad2":"public/ad")}}),cc._RF.pop()},{}],AdUtils:[function(e,t){"use strict";cc._RF.push(t,"7c7610vsk9D7YhS9pctvYTi","AdUtils");var o=null,a=null,n=null,i=[0],c={initAllAds:function(){cc.sys.platform==cc.sys.WECHAT_GAME&&(o=wx.getLaunchOptionsSync()),cc.isControlAd&&this.initP8AdInfo()},getLaunchOptions:function(){return o},isWhiteList:function(){return cc.sys.platform!=cc.sys.WECHAT_GAME||this.isWhiteListSceneId()||cc.pvz.TAUtils.getTwtraceidSwitch(cc.pvz.GameConst.Twtraceid_YXBN)||cc.pvz.TAUtils.getTwtraceidSwitch(cc.pvz.GameConst.Twtraceid_YXSP)},isWhiteListSceneId:function(){return cc.sys.platform!=cc.sys.WECHAT_GAME||-1!=[1095].findIndex(function(e){return e==o.scene})},getTwtraceidFrom:function(e){if(Object.keys(e.query).length>0)for(var t in e.query){if("?twtraceid"==t)return e.query[t];if("twtraceid"==t)return e.query[t]}return""},callRewardAdCallback:function(e){cc.butler.resumeDirector(0),this.hasCalledCB?console.log("callRewardAdCallback but hascalled"):(e&&(cc.player.adTimes++,cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u89c2\u770b\u5e7f\u544an\u6b21"],1),cc.pvz.PlayerData.saveData(),cc.pvz.TAUtils.trackP8AdSucc(this.rewardVideoIndex)),this.cb?(this.cb(e),cc.butler.node.emit("ad"),this.hasCalledCB=!0):cc.pvz.TAUtils.track("error",{message:"Ad",stack:"cb is null,isEnded:"+e+",index:"+this.rewardVideoIndex}))},createRewardAd:function(e){var t=this,o=wx.createRewardedVideoAd({adUnitId:cc.pvz.GameConst.AD_UNITS_REWARD[e],multiton:!0});return o.onLoad(function(){console.log("RewardedVideoAd onLoad",e)}),o.onError(function(t){console.log("RewardedVideoAd onError",e,t),cc.pvz.TAUtils.track("adError",{errCode:t.errCode||t.err_code,errMsg:t.errMsg})}),o.onClose(function(e){e&&e.isEnded||void 0===e?(t.callRewardAdCallback(!0),cc.pvz.TAUtils.trackAdClose(t.rewardVideoIndex,!0)):(t.callRewardAdCallback(!1),cc.pvz.TAUtils.trackAdClose(t.rewardVideoIndex,!1))}),o},createPublicRewardAd:function(e){var t=this,o=!n;n=wx.createRewardedVideoAd({adUnitId:cc.pvz.GameConst.AD_UNITS_REWARD[e]}),o&&(n.onLoad(function(){console.log("RewardedVideoAd onLoad")}),n.onError(function(e){console.log("RewardedVideoAd onError",e)}),n.onClose(function(e){e&&e.isEnded||void 0===e?(t.callRewardAdCallback(!0),cc.pvz.TAUtils.trackAdClose(t.rewardVideoIndex,!0)):(t.callRewardAdCallback(!1),cc.pvz.TAUtils.trackAdClose(t.rewardVideoIndex,!1))}))},initP8AdInfo:function(){cc.sys.platform==cc.sys.WECHAT_GAME&&P8SDK.wxADinit(cc.pvz.GameConst.AD_UNITS_REWARD[0],null,null,null)},initRewardVideo:function(){var e=this;cc.sys.platform==cc.sys.WECHAT_GAME&&(a=new Array(cc.pvz.GameConst.AD_UNITS_REWARD.length).fill(null),"devtools"!=(wx.getDeviceInfo?wx.getDeviceInfo():wx.getSystemInfoSync()).platform?(i.forEach(function(t){a[t]=e.createRewardAd(t)}),console.log("initRewardVideo ended")):console.log("initRewardVideo skiped"))},showAdRewardVideo:function(e,t){if(console.log("showAdRewardVideo",e),cc.isControlAd){var o=this;if(o.cb=t,o.rewardVideoIndex=e,o.hasCalledCB=!1,10==cc.player.adTimes&&[cc.pvz.GameConfig.AdType["\u5e7f\u544a\u683c\u5b50"],cc.pvz.GameConfig.AdType["buff\u5237\u65b0"],cc.pvz.GameConfig.AdType["buff\u5168\u90e8"],cc.pvz.GameConfig.AdType["\u5173\u5361\u7ed3\u7b97"],cc.pvz.GameConfig.AdType["\u9633\u5149"],cc.pvz.GameConfig.AdType["\u6b7b\u4ea1\u590d\u6d3b"],cc.pvz.GameConfig.AdType["\u53cc\u500d\u901f\u5ea6"]].some(function(t){return t==e}))return void cc.pvz.TAUtils.share(e,function(e){o.callRewardAdCallback(e)});if(cc.pvz.TAUtils.trackP8AdClick(e),cc.sys.platform==cc.sys.WIN32||cc.sys.platform==cc.sys.MACOS||cc.sys.platform==cc.sys.DESKTOP_BROWSER||cc.sys.platform==cc.sys.MOBILE_BROWSER)return cc.popupManager.showToast("\u5e7f\u544a"+e),void o.callRewardAdCallback(!0);cc.pvz.cloud.access>=90?o.callRewardAdCallback(!0):(cc.butler.pauseDirector(0),P8SDK.videoADShow(function(){o.callRewardAdCallback(!0)},function(){o.callRewardAdCallback(!1)},function(){cc.popupManager.showToast("\u6682\u65e0\u5e7f\u544a\u53ef\u770b"),o.callRewardAdCallback(!1)}))}else cc.popupManager.showToast("\u6682\u65e0\u5e7f\u544a\u53ef\u770b")},showAdBanner:function(e){void 0===e&&(e=!1)},hideAdBanner:function(){}};cc.pvz||(cc.pvz={}),cc.pvz.AdUtils=c,t.exports=c,cc._RF.pop()},{}],AutoScale:[function(e,t){"use strict";cc._RF.push(t,"863dallCn5L1ITZ5Vr7oggX","AutoScale"),cc.Class({extends:cc.Component,onLoad:function(){this.initBy(this.usingInitSize?this.w:this.node.width,this.usingInitSize?this.h:this.node.height)},setNodeSize:function(e,t){this.usingInitSize=!0,this.w=e,this.h=t},initBy:function(e,t){var o=Math.min(cc.view.getCanvasSize().width/e,cc.view.getCanvasSize().height/t),a=e*o,n=t*o;this.node.scale=Math.max(cc.view.getCanvasSize().width/a,cc.view.getCanvasSize().height/n)}}),cc._RF.pop()},{}],BattleGround2Ctrl:[function(e,t,o){"use strict";cc._RF.push(t,"3bce079b2xL47cGTCCdMl1d","BattleGround2Ctrl");var a=e("./SoundManager"),n=e("./Tool"),i=e("./Pool"),c=e("./Bullet2"),s=e("./DieEff2"),r=e("./Gate2"),l=e("./Num2"),u=e("./Role2"),p=cc._decorator,d=p.ccclass,h=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.jsonAssets=[],t.pools=[],t.startNode=null,t.endNode=null,t.hpProgBar=null,t.hitAni=null,t.atkStr=null,t.WIDTH=600,t.state=10,t.baseLineY=-500,t.endLineY=-500,t.player=null,t.winTCount=-99999999,t.hp=[3,3],t.waveEnemyHandles=[[],[],[],[],[],[]],t.bulletHandles=[],t}var o;return __extends(t,e),o=t,t.prototype.start=function(){for(var e=["ConfigBattle"],t=function(t){o.JSONManager[e[t]]={},n.jsonAssets[t].json.map(function(a){o.JSONManager[e[t]][a.id]=a})},n=this,i=0;i<this.jsonAssets.length;i++)t(i);this.baseLineY=this.startNode.y,this.endLineY=this.endNode.y,this.state=10,this.createNewPlayer(),setTimeout(function(){a.default.playBgm(0)},1e3),cc.director.getCollisionManager().enabled=!0},t.prototype.createNewPlayer=function(){var e=this.pools[4].getComponent(i.default).getNewPoolItem();this.player=e,e.setPosition(new cc.Vec2(0,this.baseLineY)),e.getComponent(u.default).init({team:0,rId:1,par:this})},t.prototype.createNewEnemy=function(e,t,o){void 0===o&&(o={});var a=this.pools[0].getComponent(i.default).getNewPoolItem();return a.setPosition(new cc.Vec2(e,t)),a.getComponent(u.default).init({team:1,rId:o.rId,config:o.config,par:this}),a},t.prototype.createNewBullet=function(e,t,o){var a=this.pools[2].getComponent(i.default).getNewPoolItem();o.par=this,a.getComponent(c.default).init(e,t,o)},t.prototype.createNewHpNum=function(e){var t=this.pools[1].getComponent(i.default).getNewPoolItem();return t.getComponent(l.default).initAsHp(e),t},t.prototype.createNewHitNum=function(){},t.prototype.createNewDieEff=function(e){var t=this.pools[5].getComponent(i.default).getNewPoolItem();t.setPosition(e.position),t.getComponent(s.default).init()},t.prototype.createNewGate=function(e){void 0===e&&(e={});var t=this.pools[3].getComponent(i.default).getNewPoolItem();t.y=800;for(var o=[],a=1;a<=5;a++)0!==e["door"+a]&&o.push(a);var c=n.default.randomFromArr2(o,2);n.default.shuffle(c);var s=[[c[0],e["door"+c[0]]],[c[1],e["door"+c[1]]]];t.getComponent(r.default).init({par:this,gateInfo:s})},t.prototype.beHit=function(){this.hitAni.play(),this.hp[0]--,this.hpProgBar.progress=this.hp[0]/this.hp[1],this.hp[0]<=0&&(console.log("game over."),cc.popupManager.popup("game2","win","UIGame2End",{ad:!1,scale:!0},!1),this.state=0)},t.prototype.refreshAtk=function(){this.atkStr.string=""+this.player.getComponent(u.default).bulletConfig.dmg},t.prototype.showPauseMenu=function(){this.state=0,cc.popupManager.popup("game2","set","UIGame2Set",{scale:!1},this)},t.prototype.hidePauseMenu=function(){this.state=10},t.prototype.update=function(e){10===this.state&&this.winTCount>0&&(this.winTCount-=e,this.winTCount<=0&&cc.popupManager.popup("game2","win","UIGame2End",{ad:!1,scale:!0},!0))},t.JSONManager={ConfigBattle:{}},__decorate([h(cc.JsonAsset)],t.prototype,"jsonAssets",void 0),__decorate([h(cc.Node)],t.prototype,"pools",void 0),__decorate([h(cc.Node)],t.prototype,"startNode",void 0),__decorate([h(cc.Node)],t.prototype,"endNode",void 0),__decorate([h(cc.ProgressBar)],t.prototype,"hpProgBar",void 0),__decorate([h(cc.Animation)],t.prototype,"hitAni",void 0),__decorate([h(cc.Label)],t.prototype,"atkStr",void 0),o=__decorate([d],t)}(cc.Component);o.default=f,cc._RF.pop()},{"./Bullet2":"Bullet2","./DieEff2":"DieEff2","./Gate2":"Gate2","./Num2":"Num2","./Pool":"Pool","./Role2":"Role2","./SoundManager":"SoundManager","./Tool":"Tool"}],Bullet2:[function(e,t,o){"use strict";cc._RF.push(t,"109d76PvmlOd5jtepoMkZ3y","Bullet2");var a=e("./SoundManager"),n=e("./Pool"),i=e("./BattleGround2Ctrl"),c=e("./Gate2"),s=e("./Role2"),r=cc._decorator,l=r.ccclass,u=r.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.bodySpr=null,t.bodySFS=[],t.collBody=null,t.par=null,t.v=500,t.dmg=1,t.hitTimes=0,t.fCount=0,t.state=0,t.cIdx=0,t.tarColHandle=null,t}var o;return __extends(t,e),o=t,t.prototype.init=function(e,t,o){this.node.x=e,this.node.y=t,this.par=o.par,this.hitTimes=0,this.v=i.default.JSONManager.ConfigBattle[6].v[6],this.dmg=o.dmg,this.bodySpr.getComponent(cc.Sprite).spriteFrame=this.bodySFS[0],this.cIdx=Math.floor((this.node.x+299)/10),this.par.bulletHandles[this.cIdx]||(this.par.bulletHandles[this.cIdx]=[]),this.par.bulletHandles[this.cIdx].push(this.node),this.collBody.enabled=1===this.par.bulletHandles[this.cIdx].length,a.default.playEffect2(0),this.state=0},t.prototype.remove=function(e){this.updateBulletHandles(),1===e?(this.v=0,this.state=1,this.fCount=0,this.bodySpr.getComponent(cc.Sprite).spriteFrame=this.bodySFS[1]):this.node.parent.getComponent(n.default).destroyPoolItem(this.node)},t.prototype.start=function(){},t.prototype.onCollisionEnter=function(e){o.collTimes++,this.hitTimes>0||(1===e.tag?e.node.getComponent(s.default).beHit(this):3===e.tag&&e.node.getComponent(c.default).beHit(this),this.collBody.enabled=!1,this.hitTimes++,this.remove(1))},t.prototype.updateBulletHandles=function(){this.par.bulletHandles[this.cIdx].shift(),this.par.bulletHandles[this.cIdx].length>=1&&(this.par.bulletHandles[this.cIdx][0].getComponent(o).collBody.enabled=!0)},t.prototype.update=function(e){10===this.par.state&&(1===this.state?(this.fCount++,3===this.fCount?this.bodySpr.getComponent(cc.Sprite).spriteFrame=this.bodySFS[2]:6===this.fCount&&this.remove(0)):(this.node.y+=this.v*e,this.node.y>=799&&this.remove(0)))},t.collTimes=0,__decorate([u(cc.Label)],t.prototype,"label",void 0),__decorate([u(cc.Node)],t.prototype,"bodySpr",void 0),__decorate([u(cc.SpriteFrame)],t.prototype,"bodySFS",void 0),__decorate([u(cc.BoxCollider)],t.prototype,"collBody",void 0),o=__decorate([l],t)}(cc.Component);o.default=p,cc._RF.pop()},{"./BattleGround2Ctrl":"BattleGround2Ctrl","./Gate2":"Gate2","./Pool":"Pool","./Role2":"Role2","./SoundManager":"SoundManager"}],Butler:[function(e,t){"use strict";cc._RF.push(t,"f2ea01mWfhFUqhZWXpl3KFV","Butler"),cc.Class({extends:cc.Component,properties:{loadingBar:cc.ProgressBar},onLoad:function(){cc.butler=this,this.dFlag=0,cc.pvz.time=0,cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,this.beforeDirectorUpdate,this),cc.sys.platform==cc.sys.WECHAT_GAME&&this.polyfillSafeArea()},polyfillSafeArea:function(){wx.getSystemInfoSync().safeArea||(console.log("polyfill safeArea"),cc.sys.getSafeAreaRect=function(){var e=cc.view.getVisibleSize();return cc.rect(0,0,e.width,e.height)})},beforeDirectorUpdate:function(){this.checkToHandleGameHide&&this.handleGameHide();var e=1e3*cc.director.getDeltaTime();cc.pvz.time+=e*cc.director.getScheduler().getTimeScale(),cc.pvz.cloud&&cc.pvz.cloud.uid&&cc.pvz.cloud.needSaveToCloud>0&&(cc.pvz.PlayerData.saveDataToLocalOnline(),cc.pvz.cloud.needSaveToCloud=0)},start:function(){var e=this;cc.game.addPersistRootNode(this.node),cc.sys.platform==cc.sys.WECHAT_GAME?(wx.onHide(function(){console.log("wx.onHide"),e.handleGameHide()}),wx.onShow(function(){console.log("wx.onShow"),e.handleGameShow(),cc.pvz.TAUtils.onWxShow()})):cc.sys.platform==cc.sys.BYTEDANCE_GAME?(tt.onHide(function(){console.log("tt.onHide"),e.handleGameHide()}),tt.onShow(function(){console.log("tt.onShow"),e.handleGameShow()})):(cc.game.on(cc.game.EVENT_HIDE,function(){console.log("cc.game.EVENT_HIDE, frame:",cc.director.getTotalFrames()),e.handleGameHide()}),cc.game.on(cc.game.EVENT_SHOW,function(){console.log("cc.game.EVENT_SHOW, frame:",cc.director.getTotalFrames()),e.handleGameShow()})),cc.pvz.TAUtils.onCheckGameVersion()},handleGameHide:function(){console.log("handleGameHide"),this.pauseMusic(),cc.audioEngine.stopAllEffects(),cc.isRestart||this.saveData()},handleGameShow:function(){this.resumeMusic()},pauseDirector:function(e){0==this.dFlag&&cc.director.pause(),this.dFlag|=1<<e},resumeDirector:function(e){this.dFlag&=~(1<<e),0==this.dFlag&&cc.director.resume()},playMusic:function(e){this.music=e,cc.player&&cc.player.isMMute||(this.playingMusic=e,e&&(console.log("playmusic"),cc.audioEngine.playMusic(e,!0)))},pauseMusic:function(){cc.audioEngine.pauseMusic()},resumeMusic:function(){cc.player&&cc.player.isMMute?console.log("resumeMusic return"):this.music!=this.playingMusic?(console.log("resumeMusic play new"),this.playMusic(this.music)):(console.log("resumeMusic resume old"),cc.audioEngine.resumeMusic())},playEffect:function(e,t){return void 0===t&&(t=!1),cc.player&&cc.player.isSMute?-1:e?cc.audioEngine.playEffect(e,t):-1},resumeEffect:function(e){if(cc.player&&cc.player.isSMute)return-1;cc.audioEngine.resumeEffect(e)},playEffectAsync:function(e,t,o){var a=this;if(void 0===o&&(o=!1),!cc.player||!cc.player.isSMute){var n=null;if(o){if(this.exclusiveMap||(this.exclusiveMap={}),n=e+t,this.exclusiveMap[n])return;this.exclusiveMap[n]=!0}cc.pvz.utils.useBundleAsset(e,t,cc.AudioClip,function(e){if(o){var t=a.playEffect(e,!1);-1==t?a.exclusiveMap[n]=!1:cc.audioEngine.setFinishCallback(t,function(){a.exclusiveMap[n]=!1})}else a.playEffect(e,!1)})}},playEffectAsync2:function(e){if(!cc.player||!cc.player.isSMute){var t=e.indexOf(",");this.playEffectAsync(e.substring(0,t),e.substring(t+1))}},setMusicSwitch:function(e){cc.player.isMMute!=e&&this.node.emit("music-switch",e),this.setMusicMute(e),cc.player.isMMute?this.pauseMusic():this.resumeMusic()},setSoundSwitch:function(e){this.setSoundMute(e),cc.player.isSMute&&cc.audioEngine.stopAllEffects()},saveData:function(){cc.pvz.PlayerData.saveData()},setMusicMute:function(e){cc.player.isMMute=e,cc.pvz.PlayerData.onDataChanged()},setSoundMute:function(e){cc.player.isSMute=e,cc.pvz.PlayerData.onDataChanged()},onToggleMusic:function(e){console.log("onToggleMusic",e.isChecked),this.setMusicSwitch(!e.isChecked),this.setSoundSwitch(!e.isChecked)},loadBundles:function(e,t,o){var a=this;this.loadingBar&&(this.loadingBar.progress=0),this.loadedBundle=0,cc.assetManager.loadBundle(e[0],null,function n(i,c){i?console.log("load subpackage  fail:",i):(console.log("load bundle "+c.name+" successfully."),a.loadedBundle++,a.loadedBundle==e.length?o&&o():cc.assetManager.loadBundle(e[a.loadedBundle],null,n),a.loadingBar&&cc.tween(a.loadingBar).to(.2,{progress:(a.loadedBundle+1)/t}).start())}),this.loadingBar&&cc.tween(this.loadingBar).to(.2,{progress:(this.loadedBundle+1)/t}).start()}}),cc._RF.pop()},{}],Cloud:[function(e,t){"use strict";cc._RF.push(t,"5d7fa5ix3RGmr2YNPNDOpd8","Cloud");var o="https://yiyouzan.cn/xsapi/rabbit/",a={uid:null,header:null,access:0,isGM:!1,needSaveToCloud:0,baseData:"{}",login:function(e){var t=this;if(cc.sys.platform==cc.sys.DESKTOP_BROWSER||cc.sys.platform==cc.sys.WIN32||cc.sys.platform==cc.sys.MOBILE_BROWSER)return this.access=100,void e(!0);var o=function(t){e&&e(t)};console.log("perpare p8 login"),P8SDK.login().then(function(e){var a=e.data.openid;t.loginSelf(a,o)})},loginSelf:function(e,t){var a=this,n=o+(cc.sys.platform==cc.sys.BYTEDANCE_GAME?"user/bytelogin2":"/user/p8loginkp");wx.request({url:n,method:"POST",data:{loginCode:e},success:function(e){console.log("login success:",e.data),e.data.new&&cc.pvz.TAUtils.uploadRegisterData({uid:e.data.uid}),a.uid=e.data.uid,e.data.name?a.name=e.data.name:a.name="\u73a9\u5bb6"+a.uid,a.access=e.data.access,a.header={uid:e.data.uid,uToken:e.data.token},a.isGM=e.data.access,a.getOnlineData(t)},fail:function(){t(!1)}})},req:function(e,t,a,n){wx.request({url:o+e,method:t?"POST":"GET",header:this.header,data:a,success:function(e){console.log("req success, data:",e.data),n(!0,e.data)},fail:function(e){console.log("req fail, errMsg:",e.errMsg),n(!1)}})},getOnlineData:function(e){var t=this;wx.request({url:o+"game/infokp",method:"GET",header:t.header,success:function(o){1==o.data.ok?(t.baseData=o.data.baseData,e(!0)):e(!1)},fail:function(t){console.log("info errMsg:",t.errMsg),e(!1)}})},checkUpdatePlayerInfo:function(e,t){var o=this;this.uid?this.updatePlayerInfo(e,t):this.login(function(a){a?o.updatePlayerInfo(e,t):t(!1)})},updatePlayerInfo:function(e,t){if(console.log("updatePlayerInfo"),cc.sys.platform==cc.sys.WECHAT_GAME){var a=0,n=!0,i=function(e){e||(n=!1),++a>=0&&t(n)},c=JSON.stringify(e);wx.request({url:o+"game/setbaseinfokp",method:"POST",header:this.header,data:{lv:cc.pvz.PlayerData.getAchieveProgress(cc.pvz.GameConfig.MissionType["\u88c5\u5907\u603b\u7b49\u7ea7n"]),info:c},success:function(e){console.log("setbaseinfo success:",e.data),i(1==e.data.ok),0==e.data.ok&&"not login"==e.data.rsn&&wx.showToast({title:"\u767b\u5f55\u5df2\u5931\u6548",icon:"success",duration:1500})},fail:function(e){console.log("setbaseinfo errMsg:",e.errMsg),i(!1)}}),this.sendC++}else t(!0)},setAvatar:function(e,t,a){wx.request({url:o+"game/authkp",method:"POST",header:this.header,data:{name:e,avatarUrl:t},success:function(e){console.log("authkp success:",e.data),a(1==e.data.ok)},fail:function(e){console.log("authkp fail:",e.errMsg),a(!1)}})},uploadScore:function(e,t,a,n){if(cc.sys.platform!=cc.sys.WECHAT_GAME)return console.log("update score:",e,",exInfo:",t,",exInfo2:",a),void setTimeout(function(){n(!0)});wx.request({url:o+"game/updatescorekp",method:"POST",header:this.header,data:{score:e,exInfo:t,exInfo2:a},success:function(e){console.log("updatescorekp success:",e.data),n(1==e.data.ok)},fail:function(e){console.log("updatescorekp fail:",e.errMsg),n(!1)}})},myRank:function(e){cc.sys.platform==cc.sys.WECHAT_GAME?wx.request({url:o+"game/myrankkp",method:"GET",header:this.header,success:function(t){console.log("myrankkp success:",t.data),e(1==t.data.ok,t.data)},fail:function(t){console.log("myrankkp fail:",t.errMsg),e(!1)}}):setTimeout(function(){e(!0,{ok:1,rank:0,info:{uid:40303867,sector:2,name:"momo",avatarUrl:"",score:13,exInfo:"",isCheat:0,rankLastWeek:4}})})},rankList:function(e,t){cc.sys.platform==cc.sys.WECHAT_GAME?wx.request({url:o+"game/ranklistkp",method:"POST",header:this.header,data:{fromIdx:e},success:function(e){console.log("ranklistkp success:",e.data),t(1==e.data.ok,e.data.ret)},fail:function(e){console.log("ranklistkp fail:",e.errMsg),t(!1)}}):setTimeout(function(){t(!0,[{rank:0,uInfo:{uid:40000006,sector:2,name:"NONAME",avatarUrl:"",score:15,exInfo:"8",isCheat:0}}])})},makeFriend:function(){if(cc.sys.platform==cc.sys.WECHAT_GAME)if(wx.getEnterOptionsSync){var e=wx.getEnterOptionsSync();e.query&&e.query.fromuid?(console.log("setrelationkp to",e.query.fromuid),this.req("game/setrelationkp",!0,{uid2:parseInt(e.query.fromuid)},function(t,o){console.log("setrelationkp to",e.query.fromuid,t,o)})):console.log("no query!",e)}else console.log("no option func");else console.log("make friend relation.")},updatePlayerSub:function(e){var t=o+"game/subscribekp";cc.sys.platform==cc.sys.BYTEDANCE_GAME?tt.request({url:t,method:"POST",header:this.header,data:{flag:e},success:function(e){console.log("subscribe success:",e.data)},fail:function(e){console.log("subscribe fail:",e.errMsg)}}):cc.sys.platform==cc.sys.WECHAT_GAME&&wx.request({url:t,method:"POST",header:this.header,data:{flag:e},success:function(e){console.log("subscribe success:",e.data)},fail:function(e){console.log("subscribe fail:",e.errMsg)}})}};cc.pvz||(cc.pvz={}),cc.pvz.cloud=a,t.exports=a,cc._RF.pop()},{}],ContentAdapter:[function(e,t){"use strict";cc._RF.push(t,"5bef7annw9LvoYqXEHEylmf","ContentAdapter"),cc.Class({extends:cc.Component,onLoad:function(){var e=Math.min(cc.view.getCanvasSize().width/this.node.width,cc.view.getCanvasSize().height/this.node.height),t=this.node.width*e,o=this.node.height*e;this.node.width=this.node.width*(cc.view.getCanvasSize().width/t),this.node.height=this.node.height*(cc.view.getCanvasSize().height/o)}}),cc._RF.pop()},{}],CustomSafeArea:[function(e,t){"use strict";cc._RF.push(t,"ec394g+uDNETL/uJudd6l8Y","CustomSafeArea");var o=cc.Enum({WIN:0,PARENT:1,CANVAS:2});cc.Class({extends:cc.SafeArea,properties:{fitTarget:{type:o,default:o.WIN},ensureLeft:!0,ensureRight:!0,ensureTop:!0,ensureBottom:!0,top:0},updateArea:function(){var e=this.getComponent(cc.Widget);if(e){e.updateAlignment(),this.node.position,this.node.getAnchorPoint();var t=0,a=0;switch(this.fitTarget){case o.WIN:t=cc.winSize.width,a=cc.winSize.height;break;case o.PARENT:t=this.node.parent.width,a=this.node.parent.height;break;case o.CANVAS:t=cc.view.getCanvasSize().width,a=cc.view.getCanvasSize().height}var n,i=cc.sys.getSafeAreaRect();if(this.ensureLeft)e.isAlignLeft=!0,cc.sys.platform==cc.sys.WECHAT_GAME&&(n=wx.getWindowInfo?wx.getWindowInfo():wx.getSystemInfoSync()).safeArea?e.left=1600*n.safeArea.left/n.screenWidth:e.left=0,console.log("ensureLeft:",e.left);this.ensureRight&&(e.isAlignRight=!0,e.right=t-i.x-i.width,console.log("ensureRight:",e.right)),this.ensureTop&&(e.isAlignTop=!0,e.top=a-i.y-i.height+this.top,console.log("ensureTop:",e.top)),this.ensureBottom&&(e.isAlignBottom=!0,e.bottom=i.y,console.log("ensureBottom:",e.bottom)),e.updateAlignment(),cc._widgetManager.add(e)}}}),cc._RF.pop()},{}],DieEff2:[function(e,t,o){"use strict";cc._RF.push(t,"f867bPLNXFBP6DGSwTrk17o","DieEff2");var a=e("./Tool"),n=e("./Pool"),i=cc._decorator,c=i.ccclass,s=i.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bodySpine=null,t}return __extends(t,e),t.prototype.init=function(){this.bodySpine.setAnimation(0,"die"+a.default.randomInt(1,3),!1)},t.prototype.start=function(){var e=this;this.bodySpine.setCompleteListener(function(){e.node.parent.getComponent(n.default).destroyPoolItem(e.node)})},__decorate([s(sp.Skeleton)],t.prototype,"bodySpine",void 0),__decorate([c],t)}(cc.Component);o.default=r,cc._RF.pop()},{"./Pool":"Pool","./Tool":"Tool"}],EnemySpawner2:[function(e,t,o){"use strict";cc._RF.push(t,"b0a83OYe7VCLIJ5J+x88fA0","EnemySpawner2");var a=e("./BattleGround2Ctrl"),n=e("./Role2"),i=cc._decorator,c=i.ccclass,s=i.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.jsonConfig=null,t.par=null,t.tCount=0,t.enemyLivingCount=[0,0],t.waveId=0,t.ePoint=0,t.waveEnemies=[[[1],[-100,100],[-100,100]],[[1],[0],[-100,100],[-200,0,200],[-100,100],[0]],[[1],[0],[-50,50],[-100,0,100],[-150,-50,50,150]],[[10],[-250,-150,-50,50,150,250]]],t.waveEnemyRec=[],t}return __extends(t,e),t.prototype.init=function(){cc.pvz.runtimeData.wave=0,this.prepareNewWaveEnemy()},t.prototype.prepareNewWaveEnemy=function(e){void 0===e&&(e=1),this.par.waveEnemyHandles=[[],[],[],[],[],[]];for(var t=0,o=0;o<this.jsonConfig.json.length;o++)if(this.jsonConfig.json[o].level===this.waveId+1){t=o;break}for(;this.jsonConfig.json[t].level===this.waveId+1;){var a=this.jsonConfig.json[t].numb-1;a>2&&(a=3);var n=this.waveEnemies[a][0][0];3===a&&(n=this.jsonConfig.json[t].numb),this.waveEnemyRec=[];for(var i=0;i<n;i++)for(o=1;o<this.waveEnemies[a].length;o++){for(var c=0;c<this.waveEnemies[a][o].length;c++)this.waveEnemyRec.push([e,t,this.waveEnemies[a][o][c]]);e+=1}if(t++,!this.jsonConfig.json[t])break}t>=this.jsonConfig.json.length||this.waveEnemyRec.push([e+3,t-1,99999]),this.tCount=0,this.ePoint=0},t.prototype.spawnNewEnemy=function(e){if(10===this.par.state){this.tCount+=e;for(var t=this.jsonConfig.json;this.ePoint<this.waveEnemyRec.length&&this.tCount>=this.waveEnemyRec[this.ePoint][0];){if(99999===this.waveEnemyRec[this.ePoint][2])this.node.getComponent(a.default).createNewGate(t[this.waveEnemyRec[this.ePoint][1]]);else{var o=this.par.createNewEnemy(this.waveEnemyRec[this.ePoint][2],800,{rId:this.waveEnemyRec[this.ePoint][1],config:t[this.waveEnemyRec[this.ePoint][1]]});if(o.zIndex=-this.ePoint,t[this.waveEnemyRec[this.ePoint][1]].numb>=10){var i=(this.waveEnemyRec[this.ePoint][2]+250)/100;this.par.waveEnemyHandles[i].push(o),1===this.par.waveEnemyHandles[i].length?o.getComponent(n.default).collBody.enabled=!0:o.getComponent(n.default).collBody.enabled=!1}else o.getComponent(n.default).collBody.enabled=!0}this.ePoint++}this.ePoint===this.waveEnemyRec.length&&(this.waveId+1===t[t.length-1].level?-99999999===this.par.winTCount&&(this.par.winTCount=6):(this.waveId++,cc.pvz.runtimeData.wave++,this.prepareNewWaveEnemy(4)))}},t.prototype.updateEnemyHandles=function(e){var t=Math.floor((e+250)/100);this.par.waveEnemyHandles[t]&&(this.par.waveEnemyHandles[t].shift(),this.par.waveEnemyHandles[t].length>=1&&(this.par.waveEnemyHandles[t][0].getComponent(n.default).collBody.enabled=!0))},t.prototype.start=function(){this.init()},t.prototype.update=function(e){this.spawnNewEnemy(e)},__decorate([s(cc.JsonAsset)],t.prototype,"jsonConfig",void 0),__decorate([s(a.default)],t.prototype,"par",void 0),__decorate([c],t)}(cc.Component);o.default=r,cc._RF.pop()},{"./BattleGround2Ctrl":"BattleGround2Ctrl","./Role2":"Role2"}],GameConfig:[function(e,t){"use strict";cc._RF.push(t,"f2ab1Vav69Dga7urRgqDcj+","GameConfig");var o={ItemType:cc.Enum({"\u94f6\u5e01":1,"\u91d1\u5e01":2,"\u94bb\u77f3":3,"\u4f53\u529b":4,"\u968f\u673a\u7eff\u8272\u788e\u7247":5,"\u968f\u673a\u84dd\u8272\u788e\u7247":6,"\u968f\u673a\u7d2b\u8272\u788e\u7247":7,"\u56fa\u5b9a\u788e\u7247":8,"\u8363\u8a89":9,"\u65e5\u5e38\u4efb\u52a1\u79ef\u5206":50,"\u5468\u5e38\u4efb\u52a1\u79ef\u5206":51}),AdType:cc.Enum({"\u4f53\u529b\u8d2d\u4e70":0,"\u5546\u5e97\u94bb\u77f3":1,"\u5546\u5e97\u91d1\u5e01":2,"\u5546\u5e97\u5b9d\u7bb1":3,"\u5546\u5e97\u5237\u65b0":4,"\u5173\u5361\u626b\u8361":5,"\u5173\u5361\u7ed3\u7b97":6,"\u53cc\u500d\u901f\u5ea6":7,"\u5e7f\u544a\u683c\u5b50":8,"\u6b7b\u4ea1\u590d\u6d3b":9,"\u9053\u5177\u4e0d\u8db3":10,"\u989d\u5916\u6311\u6218":11,"\u8bd5\u7528\u690d\u7269":12,"\u5237\u65b02\u7ea7":13,"\u9633\u5149":14,"buff\u5237\u65b0":15,"buff\u5168\u90e8":16,"\u53cc\u500d\u7b7e\u5230":17,"\u57fa\u91d1":18,"\u5237\u65b0\u5e7f\u544a\u683c\u5b50":19,"\u65e0\u5c3d\u706b\u529b":20}),UIFromType:cc.Enum({"\u4e3b\u754c\u9762":0,"\u5173\u5361\u5b9d\u7bb1":1,"\u6bcf\u65e5\u5546\u5e97":2,"\u91d1\u5e01\u5546\u5e97":3,"\u5b9d\u7bb1\u5546\u5e97":4,"\u6311\u6218\u526f\u672c":5,"\u9053\u5177\u4e0d\u8db3":6,"\u7b7e\u5230":7,"\u5206\u4eab\u5956\u52b1":8,"\u6210\u5c31":9,"\u65e5\u5e38\u4efb\u52a1":10,"\u5468\u5e38\u4efb\u52a1":11,"\u57fa\u91d1":12,"\u6293\u7403\u7403":13,"\u6392\u4f4d\u8d5b":14}),MissionType:cc.Enum({"\u767b\u5f551\u6b21":1,"\u6311\u6218\u4e3b\u7ebf\u7ae0\u82821\u6b21":2,"\u5347\u7ea7\u4efb\u610f\u88c5\u59071\u6b21":3,"\u6bcf\u65e5\u5546\u5e97\u8d2d\u4e70n\u6b21\u7269\u54c1":4,"\u9ad8\u7ea7\u5b9d\u7bb1\u62bd\u53d6\u88c5\u5907n\u6b21":5,"\u626b\u8361\u5173\u5361n\u6b21":6,"\u53c2\u4e0e\u6311\u6218\u5173\u5361n\u6b21":7,"\u8d2d\u4e70\u4f53\u529bn\u6b21":8,"\u89c2\u770b\u5e7f\u544an\u6b21":9,"\u901a\u5173\u4e3b\u7ebf\u526f\u672cn\u6b21":10,"\u51fb\u8d25\u50f5\u5c38n\u4e2a":11,"\u51fb\u8d25\u9996\u9886n\u4e2a":12,"\u901a\u5173\u6311\u6218\u5173\u5361n\u6b21":13,"\u901a\u8fc7\u4e3b\u7ebf\u7ae0\u8282n":14,"\u88c5\u5907\u6700\u9ad8\u7b49\u7ea7\u8fbe\u5230n":15,"\u88c5\u5907\u603b\u7b49\u7ea7n":16,"\u7d2f\u8ba1\u83b7\u5f97\u91d1\u5e01":17,"\u7d2f\u8ba1\u6d88\u8017\u94bb\u77f3":18,"\u53c2\u4e0e\u65e0\u5c3d\u6311\u6218\u8d5bN\u6b21":19}),ActType:cc.Enum({"\u6311\u6218\u526f\u672c":0}),RewardData:cc.Class({name:"RewardData",properties:{itemId:cc.Integer,count:cc.Integer,toolId:cc.Integer}}),MaxPower:20,CdPowerTime:720,PowerBuyTip:"\u4eca\u65e5\u5269\u4f59$\u6b21",LevelFinishTip:"\u5df2\u901a\u5173",LevelMaxWaveTip:"\u6700\u9ad8\u8bb0\u5f55\uff1a\u7b2c$\u6ce2",LevelLockTip:"\u901a\u5173\u7b2c$\u7ae0\u540e\u89e3\u9501",LevelBoxTip:"\u7b2c$\u6ce2",MaxLevel:30,BattlePower:5,PowerBuyPrices:[30,30,30],MaxToolCount:12,ToolLockLevel:[0,0,0,0,0,0,2,3,4,5,6,7],Quality2Tools:[1,2,3,8],Quality3Tools:[4,5,6,10],Quality4Tools:[7,9,11,12],MaxToolLv:16,ToolAttriNameList:["\u76ee\u6807","\u51b7\u5374","\u653b\u51fb","\u5c04\u7a0b","\u8840\u91cf","\u53e0\u7532","\u56de\u8840","\u94b1\u5e01","\u53e0\u7532","\u5145\u80fd"],ToolLockTip:"\u901a\u5173\u5173\u5361$\u89e3\u9501",ToolSkinTip:"\u5408\u6210$\u9636",ShopTimesType:cc.Enum({"\u5546\u5e97\u5237\u65b0":0,"\u94bb\u77f3\u514d\u8d39":1,"\u91d1\u5e01\u514d\u8d39":2}),ShopBoxCD:[3600,86400],ShopBoxPrice:[30,200],BoxTipNames:["<outline color=black width=2.5><color=#0FFF00>\u666e\u901a</outline>","<outline color=black width=2.5><color=#00D1FF>\u9ad8\u7ea7</outline>","<outline color=black width=2.5><color=#FF33F3>\u7a00\u6709</outline>"],MaxActLevelScore:1e4,MaxShareTimes:10,AdBuyTooldCounts:[50,10,1],ShareTitileList:["\u5361\u76ae\u5df4\u62c9~~go go go\uff01"],ShareIDList:["aaM7i9PiSKuTLDzHg66UYg=="],ShareUrlList:["https://mmocgame.qpic.cn/wechatgame/C7yIVibiba7k6HgAJffl3XSadxOJ0cMLaXbbVyTcliavyxyM9OmxmLghQ3mNGUV1S1s/0"],OpenSysLv:[8,4],ArrayPlaceOpLv:[2,4]};cc.pvz||(cc.pvz={}),cc.pvz.GameConfig=o,t.exports=o,cc._RF.pop()},{}],GameConst:[function(e,t){"use strict";cc._RF.push(t,"c496eUrUmJIea8UNv8bm9A6","GameConst");var o={wxappId:"wx93940dc722752b00",TA_GAME_ID:999999,TA_APP_ID:"",TA_SERVER_ID:"",GAME_VERSION:"1.0.8",SERVER_CONFIG_URL:"",SHARE_TITLE:"",SHARE_ID:"",SHARE_URL:"",AD_UNITS_BANNER:[],AD_UNITS_REWARD:["adunit-f8114fe54aa1d779"],Twtraceid_YXBN:"yxbn",Twtraceid_YXSP:"yxsp"};cc.pvz||(cc.pvz={}),cc.pvz.GameConst=o,t.exports=o,cc._RF.pop()},{}],Gate2:[function(e,t,o){"use strict";cc._RF.push(t,"d38e1GOzXlHE6pl6LVEnVvY","Gate2");var a=e("./Pool"),n=e("./BattleGround2Ctrl"),i=e("./Role2"),c=cc._decorator,s=c.ccclass,r=c.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sep=null,t.gates=[],t.gateStrs=[],t.gateColors=[],t.par=null,t.sepWidth=5,t.nextHitTime=0,t.v=0,t.buffs=[[300,0,0,0],[300,0,0,0]],t}return __extends(t,e),t.prototype.init=function(e){void 0===e&&(e={}),this.par=e.par,this.v=n.default.JSONManager.ConfigBattle[6].v[0],this.buffs[0][0]=this.par.WIDTH/2,this.buffs[1][0]=this.par.WIDTH/2,this.buffs[0][3]=0,this.buffs[1][3]=0,this.gates[0].width=this.par.WIDTH/2,this.gates[0].x=-this.par.WIDTH/4,this.gates[1].width=this.par.WIDTH/2,this.gates[1].x=this.par.WIDTH/4,this.buffs[0][1]=e.gateInfo[0][0],this.buffs[0][2]=e.gateInfo[0][1],this.buffs[1][1]=e.gateInfo[1][0],this.buffs[1][2]=e.gateInfo[1][1],this.sep.x=0,this.nextHitTime=0,this.setText()},t.prototype.moving=function(e){10===this.par.state&&(this.node.y-=this.v*e,this.nextHitTime-=e,this.nextHitTime<=0&&(this.buffs[0][3]>0&&(this.addBuff(0),this.buffs[0][3]>this.buffs[1][3]&&(this.setGateWidth(0,this.sepWidth),this.setGateWidth(1,-this.sepWidth)),this.nextHitTime=n.default.JSONManager.ConfigBattle[6].v[1]),this.buffs[1][3]>0&&(this.addBuff(1),this.buffs[1][3]>this.buffs[0][3]&&(this.setGateWidth(1,this.sepWidth),this.setGateWidth(0,-this.sepWidth)),this.nextHitTime=n.default.JSONManager.ConfigBattle[6].v[1]),this.buffs[0][3]=0,this.buffs[1][3]=0),this.node.y<this.par.endLineY+this.node.height/2&&this.use())},t.prototype.addBuff=function(e){this.buffs[e][2]++,0===this.buffs[e][2]&&(this.buffs[e][2]=1),2===this.buffs[e][1]&&this.buffs[e][2]>8&&(this.buffs[e][2]=8)},t.prototype.setGateWidth=function(e,t){this.buffs[e][0]+=t,this.buffs[e][0]<10*this.sepWidth?this.buffs[e][0]=10*this.sepWidth:this.buffs[e][0]>this.par.WIDTH-10*this.sepWidth&&(this.buffs[e][0]=this.par.WIDTH-10*this.sepWidth),this.gates[e].width=this.buffs[e][0],0===e?(this.gates[e].x=-this.par.WIDTH/2+this.gates[e].width/2,this.sep.x=-this.par.WIDTH/2+this.gates[e].width):this.gates[e].x=this.par.WIDTH/2-this.gates[e].width/2,this.gates[e].getComponent(cc.Sprite).spriteFrame=this.gateColors[t>0?0:1]},t.prototype.beHit=function(e){e.node.x<-this.par.WIDTH/2+this.buffs[0][0]?this.buffs[0][3]++:this.buffs[1][3]++,this.setText()},t.prototype.use=function(){this.par.player.x<this.sep.x?this.getBuff(this.buffs[0][1],this.buffs[0][2]):this.getBuff(this.buffs[1][1],this.buffs[1][2]),this.node.parent.getComponent(a.default).destroyPoolItem(this.node)},t.prototype.getBuff=function(e,t){var o=this.par.player.getComponent(i.default);switch(e){case 1:t>0?(o.bulletConfig.rate-=.015*t,o.bulletConfig.rate<1/15&&(o.bulletConfig.rate=1/15)):o.bulletConfig.rate*=Math.abs(t);break;case 2:o.bulletConfig.nums+=t,o.bulletConfig.nums<1&&(o.bulletConfig.nums=1),o.bulletConfig.nums>10&&(o.bulletConfig.nums=10);break;case 3:t>0?o.bulletConfig.dmg*=t:(o.bulletConfig.dmg/=Math.abs(t),o.bulletConfig.dmg=Math.floor(o.bulletConfig.dmg)),this.par.refreshAtk();break;case 4:case 5:o.bulletConfig.dmg+=t,this.par.refreshAtk()}},t.prototype.setText=function(){var e={1:["\u653b\u901f ","x","\xf7"],2:["\u5f39\u9053 ","+","-"],3:["\u653b\u51fb ","x","\xf7"],4:["\u653b\u51fb ","+","-"],5:["\u653b\u51fb ","+","-"]};this.gateStrs[0].node.setScale(this.buffs[0][0]/300),this.gateStrs[1].node.setScale(this.buffs[1][0]/300),this.gateStrs[0].string=e[this.buffs[0][1]][0]+e[this.buffs[0][1]][this.buffs[0][2]>=0?1:2]+" "+Math.abs(this.buffs[0][2]),this.gateStrs[1].string=e[this.buffs[1][1]][0]+e[this.buffs[1][1]][this.buffs[1][2]>=0?1:2]+" "+Math.abs(this.buffs[1][2])},t.prototype.start=function(){},t.prototype.update=function(e){this.moving(e)},__decorate([r(cc.Node)],t.prototype,"sep",void 0),__decorate([r(cc.Node)],t.prototype,"gates",void 0),__decorate([r(cc.Label)],t.prototype,"gateStrs",void 0),__decorate([r(cc.SpriteFrame)],t.prototype,"gateColors",void 0),__decorate([s],t)}(cc.Component);o.default=l,cc._RF.pop()},{"./BattleGround2Ctrl":"BattleGround2Ctrl","./Pool":"Pool","./Role2":"Role2"}],GuideManager:[function(e,t){"use strict";cc._RF.push(t,"3e530AnaFpCRpPVjJjsRRmq","GuideManager"),cc.Class({extends:cc.Component,properties:{spine:sp.Skeleton,focusNode:cc.Node,fingerSpine:sp.Skeleton,guideNode:cc.Node,guideLabel:cc.Label},onLoad:function(){var e=this;cc.guideManager=this,this.guideNode&&(this.guideNode.active=!1),this.hackButton(),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,function(t){e.node.parent=t})},isGuiding:function(){return this.guideNode.active},showGuide:function(e,t,o){var a=this,n=-1;!function e(){if(++n>=t.length)a.hideGuideDialog(),a.guideConfig=null,o&&o(!0);else{var i=t[n];a.showGuideDialog(i,e),o&&o(!1,n)}}()},showGuideDialog:function(e,t){var o,a=this;this.guideConfig={btn:e.btn,r:e.r,cb:t},this.guideNode.zIndex=cc.macro.MAX_ZINDEX,this.guideNode.active=!0,e.y?this.spine.node.y=e.y:e.t?this.spine.node.y=200:this.spine.node.y=0,this.spine.setAnimation(0,e.r?"jiaoxue1_R":"jiaoxue1",!1),this.spine.setCompleteListener(function(){a.spine.setAnimation(0,e.r?"jiaoxue2_R":"jiaoxue2",!0),a.spine.setCompleteListener(null)}),this.guideLabel.string=e.tip,this.guideLabel.node.stopAllActions(),this.guideLabel.node.opacity=0,this.guideLabel.node.runAction(cc.fadeIn(.5)),o=e.focus?e.focus.getBoundingBoxToWorld():cc.rect();var n=this.guideNode.parent.convertToNodeSpaceAR(o.center);this.focusNode.active=!0,this.focusNode.x=n.x,this.focusNode.y=n.y,this.focusNode.width=this.focusNode.height=0,this.focusNode.opacity=255,cc.tween(this.focusNode).to(.5,{width:o.width,height:o.height}).start(),this.fingerSpine.node.active=!e.hideFinger,this.fingerSpine.node.active&&this.fingerSpine.setAnimation(0,e.fingerAni||"dianji",!0)},hideGuideDialog:function(){var e=this;this.spine.setAnimation(0,this.guideConfig.r?"jiaoxue3_R":"jiaoxue3",!1),this.spine.setCompleteListener(function(){e.guideNode.active=!1,e.spine.setCompleteListener(null)}),this.guideLabel.node.runAction(cc.fadeOut(.2)),this.focusNode.width=0,this.focusNode.height=0,this.focusNode.active=!1,this.fingerSpine.node.active=!1},guideLogAndCheckBtnClick:function(e){this.guideConfig&&this.guideConfig.btn==e&&this.onStepFinished()},onStepFinished:function(){this.guideConfig&&this.guideConfig.cb&&this.guideConfig.cb()},onClickGuide:function(){console.log("onClickGuide"),this.guideConfig&&(this.guideConfig.btn||this.onStepFinished())},hackButton:function(){if(!cc.hasHackButton){cc.hasHackButton=!0;var e=cc.Button.prototype._onTouchEnded;cc.Button.prototype._onTouchEnded=function(t){this.interactable&&this.enabledInHierarchy&&this._pressed&&cc.guideManager.guideLogAndCheckBtnClick(this.node.name),e.call(this,t)}}}}),cc._RF.pop()},{}],JsonControl:[function(e,t){"use strict";cc._RF.push(t,"a52e5qhqWhJ5obJUHW0sS3o","JsonControl"),cc.Class({extends:cc.Component,properties:{itemJsonFile:cc.JsonAsset,levelMapJsonFile:cc.JsonAsset,toolInfoJsonFile:cc.JsonAsset,toollvUpJsonFile:cc.JsonAsset,levelDataJsonFile:cc.JsonAsset,actLevelBoxJsonFile:cc.JsonAsset,actLevelBuffJsonFile:cc.JsonAsset,actLevelJsonFile:cc.JsonAsset,rankLevelJsonFile:cc.JsonAsset,dayMissionJsonFile:cc.JsonAsset,dayMissionBoxJsonFile:cc.JsonAsset,weekMissionJsonFile:cc.JsonAsset,weekMissionBoxJsonFile:cc.JsonAsset,achieveJsonFile:cc.JsonAsset,materialList:{default:[],type:[cc.Material],tooltip:"\u7070\u8272\u6750\u8d28"}},onLoad:function(){cc.JsonControl=this,this.itemJson=this.itemJsonFile.json,this.levelMapJson=this.levelMapJsonFile.json,this.toolInfoJson=this.toolInfoJsonFile.json,this.toolLvUpJson=this.toollvUpJsonFile.json,this.levelDataJson=this.levelDataJsonFile.json,this.ActLevelBoxJson=this.actLevelBoxJsonFile.json,this.ActLevelJson=this.actLevelJsonFile.json,this.ActLevelBuffJson=this.actLevelBuffJsonFile.json,this.dayMissionJson=this.dayMissionJsonFile.json,this.dayMissionBoxJson=this.dayMissionBoxJsonFile.json,this.weekMissionJson=this.weekMissionJsonFile.json,this.weekMissionBoxJson=this.weekMissionBoxJsonFile.json,this.achieveJson=this.achieveJsonFile.json},getAllAchieveJson:function(){return this.achieveJson},getAchieveJson:function(e){return this.achieveJson.find(function(t){return t.ID==e})},getAllDayMissionJson:function(){return this.dayMissionJson},getDayMissionBoxJson:function(){return this.dayMissionBoxJson},getAllWeekMissionJson:function(){return this.weekMissionJson},getWeekMissionBoxJson:function(){return this.weekMissionBoxJson},getActBuffJson:function(e){return this.ActLevelBuffJson.find(function(t){return t.id==e})},getLevelData:function(e){return this.levelDataJson[e-1]},getSkillIcon:function(e,t){cc.pvz.utils.setSpriteFrame(e,"uiImage","skill/skill"+t)},getToolLvUpJson:function(e){return e>=cc.pvz.GameConfig.MaxToolLv&&(e=cc.pvz.GameConfig.MaxToolLv-1),this.toolLvUpJson[e-1]},getToolJson:function(e){return this.toolInfoJson.find(function(t){return t.id==e})},getToolIcon:function(e,t,o){cc.pvz.utils.setSpriteFrame(e,"uiImage","plant/wq/zw_"+t+"_"+o)},getToolSkinIcon:function(e,t,o){cc.pvz.utils.setSpriteFrame(e,"uiImage","game/wq/wq"+t+"_"+o)},getToolBgIcon:function(e,t){cc.pvz.utils.setSpriteFrame(e,"uiImage","wqdi/wqdi"+t)},getQualityCardIcon:function(e,t){var o="pz"+t;cc.pvz.utils.setSpriteFrame(e,"uiImage","plant/"+o)},getToolTypeIcon:function(e,t){var o="lattice"+t;cc.pvz.utils.setSpriteFrame(e,"uiImage","plant/"+o)},getToolAttriIcon:function(e,t){var o="attr"+t;cc.pvz.utils.setSpriteFrame(e,"uiImage","plant/"+o)},getItemJson:function(e){return this.itemJson.find(function(t){return t.ItemID==e})},getItemIcon:function(e,t){cc.pvz.utils.setSpriteFrame(e,"uiImage","item/item"+t)},getQualityBgIcon:function(e,t){var o="pz_"+t;cc.pvz.utils.setSpriteFrame(e,"uiImage","item/"+o)},getLevelCount:function(){return this.levelMapJson.length},getLevelJson:function(e){return this.levelMapJson[e-1]},setSpriteGray:function(e,t){e.setMaterial(0,this.materialList[t?1:0])}}),cc._RF.pop()},{}],Num2:[function(e,t,o){"use strict";cc._RF.push(t,"c18a6Zw+ixNe57UebjcDx57","Num2");var a=cc._decorator,n=a.ccclass,i=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.type=0,t.owner=null,t}return __extends(t,e),t.prototype.initAsHp=function(e){this.type=0,this.owner=e,this.changeHpTo(),this.updateAsHp()},t.prototype.updateAsHp=function(){this.node.setPosition(this.owner.node.position.x,this.owner.node.position.y+this.owner.hpY)},t.prototype.changeHpTo=function(){this.label.string=""+this.owner.hp},t.prototype.init=function(){},t.prototype.start=function(){},t.prototype.update=function(){0===this.type&&this.updateAsHp()},__decorate([i(cc.Label)],t.prototype,"label",void 0),__decorate([n],t)}(cc.Component);o.default=c,cc._RF.pop()},{}],PlayerData:[function(e,t){"use strict";cc._RF.push(t,"7398erhmudN35OfMQ/PJA65","PlayerData"),cc.ToolItem=cc.Class({name:"ToolItem",properties:{lv:cc.Integer,c:cc.Integer}});var o={newData:function(){var e={dataVersion:1,t:-1,isMMute:!1,isSMute:!1,itemData:{},power:20,powerDate:-1,powerBuyDate:-1,powerBuyTimes:[5,3],toolData:{},gameDate:-1,level:1,levelWave:0,sweepTimes:5,levelBoxData:{},actLevelDate:-1,actLevelData:{level:0,times:3,score:0,buffList:[-1,-1],boxStatus:[0,0,0,0]},shopDate:-1,isNewShop:!0,shopDailyData:{},shopTimesData:[20,1,7],shopBoxData:{lv:1,exp:0,date:[-1,-1]},isShare:!1,shareDate:-1,shareTimes:10,adBuffDate:-1,adBuffTimes:[10,3],adBuyData:{bank:[3,3],toolBuy:[1,1,1,1,1,1,1,1,1,1,1,1,1],actTimes:1},guide1:0,signDate:-1,signData:{signDay:1,isReward:!1},dayMissionDate:-1,dayMissionData:{},dayBoxData:{},weekMissionDate:-1,weekMissionData:{},weekBoxData:{},achievePro:{},achieveData:{},adTimes:0};e.regTime=Date.now(),e.free3b=1,e.rankCount=2,cc.player=e},postLoadData:function(){cc.player.dataVersion<1&&(cc.player.dataVersion=1,this.saveData(!0))},initPlayerData:function(){var e=cc.sys.localStorage.getItem("kapipack1");e?(cc.player=JSON.parse(e),cc.pvz.TAUtils.trackLogin(!1)):(console.log("New Player initPlayer"),this.newData(),console.log("\u521d\u59cb\u5316 \u80cc\u5305"),this.initBaseToolData(),this.initBaseItemData(),cc.pvz.cloud.needSaveToCloud=0,cc.pvz.TAUtils.trackLogin(!0)),this.postLoadData()},saveData:function(){cc.player&&cc.sys.localStorage.setItem("kapipack1",JSON.stringify(cc.player))},clearData:function(){cc.sys.localStorage.removeItem("kapipack1")},onDataChanged:function(){this.saveData(),cc.pvz.cloud.needSaveToCloud++},saveDataToLocalOnlineCore:function(e){var t=this,o=Date.now(),a=JSON.parse(JSON.stringify(cc.player));a.t=o,cc.pvz.cloud.checkUpdatePlayerInfo(a,function(a){e&&(cc.player.t=o,t.saveData(),e(a))}),cc.storageTime=Date.now()},saveDataToLocalOnline:function(e){var t=this;this.saveDataToLocalOnlineCore(e),cc.storageTimeId&&(clearTimeout(cc.storageTimeId),cc.storageTimeId=null),cc.storageTimeId=setTimeout(function(){t.saveDataToLocalOnlineCore()},3e5)},getZeroOClock:function(e){var t=new Date(e),o=t.getFullYear(),a=t.getMonth(),n=t.getDate();return new Date(o,a,n).getTime()},hasPastOneDay:function(){return this.getZeroOClock(Date.now())-this.getZeroOClock(cc.player.regTime)>0},initBaseItemData:function(){for(var e=[2,3],t=[500,0],o=0;o<e.length;o++)this.changeItemNum(e[o],t[o])},changeItemNum:function(e,t){cc.player.itemData.hasOwnProperty(e)?cc.player.itemData[e]+=t:cc.player.itemData[e]=t,e==cc.pvz.GameConfig.ItemType["\u91d1\u5e01"]&&t>0?this.addMissionProgress(cc.pvz.GameConfig.MissionType["\u7d2f\u8ba1\u83b7\u5f97\u91d1\u5e01"],t):e==cc.pvz.GameConfig.ItemType["\u94bb\u77f3"]&&t<0&&this.addMissionProgress(cc.pvz.GameConfig.MissionType["\u7d2f\u8ba1\u6d88\u8017\u94bb\u77f3"],Math.abs(t)),this.onDataChanged()},setItemNum:function(e,t){cc.player.itemData[e]=t},getItemNum:function(e){return cc.player.itemData.hasOwnProperty(e)?cc.player.itemData[e]:0},isItemEnough:function(e,t){return!!cc.player.itemData.hasOwnProperty(e)&&cc.player.itemData[e]>=t},initBaseToolData:function(){cc.player.toolData={};for(var e=0;e<cc.pvz.GameConfig.MaxToolCount;e++){var t,o,a=e+1;t=1==a?5:0,o=e<6?e:-1,cc.player.toolData[a]={lv:1,c:t,pos:o}}this.saveData()},getToolData:function(e){return cc.player.toolData.hasOwnProperty(e)||(cc.player.toolData[e]={lv:1,c:0,pos:-1},this.onDataChanged()),cc.player.toolData[e]},updateToolLv:function(e,t){cc.player.toolData.hasOwnProperty(e)?(cc.player.toolData[e].lv+=t,this.onDataChanged()):console.log("\u9053\u5177\u4e0d\u5b58\u5728",e)},updateToolFragCount:function(e,t){cc.player.toolData.hasOwnProperty(e)?(cc.player.toolData[e].c+=t,this.onDataChanged()):console.log("\u9053\u5177\u4e0d\u5b58\u5728",e)},isEnoughArrayTool:function(){var e=6;cc.player.level>cc.pvz.GameConfig.ArrayPlaceOpLv[1]?e=8:cc.player.level>cc.pvz.GameConfig.ArrayPlaceOpLv[0]&&(e=7);for(var t=0,o=0;o<cc.pvz.GameConfig.MaxToolCount;o++)-1!=cc.player.toolData[o+1].pos&&t++;return t>=e},checkAndResetPowetBuy:function(){var e=(new Date).getDate();e!=cc.player.powerBuyDate&&(cc.player.powerBuyDate=e,cc.player.powerBuyTimes=[5,3],this.onDataChanged())},getPowerBuyTimes:function(e){return void 0===e&&(e=!1),cc.player.powerBuyTimes[e?0:1]},updatePowerBuyTimes:function(e,t){void 0===t&&(t=1),cc.player.powerBuyTimes[e?0:1]-=t,this.onDataChanged()},isHaveBuyPowerTimes:function(){return cc.player.powerBuyTimes[0]+cc.player.powerBuyTimes[1]>0},usePlayerPower:function(e){cc.player.power+=e,this.isMaxPower()||(cc.player.powerDate=Date.now()+1e3*cc.pvz.GameConfig.CdPowerTime),this.onDataChanged()},addPower:function(e,t){void 0===t&&(t=!1),cc.player.power+=e,this.isMaxPower()?(cc.player.power=t?cc.player.power:this.getMaxPower(),cc.player.powerDate=-1):cc.player.powerDate=Date.now()+1e3*cc.pvz.GameConfig.CdPowerTime,this.onDataChanged()},isMaxPower:function(){return cc.player.power>=this.getMaxPower()},getMaxPower:function(){return cc.pvz.GameConfig.MaxPower},getPower:function(){return cc.player.power},getPowerDate:function(){return cc.player.powerDate},updatePowerDate:function(){cc.player.powerDate=Date.now(),this.onDataChanged()},checkAndResetActLevel:function(){var e=(new Date).getDate();e!=cc.player.actLevelDate&&(cc.player.actLevelDate=e,cc.player.actLevelData.times=3,cc.player.actLevelData.score=0,cc.player.actLevelData.buffList=[-1,-1],cc.player.actLevelData.boxStatus=[0,0,0,0],cc.player.actLevelData.level<2?cc.player.actLevelData.level++:cc.player.actLevelData.level=1,this.onDataChanged())},getActLevelData:function(){return cc.player.actLevelData},updateActLevelTimes:function(){cc.player.actLevelData.times--,this.onDataChanged()},updateActLevelScore:function(e){cc.player.actLevelData.score+=e,this.onDataChanged()},updateActLevelBuff:function(e,t){cc.player.actLevelData.buffList[e-1]=t,this.onDataChanged()},updateActLevelBoxStatus:function(e){cc.player.actLevelData.boxStatus[e-1]=1,this.onDataChanged()},checkAndResetGameDate:function(){var e=(new Date).getDate();e!=cc.player.gameDate&&(cc.player.gameDate=e,cc.player.sweepTimes=5,cc.player.adTimes=0,cc.player.rankCount=2,this.onDataChanged())},getSweepTimes:function(){return cc.player.sweepTimes},updateSweepTimes:function(){cc.player.sweepTimes--,this.onDataChanged()},updateStageLevel:function(e){void 0===e&&(e=1),cc.player.level<cc.pvz.GameConfig.MaxLevel&&(cc.player.level+=e),cc.player.levelWave=0,cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u901a\u8fc7\u4e3b\u7ebf\u7ae0\u8282n"],cc.player.level-1),this.onDataChanged(),cc.pvz.TAUtils.uploadLvUpData()},getStageLevel:function(){return cc.player.level},getMaxLevelWave:function(){return cc.player.levelWave},updateMaxLevelWave:function(e){cc.player.levelWave<e&&(cc.player.levelWave=e,this.onDataChanged())},getLevelBoxData:function(e){return cc.player.levelBoxData.hasOwnProperty(e)||(cc.player.levelBoxData[e]=[0,0,0],this.onDataChanged()),cc.player.levelBoxData[e]},updateLevelBoxData:function(e,t){cc.player.levelBoxData.hasOwnProperty(e)||(cc.player.levelBoxData[e]=[0,0,0]),cc.player.levelBoxData[e][t-1]=1,this.onDataChanged()},checkAndResetShop:function(){var e=(new Date).getDate();e!=cc.player.shopDate&&(cc.player.shopDate=e,cc.player.shopDailyData={},cc.player.shopTimesData=[20,1,7],cc.player.isNewShop=!0,this.onDataChanged())},updateShopTimes:function(e){cc.player.shopTimesData[e]--,this.onDataChanged()},getShopTimes:function(e){return cc.player.shopTimesData[e]},isNewShopStatus:function(){return cc.player.isNewShop},changeShopStatus:function(){cc.player.isNewShop=!1,this.onDataChanged()},addShopData:function(e,t){cc.player.shopDailyData.hasOwnProperty(e)?console.log(" Error Add Shop Data :",e):(cc.player.shopDailyData[e]=t,this.onDataChanged())},setShopData:function(e,t){cc.player.shopDailyData[e]=t,this.onDataChanged()},getShopData:function(e){return cc.player.shopDailyData.hasOwnProperty(e)||(cc.player.shopDailyData[e]=null),cc.player.shopDailyData[e]},updateShopDataBuy:function(e,t){void 0===t&&(t=1),cc.player.shopDailyData.hasOwnProperty(e)?(cc.player.shopDailyData[e].buyTimes-=t,this.onDataChanged()):console.log(" Error Add Shop Data :",e)},getShopBoxData:function(){return cc.player.shopBoxData},updateShopBoxDate:function(e,t){cc.player.shopBoxData.date[e-1]=t,this.onDataChanged()},updateShopBoxExp:function(e){cc.player.shopBoxData.lv<10&&(cc.player.shopBoxData.exp+=e,this.onDataChanged())},updateShopBoxlV:function(e,t){cc.player.shopBoxData.exp=t,cc.player.shopBoxData.lv<10&&(cc.player.shopBoxData.lv+=e),this.onDataChanged()},checkAndResetShare:function(){var e=(new Date).getDate();e!=cc.player.shareDate&&(cc.player.shareDate=e,cc.player.isShare=!1,cc.player.shareTimes=10,this.onDataChanged())},getShareTimes:function(){return cc.player.shareTimes},updateShareTimes:function(){cc.player.shareTimes--,this.onDataChanged()},finishShare:function(){cc.player.isShare=!0,this.onDataChanged()},checkAndResetAdData:function(){var e=(new Date).getDate();e!=cc.player.adBuffDate&&(cc.player.adBuffDate=e,cc.player.adBuffTimes=[10,3],cc.player.adBuyData={bank:[3,3],toolBuy:[1,1,1,1,1,1,1,1,1,1,1,1,1],actTimes:1},this.onDataChanged())},isHaveMoreActTimes:function(){return 1==cc.player.adBuyData.actTimes},updateAdActTimes:function(){cc.player.adBuyData.actTimes=0,this.onDataChanged()},isHaveAdBuyBankTimes:function(e){return cc.player.adBuyData.bank[e]>0},isHaveAdBuyToolTimes:function(e){return 1==cc.player.adBuyData.toolBuy[e-1]},updateAdBuyBankTimes:function(e){cc.player.adBuyData.bank[e]--,this.onDataChanged()},updateAdBuyToolTimes:function(e){cc.player.adBuyData.toolBuy[e-1]=0,this.onDataChanged()},getAdBuyData:function(){return cc.player.adBuyData},getAdBuffTimes:function(e){return cc.player.adBuffTimes[e]},updateAdBuffTimes:function(e){cc.player.adBuffTimes[e]--,this.onDataChanged()},finishSignReward:function(){cc.player.signData.isReward=!0,this.onDataChanged()},getSignData:function(){return cc.player.signData},checkAndResetSign:function(){var e=(new Date).getDate();e!=cc.player.signDate&&(cc.player.signDate=e,cc.player.signData.isReward&&cc.player.signData.signDay++,cc.player.signData.isReward=!1,this.onDataChanged())},checkAndResetDayMission:function(){var e=(new Date).getDate();e!=cc.player.dayMissionDate&&(cc.player.dayMissionDate=e,cc.player.dayMissionData={},cc.player.dayBoxData={},this.setItemNum(cc.pvz.GameConfig.ItemType["\u65e5\u5e38\u4efb\u52a1\u79ef\u5206"],0),this.addDayMissionProgress(cc.pvz.GameConfig.MissionType["\u767b\u5f551\u6b21"]),this.onDataChanged())},getDayBoxData:function(e){return cc.player.dayBoxData[e]||(cc.player.dayBoxData[e]={isReward:!1},this.onDataChanged()),cc.player.dayBoxData[e]},finishDayBoxReward:function(e){cc.player.dayBoxData[e]&&(cc.player.dayBoxData[e].isReward=!0,this.onDataChanged())},getDayMissionData:function(e){return cc.player.dayMissionData[e]||(cc.player.dayMissionData[e]={pro:0,isReward:!1},this.onDataChanged()),cc.player.dayMissionData[e]},addDayMissionProgress:function(e,t){void 0===t&&(t=1),this.checkAndResetDayMission(),cc.player.dayMissionData[e]||(cc.player.dayMissionData[e]={pro:0,isReward:!1}),cc.player.dayMissionData[e].isReward||(cc.player.dayMissionData[e].pro+=t)},finishDayMission:function(e){cc.player.dayMissionData[e]&&(cc.player.dayMissionData[e].isReward=!0,this.onDataChanged())},getWeekBoxData:function(e){return cc.player.weekBoxData[e]||(cc.player.weekBoxData[e]={isReward:!1},this.onDataChanged()),cc.player.weekBoxData[e]},finishWeekBoxReward:function(e){cc.player.weekBoxData[e]&&(cc.player.weekBoxData[e].isReward=!0,this.onDataChanged())},checkAndResetWeekMission:function(){var e=cc.pvz.utils.getCurDayInWeek();e!=cc.player.weekMissionDate&&(cc.player.weekMissionDate=e,1==e&&(cc.player.weekMissionData={},cc.player.weekBoxData={},this.setItemNum(cc.pvz.GameConfig.ItemType["\u5468\u5e38\u4efb\u52a1\u79ef\u5206"],0)),this.onDataChanged())},getWeekMissionData:function(e){return cc.player.weekMissionData[e]||(cc.player.weekMissionData[e]={pro:0,isReward:!1},this.onDataChanged()),cc.player.weekMissionData[e]},addWeekMissionProgress:function(e,t){void 0===t&&(t=1),this.checkAndResetWeekMission(),cc.player.weekMissionData[e]||(cc.player.weekMissionData[e]={pro:0,isReward:!1}),cc.player.weekMissionData[e].isReward||(cc.player.weekMissionData[e].pro+=t)},finishWeekMission:function(e){cc.player.weekMissionData[e]&&(cc.player.weekMissionData[e].isReward=!0,this.onDataChanged())},getAchieveData:function(e){return cc.player.achieveData[e]||(cc.player.achieveData[e]={lv:1,end:!1},this.onDataChanged()),cc.player.achieveData[e]},updateAchieveData:function(e,t){void 0===t&&(t=1),cc.player.achieveData[e]||(cc.player.achieveData[e]={lv:1,end:!1}),cc.player.achieveData[e].lv+=t;var o=100*e+cc.player.achieveData[e].lv;cc.JsonControl.getAchieveJson(o)||(cc.player.achieveData[e].lv-=t,cc.player.achieveData[e].end=!0),this.onDataChanged()},getAchieveProgress:function(e){return cc.player.achievePro.hasOwnProperty(e)||(cc.player.achievePro[e]=0,this.saveData()),cc.player.achievePro[e]},addAchieveProgress:function(e,t){switch(void 0===t&&(t=1),cc.player.achievePro.hasOwnProperty(e)||(cc.player.achievePro[e]=0),e){case cc.pvz.GameConfig.MissionType["\u901a\u8fc7\u4e3b\u7ebf\u7ae0\u8282n"]:t>cc.player.achievePro[e]&&(cc.player.achievePro[e]=t);break;case cc.pvz.GameConfig.MissionType["\u88c5\u5907\u6700\u9ad8\u7b49\u7ea7\u8fbe\u5230n"]:var o=cc.player.achievePro[e],a=this.getToolMaxLv();o<a&&(cc.player.achievePro[e]=a);break;case cc.pvz.GameConfig.MissionType["\u88c5\u5907\u603b\u7b49\u7ea7n"]:var n=cc.player.achievePro[e],i=this.getToolAllLv();n<i&&(cc.player.achievePro[e]=i);break;default:cc.player.achievePro[e]+=t}},getToolMaxLv:function(){var e=0;for(var t in cc.player.toolData){var o=cc.player.toolData[t];e<=o.lv&&(e=o.lv)}return e},getToolAllLv:function(){var e=0;for(var t in cc.player.toolData)e+=cc.player.toolData[t].lv;return e},addMissionProgress:function(e,t){switch(void 0===t&&(t=1),e){case cc.pvz.GameConfig.MissionType["\u6311\u6218\u4e3b\u7ebf\u7ae0\u82821\u6b21"]:case cc.pvz.GameConfig.MissionType["\u5347\u7ea7\u4efb\u610f\u88c5\u59071\u6b21"]:cc.pvz.PlayerData.addDayMissionProgress(e,t);break;case cc.pvz.GameConfig.MissionType["\u6bcf\u65e5\u5546\u5e97\u8d2d\u4e70n\u6b21\u7269\u54c1"]:case cc.pvz.GameConfig.MissionType["\u9ad8\u7ea7\u5b9d\u7bb1\u62bd\u53d6\u88c5\u5907n\u6b21"]:cc.pvz.PlayerData.addDayMissionProgress(e,t),cc.pvz.PlayerData.addWeekMissionProgress(e,t);break;case cc.pvz.GameConfig.MissionType["\u626b\u8361\u5173\u5361n\u6b21"]:case cc.pvz.GameConfig.MissionType["\u53c2\u4e0e\u65e0\u5c3d\u6311\u6218\u8d5bN\u6b21"]:case cc.pvz.GameConfig.MissionType["\u53c2\u4e0e\u6311\u6218\u5173\u5361n\u6b21"]:cc.pvz.PlayerData.addDayMissionProgress(e,t);break;case cc.pvz.GameConfig.MissionType["\u8d2d\u4e70\u4f53\u529bn\u6b21"]:cc.pvz.PlayerData.addDayMissionProgress(e,t),cc.pvz.PlayerData.addAchieveProgress(e,t);break;case cc.pvz.GameConfig.MissionType["\u89c2\u770b\u5e7f\u544an\u6b21"]:cc.pvz.PlayerData.addDayMissionProgress(e,t),cc.pvz.PlayerData.addWeekMissionProgress(e,t),cc.pvz.PlayerData.addAchieveProgress(e,t);break;case cc.pvz.GameConfig.MissionType["\u901a\u5173\u4e3b\u7ebf\u526f\u672cn\u6b21"]:cc.pvz.PlayerData.addWeekMissionProgress(e,t);break;case cc.pvz.GameConfig.MissionType["\u51fb\u8d25\u50f5\u5c38n\u4e2a"]:case cc.pvz.GameConfig.MissionType["\u51fb\u8d25\u9996\u9886n\u4e2a"]:cc.pvz.PlayerData.addWeekMissionProgress(e,t),cc.pvz.PlayerData.addAchieveProgress(e,t);break;case cc.pvz.GameConfig.MissionType["\u901a\u5173\u6311\u6218\u5173\u5361n\u6b21"]:cc.pvz.PlayerData.addWeekMissionProgress(e,t);break;case cc.pvz.GameConfig.MissionType["\u901a\u8fc7\u4e3b\u7ebf\u7ae0\u8282n"]:case cc.pvz.GameConfig.MissionType["\u88c5\u5907\u6700\u9ad8\u7b49\u7ea7\u8fbe\u5230n"]:case cc.pvz.GameConfig.MissionType["\u88c5\u5907\u603b\u7b49\u7ea7n"]:case cc.pvz.GameConfig.MissionType["\u7d2f\u8ba1\u83b7\u5f97\u91d1\u5e01"]:case cc.pvz.GameConfig.MissionType["\u7d2f\u8ba1\u6d88\u8017\u94bb\u77f3"]:cc.pvz.PlayerData.addAchieveProgress(e,t)}this.onDataChanged()},onCheckOldPlayerMission:function(){cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u901a\u8fc7\u4e3b\u7ebf\u7ae0\u8282n"],cc.player.level-1),cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u88c5\u5907\u603b\u7b49\u7ea7n"]),cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u88c5\u5907\u6700\u9ad8\u7b49\u7ea7\u8fbe\u5230n"])},hasFundGet:function(){return!1},setFundGetted:function(){}};cc.pvz||(cc.pvz={}),cc.pvz.PlayerData=o,t.exports=o,cc._RF.pop()},{}],Pool:[function(e,t,o){"use strict";cc._RF.push(t,"d85e2IYXQNIq6ozbK914/a9","Pool");var a=cc._decorator,n=a.ccclass,i=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.inPool=null,t.poolIdx=0,t.pool=[],t.poolDirc={},t.size=100,t.actives={},t.sleeps={},t}return __extends(t,e),t.prototype.createPool=function(e){this.size=e},t.prototype.getNewPoolItem=function(){for(var e in this.sleeps){delete this.sleeps[e],this.actives[e]=1;var t=parseInt(e)-1e5*this.poolIdx;return this.pool[t].active=!0,this.pool[t]}var o=cc.instantiate(this.inPool);return o.setParent(this.node),this.pool.push(o),o.inPoolIdx=this.pool.length-1+1e5*this.poolIdx,o.name="pool"+o.inPoolIdx,this.actives[o.inPoolIdx]=1,this.poolDirc[o.inPoolIdx]=o,o},t.prototype.destroyPoolItem=function(e){this.pool[e.inPoolIdx-1e5*this.poolIdx].active=!1,delete this.actives[e.inPoolIdx],this.sleeps[e.inPoolIdx]=1},t.prototype.destroyAllPoolItem=function(){for(var e=0;e<this.node.children.length;e++)this.node.children[e].active&&this.destroyPoolItem(this.node.children[e])},t.prototype.getAllActiveItem=function(){var e=[];for(var t in this.actives){var o=parseInt(t)-1e5*this.poolIdx;e.push(this.pool[o])}return e},t.prototype.start=function(){},__decorate([i(cc.Prefab)],t.prototype,"inPool",void 0),__decorate([i(cc.Integer)],t.prototype,"poolIdx",void 0),__decorate([i(cc.Integer)],t.prototype,"size",void 0),__decorate([n],t)}(cc.Component);o.default=c,cc._RF.pop()},{}],PopupManager:[function(e,t){"use strict";cc._RF.push(t,"1f46aROMcZBAKSIrLVXbx2j","PopupManager");var o=e("./PrefabInfo");cc.Class({extends:cc.Component,properties:{default_sprite_splash:cc.SpriteFrame,onPopup1st:cc.Component.EventHandler,onAllClosed:cc.Component.EventHandler,taskToastPrfefab:o,toastPrefab:o,effectPrefab:o,effectBattlePrefab:o,adToastNode:cc.Node},onLoad:function(){cc.popupManager=this,this.adToastNode&&(this.adToastNode.active=!1,this.adToastNode.zIndex=cc.macro.MAX_ZINDEX-2),this.popups=[],this.showModals=[],this.isAutoPop=!1},nonePopupUI:function(){return!this.modal||!this.modal.active},createModal:function(){if(!this.modal){var e=new cc.Node;e.width=4*this.node.width,e.height=4*this.node.height,e.color=cc.Color.BLACK,e.opacity=230,e.addComponent(cc.BlockInputEvents);var t=e.addComponent(cc.Sprite);t.sizeMode=cc.Sprite.SizeMode.CUSTOM,t.spriteFrame=this.default_sprite_splash,this.modal=e,this.modal.parent=this.node}},onAllPopupClosed:function(){this.modal&&(this.modal.active=!1),this.onAllClosed&&this.onAllClosed.emit()},removeAllPopups:function(){this.popups.forEach(function(e){e.node.destroy()}),this.popups=[],this.showModals=[],cc.pvz.AdUtils.hideAdBanner(),this.onAllPopupClosed()},popup:function(e,t,o,a){var n,i=this,c=a.ad,s=void 0===c||c,r=a.scale,l=void 0===r||r,u=a.adLeft,p=void 0!==u&&u,d=a.showModal,h=void 0===d||d,f=a.opacity;n=void 0===f?225:f;for(var g,v=a.usingTop,y=void 0!==v&&v,m=arguments.length,C=new Array(m>4?m-4:0),w=4;w<m;w++)C[w-4]=arguments[w];this.popups.length>0&&this.popups[this.popups.length-1].onPopupUI&&this.popups[this.popups.length-1].onPopupUI(),this.nonePopupUI()&&(this.createModal(),this.modal.active=!0,this.onPopup1st&&this.onPopup1st.emit()),h||this.showModals.some(function(e){return e})?(g=h?this.popups.length:this.showModals.findIndex(function(e){return e}),this.createModal(),this.modal.opacity=n,this.modal.zIndex=2*g+1):this.modal&&(this.modal.opacity=0),this.showModals.push(h),s&&this.popups.every(function(e){return!e.__showAd}),y&&cc.main2.setUsingTopInfo(),cc.pvz.utils.useBundleAsset(e,t,cc.Prefab,function(e){var t=cc.instantiate(e),a=t.getComponent(o);t.parent=i.node,t.zIndex=2*i.popups.length+2,l?(t.scale=.5,t.runAction(cc.sequence(cc.scaleTo(.5,1).easing(cc.easeElasticOut(3)),cc.callFunc(function(){a.showFinish&&a.showFinish.apply(a)},i)))):t.runAction(cc.sequence(cc.delayTime(.032),cc.callFunc(function(){a.showFinish&&a.showFinish.apply(a)},i))),a.__showAd=s,a.__showAdAlignLeft=p,i.popups.push(a),a.initBy&&a.initBy.apply(a,C),cc.director.isPaused()&&t.parent.sortAllChildren()})},removePopup:function(e){var t=this.popups.findIndex(function(t){return t==e});if(-1!=t){if(-1!=t){this.popups.splice(t,1),this.showModals.splice(t,1),t>0&&this.popups[t-1].onPopupClosed&&this.popups[t-1].onPopupClosed();for(var o=-1,a=this.showModals.length;--a>=0;)if(this.showModals[a]){o=a;break}-1!==o?(this.createModal(),this.modal.opacity=210,this.modal.zIndex=2*o+1):this.modal&&(this.modal.active=!1)}if(e.__showAd)for(var n=this.popups.length-1;n>=0&&!this.popups[n].__showAd;n--);e.node.destroy(),this.nonePopupUI()&&this.onAllPopupClosed(),cc.director.isPaused()&&this.node.sortAllChildren()}},showTaskToast:function(e){var t=this.taskToastPrfefab.addNode();t.opacity=255,t.zIndex=cc.macro.MAX_ZINDEX-3,t.runAction(cc.sequence(cc.delayTime(1.2),cc.fadeOut(.4),cc.removeSelf())),cc.find("tip",t).getComponent(cc.Label).string=e},showToast:function(e){var t=this.toastPrefab.addNode();t.y=0,t.opacity=255,t.zIndex=cc.macro.MAX_ZINDEX-3,t.runAction(cc.sequence(cc.moveBy(.3,0,80),cc.delayTime(.8),cc.fadeOut(.3),cc.removeSelf())),cc.find("tip",t).getComponent(cc.Label).string=e},showEffectFly:function(e,t,o){void 0===o&&(o=1),this.effectPrefab.addEffectNode(e,t,o).zIndex=cc.macro.MAX_ZINDEX},showBattleEffect:function(e,t){var o=this.effectBattlePrefab.addBattleEffectNode(e,t);o.y=-200,o.x=0,o.zIndex=cc.macro.MAX_ZINDEX-3,o.runAction(cc.sequence(cc.delayTime(2.5),cc.removeSelf()))},showAdToast:function(e){this.adToastNode.active=2!=e,this.adToastNode.active&&(cc.find("blockTouch",this.adToastNode).active=0==e,cc.find("tip",this.adToastNode).getComponent(cc.Label).string=["\u62c9\u53d6\u5e7f\u544a\u4e2d...","\u770b\u5b8c\u5e7f\u544a\u624d\u6709\u5956\u52b1",null,"\u5e7f\u544a\u52a0\u8f7d\u5931\u8d25"][e],this.adToastNode.y=0,this.adToastNode.opacity=255,this.adToastNode.stopAllActions(),0!=e&&this.adToastNode.runAction(cc.sequence(cc.moveBy(.3,0,80),cc.delayTime(.8),cc.fadeOut(.3))))}}),cc._RF.pop()},{"./PrefabInfo":"PrefabInfo"}],PowerInfo:[function(e,t){"use strict";cc._RF.push(t,"f6670cqMmVPLpvkQfiIvCh6","PowerInfo"),cc.Class({extends:cc.Component,properties:{powerLabel:cc.Label,powerTimeLabel:cc.Label},updatePowerInfo:function(){this.lastTime=0;var e=0,t=cc.pvz.PlayerData.getPowerDate();if(t>0){var o=Math.abs(Date.now()-t)/1e3;e=parseInt(o/cc.pvz.GameConfig.CdPowerTime)}e>0&&!cc.pvz.PlayerData.isMaxPower()&&cc.pvz.PlayerData.addPower(e);var a=cc.pvz.PlayerData.getPower(),n=cc.pvz.PlayerData.getMaxPower();if(this.powerLabel.string=a+"/"+n,this.isMaxPower=cc.pvz.PlayerData.isMaxPower(),this.powerTimeLabel.node.active=!this.isMaxPower,!this.isMaxPower){t<0&&(cc.player.powerDate=Date.now()+1e3*cc.pvz.GameConfig.CdPowerTime,t=cc.player.powerDate);var i=Math.abs(Date.now()-t)/1e3;this.lastTime=parseInt(i)-e*cc.pvz.GameConfig.CdPowerTime,this.powerTimeLabel.string=cc.pvz.utils.formatSeconds2(this.lastTime),this.schedule(this.onRefreshTime,1)}},onRefreshTime:function(){if(this.lastTime--,0==this.lastTime){cc.pvz.PlayerData.isMaxPower()||cc.pvz.PlayerData.addPower(1);var e=cc.pvz.PlayerData.getPower(),t=cc.pvz.PlayerData.getMaxPower();if(this.powerLabel.string=e+"/"+t,this.isMaxPower=cc.pvz.PlayerData.isMaxPower(),this.isMaxPower)return this.powerTimeLabel.node.active=!1,void this.unschedule(this.onRefreshTime,this);this.lastTime=cc.pvz.GameConfig.CdPowerTime}this.powerTimeLabel.string=cc.pvz.utils.formatSeconds2(this.lastTime)},checkPowerShow:function(){var e=cc.pvz.PlayerData.getPower(),t=cc.pvz.PlayerData.getMaxPower();if(this.powerLabel.string=e+"/"+t,e>=t)return this.powerTimeLabel.node.active=!1,void this.unscheduleAllCallbacks();this.powerTimeLabel.node.active||(this.lastTime=cc.pvz.GameConfig.CdPowerTime,this.powerTimeLabel.node.active=!0,this.powerTimeLabel.string=cc.pvz.utils.formatSeconds2(this.lastTime),this.schedule(this.onRefreshTime,1))}}),cc._RF.pop()},{}],PrefabInfo:[function(e,t){"use strict";cc._RF.push(t,"b969bx+7YhL9p7F4HPdvrXY","PrefabInfo"),cc.Class({extends:cc.Component,properties:{prefab:cc.Node,prefabAsset:cc.Prefab,clazz:"",count:0,root:cc.Node},onLoad:function(){this.init(),cc.hasHackNode||(cc.hasHackNode=!0,cc._BaseNode.prototype._onSetParent=function(e){null==e&&this.__pool&&(this.__poolCounter++,this.__isInPool=!0,this.__pool.put(this))})},onDestroy:function(){if(this.hasInit)for(var e=0,t=this.pool.size();e<t;e++)this.pool.get().destroy()},lazyInit:function(){this.hasInit||(this.hasInit=!0,this.prefab&&(this.prefab.__isInPool=!1,this.prefab.active=!1,this.prefab.position=cc.Vec2.ZERO),this.clazz.length>0?this.pool=new cc.NodePool(this.clazz):this.pool=new cc.NodePool)},init:function(){if(this.count>=0){this.lazyInit();for(var e=this.prefab||this.prefabAsset,t=0;t<this.count;t++){var o=cc.instantiate(e);o.__poolCounter=0,o.__isInPool=!0,o.__pool=this.pool,this.pool.put(o)}}},newNode:function(){this.lazyInit();var e=null;return this.pool&&this.pool.size()>0?e=this.pool.get():(e=cc.instantiate(this.prefab||this.prefabAsset)).__poolCounter=0,e.__isInPool=!1,e.__pool=this.pool,e},addNodeByWorldPos:function(e){return this.addNode(this.root.convertToNodeSpaceAR(e))},addNode:function(e){return this.addNodeTo(this.root,e)},addNodeTo:function(e,t){var o=this.newNode();return t&&(o.position=t),o.parent=e,o.active=!0,o._calculWorldMatrix(),o},addEffectNode:function(e,t,o){void 0===o&&(o=1);var a=this.newNode();return a.parent=this.root,a.active=!0,a.getComponent("EffectFly").initEffect(e,t,o),a._calculWorldMatrix(),a},addBattleEffectNode:function(e,t){var o=this.newNode();return o.parent=this.root,o.active=!0,o.getComponent("EffectBattleNum").initEffect(e,t),o._calculWorldMatrix(),o}}),cc._RF.pop()},{}],RemoveWhenComplete:[function(e,t){"use strict";cc._RF.push(t,"dace2p4R3RLfYgcmFlF+SSd","RemoveWhenComplete"),cc.Class({extends:cc.Component,properties:{spine:sp.Skeleton,fixedScale:!0},onLoad:function(){var e=this;this.spine.setCompleteListener(function(){e.node.parent=null})}}),cc._RF.pop()},{}],RewardItem:[function(e,t){"use strict";cc._RF.push(t,"45b8fBIhzxILZkRHu8edIIh","RewardItem"),cc.Class({extends:cc.Component,properties:{iconSprite:cc.Sprite,spine:sp.Skeleton,fragNode:cc.Node,qualitySprite:cc.Sprite,countLabel:cc.Label},initBoxRewardItem:function(e){this.RewardData=e,this.itemId=this.RewardData.itemId,this.count=this.RewardData.count,this.countLabel.string="x"+cc.pvz.utils.formatItemNum(this.count);var t=cc.JsonControl.getItemJson(this.itemId);cc.JsonControl.getItemIcon(this.iconSprite,t.Icon),cc.JsonControl.getQualityBgIcon(this.qualitySprite,t.Quality)},onClickShopBox:function(){this.itemId>=5&&this.itemId<=7&&cc.popupManager.popup("mainUI","shopboxList","UIShopBoxDetail",{ad:!1,scale:!0},this.itemId)},initShopBoxToolItem:function(e,t){var o=this,a=e,n=cc.JsonControl.getToolJson(a);cc.JsonControl.getQualityBgIcon(this.qualitySprite,n.quality);var i=cc.pvz.PlayerData.getToolData(a),c=cc.pvz.utils.getLevelInterval(i.lv);if(this.spine.node.scale=n.scale,cc.pvz.utils.useBundleAsset("actors","kapi/hero"+a,sp.SkeletonData,function(e){o.spine.skeletonData=e,o.spine.setAnimation(0,"stand"+c,!0)}),this.fragNode.active=t,t)for(var s=0;s<this.node.childrenCount;s++)this.node.children[s].getComponent(cc.Sprite).setMaterial(0,cc.JsonControl.materialList[t?1:0])},initRewardItem:function(e,t){var o=this;void 0===t&&(t=!0),this.RewardData=e,this.itemId=this.RewardData.itemId,this.count=this.RewardData.count,this.toolId=this.RewardData.toolId,this.countLabel.string="x"+this.count;var a=cc.JsonControl.getItemJson(this.itemId);if(this.spine&&(this.spine.node.active=this.itemId==cc.pvz.GameConfig.ItemType["\u56fa\u5b9a\u788e\u7247"]),this.iconSprite&&(this.iconSprite.node.active=this.itemId!=cc.pvz.GameConfig.ItemType["\u56fa\u5b9a\u788e\u7247"]),this.itemId===cc.pvz.GameConfig.ItemType["\u56fa\u5b9a\u788e\u7247"]){this.fragNode&&(this.fragNode.active=!0);var n=cc.JsonControl.getToolJson(this.toolId);cc.JsonControl.getQualityBgIcon(this.qualitySprite,n.quality);var i=cc.pvz.PlayerData.getToolData(this.toolId),c=cc.pvz.utils.getLevelInterval(i.lv);this.spine.node.scale=n.scale,cc.pvz.utils.useBundleAsset("actors","kapi/hero"+this.toolId,sp.SkeletonData,function(e){o.spine.skeletonData=e,o.spine.setAnimation(0,"stand"+c,!0)})}else cc.JsonControl.getItemIcon(this.iconSprite,a.Icon),cc.JsonControl.getQualityBgIcon(this.qualitySprite,a.Quality),this.fragNode&&(this.fragNode.active=!1);t&&this.onSaveReward()},onSaveReward:function(){switch(this.itemId){case cc.pvz.GameConfig.ItemType["\u4f53\u529b"]:cc.pvz.PlayerData.addPower(this.count,!0);break;case cc.pvz.GameConfig.ItemType["\u8363\u8a89"]:cc.pvz.PlayerData.updateActLevelScore(this.count);break;case cc.pvz.GameConfig.ItemType["\u56fa\u5b9a\u788e\u7247"]:cc.pvz.PlayerData.updateToolFragCount(this.toolId,this.count);break;default:cc.pvz.PlayerData.changeItemNum(this.itemId,this.count)}}}),cc._RF.pop()},{}],Role2:[function(e,t,o){"use strict";cc._RF.push(t,"1d26brL2YpAL6MA/oh9YDuz","Role2");var a=e("./SoundManager"),n=e("./Tool"),i=e("./Pool"),c=e("./BattleGround2Ctrl"),s=e("./EnemySpawner2"),r=e("./Num2"),l=cc._decorator,u=l.ccclass,p=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.body=null,t.bulletSPos=null,t.bodySpine=null,t.bodySDS=[],t.collBody=null,t.team=0,t.tCount=0,t.v=50,t.par=null,t.bulletConfig={rate:0,nums:0,dmg:0},t.hp=100,t.state=0,t.hpY=0,t.isDragging=!1,t.dXYRec=[0,0],t.hpNumberHandle=null,t}return __extends(t,e),t.prototype.init=function(e){void 0===e&&(e={}),this.team=e.team,this.par=e.par,0===this.team?(this.collBody.enabled=!1,this.bulletConfig={rate:c.default.JSONManager.ConfigBattle[6].v[5],nums:c.default.JSONManager.ConfigBattle[6].v[3],dmg:c.default.JSONManager.ConfigBattle[6].v[4]},this.initDragEvent()):(this.bodySpine.skeletonData=this.bodySDS[e.rId],this.bodySpine.setAnimation(0,"walk",!0),this.hp=e.config.hp,this.bodySpine.node.setScale(e.config.spineSize),this.hpY=e.config.hpy,this.v=c.default.JSONManager.ConfigBattle[6].v[2],this.createNewHpNum()),this.par.refreshAtk()},t.prototype.initDragEvent=function(){var e=this;this.body.on(cc.Node.EventType.TOUCH_START,function(t){e.isDragging=!0,e.dXYRec[0]=t.getLocationX(),e.dXYRec[1]=t.getLocationY()}),this.body.on(cc.Node.EventType.TOUCH_MOVE,function(t){var o=t.getLocationX(),a=t.getLocationY();e.node.x+=o-e.dXYRec[0],e.node.x<-300?e.node.x=-300:e.node.x>300&&(e.node.x=300),e.dXYRec[0]=o,e.dXYRec[1]=a}),this.body.on(cc.Node.EventType.TOUCH_END,function(){e.isDragging=!1}),this.body.on(cc.Node.EventType.TOUCH_CANCEL,function(){e.isDragging=!1})},t.prototype.createNewBullet=function(e){if(10===this.par.state&&(this.tCount+=e,!(this.tCount<this.bulletConfig.rate))){this.tCount-=this.bulletConfig.rate;for(var t=c.default.JSONManager.ConfigBattle[6].v[7],o=this.node.x+this.bulletSPos.x-Math.floor(this.bulletConfig.nums/2)*t,a=this.node.y+this.bulletSPos.y,n=0;n<this.bulletConfig.nums;n++)this.par.createNewBullet(o,a,{dmg:this.bulletConfig.dmg}),o+=t;this.bodySpine.setAnimation(1,"atk",!1)}},t.prototype.createNewHpNum=function(){this.hpNumberHandle=this.par.createNewHpNum(this)},t.prototype.moving=function(e){10===this.par.state&&(this.node.y-=this.v*e,this.node.y<this.par.endLineY+this.node.height/2&&(this.par.beHit(),this.remove()))},t.prototype.beHit=function(e){this.hp-=e.dmg,this.hp<=0?(this.par.createNewDieEff(this.node),this.par.node.getComponent(s.default).updateEnemyHandles(this.node.x),this.remove(),a.default.playEffect2(n.default.randomInt(3,5))):this.hpNumberHandle.getComponent(r.default).changeHpTo()},t.prototype.remove=function(){this.hpNumberHandle.parent.getComponent(i.default).destroyPoolItem(this.hpNumberHandle),this.node.parent.getComponent(i.default).destroyPoolItem(this.node)},t.prototype.start=function(){},t.prototype.update=function(e){0===this.team?this.createNewBullet(e):this.moving(e)},__decorate([p(cc.Node)],t.prototype,"body",void 0),__decorate([p(cc.Node)],t.prototype,"bulletSPos",void 0),__decorate([p(sp.Skeleton)],t.prototype,"bodySpine",void 0),__decorate([p(sp.SkeletonData)],t.prototype,"bodySDS",void 0),__decorate([p(cc.BoxCollider)],t.prototype,"collBody",void 0),__decorate([u],t)}(cc.Component);o.default=d,cc._RF.pop()},{"./BattleGround2Ctrl":"BattleGround2Ctrl","./EnemySpawner2":"EnemySpawner2","./Num2":"Num2","./Pool":"Pool","./SoundManager":"SoundManager","./Tool":"Tool"}],RuntimeData:[function(e,t){"use strict";cc._RF.push(t,"b0885+oCPJBKa6AE7raczBC","RuntimeData");var o={showGame1st:!1,mode:0,level:1,money:0,autoTimes:0,freeTimes:1,lv2Count:1,wave:0,lv:0,exp:0,speed:1,blocks:[],items:[],bagItems:[],buffs:[],buffValues:{},actBuff1:-1,actBuff2:-1,openSpeed:!0,hasReborn:!1,forceAdWave:3,tryPlantId:0,stats:[],guide:0,adBlockCount:3,buyCoinCount:10,buffRefreshCount:3,buffAllCount:1,anger:500,hasUseReborn:!1,init:function(e,t){this.removeData(),this.showGame1st=!1,this.mode=e,this.level=t,this.anger=500,this.hasUseReborn=!1,this.blocks=[];var o=null;switch(this.mode){case 0:o=cc.JsonControl.levelDataJson[this.level-1],this.actBuff1=-1,this.actBuff2=-1;for(var a=2;a<5;a++)for(var n=1;n<4;n++)this.blocks.push(5*a+n);break;case 1:o=cc.JsonControl.ActLevelJson[this.level-1],this.actBuff1=cc.player.actLevelData.buffList[0],this.actBuff2=cc.player.actLevelData.buffList[1];for(var i=1;i<6;i++)for(var c=1;c<4;c++)this.blocks.push(5*i+c);break;case 2:o=cc.JsonControl.rankLevelJsonFile.json[0],this.actBuff1=-1,this.actBuff2=-1;for(var s=2;s<5;s++)for(var r=1;r<4;r++)this.blocks.push(5*s+r);this.buyCoinCount=20,this.buffRefreshCount=3,this.buffAllCount=1}this.money=o.startyinbi,this.tryPlantId=0,this.stats=new Array(14).fill(0),this.autoTimes=1,this.freeTimes=1,this.lv2Count=1,this.wave=0,this.lv=0,this.exp=0,this.speed=1,this.openSpeed=!0,this.items=[],this.bagItems=[],this.buffs=[],this.buffValues={},this.buffInfo=null,this.hasReborn=!1,this.forceAdWave=3,this.adBlockCount=3,this.guide=0},loadJsonData:function(e){var t=this;if(!this.buffInfo){this.buffInfo={};var o=new Set;e.forEach(function(e){t.buffInfo[e.id]={type:e.type,value:e.value},o.add(e.type)}),o.forEach(function(e){t.buffValues[e]=0})}},addMoney:function(e){this.money+=e,e>0&&cc.butler.playEffectAsync("game","sound/getSunShine"),cc.butler.node.emit("money")},hasEnableBuff:function(e){return this.buffs.some(function(t){return t==e})},getBuffValue:function(e){return this.buffValues[e]},addBuff:function(e){var t=this.buffInfo[e];switch(t.type){case 1:break;case 6:this.addMoney(t.value);break;case 12:var o=[];if(this.items.forEach(function(e,t){e.lv<3&&o.push(t)}),o.length>0){var a=o[cc.math.randomRangeInt(0,o.length)],n=this.items[a];n.lv++,cc.butler.node.emit("lvup",a,n.lv)}}this.buffValues[t.type]+=t.value,this.buffs.push(e),1==t.type&&cc.butler.node.emit("maxHp")},hasPreGame:function(){var e=cc.sys.localStorage.getItem("kapi-rt1");return!!e&&(this.preData=JSON.parse(e),!0)},saveData:function(){delete this.preData,cc.sys.localStorage.setItem("kapi-rt1",JSON.stringify(this))},removeData:function(){cc.sys.localStorage.removeItem("kapi-rt1"),delete this.preData},initByPreData:function(){var e=this;Object.keys(this.preData).forEach(function(t){e[t]=e.preData[t]})}};cc.pvz||(cc.pvz={}),cc.pvz.runtimeData=o,t.exports=o,cc._RF.pop()},{}],SoundManager:[function(e,t,o){"use strict";cc._RF.push(t,"f8dc6tQzqhD6JGqjoRnr6yk","SoundManager");var a=cc._decorator,n=a.ccclass,i=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.soundEffects=[],t.bgms=[],t}var o;return __extends(t,e),o=t,t.prototype.start=function(){o.SoundEffects=[],o.Bgms=[];for(var e=0;e<this.soundEffects.length;e++)o.SoundEffects.push(this.soundEffects[e]);for(e=0;e<this.bgms.length;e++)o.Bgms.push(this.bgms[e]);o.effPlayTime={}},t.playBgm=function(e){cc.butler.playMusic(o.Bgms[e])},t.playEffect=function(e){e&&cc.butler.playEffect(o.SoundEffects[e])},t.playEffect2=function(e){(!o.effPlayTime[e]||Date.now()-o.effPlayTime[e]>100)&&(cc.butler.playEffect(o.SoundEffects[e]),o.effPlayTime[e]=Date.now())},t.SoundEffects=[],t.Bgms=[],t.effPlayTime={},__decorate([i(cc.AudioClip)],t.prototype,"soundEffects",void 0),__decorate([i(cc.AudioClip)],t.prototype,"bgms",void 0),o=__decorate([n],t)}(cc.Component);o.default=c,cc._RF.pop()},{}],Subpub:[function(e,t,o){"use strict";cc._RF.push(t,"6ddb50dvtJBk4vLFdU9liUF","Subpub");var a=function(){function e(t){void 0===t&&(t={}),this.idx=0,this.config={},this.idx=e.subPubUniqueIdx++,this.config=t}return e.clearAll=function(){e.subPubUniqueIdx=1,e.subRec={}},e.prototype.subscribe=function(t,o){e.subRec[t]||(e.subRec[t]={}),e.subRec[t][this.idx]={cb:o}},e.prototype.deSubscribe=function(t){e.subRec[t]&&delete e.subRec[t][this.idx]},e.prototype.publish=function(t,o){for(var a in e.subRec[t])e.subRec[t][a].cb(this.idx,o,this.config)},e.publishEx=function(t,o){for(var a in void 0===o&&(o={}),e.subRec[t])try{e.subRec[t][a].cb(-1,o,{})}catch(e){}},e.subPubUniqueIdx=1,e.subRec={},e}();o.default=a,cc._RF.pop()},{}],TAUtils:[function(e,t){"use strict";cc._RF.push(t,"46e3buVsjdFBq0SaewWRolc","TAUtils");var o=0,a={init:function(){},initShareConfig:function(){var e=this;cc.sys.platform==cc.sys.WECHAT_GAME&&(wx.onShareAppMessage(function(){return o=e.getShareIndex(),{title:cc.pvz.GameConfig.ShareTitileList[o],imageUrlId:cc.pvz.GameConfig.ShareIDList[o],imageUrl:cc.pvz.GameConfig.ShareUrlList[o],query:"fromuid="+(cc.pvz.cloud.uid?cc.pvz.cloud.uid:0)}}),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]}))},share:function(e,t){if(console.log("share",e),this.lastShareType!=e&&(this.shareIndex=0,this.lastShareType=e),o=this.getShareIndex(),cc.sys.platform!=cc.sys.WECHAT_GAME)return cc.popupManager.showToast("\u5206\u4eab"),void t(!0);var a={title:cc.pvz.GameConfig.ShareTitileList[o],imageUrlId:cc.pvz.GameConfig.ShareIDList[o],imageUrl:cc.pvz.GameConfig.ShareUrlList[o],query:"fromuid="+(cc.pvz.cloud.uid?cc.pvz.cloud.uid:0)};this.isFromShare=!0,this.shareCB=t,this.shareDate=Date.now(),wx.shareAppMessage(a)},shareCurrent:function(e,t){if(cc.sys.platform==cc.sys.WECHAT_GAME){var o={title:e,query:"fromuid="+(cc.pvz.cloud.uid?cc.pvz.cloud.uid:0)};wx.shareAppMessage(o)}else t(!0)},getShareIndex:function(){return 0},onWxShow:function(){this.isFromShare&&this.shareCB&&(this.shareCB(!0),this.shareIndex++),this.isFromShare=!1},getGlobalConfig:function(){return cc.pvz.utils.sendMsg(cc.pvz.GameConst.SERVER_CONFIG_URL,null,"GET").then(function(e){return Promise.resolve(e)}).catch(function(e){return console.log("getGlobalConfig data error",e),Promise.resolve({})})},getSwitch:function(e){return!!cc.gameGlobalConfig&&((t=cc.gameGlobalConfig.buttonCfgList?cc.gameGlobalConfig.buttonCfgList.find(function(t){return t.button_name==e}):null)?(console.log("getSwitch",e,!!t.flag&&1==t.flag),!!t.flag&&1==t.flag):(console.log("getSwitch using default",e,!1),!1));var t},getSwitchAd:function(){return!0},initShareKey:function(){},getTwtraceidSwitch:function(e){return void 0===e&&(e="yxbn"),cc.sys.platform!=cc.sys.WECHAT_GAME||(cc.Twtraceid=this.getTwtraceidFrom(wx.getLaunchOptionsSync()),cc.Twtraceid==e)},getThreshold:function(e,t){if(cc.gameGlobalConfig.valueCfgList){var o=cc.gameGlobalConfig.valueCfgList.find(function(t){return t.value_name==e});if(o)return console.log("getThreshold",e,o.value_num),o.value_num}return console.log("getThreshold using default",e,t),t},getTwtraceidFrom:function(e){if(Object.keys(e.query).length>0)for(var t in e.query){if("?twtraceid"==t)return e.query[t];if("twtraceid"==t)return e.query[t]}return""},onCheckGameVersion:function(){if(cc.sys.platform==cc.sys.WECHAT_GAME){console.log("onCheckGameVersion");var e=wx.getUpdateManager();e.onCheckForUpdate(function(e){console.log("\u8bf7\u6c42\u5b8c\u65b0\u7248\u672c\u4fe1\u606f\u7684\u56de\u8c03 : ",e.hasUpdate)}),e.onUpdateReady(function(){wx.showModal({title:"\u66f4\u65b0\u63d0\u793a",content:"\u65b0\u7248\u672c\u5df2\u51c6\u5907\u5c31\u7eea\uff0c\u8bf7\u91cd\u542f\u6e38\u620f\uff01",confirmText:"\u91cd\u542f\u6e38\u620f",showCancel:!1,success:function(t){t.confirm&&e.applyUpdate()}})}),e.onUpdateFailed(function(){})}},uploadRegisterData:function(e){if(cc.sys.platform!=cc.sys.DESKTOP_BROWSER&&cc.sys.platform!=cc.sys.WIN32&&cc.sys.platform!=cc.sys.MOBILE_BROWSER){console.log("\u51c6\u5907\u4e0a\u62a5\u6ce8\u518c\u4fe1\u606f");var t={sid:"1",roleid:e.uid+"",rolename:"\u73a9\u5bb6"+e.uid,level:"1"};P8LogSDK.signLog(t).then(function(e){console.log("\u5df2\u4e0a\u62a5\u6ce8\u518c\u4fe1\u606f:",e)})}},uploadLoginData:function(e){if(cc.sys.platform!=cc.sys.DESKTOP_BROWSER&&cc.sys.platform!=cc.sys.WIN32&&cc.sys.platform!=cc.sys.MOBILE_BROWSER){console.log("\u51c6\u5907\u4e0a\u62a5\u767b\u5f55\u4fe1\u606f");var t={sid:"1",roleid:e.uid+"",rolename:"NONAME"===e.name?"\u73a9\u5bb6"+e.uid:e.name,level:e.level+"",vip:"1",oaid:""};P8LogSDK.pushLoginData(t).then(function(e){console.log("\u5df2\u4e0a\u62a5\u767b\u5f55\u4fe1\u606f:",e)})}},uploadLvUpData:function(){if(cc.sys.platform!=cc.sys.DESKTOP_BROWSER&&cc.sys.platform!=cc.sys.WIN32&&cc.sys.platform!=cc.sys.MOBILE_BROWSER){console.log("\u51c6\u5907\u4e0a\u62a5\u5347\u7ea7\u4fe1\u606f");var e={level:""+cc.player.level,sid:"1",roleid:""+cc.pvz.cloud.uid,rolename:""+cc.pvz.cloud.name,vip:"1",oaid:""};P8LogSDK.upGradeRecord(e).then(function(e){console.log("\u5df2\u4e0a\u62a5\u767b\u5f55\u4fe1\u606f:",e)})}},trackP8AdClick:function(e){if(cc.sys.platform==cc.sys.WECHAT_GAME){var t={sid:"1",uid:""+cc.pvz.cloud.uid,roleid:""+cc.pvz.cloud.uid,rolename:"\u73a9\u5bb6"+cc.pvz.cloud.uid,level:""+cc.player.level,ad_slot:""+cc.pvz.GameConfig.AdType[e],ad_unit_id:cc.pvz.GameConst.AD_UNITS_REWARD[0],type:"RewardedVideoAd",status:"0"};P8LogSDK.wxVideoLog(t).then(function(e){console.log(e)})}},trackP8AdSucc:function(e){if(cc.sys.platform==cc.sys.WECHAT_GAME){var t={sid:"1",uid:""+cc.pvz.cloud.uid,roleid:""+cc.pvz.cloud.uid,rolename:"\u52c7\u58eb"+cc.pvz.cloud.uid,level:""+cc.player.level,ad_slot:""+cc.pvz.GameConfig.AdType[e],ad_unit_id:cc.pvz.GameConst.AD_UNITS_REWARD[0],type:"RewardedVideoAd",status:"1"};P8LogSDK.wxVideoLog(t).then(function(e){console.log(e)})}},track:function(){},trackLogin:function(){},trackLoading:function(e,t){void 0===t&&(t=0)},trackBackpack:function(){},trackLevel:function(){},trackEndLevel:function(){},trackAdUIShow:function(){},trackAdBtnClick:function(){},trackAdClose:function(){},trackAdEnd:function(){},trackSystemUI:function(){}};cc.pvz||(cc.pvz={}),cc.pvz.TAUtils=a,t.exports=a,cc._RF.pop()},{}],Tool:[function(e,t,o){"use strict";cc._RF.push(t,"90351EISPtCoJXWzb3n6Exa","Tool");var a=e("./Subpub"),n=function(){function e(){}return e.init=function(t){var o=cc.find("Canvas");e.ScreenWH[0]=o.width,e.ScreenWH[1]=o.height,e.BattlegroundBoard[0]=t.x-t.width/2,e.BattlegroundBoard[1]=t.x+t.width/2,e.BattlegroundBoard[2]=t.y-t.height/2,e.BattlegroundBoard[3]=t.y+t.height/2,cc.director.getCollisionManager().enabled=!0},e.isInBattleGround=function(t,o){return t>=e.BattlegroundBoard[0]-100&&t<=e.BattlegroundBoard[1]+100&&o>=e.BattlegroundBoard[2]-100&&o<=e.BattlegroundBoard[3]+100},e.getAngle=function(e,t){if(0===e)return 0===t?0:t>0?90:270;if(0===t)return e>0?0:180;var o=180*Math.atan(Math.abs(t)/Math.abs(e))/Math.PI;return t>0?e<0&&(o=180-o):o=e>0?360-o:180+o,o},e.setValueTo=function(e,t,o){return e<t?t:e>o?o:e},e.isInEllipse=function(e,t,o,a,n,i){return(e-o)*(e-o)/(n*n)+(t-a)*(t-a)/(i*i)<=1},e.isInRect=function(e,t,o,a,n,i){return e>=o-n/2&&e<=o+n/2&&t>=a-i/2&&t<=a+i/2},e.randomPointInNode=function(e){return[e.x-e.width/2+Math.random()*e.width,e.y-e.height/2+Math.random()*e.height]},e.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.randomFromArr=function(e){return e[Math.floor(Math.random()*e.length)]},e.randomFromArr2=function(e,t){if(e.length<=t)return e;if(t<=0)return[];for(var o=[],a=e.map(function(e){return e}),n=0;n<t;n++){var i=Math.floor(Math.random()*(a.length-n));o.push(a[i]),a[i]=a[a.length-1-n]}return o},e.randomByWeight=function(e,t){void 0===t&&(t=[]);var o=[],a=0,n={};t.map(function(e){n[e]=1});for(var i=0;i<e.length;i++)n[i]||(o.push({idx:i,w:e[i]}),a+=e[i]);var c=Math.random()*a;for(i=0;i<o.length;i++){if(c<o[i].w)return o[i].idx;c-=o[i].w}console.log("Tools.randombyWeight\u53d1\u751f\u672a\u77e5\u9519\u8bef\uff1a",o,a,c)},e.getPrefab=function(e,t,o){var a=e.getChildByName(o);return a||((a=cc.instantiate(t)).setParent(e),a.name=o),a.active=!0,a},e.showVideoAd=function(e,t){cc.pvz.AdUtils.showAdRewardVideo(e,function(e){e&&t()})},e.formatBigNum3=function(e){return e<1e4?""+e:e%1e3==0?e/1e3+"K":(e/1e3).toFixed(1)+"K"},e.resetGamePauseInfo=function(){e.gameTimeScale=1,e.gamePause=0},e.pauseGame=function(){e.gamePause=1,a.default.publishEx("Spine.SetTimeScale",{timeScale:0})},e.resumeGame=function(){e.gamePause=0,a.default.publishEx("Spine.SetTimeScale",{timeScale:e.gameTimeScale})},e.setGameTimeScale=function(t){e.gameTimeScale=t,e.gamePause||a.default.publishEx("Spine.SetTimeScale",{timeScale:t})},e.copyArr=function(t){void 0===t&&(t=[]);for(var o=[],a=0;a<t.length;a++)Array.isArray(t[a])?o.push(e.copyArr(t[a])):o.push(t[a]);return o},e.getRGBColor=function(e){for(var t=[0,0,0],o=0;o<3;o++)t[o]=parseInt("0x"+e[2*o+1]+e[2*o+2]);return new cc.Color(t[0],t[1],t[2])},e.shuffle=function(e){for(var t=0;t<e.length;t++){var o=Math.floor(Math.random()*(e.length-t))+t,a=e[t];e[t]=e[o],e[o]=a}return e},e.ScreenWH=[0,0],e.BattlegroundBoard=[0,0,0,0],e.inSceneTest=1,e.gameTimeScale=1,e.gamePause=0,e}();o.default=n,cc._RF.pop()},{"./Subpub":"Subpub"}],loading:[function(e,t){"use strict";cc._RF.push(t,"66743DrwvlEwIWvKFiPlrpI","loading"),cc.Class({extends:cc.Component,properties:{progressBar:cc.ProgressBar},onLoad:function(){cc.debug.setDisplayStats(!1);var e=cc.RenderFlow.prototype._updateRenderData;cc.RenderFlow.prototype._updateRenderData=function(t){if(!t._renderComponent||!t._renderComponent._assembler)return t._renderFlag&=~cc.RenderFlow.FLAG_UPDATE_RENDER_DATA,void this._next._func(t);e.call(this,t)};var t=cc.RenderFlow.prototype._render;cc.RenderFlow.prototype._render=function(e){e._renderComponent&&e._renderComponent._assembler?t.call(this,e):this._next._func(e)};var o=cc.RenderFlow.prototype._postRender;cc.RenderFlow.prototype._postRender=function(e){e._renderComponent&&e._renderComponent._assembler?o.call(this,e):this._next._func(e)}},start:function(){cc.macro.ENABLE_MULTI_TOUCH=!1,cc.pvz.TAUtils.init(),this.total=1,this.waited=1,this.loadSubpackage("uiImage"),this.loadSubpackage("mainUI"),this.loadSubpackage("actors"),this.loadSubpackage("game"),this.singleTime=Math.max(.3,1.8/this.total),this.barProgress=0,this.progressBar.progress=0,this.updateProgress()},updateProgress:function(){var e=(this.barProgress+1)/this.total;cc.tween(this.progressBar).to(this.singleTime,{progress:e}).start()},initData:function(){cc.sys.platform==cc.sys.WECHAT_GAME&&(wx.setKeepScreenOn({keepScreenOn:!0}),wx.onError(function(e){cc.pvz.TAUtils.track("error",{message:e.message,stack:e.stack})})),cc.isControlAd=!0,cc.pvz.AdUtils.initAllAds(),cc.pvz.PlayerData.initPlayerData(),this.onResReady()},onProgressChanged:function(){this.barProgress++,this.updateProgress()},onResReady:function(){this.onProgressChanged(),this.waited-=1,1==this.waited?this.initData():0==this.waited&&this.onAllResReady()},loadSubpackage:function(e){var t=this;cc.assetManager.getBundle(e)?this.onResReady():(this.total++,this.waited++,cc.assetManager.loadBundle(e,null,function(o){o?console.log("load subpackage "+e+" fail:",o):(console.log("load subpackage "+e),t.onResReady())}))},onAllResReady:function(){var e=this;cc.pvz.cloud.login(function(){if(cc.pvz.cloud.baseData.length>2){var t,o,a=JSON.parse(cc.pvz.cloud.baseData);console.log("server t:",a.t,", local t:",cc.player.t,"s version:",a.dataVersion),t=cc.player.achievePro.hasOwnProperty(cc.pvz.GameConfig.MissionType["\u88c5\u5907\u603b\u7b49\u7ea7n"])?cc.player.achievePro[cc.pvz.GameConfig.MissionType["\u88c5\u5907\u603b\u7b49\u7ea7n"]]:0,o=a.achievePro.hasOwnProperty(cc.pvz.GameConfig.MissionType["\u88c5\u5907\u603b\u7b49\u7ea7n"])?a.achievePro[cc.pvz.GameConfig.MissionType["\u88c5\u5907\u603b\u7b49\u7ea7n"]]:0,(a.t>cc.player.t||o>t)&&(cc.player=a,cc.pvz.PlayerData.postLoadData())}cc.pvz.TAUtils.uploadLoginData({uid:cc.pvz.cloud.uid,name:cc.pvz.cloud.name,level:cc.pvz.PlayerData.getStageLevel()}),e.checkIntoGame()}),cc.pvz.TAUtils.initShareKey(),cc.pvz.TAUtils.initShareConfig()},checkIntoGame:function(){1==cc.pvz.PlayerData.getStageLevel()?(cc.pvz.runtimeData.init(0,1),cc.director.loadScene("game1"),cc.pvz.TAUtils.trackBackpack(1)):cc.director.loadScene("mainUI")}}),cc._RF.pop()},{}],temp:[function(e,t){"use strict";cc._RF.push(t,"61a9ahqtSxM64bKi6E+YicE","temp"),cc._RF.pop()},{}],utils:[function(e,t){"use strict";cc._RF.push(t,"16759n/eJRFL4+HP4MKdKZI","utils");var o={getRGBColor:function(e){var t=new cc.Color;return t.fromHEX("#"===e[0]?e.substring(1):e),t},getReminDays:function(e,t){var o=Date.now()-t;return e-Math.floor(o/864e5)},getTodayZeroTimes:function(){var e=Date.now();return e-e%864e5},getTodayLastTimes:function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59);return Math.floor((t-e)/1e3)},getCurDayInYears:function(){var e=(new Date).getFullYear().toString(),t=new Date-new Date(e)+288e5;return Math.ceil(t/864e5)+1},getDate:function(){var e=new Date;return 1e4*e.getFullYear()+100*e.getMonth()+e.getDate()},getStartOfWeek:function(){var e,t=new Date,o=t.getDay();return e=0==o?-6:1-o,t.setDate(t.getDate()+e),t.setHours(0,0,0,0),t.getTime()},getCurDayInWeek:function(){var e=(new Date).getDay();return 0==e?7:e},formatItemNum:function(e){var t=e;if(t<1e4)return e;var o=parseInt(t/1e3);return(o=(t/1e3).toFixed((t-1e3*o)%100==0?1:2))+"k"},foramtAttributeNum:function(e){var t=e;return 10*e%10==0?t.toFixed(0):t.toFixed(1)},randomWeightIndex:function(e){for(var t=0,o=[0],a=e.length,n=0;n<a;n++)t+=e[n],o.push(t);for(var i=Math.random()*o[o.length-1]-1,c=0,s=0,r=0,l=o.length-1;r<l;)if((s=o[(c=parseInt((r+l)/2))+1])<i)r=c+1;else{if(!(s>i)){r=c;break}l=c}return r},getZIndex:function(e){return e.zIndex},checkZIndex:function(e,t){return e.zIndex<=t.zIndex},getTargetLength:function(e,t){return e.position.sub(t.position).len()},_withinTarget:function(e,t){var o=e.getBoundingBox(),a=t.convertToWorldSpaceAR(cc.v2()),n=e.parent.convertToNodeSpaceAR(a);return o.contains(n)},_withinTargetPlace:function(e,t){var o=e.getBoundingBox(),a=t.getLocation(),n=e.parent.convertToNodeSpaceAR(a);return o.contains(n)},_withinTargetSun:function(e,t){var o=e.getBoundingBox(),a=t.getLocation(),n=e.parent.convertToNodeSpaceAR(a);return o.contains(n)},getSpineCurrentName:function(e){return e.animation},getTargetNodeComponent:function(e,t){return e.getComponent(t)},ComputeBulletPosition:function(e,t){var o=cc.v2(t.worldX,t.worldY);return e.convertToWorldSpaceAR(o)},ComputeDistance:function(e,t){var o=e.convertToWorldSpaceAR(cc.v2()),a=t.convertToWorldSpaceAR(cc.v2());return o.sub(a).mag()},ComputeListSum:function(e){return e.reduce(function(e,t){return e+t},0)},getRotationRadians:function(e,t){var o=t.sub(e);return Math.atan2(o.y,o.x)},shuffleArray:function(e){for(var t,o,a=e.length;a;)o=Math.floor(Math.random()*a--),t=e[a],e[a]=e[o],e[o]=t;return e},compareVersion:function(e,t){e=e.split("."),t=t.split(".");for(var o=Math.max(e.length,t.length);e.length<o;)e.push("0");for(;t.length<o;)t.push("0");for(var a=0;a<o;a++){var n=parseInt(e[a]),i=parseInt(t[a]);if(n>i)return 1;if(n<i)return-1}return 0},formatCDTime:function(e){var t="",o=e%60;if(e>=86400)t+=Math.floor(e/86400)+"\u5929",t+=Math.floor(e/3600%24)+"\u5c0f\u65f6";else{if(e>=3600)return(t+=Math.floor(e/3600)+"\u5c0f\u65f6")+Math.floor(e/60%60)+"\u5206";if(e>60)return(t+=Math.floor(e/60%60)+"\u5206")+Math.floor(o)+"\u79d2";o>0&&(t+=Math.floor(o)+"\u79d2")}return t},formatSeconds3:function(e){var t=Math.floor(e/3600);e-=3600*t;var o=Math.floor(e/60),a=e%60;return(t=t.toString().padStart(2,"0"))+":"+(o=o.toString().padStart(2,"0"))+":"+a.toString().padStart(2,"0")},formatSeconds:function(e){var t=e%60,o="";return e>=3600&&(o+=Math.floor(e/3600)+"\u5c0f\u65f6"),e>=60&&(o+=Math.floor(e/60%60)+"\u5206"),t>0&&(o+=Math.floor(t)+"\u79d2"),o},formatSeconds2:function(e){var t=e%60,o="";if(e>=60){var a=e/60;o+=((a=parseInt(a))>=10?a:"0"+a)+":"}else o+="00:";return o+(t>0?t>=10?t:"0"+t:"00")},getNodeSelfBoundBox:function(e){var t=e.getBoundingBox();return t.x=e.convertToWorldSpaceAR(cc.v2()).x-t.width/2,t.y=e.convertToWorldSpaceAR(cc.v2()).y-t.height/2,t},getNodeSelfBoundBox2:function(e){if(e._parent){e._parent._updateWorldMatrix();var t=e.getBoundingBox();return e._calculWorldMatrix(),t.transformMat4(t,e._worldMatrix),t}return e.getBoundingBox()},uploadScore:function(e){if(cc.sys.platform==cc.sys.WECHAT_GAME){var t=[],o={};o.key=String("s"),o.value=String(e),t.push(o),wx.setUserCloudStorage({KVDataList:t,success:function(){},fail:function(){}})}},fadeInBtn:function(e){e.opacity=0,e.active=!0,e.runAction(cc.fadeIn(.16))},bindSpine:function(e,t,o){var a=e.attachUtil.generateAttachedNodes(t)[0];o.parent=a},getbindSpine:function(e,t){return e.attachUtil.generateAttachedNodes(t)[0].children[0]},bindSpines:function(e,t){var o=e.attachUtil;t.forEach(function(e){var t=o.generateAttachedNodes(e.bone)[0];e.node.parent=t})},sendMsg:function(e,t,o,a){if(void 0===a&&(a=5e3),cc.sys.platform==cc.sys.WECHAT_GAME)return new Promise(function(n,i){var c={url:e,data:t||{},method:o,success:function(e){n(e.data)},fail:function(e){i(e)},timeout:a};t&&(c.data=t),wx.request(c)});var n=new XMLHttpRequest;return new Promise(function(i,c){var s=function(){c("error:xhr status="+n.status),n=null},r=setTimeout(function(){console.error("xhr timeout"),n&&(n.abort(),s())},a);if(n.onreadystatechange=function(){4==n.readyState&&(n.status>=200&&n.status<400?function(){var t=n.responseText;if(0==t.length)cc.error("empty response, url:",e),i({});else{var o=JSON.parse(t);i("object"==typeof o&&o?o:t)}n=null,clearTimeout(r)}():n.status>=400&&s())},console.log("xhr start by "+o+" method!url="+e+", data="+t),n.open(o,e,!0),"POST"==o&&t){var l=new Blob([JSON.stringify(t)]);n.send(l)}else n.send()})},setSpriteFrame:function(e,t,o){e?this.useBundleAsset(t,o,cc.SpriteFrame,function(t){e.spriteFrame=t}):console.warn("sprite is null",t,o)},setSpriteFrames:function(e,t,o){this.useBundleAsset(t,o,cc.SpriteFrame,function(t){e.forEach(function(e){return e.spriteFrame=t})})},useBundleAsset:function(e,t,o,a){var n=function(e){var n=e.get(t,o);n?a(n):e.load(t,o,function(e,t){e?console.warn(e):a(t)})},i=cc.assetManager.getBundle(e);i?n(i):cc.assetManager.loadBundle(e,function(e,t){e?console.warn(e):n(t)})},releaseAsset:function(e,t,o){var a=cc.assetManager.getBundle(e);a&&a.get(t,o)&&a.release(t,o)},manuallyCheckCollider:function(e){for(var t=cc.director.getCollisionManager(),o=[],a=t._contacts[0].constructor,n=0,i=0,c=t._colliders,s=0,r=c.length;s<r;s++){var l=c[s];t.shouldCollide(e,l)&&o.push(new a(e,l))}t.initCollider(e),t.updateCollider(e);var u=[];for(n=0,i=o.length;n<i;n++){var p=o[n].updateState();p!==a.CollisionType.None&&u.push([p,o[n]])}for(n=0,i=u.length;n<i;n++){var d=u[n];t._doCollide(d[0],d[1])}return u.length>0},manuallyCheck2Collider:function(e,t){var o=cc.director.getCollisionManager(),a=o._contacts[0].constructor;return o.initCollider(e),o.initCollider(t),o.updateCollider(e),o.updateCollider(t),new a(e,t).test()},updateColliders:function(e){for(var t=cc.director.getCollisionManager(),o=0,a=e.length;o<a;o++){var n=e[o];t.initCollider(n),t.updateCollider(n)}},getCollideWith:function(e,t){var o=cc.director.getCollisionManager();o._contacts[0]||console.error("s");var a=o._contacts[0].constructor;o.initCollider(e),o.updateCollider(e);for(var n=0,i=t.length;n<i;n++){var c=t[n];if(o.initCollider(c),o.updateCollider(c),new a(e,c).test())return c}return null},inRange2:function(e,t,o){var a=o.x-e.x,n=o.y-e.y;return a*a+n*n/.49<=t},getRewardItem:function(e,t){var o=new cc.pvz.GameConfig.RewardData;return o.itemId=e,o.count=t,o.toolId=-1,o},getRewardToolItem:function(e,t){void 0===t&&(t=1);var o=new cc.pvz.GameConfig.RewardData;return o.itemId=cc.pvz.GameConfig.ItemType["\u56fa\u5b9a\u788e\u7247"],o.count=t,o.toolId=e,o},onCheckRandomTool:function(e,t,o){void 0===o&&(o=!0);var a=[],n=cc.JsonControl.getItemJson(e.itemId),i=cc.pvz.utils.getOpenToolList(n.Quality,o);0==i.length&&i.push(7);for(var c=function(){var e=i[cc.math.randomRangeInt(0,i.length)],t=cc.pvz.utils.getRewardToolItem(e,1),o=a.find(function(t){return t.toolId==e});o?o.count++:a.push(t)},s=0;s<e.count;s++)c();for(var r=0;r<a.length;r++)t.push(a[r])},getOpenToolList:function(e,t){void 0===t&&(t=!0);var o=cc.pvz.PlayerData.getStageLevel(),a=[],n=cc.pvz.GameConfig["Quality"+e+"Tools"];if(t){for(var i=0;i<n.length;i++){var c=n[i];o>cc.pvz.GameConfig.ToolLockLevel[c-1]&&a.push(c)}return a}return n},getLevelInterval:function(e){for(var t=[[0,3],[4,7],[8,11],[12,15],[16,999]],o=0;o<t.length;o++)if(e>=t[o][0]&&e<=t[o][1])return o+1;return null},onChangeCNNUm:function(e){return["\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341"][e-1]},spineFromTo:function(e,t,o,a,n){void 0===a&&(a=!0),void 0===n&&(n=null),t&&e.setAnimation(0,t,!1);var i=n;e.setCompleteListener(function(){e.setAnimation(0,o,a),i&&i(),e.setCompleteListener(null)})}};cc.pvz||(cc.pvz={}),cc.pvz.utils=o,t.exports=o,cc._RF.pop()},{}]},{},["ActBuffPanel","AdBtn","AdUtils","AutoScale","BattleGround2Ctrl","Bullet2","Butler","Cloud","ContentAdapter","CustomSafeArea","DieEff2","EnemySpawner2","GameConfig","GameConst","Gate2","GuideManager","JsonControl","Num2","PlayerData","Pool","PopupManager","PowerInfo","PrefabInfo","RemoveWhenComplete","RewardItem","Role2","RuntimeData","SoundManager","Subpub","TAUtils","Tool","loading","utils","temp"]);