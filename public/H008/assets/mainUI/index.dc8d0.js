window.__require=function e(t,i,o){function a(c,n){if(!i[c]){if(!t[c]){var r=c.split("/");if(r=r[r.length-1],!t[r]){var h="function"==typeof __require&&__require;if(!n&&h)return h(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+c+"'")}c=r}var p=i[c]={exports:{}};t[c][0].call(p.exports,function(e){return a(t[c][1][e]||e)},p,p.exports,e,t,i,o)}return i[c].exports}for(var s="function"==typeof __require&&__require,c=0;c<o.length;c++)a(o[c]);return a}({ActLevelItem:[function(e,t){"use strict";cc._RF.push(t,"cdb0cOcgO5BHa5TmKOEHZP9","ActLevelItem"),cc.Class({extends:cc.Component,properties:{timeLabel:cc.Label,timePanel:cc.Node,battleTimesLabel:cc.Label,battleBtn:cc.Node,redTip:cc.Node},initActLevelItem:function(e){this.actType=e,this.stageLevel=cc.pvz.PlayerData.getStageLevel(),this.lockLevel=cc.pvz.GameConfig.OpenSysLv[this.actType],this.timePanel.active=this.stageLevel>this.lockLevel;var t=this.battleBtn.children[0].getComponent(cc.Sprite);cc.JsonControl.setSpriteGray(t,this.stageLevel<=this.lockLevel),this.actType===cc.pvz.GameConfig.ActType["\u6311\u6218\u526f\u672c"]&&this.initActLevelInfo(),this.onCheckActLevelRed()},initActLevelInfo:function(){cc.pvz.PlayerData.checkAndResetActLevel(),this.ActLevelData=cc.pvz.PlayerData.getActLevelData(),this.battleTimesLabel.string=this.ActLevelData.times,this.lastTime=cc.pvz.utils.getTodayLastTimes(),this.timeLabel.string=""+cc.pvz.utils.formatSeconds3(this.lastTime),this.schedule(this.refreshLoastTime,1)},refreshLoastTime:function(){this.lastTime--,this.timeLabel.string=cc.pvz.utils.formatSeconds3(this.lastTime),this.lastTime<=0&&(this.lastTime=86400,this.timeLabel.string=cc.pvz.utils.formatSeconds3(this.lastTime),this.actType==cc.pvz.GameConfig.ActType["\u6311\u6218\u526f\u672c"]&&(cc.pvz.PlayerData.checkAndResetActLevel(),this.ActLevelData=cc.pvz.PlayerData.getActLevelData(),this.battleTimesLabel.string=this.ActLevelData.times),this.redTip.active=this.stageLevel>this.lockLevel)},onCheckActLevelRed:function(){if(this.stageLevel<=this.lockLevel)this.redTip.active=!1;else{if(this.actType==cc.pvz.GameConfig.ActType["\u6311\u6218\u526f\u672c"]){if(this.ActLevelData.times>0)return void(this.redTip.active=!0);for(var e=cc.JsonControl.ActLevelBoxJson,t=0;t<4;t++)if(e[t].score<=this.ActLevelData.score&&0==this.ActLevelData.boxStatus[t])return void(this.redTip.active=!0)}else if(this.ActBallData.times>0)return void(this.redTip.active=!0);this.redTip.active=!1}},onClickActStart:function(){this.stageLevel<=this.lockLevel?cc.popupManager.showToast("\u901a\u8fc7\u5173\u5361\u7b2c"+this.lockLevel+"\u5173\u89e3\u9501\uff01"):this.actType===cc.pvz.GameConfig.ActType["\u6311\u6218\u526f\u672c"]&&cc.popupManager.popup("mainUI","TiaozhanInfoUI","UIActLevelInfo",{ad:!1,scale:!1},function(){cc.UIActLevel.initActItemList()})}}),cc._RF.pop()},{}],Dragable:[function(e,t){"use strict";cc._RF.push(t,"3adadwr1bRO+KBUksbSlGo6","Dragable"),cc.Class({extends:cc.Component,properties:{dragingRoot:cc.Node,onDragBegan:cc.Component.EventHandler,onDragMoved:cc.Component.EventHandler,onDragEnded:cc.Component.EventHandler},start:function(){this.initRoot=this.node.parent,this.initPos=this.node.position,this.node.on(cc.Node.EventType.TOUCH_START,this.onClickBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onClickMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onClickEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onClickEnded,this)},setNodePos:function(e){this.node.position=this.node.parent.convertToNodeSpaceAR(e)},onClickBegan:function(e){var t=e.getLocation();this.node.parent=this.dragingRoot,this.setNodePos(t),this.onDragBegan&&this.onDragBegan.emit([this,t])},onClickMoved:function(e){var t=e.getLocation();this.setNodePos(t),this.onDragMoved&&this.onDragMoved.emit([this,t])},onClickEnded:function(e){var t=e.getLocation();this.setNodePos(t),this.onDragEnded&&this.onDragEnded.emit([this,t]),this.node.parent=this.initRoot,this.node.position=this.initPos}}),cc._RF.pop()},{}],EffectFly:[function(e,t){"use strict";cc._RF.push(t,"06a6bYADh5PIbKe9+Jug5M8","EffectFly"),cc.Class({extends:cc.Component,properties:{coinSpine:sp.Skeleton,effectNodeList:[cc.Sprite]},initEffect:function(e,t,i){var o=this;void 0===i&&(i=1),this.coinSpine.node.active=!0,this.IKBone||(this.IKBone=this.coinSpine.findBone("IK"));var a=this.node.parent.convertToNodeSpaceAR(t);this.IKBone.y=a.y,this.IKBone.x=a.x;var s=cc.JsonControl.getItemJson(e);cc.pvz.utils.setSpriteFrames(this.effectNodeList,"uiImage","item/item"+s.Icon),this.coinSpine.setAnimation(0,1==i?"huobi":"huobi"+i,!1),this.coinSpine.setCompleteListener(function(){o.node.runAction(cc.removeSelf()),o.coinSpine.setCompleteListener(null)})}}),cc._RF.pop()},{}],LevelMap:[function(e,t){"use strict";cc._RF.push(t,"a0eb5kxvh5HA5kUEfXyGaEg","LevelMap"),cc.Class({extends:cc.Component,properties:{lockNode:cc.Node,mapNameLabel:cc.Label,mapTipLabel:cc.Label,lockMapTipLabel:cc.Label,battlePanel:cc.Node,sweepBtn:cc.Node,battleBtn:cc.Node,sweepTimesLabel:cc.Label,sweepAdNode:cc.Node,boxSpineList:[sp.Skeleton],boxLabelList:[cc.Label],boxRewardPanel:cc.Node,rewardParent:cc.Node},onHideBoxRewardPanel:function(){this.boxRewardPanel.active=!1},initLevelMap:function(e){this.boxRewardPanel.active=!1,this.curBoxId=-1,this.stageLevel=e,this.levelJson=cc.JsonControl.getLevelJson(this.stageLevel),this.curStageLevel=cc.pvz.PlayerData.getStageLevel(),this.sweepTimes=cc.pvz.PlayerData.getSweepTimes(),this.maxWave=cc.pvz.PlayerData.getMaxLevelWave(),this.isLock=this.stageLevel>this.curStageLevel,this.isFinish=this.stageLevel<this.curStageLevel,this.mapNameLabel.string=this.levelJson.name,this.lockNode.active=this.isLock,this.mapTipLabel.node.active=!this.isLock,this.lockMapTipLabel.node.active=this.isLock,this.battlePanel.active=!this.isLock,this.sweepBtn.active=this.isFinish,this.isFinish?(this.mapTipLabel.string=cc.pvz.GameConfig.LevelFinishTip,this.sweepTimesLabel.string=this.sweepTimes,this.sweepTimesLabel.node.active=this.sweepTimes>0,this.sweepAdNode.active=this.sweepTimes<=0):this.isLock?this.lockMapTipLabel.string=cc.pvz.GameConfig.LevelLockTip.replace("$",this.stageLevel-1):this.mapTipLabel.string=cc.pvz.GameConfig.LevelMaxWaveTip.replace("$",this.maxWave),this.levelBoxData=cc.pvz.PlayerData.getLevelBoxData(this.stageLevel);for(var t=0;t<this.boxLabelList.length;t++){var i=this.levelJson["wave"+(t+1)];this.boxLabelList[t].string=cc.pvz.GameConfig.LevelBoxTip.replace("$",i);var o=this.boxSpineList[t];this.isLock?o.setAnimation(0,"baoxiang1",!1):1==this.levelBoxData[t]?o.setAnimation(0,"baoxiang4",!1):i<=this.maxWave||this.isFinish?o.setAnimation(0,"baoxiang2",!0):o.setAnimation(0,"baoxiang1",!1)}},onClickBox:function(e,t){if(!cc.MainUI.isLookAd){var i=parseInt(t);if(1!=this.levelBoxData[i-1]){var o,a=this.levelJson["wave"+i];o=!this.isLock&&(a<=this.maxWave||this.isFinish);var s=this.levelJson["reward"+i],c=Math.floor(s.length/2),n=0;this.rewardData=[];for(var r=0;r<c;r++){var h=cc.pvz.utils.getRewardItem(s[n],s[n+1]);this.rewardData.push(h),n+=2}if(o){this.boxRewardPanel.active=!1,cc.pvz.PlayerData.updateLevelBoxData(this.stageLevel,i);var p=this.boxSpineList[i-1];p.setAnimation(0,"baoxiang3",!1),p.setCompleteListener(function(){p.setAnimation(0,"baoxiang4",!1),p.setCompleteListener(null)}),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},this.rewardData,cc.pvz.GameConfig.UIFromType["\u5173\u5361\u5b9d\u7bb1"])}else i!=this.curBoxId?(this.curBoxId=i,this.boxRewardPanel.active=!0,this.refreshBoxPanelInfo(i)):this.boxRewardPanel.active=!this.boxRewardPanel.active}else cc.popupManager.showToast("\u5956\u52b1\u5df2\u9886\u53d6")}},refreshBoxPanelInfo:function(e){this.boxRewardPanel.position=cc.v2(this.boxSpineList[e-1].node.parent.position.x,this.boxRewardPanel.position.y);for(var t=0;t<this.rewardParent.childrenCount;t++){var i=this.rewardParent.children[t];t<this.rewardData.length?(i.active=!0,i.getComponent("RewardItem").initBoxRewardItem(this.rewardData[t])):i.active=!1}},onClickSweep:function(){var e=this;cc.MainUI.isLookAd||(cc.pvz.PlayerData.getPower()<cc.pvz.GameConfig.BattlePower?cc.pvz.PlayerData.isHaveBuyPowerTimes()?cc.popupManager.popup("mainUI","powerbuy","UIPowerBuy",{ad:!1,scale:!0},cc.pvz.GameConfig.UIFromType["\u4e3b\u754c\u9762"]):cc.popupManager.showToast("\u4f53\u529b\u4e0d\u8db3"):(cc.pvz.PlayerData.usePlayerPower(-5),cc.MainControl.checkPowerInfo(),this.sweepTimes>0?(cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u626b\u8361\u5173\u5361n\u6b21"],1),cc.pvz.PlayerData.updateSweepTimes(),this.sweepTimes--,this.sweepTimesLabel.string=this.sweepTimes,this.sweepTimesLabel.node.active=this.sweepTimes>0,this.sweepAdNode.active=this.sweepTimes<=0,cc.popupManager.popup("game","win","UIGameEnd",{ad:!1,scale:!0},this,!1),cc.RedControl.onCheckBattleRed()):(cc.MainUI.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5173\u5361\u626b\u8361"],function(t){e.onAdClose(t)}))))},onAdClose:function(e){cc.MainUI.isLookAd=!1,e&&(cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u626b\u8361\u5173\u5361n\u6b21"],1),cc.popupManager.popup("game","win","UIGameEnd",{ad:!1,scale:!0},this,!1),cc.RedControl.onCheckBattleRed())},onClickBattle:function(){cc.MainUI.isLookAd||(cc.pvz.PlayerData.isEnoughArrayTool()?cc.pvz.PlayerData.getPower()<cc.pvz.GameConfig.BattlePower?cc.pvz.PlayerData.isHaveBuyPowerTimes()?cc.popupManager.popup("mainUI","powerbuy","UIPowerBuy",{ad:!1,scale:!0},cc.pvz.GameConfig.UIFromType["\u4e3b\u754c\u9762"]):cc.popupManager.showToast("\u4f53\u529b\u4e0d\u8db3"):(cc.pvz.PlayerData.usePlayerPower(-cc.pvz.GameConfig.BattlePower),cc.MainControl.checkPowerInfo(),cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u6311\u6218\u4e3b\u7ebf\u7ae0\u82821\u6b21"],1),cc.MainUI.setClubBtnVisible(!1),cc.pvz.runtimeData.init(0,this.stageLevel),cc.director.loadScene("game1"),cc.pvz.TAUtils.trackBackpack(this.stageLevel)):cc.popupManager.showToast("\u8fd8\u6709\u672a\u4e0a\u9635\u7684\u5361\u76ae\u5df4\u62c9\uff01"))}}),cc._RF.pop()},{}],LevelPlayer:[function(e,t){"use strict";cc._RF.push(t,"c4bd9oIzAdEaJtMfm2nZyRi","LevelPlayer"),cc.Class({extends:cc.Component,properties:{heroSpines:[sp.Skeleton],enemySpines:[sp.Skeleton]},initHeroShow:function(){for(var e=this,t=cc.pvz.PlayerData.getStageLevel(),i=new Array(8).fill(-1),o=0;o<cc.pvz.GameConfig.MaxToolCount;o++){var a=o+1;if(cc.pvz.GameConfig.ToolLockLevel[o]<t){var s=cc.player.toolData[a].pos;-1!=s&&(i[s]=a)}}for(var c=function(t){if(-1!=i[t]){var o=i[t];e.heroSpines[t].node.active=!0,cc.pvz.utils.useBundleAsset("actors","kapi/hero"+o,sp.SkeletonData,function(o){e.heroSpines[t].skeletonData=o;var a=cc.pvz.PlayerData.getToolData(i[t]).lv,s=cc.pvz.utils.getLevelInterval(a);e.heroSpines[t].setAnimation(0,"stand"+s,!0)})}else e.heroSpines[t].node.active=!1},n=0;n<this.heroSpines.length;n++)c(n)},initEnemyShow:function(e){for(var t=this,i=cc.JsonControl.getLevelJson(e).enemy,o=function(e){var o=i[e];t.enemySpines[e].node.active=!0,cc.pvz.utils.useBundleAsset("actors","Zombie/e"+o,sp.SkeletonData,function(i){t.enemySpines[e].skeletonData=i,t.enemySpines[e].setAnimation(0,"stand",!0)})},a=0;a<i.length;a++)o(a)},onTouchEnemy:function(e,t){var i=parseInt(t),o=this.enemySpines[i];o&&"stand"==o.animation&&(o.setAnimation(0,"attack",!1),o.setCompleteListener(function(){o.setAnimation(0,"stand",!0),o.setCompleteListener(null)}))}}),cc._RF.pop()},{}],MainControl:[function(e,t){"use strict";cc._RF.push(t,"bca317xWbNPxYrN9zBJhXaY","MainControl"),cc.UIPage=cc.Enum({Shop:1,Rank:2,Battle:3,Tool:4,Fuben:5}),cc.Class({extends:cc.Component,properties:{bgMusic:cc.AudioClip,lvUpSound:cc.AudioClip,rewardSound:cc.AudioClip,coinLabel:cc.Label,diamondLabel:cc.Label,powerPanel:cc.Node,btnNodeList:[cc.Node],mainPagePanel:cc.Node,spineList:[sp.Skeleton]},getItemEffectPos:function(e){switch(e){case cc.pvz.GameConfig.ItemType["\u94bb\u77f3"]:return this.diamondLabel.node.convertToWorldSpaceAR(cc.v2());case cc.pvz.GameConfig.ItemType["\u4f53\u529b"]:return this.powerInfo.powerLabel.node.convertToWorldSpaceAR(cc.v2());default:return this.coinLabel.node.convertToWorldSpaceAR(cc.v2())}},onLoad:function(){cc.MainControl=this},clearUICatch:function(){cc.UIShop=null,cc.UITool=null,cc.UIActLevel=null,cc.UIRankMode=null},start:function(){var e=this;if(console.log("  Start MainControl "),cc.RedControl.refreshAllRedTip(),this.powerInfo=this.powerPanel.getComponent("PowerInfo"),this.updatePowerInfo(),this.updateItemInfo(),this.clearUICatch(),this.initMainControl(),cc.butler.playMusic(this.bgMusic),1!=cc.player.guide1){cc.tempGuideIndex=0;var t=this.btnNodeList[3];cc.guideManager.showGuide(0,[{tip:"\u8fdb\u5165\u89d2\u8272\u5347\u7ea7\u62e5\u6709\u7684\u5361\u76ae\u5df4\u62c9",focus:t,btn:t.name}],function(e){e&&(cc.tempGuideIndex=1)})}else cc.pvz.PlayerData.getStageLevel()>cc.pvz.GameConfig.OpenSysLv[1]?cc.pvz.cloud.myRank(function(t,i){t?(cc.tmpScore=i.info.score,-1!=i.info.rankLastWeek&&(!cc.player.rankWeek||cc.pvz.utils.getStartOfWeek()>cc.player.rankWeek)?cc.popupManager.popup("rank","RankReward","UIRankReward",{ad:!1,scale:!0},i.info.rankLastWeek,function(){e.updateItemInfo(),e.onRankRewardShown()}):e.onRankRewardShown()):e.onRankRewardShown()}):this.onRankRewardShown()},onRankRewardShown:function(){var e=this;cc.hasPopupType||(cc.pvz.runtimeData.hasPreGame()?cc.popupManager.popup("mainUI","leveltipUI","UIPreGame",{ad:!1,scale:!0},function(){e.onRankRewardShown()}):(cc.pvz.PlayerData.checkAndResetSign(),cc.pvz.PlayerData.getSignData().isReward?cc.pvz.PlayerData.hasPastOneDay()&&!cc.player.isShare&&cc.player.adTimes>=5&&cc.MainUI.onClickShareUI():cc.popupManager.popup("mainUI","signUI","UISign",{ad:!1,scale:!0})))},initMainControl:function(){this.isChangeCard=!1,this.curStatus=cc.UIPage.Battle,this.lastStatus=this.curStatus,this.onShopOpenStatus=0,this.isLockRank=cc.pvz.PlayerData.getStageLevel()<=cc.pvz.GameConfig.OpenSysLv[1],this.initBtnStatus(),cc.hasPopupType==cc.UIPage.Rank?(this.isChangeCard=!0,this.curStatus=cc.UIPage.Rank,this.onChangePage()):cc.hasPopupType==cc.UIPage.Fuben&&(this.isChangeCard=!0,this.curStatus=cc.UIPage.Fuben,this.onChangePage())},onClickPageBtn:function(e,t){if(!this.isChangeCard){var i=parseInt(t);i==cc.UIPage.Rank&&cc.pvz.PlayerData.getStageLevel()<=cc.pvz.GameConfig.OpenSysLv[1]?cc.popupManager.showToast("\u901a\u8fc7\u5173\u5361\u7b2c"+cc.pvz.GameConfig.OpenSysLv[1]+"\u5173\u89e3\u9501"):i!=this.curStatus&&(this.onShopOpenStatus=0,this.isChangeCard=!0,this.curStatus=i,this.onChangePage())}},onChangePage:function(){this.onHidePageUI(),this.onShowPageUI(),this.onChangeBtnAni()},onShowPageUI:function(){switch(this.curStatus){case cc.UIPage.Shop:cc.UIShop?(cc.UIShop.initBy(),1==this.onShopOpenStatus?cc.UIShop.onShopToCoin():2==this.onShopOpenStatus&&cc.UIShop.onShopToDiamond()):this.onLoadMainPageUI("shop","UIShop"),cc.pvz.TAUtils.trackSystemUI(1);break;case cc.UIPage.Rank:cc.UIRankMode?cc.UIRankMode.initBy():this.onLoadMainPageUI("Rank","UIRankMode");break;case cc.UIPage.Battle:cc.MainUI.showMainUI();break;case cc.UIPage.Tool:cc.UITool?cc.UITool.initBy():this.onLoadMainPageUI("plant","UITool"),cc.pvz.TAUtils.trackSystemUI(2);break;case cc.UIPage.Fuben:cc.UIActLevel?cc.UIActLevel.initBy():this.onLoadMainPageUI("TiaozhanUI","UIActLevel"),cc.pvz.TAUtils.trackSystemUI(3)}},onLoadMainPageUI:function(e,t){var i=this;cc.assetManager.getBundle("mainUI").load(e,cc.Prefab,function(o,a){if(o)console.log("prefabName load error: ",e,o);else{var s=cc.instantiate(a),c=s.getComponent(t);s.parent=i.mainPagePanel,s.position=cc.v2(0,0),c.initBy(),"UIShop"==t&&cc.UIShop&&(1==i.onShopOpenStatus?cc.UIShop.onShopToCoin():2==i.onShopOpenStatus&&cc.UIShop.onShopToDiamond())}})},onHidePageUI:function(){switch(this.lastStatus){case cc.UIPage.Shop:cc.UIShop.onCloseUI();break;case cc.UIPage.Rank:cc.UIRankMode.onClickClose();break;case cc.UIPage.Battle:cc.MainUI.hideMainUI();break;case cc.UIPage.Tool:cc.UITool.onCloseUI();break;case cc.UIPage.Fuben:cc.UIActLevel.onCloseUI()}},initBtnStatus:function(){for(var e=0;e<5;e++){var t="",i=e+1;i<this.curStatus?(t="_4_R",i==cc.UIPage.Rank&&this.isLockRank&&(t="_5_R"),this.spineList[e].setAnimation(0,"anniu"+i+t,!1)):i>this.curStatus?(t="_4_L",i==cc.UIPage.Rank&&this.isLockRank&&(t="_5_L"),this.spineList[e].setAnimation(0,"anniu"+i+t,!1)):(this.spineList[e].setAnimation(0,"anniu"+i+"_3",!0),this.spineList[e].node.setSiblingIndex(6))}},onChangeBtnAni:function(){for(var e=this,t=function(t){if(t<Math.min(e.lastStatus,e.curStatus)||t>Math.max(e.lastStatus,e.curStatus))return"continue";if(t===e.curStatus){var i,o=e.spineList[t-1];i=e.curStatus<e.lastStatus?"R":"L",o.setAnimation(0,"anniu"+t+"_1_"+i,!1),o.setCompleteListener(function(){o.setAnimation(0,"anniu"+t+"_3",!0),e.isChangeCard=!1,o.setCompleteListener(null)}),o.node.setSiblingIndex(6)}else if(t===e.lastStatus){var a;a=e.curStatus>e.lastStatus?"R":"L",e.spineList[t-1].setAnimation(0,"anniu"+t+"_2_"+a,!1),e.spineList[t-1].addAnimation(0,"anniu"+t+"_4_"+a,!1)}else{var s;s=e.curStatus>e.lastStatus?"R":"L",e.isLockRank&&t==cc.UIPage.Rank?e.spineList[t-1].setAnimation(0,"anniu"+t+"_5_"+s,!1):e.spineList[t-1].setAnimation(0,"anniu"+t+"_4_"+s,!1)}},i=1;i<=5;i++)t(i);this.lastStatus=this.curStatus;for(var o=0;o<5;o++)this.btnNodeList[o].active=o!==this.curStatus-1,this.btnNodeList[o+5].active=o===this.curStatus-1},updateItemInfo:function(){var e=cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"]);this.coinLabel.string=cc.pvz.utils.formatItemNum(e);var t=cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"]);this.diamondLabel.string=cc.pvz.utils.formatItemNum(t)},updatePowerInfo:function(){this.powerInfo.updatePowerInfo()},checkPowerInfo:function(){this.powerInfo.checkPowerShow()},onClickBuyPower:function(){cc.popupManager.popup("mainUI","powerbuy","UIPowerBuy",{ad:!1,scale:!0},cc.pvz.GameConfig.UIFromType["\u4e3b\u754c\u9762"])},onClickBuyCoin:function(){this.curStatus!=cc.UIPage.Shop?(this.onShopOpenStatus=1,this.isChangeCard=!0,this.curStatus=cc.UIPage.Shop,this.onChangePage()):cc.UIShop&&cc.UIShop.onShopToCoin()},onClickBuyDiamond:function(){this.curStatus!=cc.UIPage.Shop?(this.onShopOpenStatus=2,this.isChangeCard=!0,this.curStatus=cc.UIPage.Shop,this.onChangePage()):cc.UIShop&&cc.UIShop.onShopToDiamond()},onAutoChangePage:function(e){this.onShopOpenStatus=0,this.isChangeCard=!0,this.curStatus=e,this.onChangePage()}}),cc._RF.pop()},{}],MainUI:[function(e,t){"use strict";cc._RF.push(t,"bf8a4Zf/1BFk5/iJ9B1k3XW","MainUI"),cc.Class({extends:cc.Component,properties:{stageLeftBtn:cc.Node,stageRigthBtn:cc.Node,levelPlayerPanel:cc.Node,levelMapPanel:cc.Node,leftRedNode:cc.Node,rigthRedNode:cc.Node,shareBtnNode:cc.Node},onLoad:function(){cc.MainUI=this},start:function(){this.isLookAd=!1,console.log("  Start Main "),cc.pvz.PlayerData.checkAndResetGameDate(),cc.pvz.PlayerData.checkAndResetAdData(),cc.pvz.PlayerData.checkAndResetShare(),this.initMainUI()},initMainUI:function(){this.stageLevel=cc.pvz.PlayerData.getStageLevel(),this.curStageLevel=this.stageLevel,this.refreshLevelMapShow(this.stageLevel),this.refreshLevelEnemyShow(this.stageLevel),this.refreshLevelPlayerShow(),this.refreshPageBtnShow(),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5173\u5361\u626b\u8361"])},refreshLevelMapShow:function(e){this.levelMap||(this.levelMap=this.levelMapPanel.getComponent("LevelMap")),this.levelMap.initLevelMap(e)},refreshLevelPlayerShow:function(){this.levelPlayer||(this.levelPlayer=this.levelPlayerPanel.getComponent("LevelPlayer")),this.levelPlayer.initHeroShow()},refreshLevelEnemyShow:function(e){this.levelPlayer||(this.levelPlayer=this.levelPlayerPanel.getComponent("LevelPlayer")),this.levelPlayer.initEnemyShow(e)},refreshPageBtnShow:function(){1==this.curStageLevel?(this.stageLeftBtn.active=!1,this.stageRigthBtn.active=!0,this.onCheckPageBtnRedTip(!1)):this.curStageLevel==cc.pvz.GameConfig.MaxLevel||this.curStageLevel-this.stageLevel==2?(this.stageRigthBtn.active=!1,this.stageLeftBtn.active=!0,this.onCheckPageBtnRedTip(!0)):(this.stageLeftBtn.active=!0,this.stageRigthBtn.active=!0,this.onCheckPageBtnRedTip(!0),this.onCheckPageBtnRedTip(!1))},onCheckPageBtnRedTip:function(e){if(e){for(var t=this.curStageLevel-1;t>0;t--)for(var i=this.stageLevel>t,o=cc.pvz.PlayerData.getLevelBoxData(t),a=cc.JsonControl.getLevelJson(t),s=0;s<o.length;s++){var c=a["wave"+(s+1)];if(0==o[s]){if(i)return void(this.leftRedNode.active=!0);if(this.levelMap.maxWave>=c&&this.stageLevel==t)return void(this.leftRedNode.active=!0)}}this.leftRedNode.active=!1}else{for(var n=this.curStageLevel+1;n<=this.stageLevel;n++)for(var r=this.stageLevel>n,h=cc.pvz.PlayerData.getLevelBoxData(n),p=cc.JsonControl.getLevelJson(n),l=0;l<h.length;l++){var d=p["wave"+(l+1)];if(0==h[l]){if(r)return void(this.rigthRedNode.active=!0);if(this.levelMap.maxWave>=d&&this.stageLevel==n)return void(this.rigthRedNode.active=!0)}}this.rigthRedNode.active=!1}},showMainUI:function(){this.node.active=!0,cc.pvz.utils.fadeInBtn(this.node),this.stageLevel=cc.pvz.PlayerData.getStageLevel(),this.curStageLevel=this.stageLevel,this.refreshLevelMapShow(this.stageLevel),this.levelPlayerPanel.active=!0,this.refreshLevelEnemyShow(this.stageLevel),this.refreshPageBtnShow(),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5173\u5361\u626b\u8361"]),this.setClubBtnVisible(!0),cc.RedControl.onCheckMissionRed(),cc.UITool&&cc.UITool.isChangeArray&&this.refreshLevelPlayerShow()},onHideLvBoxPanel:function(){this.levelMap||(this.levelMap=this.levelMapPanel.getComponent("LevelMap")),this.levelMap.onHideBoxRewardPanel()},hideMainUI:function(){this.onHideLvBoxPanel(),this.node.active=!1,this.setClubBtnVisible(!1)},setClubBtnVisible:function(){},onPopup1st:function(){this.onHideLvBoxPanel(),this.setClubBtnVisible(!1)},onAllClosed:function(){this.node.active&&this.setClubBtnVisible(!0)},onClickStagePage:function(e,t){this.isLookAd||(parseInt(t)<0?this.curStageLevel--:this.curStageLevel++,this.refreshLevelMapShow(this.curStageLevel),this.levelPlayerPanel.active=this.stageLevel>=this.curStageLevel,this.refreshLevelEnemyShow(this.curStageLevel),this.refreshPageBtnShow())},onClickSet:function(){this.isLookAd||cc.popupManager.popup("mainUI","set","UISet",{ad:!1,scale:!0},0)},onClickSign:function(){this.isLookAd||cc.popupManager.popup("mainUI","signUI","UISign",{ad:!1,scale:!0})},onClickTask:function(){this.isLookAd||cc.popupManager.popup("mainUI","TaskUI","UITask",{ad:!1,scale:!1})},onClickFund:function(){this.isLookAd||cc.popupManager.popup("mainUI","FundUI","UIFund",{ad:!1,scale:!1})},onClickOther:function(){this.onHideLvBoxPanel(),cc.popupManager.showToast("\u6682\u672a\u5f00\u542f")},onClickShareUI:function(){cc.popupManager.popup("mainUI","FenxiangUI","UIShare",{ad:!1,scale:!0})},onClickRankMode:function(){cc.popupManager.popup("mainUI","Rank","UIRankMode",{ad:!1,scale:!1},this.node)},enterGame2:function(){cc.assetManager.loadBundle("game2",function(e,t){t&&(cc.director.loadScene("game2"),cc.player.game2t=Date.now())})},onClickGame2:function(){var e=cc.player.game2t||-1;Date.now()-e<18e5?cc.popupManager.popup("mainUI","ModeTipUI","UIAdGame2",{ad:!1,scale:!1},this):this.enterGame2()},test:function(){cc.view.emit("canvas-resize")}}),cc._RF.pop()},{}],RedControl:[function(e,t){"use strict";cc._RF.push(t,"f1243vbqOpNlrPR0OpC1Fnj","RedControl"),cc.Class({extends:cc.Component,properties:{shopRed:cc.Node,battleRed:cc.Node,toolLvRed:cc.Node,actLevelRed:cc.Node,rankRed:cc.Node,signRed:cc.Node,shareRed:cc.Node,missionRed:cc.Node,fundRed:cc.Node,game2Red:cc.Node},onLoad:function(){cc.RedControl=this},refreshAllRedTip:function(){this.onCheckShopRed(),this.onCheckBattleRed(),this.onCheckToolLvRed(),this.onCheckActLevelRed(),this.onChecRankRed(),this.onCheckSignRed(),this.onCheckShareRed(),this.onCheckMissionRed(),this.onCheckGame2Red()},onChecRankRed:function(){cc.pvz.PlayerData.getStageLevel()<=cc.pvz.GameConfig.OpenSysLv[1]?this.rankRed.active=!1:(new Date).getDate()==cc.player.gameDate?this.rankRed.active=cc.player.rankCount>0:this.rankRed.active=!0},onCheckMissionRed:function(){cc.pvz.PlayerData.checkAndResetDayMission(),cc.pvz.PlayerData.checkAndResetWeekMission(),this.onCheckDayMissionRed()||this.onCheckWeekMissionRed()||this.onCheckAchieveMissionRed()?this.missionRed.active=!0:this.missionRed.active=!1},onCheckDayMissionRed:function(){for(var e=cc.JsonControl.getAllDayMissionJson(),t=0;t<e.length;t++){var i=e[t],o=cc.pvz.PlayerData.getDayMissionData(i.func);if(!o.isReward&&o.pro>=i.need)return!0}for(var a=cc.JsonControl.getDayMissionBoxJson(),s=cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["\u65e5\u5e38\u4efb\u52a1\u79ef\u5206"]),c=0;c<a.length;c++){var n=a[c];if(!cc.pvz.PlayerData.getDayBoxData(n.ID).isReward&&s>=n.score)return!0}return!1},onCheckWeekMissionRed:function(){for(var e=cc.JsonControl.getAllWeekMissionJson(),t=0;t<e.length;t++){var i=e[t],o=cc.pvz.PlayerData.getWeekMissionData(i.func);if(!o.isReward&&o.pro>=i.need)return!0}for(var a=cc.JsonControl.getWeekMissionBoxJson(),s=cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["\u5468\u5e38\u4efb\u52a1\u79ef\u5206"]),c=0;c<a.length;c++){var n=a[c];if(!cc.pvz.PlayerData.getWeekBoxData(n.ID).isReward&&s>=n.score)return!0}return!1},onCheckAchieveMissionRed:function(){for(var e=cc.JsonControl.getAllAchieveJson(),t=Math.floor(e[e.length-1].ID/100),i=0;i<t;i++){var o=i+1,a=cc.pvz.PlayerData.getAchieveData(o);if(!a.end){var s=100*o+a.lv,c=cc.JsonControl.getAchieveJson(s),n=cc.pvz.PlayerData.getAchieveProgress(c.func);if(c.need[0]<=n)return!0}}return!1},onCheckSignRed:function(){cc.pvz.PlayerData.checkAndResetSign();var e=cc.pvz.PlayerData.getSignData();this.signRed.active=!e.isReward},onCheckShopRed:function(){if((new Date).getDate()==cc.player.shopDate)if(1!=cc.pvz.PlayerData.getShopTimes(cc.pvz.GameConfig.ShopTimesType["\u94bb\u77f3\u514d\u8d39"]))if(7!=cc.pvz.PlayerData.getShopTimes(cc.pvz.GameConfig.ShopTimesType["\u91d1\u5e01\u514d\u8d39"])){var e=cc.player.shopBoxData.date[0];-1!=e?Math.floor((Date.now()-e)/1e3)>=cc.pvz.GameConfig.ShopBoxCD[0]?this.shopRed.active=!0:this.shopRed.active=!1:this.shopRed.active=!0}else this.shopRed.active=!0;else this.shopRed.active=!0;else this.shopRed.active=!0},onCheckBattleRed:function(){if(cc.pvz.PlayerData.checkAndResetGameDate(),cc.pvz.PlayerData.checkAndResetSign(),cc.pvz.PlayerData.getSignData().isReward){for(var e=cc.pvz.PlayerData.getStageLevel(),t=cc.pvz.PlayerData.getMaxLevelWave(),i=e;i>0;i--)for(var o=e>i,a=cc.pvz.PlayerData.getLevelBoxData(i),s=cc.JsonControl.getLevelJson(i),c=0;c<a.length;c++){var n=s["wave"+(c+1)];if(0==a[c]){if(o)return void(this.battleRed.active=!0);if(t>=n&&e==c)return void(this.battleRed.active=!0)}}cc.pvz.PlayerData.checkAndResetDayMission(),cc.pvz.PlayerData.checkAndResetWeekMission(),this.onCheckDayMissionRed()||this.onCheckWeekMissionRed()||this.onCheckAchieveMissionRed()?this.battleRed.active=!0:this.battleRed.active=!1}else this.battleRed.active=!0},onCheckToolLvRed:function(){for(var e=[],t=cc.pvz.PlayerData.getStageLevel(),i=0;i<cc.pvz.GameConfig.MaxToolCount;i++){var o=i+1;cc.pvz.GameConfig.ToolLockLevel[i]<t&&e.push(o)}for(var a=0;a<e.length;a++){var s=e[a],c=cc.pvz.PlayerData.getToolData(s);if(c.lv<cc.pvz.GameConfig.MaxToolLv){var n=cc.JsonControl.getToolJson(s),r=cc.JsonControl.getToolLvUpJson(c.lv),h=r["sp"+n.quality];if(c.c>=h){var p=r["coins"+n.quality];if(cc.pvz.PlayerData.isItemEnough(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],p))return void(this.toolLvRed.active=!0)}}}cc.pvz.PlayerData.isEnoughArrayTool()?this.toolLvRed.active=!1:this.toolLvRed.active=!0},onCheckActLevelRed:function(){if(cc.pvz.PlayerData.getStageLevel()<=cc.pvz.GameConfig.OpenSysLv[0])this.actLevelRed.active=!1;else if((new Date).getDate()==cc.player.actLevelDate){var e=cc.pvz.PlayerData.getActLevelData();if(e.times>0)this.actLevelRed.active=!0;else{for(var t=cc.JsonControl.ActLevelBoxJson,i=0;i<4;i++)if(t[i].score<=e.score&&0==e.boxStatus[i])return void(this.actLevelRed.active=!0);this.actLevelRed.active=!1}}else this.actLevelRed.active=!0},onCheckShareRed:function(){var e=!cc.player.isShare;this.shareRed.active=e},isFundRed:function(){for(var e=2;e<cc.player.level;e++)if(!cc.pvz.PlayerData.hasFundGet(99+e,0))return!0;return!1},onCheckFundRed:function(){this.fundRed.active=this.isFundRed()},onCheckGame2Red:function(){this.game2Red.active=!cc.player.game2t}}),cc._RF.pop()},{}],ShopBoxItem:[function(e,t){"use strict";cc._RF.push(t,"d2decYhKsZDGJRhlQcEjCjq","ShopBoxItem"),cc.Class({extends:cc.Component,properties:{boxCdTimes:cc.Label,boxCdPanel:cc.Node,boxAdBtnPanel:cc.Node,boxBuyBtn:cc.Node,tipLabel:cc.RichText},initShopBoxItem:function(e,t,i){void 0===i&&(i=null),this.boxId=e,this.shopBoxJson=t,this.callBack=i,this.price=this.shopBoxJson["consume"+this.boxId],this.shopBoxData=cc.pvz.PlayerData.getShopBoxData();var o=this.shopBoxData.date[this.boxId-1],a=Math.floor((Date.now()-o)/1e3);this.ShopBoxCD=cc.pvz.GameConfig.ShopBoxCD[this.boxId-1],a>=this.ShopBoxCD?(this.boxCdPanel.active=!1,this.isCanAdBuy=!0,this.onCheckBoxAdBtnGray(!1),this.unscheduleAllCallbacks()):(this.boxCdPanel.active=!0,this.isCanAdBuy=!1,this.onCheckBoxAdBtnGray(!0),this.lastTime=Math.floor(this.ShopBoxCD-a),this.boxCdTimes.string=cc.pvz.utils.formatSeconds3(this.lastTime),this.schedule(this.refreshCDTime,1));var s=this.shopBoxJson["box"+this.boxId],c=s[s.length-2];this.tipLabel.string=cc.pvz.GameConfig.BoxTipNames[c-5];var n=Math.floor(s.length/2),r=0;this.rewardData=[];for(var h=0;h<n;h++){var p=cc.pvz.utils.getRewardItem(s[r],s[r+1]);this.rewardData.push(p),r+=2}},refreshCDTime:function(){this.lastTime--,this.boxCdTimes.string=cc.pvz.utils.formatSeconds3(this.lastTime),this.lastTime<=0&&(this.boxCdPanel.active=!1,this.isCanAdBuy=!0,this.onCheckBoxAdBtnGray(!1),this.unschedule(this.refreshCDTime,this))},showBoxCdTime:function(){this.boxCdPanel.active=!0,this.isCanAdBuy=!1,this.onCheckBoxAdBtnGray(!0),this.lastTime=this.ShopBoxCD,this.boxCdTimes.string=cc.pvz.utils.formatSeconds3(this.lastTime),this.schedule(this.refreshCDTime,1)},onCheckBoxAdBtnGray:function(e){if(1==this.boxId)this.boxAdBtnPanel.active=!e,this.boxBuyBtn&&(this.boxBuyBtn.active=e);else for(var t=0;t<this.boxAdBtnPanel.childrenCount;t++)this.boxAdBtnPanel.children[t].getComponent(cc.Sprite).setMaterial(0,cc.JsonControl.materialList[e?1:0])},onClickBoxInfo:function(){var e=this;cc.UIShop.isLookAd||(cc.UIShop.onStopShopScroll(),cc.popupManager.popup("mainUI","shopboxBuy","UIShopBoxBuy",{ad:!1,scale:!0},this.boxId,this.shopBoxJson,this.isCanAdBuy,function(){e.callBack&&e.callBack(),e.showBoxCdTime()}))},onClickAdBox:function(){var e=this;cc.UIShop.isLookAd||this.isCanAdBuy&&(cc.UIShop.onStopShopScroll(),1==this.boxId?this.onAdClose(!0):(cc.UIShop.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5546\u5e97\u5b9d\u7bb1"],function(t){e.onAdClose(t)})))},onAdClose:function(e){cc.UIShop.isLookAd=!1,e&&(cc.pvz.PlayerData.updateShopBoxDate(this.boxId,Date.now()),this.isCanAdBuy&&2==this.boxId&&cc.pvz.PlayerData.updateShopBoxExp(this.price),this.showBoxCdTime(),cc.popupManager.popup("mainUI","ShopBoxEft","UIShopBoxReward",{ad:!1,scale:!0},this.boxId,this.rewardData,this.callBack))},onClickBuyBox:function(){if(!cc.UIShop.isLookAd)if(cc.UIShop.onStopShopScroll(),cc.pvz.PlayerData.isItemEnough(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],this.price))cc.pvz.PlayerData.updateShopBoxExp(this.price),cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],-this.price),cc.popupManager.popup("mainUI","ShopBoxEft","UIShopBoxReward",{ad:!1,scale:!0},this.boxId,this.rewardData,this.callBack);else if(cc.pvz.PlayerData.isHaveAdBuyBankTimes(1)){var e=cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],100);cc.popupManager.popup("mainUI","adbuyUI","UIAdBuy",{ad:!1,scale:!0},e)}else cc.popupManager.showToast("\u94bb\u77f3\u4e0d\u8db3\uff01")}}),cc._RF.pop()},{}],ShopCoinItem:[function(e,t){"use strict";cc._RF.push(t,"c1e41fNdstF0Zn8cs6qpGTQ","ShopCoinItem"),cc.Class({extends:cc.Component,properties:{countLabel:cc.Label,priceLabel:cc.Label,finishNode:cc.Node,freeNode:cc.Node,adPanel:cc.Node,adTimesLabel:cc.Label,cdTimeLabel:cc.Label},initShopCoinItem:function(e,t){if(this.shopId=e,this.shopJson=t,7==this.shopId){var i=cc.pvz.PlayerData.getShopTimes(cc.pvz.GameConfig.ShopTimesType["\u91d1\u5e01\u514d\u8d39"]);this.isFree=7==i,this.isFinish=i<=0,this.finishNode.active=this.isFinish,this.freeNode.active=this.isFree&&!this.isFinish,this.adPanel.active=!this.isFree&&!this.isFinish,this.adTimesLabel.string="("+i+")",this.cdTimeLabel.node.active=!1}else this.priceLabel.string=this.shopJson.priceNum[0];this.count=this.shopJson.num1[0],this.countLabel.string="x"+this.count,this.rewardData=cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],this.count)},onClickBuy:function(){var e=this;if(!cc.UIShop.isLookAd)if(cc.UIShop.onStopShopScroll(),7==this.shopId){if(this.isFinish)return void cc.popupManager.showToast("\u5df2\u552e\u7f44\uff01");this.isFree?(cc.pvz.PlayerData.updateShopTimes(cc.pvz.GameConfig.ShopTimesType["\u91d1\u5e01\u514d\u8d39"]),cc.UIShop.updateRedTip(),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},[this.rewardData],cc.pvz.GameConfig.UIFromType["\u91d1\u5e01\u5546\u5e97"],function(){e.initShopCoinItem(e.shopId,e.shopJson)})):(cc.UIShop.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5546\u5e97\u91d1\u5e01"],function(t){e.onAdClose(t)}))}else cc.popupManager.popup("mainUI","shopbuyUI","UIShopBuy",{ad:!1,scale:!0},this.rewardData,[this.shopJson.priceItem[0],this.shopJson.priceNum[0]],function(){cc.pvz.PlayerData.updateShopTimes(cc.pvz.GameConfig.ShopTimesType["\u91d1\u5e01\u514d\u8d39"]),e.initShopCoinItem(e.shopId,e.shopJson)},!1)},onAdClose:function(e){var t=this;cc.UIShop.isLookAd=!1,e&&(cc.pvz.PlayerData.updateShopTimes(cc.pvz.GameConfig.ShopTimesType["\u91d1\u5e01\u514d\u8d39"]),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},[this.rewardData],cc.pvz.GameConfig.UIFromType["\u91d1\u5e01\u5546\u5e97"],function(){t.initShopCoinItem(t.shopId,t.shopJson)}))}}),cc._RF.pop()},{}],ShopDailyItem:[function(e,t){"use strict";cc._RF.push(t,"cf5deVGeqVHgZCPbKd20P7a","ShopDailyItem"),cc.Class({extends:cc.Component,properties:{nameLabel:cc.Label,spine:sp.Skeleton,qualitySprite:cc.Sprite,countLabel:cc.Label,priceSprite:cc.Sprite,priceLabel:cc.Label,finishNode:cc.Node,buyPanel:cc.Node,discountPanel:cc.Node,discountSprite:cc.Sprite,freeNode:cc.Node,adPanel:cc.Node,adTimesLabel:cc.Label,cdTimeLabel:cc.Label},initShopDailyItem:function(e,t){var i=this;if(this.isLookAd=!1,this.shopId=e,this.shopData=cc.pvz.PlayerData.getShopData(this.shopId),this.shopJson=t,this.itemId=this.shopData.itemId,this.isFinish=this.shopData.buyTimes<=0,this.finishNode.active=this.isFinish,1!=this.shopId){if(this.toolId=this.shopData.toolId,this.itemId===cc.pvz.GameConfig.ItemType["\u56fa\u5b9a\u788e\u7247"]){var o=cc.JsonControl.getToolJson(this.toolId);cc.JsonControl.getQualityBgIcon(this.qualitySprite,o.quality);var a=cc.pvz.PlayerData.getToolData(this.toolId),s=cc.pvz.utils.getLevelInterval(a.lv);this.spine.node.scale=o.scale,cc.pvz.utils.useBundleAsset("actors","kapi/hero"+this.toolId,sp.SkeletonData,function(e){i.spine.skeletonData=e,i.spine.setAnimation(0,"stand"+s,!0)}),this.nameLabel.string=o.name}this.countLabel.string="x"+this.shopData.count,this.discountPanel.active=this.shopData.discount<10,this.shopData.discount<10&&cc.pvz.utils.setSpriteFrame(this.discountSprite,"uiImage","shop/zhekou"+this.shopData.discount),this.buyPanel.active=!this.isFinish,this.priceLabel.string=this.shopData.price;var c=cc.JsonControl.getItemJson(this.shopData.priceType);cc.JsonControl.getItemIcon(this.priceSprite,c.Icon),this.rewardData=cc.pvz.utils.getRewardToolItem(this.toolId,this.shopData.count)}else{this.isFree=1==cc.pvz.PlayerData.getShopTimes(cc.pvz.GameConfig.ShopTimesType["\u94bb\u77f3\u514d\u8d39"]);var n=(this.isFree,100);this.countLabel.string="x"+n,this.freeNode.active=this.isFree&&!this.isFinish,this.adPanel.active=!this.isFree&&!this.isFinish,this.cdTimeLabel.node.active=!1,this.adTimesLabel.string="("+this.shopData.buyTimes+")",this.rewardData=cc.pvz.utils.getRewardItem(this.itemId,n)}},onClickInfoBuy:function(){var e=this;cc.UIShop.isLookAd||(this.isFinish?cc.popupManager.showToast("\u5df2\u552e\u7f44\uff01"):(cc.UIShop.onStopShopScroll(),cc.popupManager.popup("mainUI","shopbuyUI","UIShopBuy",{ad:!1,scale:!0},this.rewardData,[this.shopData.priceType,this.shopData.price],function(){cc.pvz.PlayerData.updateShopDataBuy(e.shopId,1),e.initShopDailyItem(e.shopId,e.shopJson)},!0)))},onClickBuy:function(){var e=this;if(!cc.UIShop.isLookAd)if(this.isFinish)cc.popupManager.showToast("\u5df2\u552e\u7f44\uff01");else if(cc.UIShop.onStopShopScroll(),1==this.shopId)this.isFree?(cc.pvz.PlayerData.updateShopTimes(cc.pvz.GameConfig.ShopTimesType["\u94bb\u77f3\u514d\u8d39"]),cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u6bcf\u65e5\u5546\u5e97\u8d2d\u4e70n\u6b21\u7269\u54c1"],1),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},[this.rewardData],cc.pvz.GameConfig.UIFromType["\u6bcf\u65e5\u5546\u5e97"],function(){e.initShopDailyItem(e.shopId,e.shopJson),cc.UIShop.updateRedTip()})):(cc.UIShop.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5546\u5e97\u94bb\u77f3"],function(t){e.onAdClose(t)}));else if(cc.pvz.PlayerData.isItemEnough(this.shopData.priceType,this.shopData.price))cc.pvz.PlayerData.updateShopDataBuy(this.shopId,1),cc.pvz.PlayerData.changeItemNum(this.shopData.priceType,-this.shopData.price),cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u6bcf\u65e5\u5546\u5e97\u8d2d\u4e70n\u6b21\u7269\u54c1"],1),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},[this.rewardData],cc.pvz.GameConfig.UIFromType["\u6bcf\u65e5\u5546\u5e97"],function(){e.initShopDailyItem(e.shopId,e.shopJson)});else{var t=2==this.shopData.priceType;if(cc.pvz.PlayerData.isHaveAdBuyBankTimes(t?0:1)){var i=cc.pvz.utils.getRewardItem(this.shopData.priceType,t?2500:100);cc.popupManager.popup("mainUI","adbuyUI","UIAdBuy",{ad:!1,scale:!0},i)}else{var o;o=2==this.shopData.priceType?"\u91d1\u5e01":"\u94bb\u77f3",cc.popupManager.showToast(o+"\u4e0d\u8db3\uff01")}}},onAdClose:function(e){var t=this;cc.UIShop.isLookAd=!1,e&&(cc.pvz.PlayerData.updateShopDataBuy(this.shopId,1),cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u6bcf\u65e5\u5546\u5e97\u8d2d\u4e70n\u6b21\u7269\u54c1"],1),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},[this.rewardData],cc.pvz.GameConfig.UIFromType["\u6bcf\u65e5\u5546\u5e97"],function(){t.initShopDailyItem(t.shopId,t.shopJson)}))}}),cc._RF.pop()},{}],SignItem:[function(e,t){"use strict";cc._RF.push(t,"d86can/RLhMb4wmzIwQScL0","SignItem"),cc.Class({extends:cc.Component,properties:{nameSprite:cc.Sprite,bgSprite:cc.Sprite,rewardItem:cc.Node,rewardPanel:cc.Node,finishNode:cc.Node},initSignItem:function(e,t,i){this.signDay=e,this.signJson=t,this.curDay=i;var o=this.signDay<this.curDay||!(this.signDay>this.curDay)&&cc.UISign.isRewardSign;this.finishNode.active=o;var a=this.signJson.reward;if(this.rewardDataList=[],7==this.signDay)for(var s=Math.floor(a.length/2),c=0,n=0;n<s;n++){var r=cc.pvz.utils.getRewardItem(a[c],a[c+1]);c+=2,this.rewardPanel.children[n].getComponent("RewardItem").initRewardItem(r,!1),this.rewardDataList.push(r)}else{var h,p=cc.pvz.utils.getRewardItem(a[0],a[1]);this.rewardItem.getComponent("RewardItem").initRewardItem(p,!1),this.rewardDataList.push(p),cc.pvz.utils.setSpriteFrame(this.nameSprite,"uiImage","sign/day"+this.signDay),h=o?1:this.signDay>this.curDay?3:2,cc.pvz.utils.setSpriteFrame(this.bgSprite,"uiImage","sign/k"+h)}},onGetSignReward:function(e){if(void 0===e&&(e=!1),e)for(var t=0;t<this.rewardDataList.length;t++)this.rewardDataList[t].count*=2;this.bgSprite&&cc.pvz.utils.setSpriteFrame(this.bgSprite,"uiImage","sign/k1"),this.finishNode.active=!0,cc.UISign.onCloseUI(),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},this.rewardDataList,cc.pvz.GameConfig.UIFromType["\u7b7e\u5230"])}}),cc._RF.pop()},{}],TaskItem:[function(e,t){"use strict";cc._RF.push(t,"376ffOv2iZHC543+FSaS+sr","TaskItem"),cc.Class({extends:cc.Component,properties:{rewardItem:cc.Node,finishNode:cc.Node,getNode:cc.Node,getPanel:cc.Node,goToNode:cc.Node,proBar:cc.ProgressBar,proLabel:cc.Label,descLabel:cc.Label},initMissionItem:function(e,t,i){this.isDayMission=e,this.MissionJson=t,this.rewardBack=i,this.isDayMission?this.MissionData=cc.pvz.PlayerData.getDayMissionData(this.MissionJson.func):this.MissionData=cc.pvz.PlayerData.getWeekMissionData(this.MissionJson.func),this.descLabel.string=this.MissionJson.desc,this.Func=this.MissionJson.func,this.rewardData=cc.pvz.utils.getRewardItem(this.MissionJson.reward[0],this.MissionJson.reward[1]),this.rewardItem.getComponent("RewardItem").initRewardItem(this.rewardData,!1),this.proBar.progress=this.MissionData.pro/this.MissionJson.need;var o=cc.pvz.utils.formatItemNum(this.MissionData.pro),a=cc.pvz.utils.formatItemNum(this.MissionJson.need);this.proLabel.string=o+"/"+a,this.isFinish=this.MissionData.isReward,this.isCanReward=this.MissionJson.need<=this.MissionData.pro,this.finishNode.active=this.isFinish,this.goToNode.active=!this.isCanReward,this.getNode.active=this.isCanReward&&!this.isFinish,this.getPanel.active=this.isCanReward&&!this.isFinish},initAchieveMissionItem:function(e,t){this.rewardBack=t,this.Id=e,this.AchieveData=cc.pvz.PlayerData.getAchieveData(this.Id),this.achieveIndex=100*this.Id+this.AchieveData.lv,this.AchieveJson=cc.JsonControl.getAchieveJson(this.achieveIndex),this.AchieveProgress=cc.pvz.PlayerData.getAchieveProgress(this.AchieveJson.func),this.Func=this.AchieveJson.func,this.descLabel.string=this.AchieveJson.desc,this.rewardData=cc.pvz.utils.getRewardItem(this.AchieveJson.reward[0],this.AchieveJson.reward[1]),this.rewardItem.getComponent("RewardItem").initRewardItem(this.rewardData,!1),this.isFinish=this.AchieveData.end,this.isCanReward=this.AchieveJson.need[0]<=this.AchieveProgress,this.proBar.progress=this.AchieveProgress/this.AchieveJson.need[0];var i=cc.pvz.utils.formatItemNum(this.AchieveProgress),o=cc.pvz.utils.formatItemNum(this.AchieveJson.need[0]);this.proLabel.string=i+"/"+o,this.finishNode.active=this.isFinish,this.goToNode.active=!this.isCanReward&&!this.isFinish,this.getNode.active=this.isCanReward&&!this.isFinish,this.getPanel.active=this.isCanReward&&!this.isFinish},finishRefresh:function(){this.isFinish=!0,this.finishNode.active=this.isFinish,this.goToNode.active=!1,this.getNode.active=!1,this.getPanel.active=!1,this.node.setSiblingIndex(this.node.parent.childrenCount-1)},onClickGoto:function(){switch(this.Func){case cc.pvz.GameConfig.MissionType["\u7d2f\u8ba1\u83b7\u5f97\u91d1\u5e01"]:case cc.pvz.GameConfig.MissionType["\u7d2f\u8ba1\u6d88\u8017\u94bb\u77f3"]:case cc.pvz.GameConfig.MissionType["\u6bcf\u65e5\u5546\u5e97\u8d2d\u4e70n\u6b21\u7269\u54c1"]:case cc.pvz.GameConfig.MissionType["\u9ad8\u7ea7\u5b9d\u7bb1\u62bd\u53d6\u88c5\u5907n\u6b21"]:case cc.pvz.GameConfig.MissionType["\u89c2\u770b\u5e7f\u544an\u6b21"]:cc.UITask.onCloseUI(),cc.MainControl.onAutoChangePage(cc.UIPage.Shop);break;case cc.pvz.GameConfig.MissionType["\u53c2\u4e0e\u6311\u6218\u5173\u5361n\u6b21"]:case cc.pvz.GameConfig.MissionType["\u901a\u5173\u6311\u6218\u5173\u5361n\u6b21"]:cc.UITask.onCloseUI(),cc.MainControl.onAutoChangePage(cc.UIPage.Fuben);break;case cc.pvz.GameConfig.MissionType["\u53c2\u4e0e\u65e0\u5c3d\u6311\u6218\u8d5bN\u6b21"]:cc.UITask.onCloseUI(),cc.MainControl.onAutoChangePage(cc.UIPage.Rank);break;case cc.pvz.GameConfig.MissionType["\u6311\u6218\u4e3b\u7ebf\u7ae0\u82821\u6b21"]:case cc.pvz.GameConfig.MissionType["\u626b\u8361\u5173\u5361n\u6b21"]:case cc.pvz.GameConfig.MissionType["\u8d2d\u4e70\u4f53\u529bn\u6b21"]:case cc.pvz.GameConfig.MissionType["\u901a\u5173\u4e3b\u7ebf\u526f\u672cn\u6b21"]:case cc.pvz.GameConfig.MissionType["\u901a\u8fc7\u4e3b\u7ebf\u7ae0\u8282n"]:case cc.pvz.GameConfig.MissionType["\u51fb\u8d25\u50f5\u5c38n\u4e2a"]:case cc.pvz.GameConfig.MissionType["\u51fb\u8d25\u9996\u9886n\u4e2a"]:cc.UITask.onCloseUI(),cc.MainControl.onAutoChangePage(cc.UIPage.Battle);break;case cc.pvz.GameConfig.MissionType["\u88c5\u5907\u6700\u9ad8\u7b49\u7ea7\u8fbe\u5230n"]:case cc.pvz.GameConfig.MissionType["\u88c5\u5907\u603b\u7b49\u7ea7n"]:case cc.pvz.GameConfig.MissionType["\u5347\u7ea7\u4efb\u610f\u88c5\u59071\u6b21"]:cc.UITask.onCloseUI(),cc.MainControl.onAutoChangePage(cc.UIPage.Tool);break;default:cc.UITask.onCloseUI()}},onClickAchieveReward:function(){!this.isFinish&&this.isCanReward&&(cc.pvz.PlayerData.updateAchieveData(this.Id,1),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},[this.rewardData],cc.pvz.GameConfig.UIFromType["\u6210\u5c31"],this.rewardBack),this.initAchieveMissionItem(this.Id,this.rewardBack),!this.isFinish&&this.isCanReward||this.node.setSiblingIndex(this.node.parent.childrenCount-1))},onClickReward:function(){if(!this.isFinish&&this.isCanReward){var e;cc.pvz.PlayerData.changeItemNum(this.MissionJson.reward[0],this.MissionJson.reward[1]),this.finishRefresh(),this.isDayMission?cc.pvz.PlayerData.finishDayMission(this.MissionJson.func):cc.pvz.PlayerData.finishWeekMission(this.MissionJson.func),this.rewardBack&&this.rewardBack(),e=this.isDayMission?cc.pvz.GameConfig.ItemType["\u65e5\u5e38\u4efb\u52a1\u79ef\u5206"]:cc.pvz.GameConfig.ItemType["\u5468\u5e38\u4efb\u52a1\u79ef\u5206"];var t=cc.math.randomRangeInt(1,4);cc.popupManager.showEffectFly(e,cc.UITask.scoreLabel.node.convertToWorldSpaceAR(cc.v2()),t)}}}),cc._RF.pop()},{}],ToolCard:[function(e,t){"use strict";cc._RF.push(t,"26cbdZ9zrlPbaULzzRpd2MI","ToolCard"),cc.Class({extends:cc.Component,properties:{spine:sp.Skeleton,qualitySprite:cc.Sprite,typeSprite:cc.Sprite,nameLabel:cc.Label,levelLabel:cc.Label,fragLabel:cc.Label,lvProgressBar:cc.ProgressBar,maxFragLine:cc.Node,lvTipNode:cc.Node,fragTipNode:cc.Node},initToolCardItem:function(e,t){var i=this;this.ui=e,this.toolId=t,this.stageLevel=cc.pvz.PlayerData.getStageLevel(),this.toolJson=cc.JsonControl.getToolJson(this.toolId),this.nameLabel.string=this.toolJson.name,cc.JsonControl.getToolTypeIcon(this.typeSprite,this.toolJson.lattice),this.spine.node.scale=this.toolJson.scale,cc.pvz.utils.useBundleAsset("actors","kapi/hero"+this.toolId,sp.SkeletonData,function(e){i.spine.skeletonData=e,i.refreshToolSpineShow()}),this.onLvUpRefreshCard(!1)},refreshToolSpineShow:function(){var e=cc.pvz.PlayerData.getToolData(this.toolId).lv,t=cc.pvz.utils.getLevelInterval(e);this.spine.setAnimation(0,"stand"+t,!0)},onLvUpRefreshCard:function(e){void 0===e&&(e=!0),this.toolData=cc.pvz.PlayerData.getToolData(this.toolId),this.toollvJson=cc.JsonControl.getToolLvUpJson(this.toolData.lv),e&&this.refreshToolSpineShow(),cc.JsonControl.getQualityCardIcon(this.qualitySprite,this.toolJson.quality),this.toolJson.quality;var t=this.stageLevel<=cc.pvz.GameConfig.ToolLockLevel[this.toolId-1];this.levelLabel.string=t?"\u672a\u89e3\u9501":"\u7b49\u7ea7"+this.toolData.lv,this.isMaxLv=this.toolData.lv>=cc.pvz.GameConfig.MaxToolLv;var i=this.toollvJson["sp"+this.toolJson.quality];this.isEnoughFrag=this.toolData.c>=i,this.isMaxLv?this.fragLabel.string="\u5df2\u6ee1\u7ea7":this.fragLabel.string=this.toolData.c+"/"+i,this.lvProgressBar.progress=this.toolData.c/i,this.lvProgressBar.node.active=!this.isEnoughFrag||!this.isMaxLv,this.maxFragLine.active=this.isEnoughFrag||this.isMaxLv,this.lvTipNode.active=this.isEnoughFrag&&!this.isMaxLv,this.fragTipNode.active=!this.isEnoughFrag||this.isMaxLv},onClickCard:function(){this.ui.onClickCard(this)}}),cc._RF.pop()},{}],ToolLockCard:[function(e,t){"use strict";cc._RF.push(t,"7df6fkRqbRJh5oFcwYwErmw","ToolLockCard"),cc.Class({extends:cc.Component,properties:{spine:sp.Skeleton,typeSprite:cc.Sprite,lockTip:cc.Label},initToolLockCard:function(e,t){var i=this;this.ui=e,this.toolId=t;var o=cc.JsonControl.getToolJson(this.toolId);this.spine.node.scale=o.scale,cc.pvz.utils.useBundleAsset("actors","kapi/hero"+this.toolId,sp.SkeletonData,function(e){i.spine.skeletonData=e,i.spine.setAnimation(0,"stand1",!0)}),cc.JsonControl.getToolTypeIcon(this.typeSprite,o.lattice),this.lockTip.string=cc.pvz.GameConfig.ToolLockTip.replace("$",cc.pvz.GameConfig.ToolLockLevel[this.toolId-1])},onClickCard:function(){cc.popupManager.popup("mainUI","plantInfo","UIToolInfo",{ad:!1,scale:!0},this.ui,this.toolId,!0)}}),cc._RF.pop()},{}],ToolSkillInfo:[function(e,t){"use strict";cc._RF.push(t,"8dc36ug6ZtBYKCF9kVMEUzb","ToolSkillInfo"),cc.Class({extends:cc.Component,properties:{toolSkillJsonFile:cc.JsonAsset,lockPanel:cc.Node,iconSprite:cc.Sprite,qualitySprite:cc.Sprite,descLabel:cc.RichText},onLoad:function(){this.descLabel.enabled=!1},initSkillInfo:function(e,t,i,o){var a=Math.floor(100*e+t),s=i,c=this.toolSkillJsonFile.json.find(function(e){return e.id==a}),n=c.lock>s||o;this.lockPanel.active=n,this.descLabel.string=n?c.lockdesc:c.desc,this.descLabel.enabled=!0,cc.JsonControl.getQualityBgIcon(this.qualitySprite,c.quality),cc.JsonControl.getSkillIcon(this.iconSprite,c.icon)}}),cc._RF.pop()},{}],UIActLevelInfo:[function(e,t){"use strict";cc._RF.push(t,"37f6cxXHKdAQY9Kixht7Gb0","UIActLevelInfo"),cc.Class({extends:cc.Component,properties:{coinLabel:cc.Label,diamondLabel:cc.Label,powerPanel:cc.Node,timeLabel:cc.Label,scoreLabel:cc.Label,scoreBar:cc.ProgressBar,buffIconList:[cc.Sprite],buffTipPanel:cc.Node,buffDescLabel:cc.RichText,boxSpineList:[sp.Skeleton],boxLabelList:[cc.Label],boxRewardPanel:cc.Node,rewardParent:cc.Node,battleBtn:cc.Node,moreAdNode:cc.Node,levelPlayerPanel:cc.Node},refreshLevelPlayerShow:function(){this.levelPlayerPanel.getComponent("LevelPlayer").initHeroShow()},updateItemInfo:function(){var e=cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"]);this.coinLabel.string=cc.pvz.utils.formatItemNum(e);var t=cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"]);this.diamondLabel.string=cc.pvz.utils.formatItemNum(t)},updatePowerInfo:function(){this.powerPanel.getComponent("PowerInfo").updatePowerInfo()},checkPowerInfo:function(){this.powerPanel.getComponent("PowerInfo").checkPowerShow()},onLoad:function(){cc.UIActLevelInfo=this},onCloseAllTip:function(){this.buffTipPanel.active=!1,this.boxRewardPanel.active=!1},initBy:function(e){if(void 0===e&&(e=null),cc.hasPopupType=cc.UIPage.Fuben,this.callback=e,this.isLookAd=!1,this.ActLevelJson=cc.JsonControl.ActLevelJson,this.ActLevelBuffJson=cc.JsonControl.ActLevelBuffJson,this.ActLevelBoxJson=cc.JsonControl.ActLevelBoxJson,this.updatePowerInfo(),this.updateItemInfo(),this.stageLevel=cc.pvz.PlayerData.getStageLevel(),cc.pvz.PlayerData.checkAndResetActLevel(),this.ActLevelData=cc.pvz.PlayerData.getActLevelData(),this.curBuffIndex=-1,this.buffTipPanel.active=!1,this.boxRewardPanel.active=!1,this.curBoxId=-1,this.scoreLabel.string=this.ActLevelData.score,this.ActLevelData.score<=2500?this.scoreBar.progress=0:this.scoreBar.progress=(this.ActLevelData.score-2500)/(cc.pvz.GameConfig.MaxActLevelScore-2500),this.initActBuffData(),this.initLevelBoxData(),this.lastTime=cc.pvz.utils.getTodayLastTimes(),this.timeLabel.string=cc.pvz.utils.formatSeconds3(this.lastTime),this.schedule(this.refreshLoastTime,1),this.ActLevelData.score<cc.pvz.GameConfig.MaxActLevelScore&&this.ActLevelData.times<=0&&cc.pvz.PlayerData.isHaveMoreActTimes())this.moreAdNode.active=!0,cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u989d\u5916\u6311\u6218"]);else{this.moreAdNode.active=!1;for(var t=this.ActLevelData.times<=0,i=0;i<1;i++){var o=this.battleBtn.children[i].getComponent(cc.Sprite);cc.JsonControl.setSpriteGray(o,t)}}this.refreshLevelPlayerShow()},initLevelMap:function(){},initActBuffData:function(){for(var e=0;e<2;e++){var t=this.ActLevelData.buffList[e];-1==t&&(t=this.getRandomBuff(0==e),cc.pvz.PlayerData.updateActLevelBuff(e+1,t));var i=cc.JsonControl.getActBuffJson(t);cc.pvz.utils.setSpriteFrame(this.buffIconList[e],"uiImage","tiaozhan/buff"+i.icon)}},getRandomBuff:function(e){void 0===e&&(e=!0);for(var t=[],i=0;i<this.ActLevelBuffJson.length;i++){var o=this.ActLevelBuffJson[i];e?o.id<100&&t.push(o.id):o.id>100&&t.push(o.id)}return t[cc.math.randomRangeInt(0,t.length)]},onClickBuff:function(e,t){this.boxRewardPanel.active=!1;var i=parseInt(t);if(i!=this.curBuffIndex){this.curBuffIndex=i;var o=this.ActLevelData.buffList[i-1],a=cc.JsonControl.getActBuffJson(o);this.buffTipPanel.active=!0,this.buffDescLabel.string=a.desc,this.buffTipPanel.position=cc.v2(this.buffIconList[i-1].node.parent.position.x,this.buffTipPanel.position.y)}else this.buffTipPanel.active=!this.buffTipPanel.active},initLevelBoxData:function(){this.levelBoxData=this.ActLevelData.boxStatus;for(var e=0;e<this.boxLabelList.length;e++){var t=this.ActLevelBoxJson[e].score;this.boxLabelList[e].string=""+t;var i=this.boxSpineList[e];1==this.levelBoxData[e]?i.setAnimation(0,"baoxiang4",!1):t<=this.ActLevelData.score?i.setAnimation(0,"baoxiang2",!0):i.setAnimation(0,"baoxiang1",!1)}},onClickBox:function(e,t){var i=this;if(!this.isLookAd){this.buffTipPanel.active=!1;var o=parseInt(t);if(1!=this.levelBoxData[o-1]){var a=this.ActLevelBoxJson[o-1].score<=this.ActLevelData.score,s=this.ActLevelBoxJson[o-1].reward,c=Math.floor(s.length/2),n=0;this.rewardData=[];for(var r=0;r<c;r++){var h=s[n],p=s[n+1];h==cc.pvz.GameConfig.ItemType["\u91d1\u5e01"]?p+=this.stageLevel*(1==o?10:20):h==cc.pvz.GameConfig.ItemType["\u94bb\u77f3"]&&(p+=this.stageLevel*(2==o?3:5));var l=cc.pvz.utils.getRewardItem(h,p);this.rewardData.push(l),n+=2}if(a){this.boxRewardPanel.active=!1,cc.pvz.PlayerData.updateActLevelBoxStatus(o);var d=this.boxSpineList[o-1];d.setAnimation(0,"baoxiang3",!1),d.setCompleteListener(function(){d.setAnimation(0,"baoxiang4",!1),d.setCompleteListener(null)}),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},this.rewardData,cc.pvz.GameConfig.UIFromType["\u6311\u6218\u526f\u672c"],function(){i.updateItemInfo()})}else o!=this.curBoxId?(this.curBoxId=o,this.boxRewardPanel.active=!0,this.refreshBoxPanelInfo(o)):this.boxRewardPanel.active=!this.boxRewardPanel.active}else cc.popupManager.showToast("\u5956\u52b1\u5df2\u9886\u53d6")}},refreshBoxPanelInfo:function(e){this.boxRewardPanel.position=cc.v2(this.boxSpineList[e-1].node.parent.position.x,this.boxRewardPanel.position.y);for(var t=0;t<this.rewardParent.childrenCount;t++){var i=this.rewardParent.children[t];t<this.rewardData.length?(i.active=!0,i.getComponent("RewardItem").initBoxRewardItem(this.rewardData[t])):i.active=!1}},refreshLoastTime:function(){this.lastTime--,this.timeLabel.string=cc.pvz.utils.formatSeconds3(this.lastTime),this.lastTime<=0&&(this.lastTime=86400,this.timeLabel.string=cc.pvz.utils.formatSeconds3(this.lastTime),this.initBy())},onAdInGameLogic:function(){var e=this;this.isLookAd||(this.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u989d\u5916\u6311\u6218"],function(t){e.onAdClose(t)}))},onAdClose:function(e){this.isLookAd=!1,e&&(cc.pvz.PlayerData.updateAdActTimes(),this.inActBattleGame())},inActBattleGame:function(){cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u53c2\u4e0e\u6311\u6218\u5173\u5361n\u6b21"],1),cc.MainUI.setClubBtnVisible(!1),cc.pvz.runtimeData.init(1,cc.player.actLevelData.level),cc.director.loadScene("game1")},onClickBattleGame:function(){this.isLookAd||(cc.pvz.PlayerData.isEnoughArrayTool()?this.ActLevelData.times<=0?this.moreAdNode.active?this.onAdInGameLogic():cc.popupManager.showToast("\u4eca\u65e5\u6b21\u6570\u5df2\u7528\u5b8c\uff01"):cc.pvz.PlayerData.getPower()<cc.pvz.GameConfig.BattlePower?cc.pvz.PlayerData.isHaveBuyPowerTimes()?cc.popupManager.popup("mainUI","powerbuy","UIPowerBuy",{ad:!1,scale:!0},cc.pvz.GameConfig.UIFromType["\u6311\u6218\u526f\u672c"]):cc.popupManager.showToast("\u4f53\u529b\u4e0d\u8db3"):(cc.pvz.PlayerData.usePlayerPower(-5),this.checkPowerInfo(),cc.pvz.PlayerData.updateActLevelTimes(),this.inActBattleGame()):cc.popupManager.showToast("\u8fd8\u6709\u672a\u4e0a\u9635\u7684\u5361\u76ae\u5df4\u62c9\u7684\u54e6\uff01"))},onCloseUI:function(){cc.hasPopupType=0,cc.popupManager.removePopup(this),this.callback&&this.callback()},onClickBuyPower:function(){},onClickBuyCoin:function(){cc.popupManager.removePopup(this),cc.MainControl.onClickBuyCoin()},onClickBuyDiamond:function(){cc.popupManager.removePopup(this),cc.MainControl.onClickBuyDiamond()}}),cc._RF.pop()},{}],UIActLevel:[function(e,t){"use strict";cc._RF.push(t,"c3207NRZlJHrJK97e4aw5/y","UIActLevel"),cc.Class({extends:cc.Component,properties:{panel:cc.Node,actLevelList:[cc.Node]},onLoad:function(){cc.UIActLevel=this},initBy:function(){cc.pvz.utils.fadeInBtn(this.node),this.node.active=!0,this.panel.scale=Math.min(1.4,this.node.width/720),this.initActItemList()},initActItemList:function(){this.actLevelList[0].getComponent("ActLevelItem").initActLevelItem(0)},onCloseUI:function(){this.node.active=!1},onClickOther:function(){cc.popupManager.showToast("\u5373\u5c06\u5f00\u542f...")}}),cc._RF.pop()},{}],UIAdBuy:[function(e,t){"use strict";cc._RF.push(t,"1a6bcfK2GBBq4FP+OT4vxBc","UIAdBuy"),cc.Class({extends:cc.Component,properties:{rewardItem:cc.Node,nameLabel:cc.Label,descLabel:cc.Label},initBy:function(e,t){if(void 0===t&&(t=null),this.isLookAd=!1,this.rewardData=e,this.callBack=t,this.rewardItem.getComponent("RewardItem").initRewardItem(this.rewardData,!1),this.itemId=this.rewardData.itemId,this.toolId=this.rewardData.toolId,this.itemId===cc.pvz.GameConfig.ItemType["\u56fa\u5b9a\u788e\u7247"]){var i=cc.JsonControl.getToolJson(this.toolId);this.nameLabel.string=i.name,this.descLabel.string=i.desc}else{var o=cc.JsonControl.getItemJson(this.itemId);this.nameLabel.string=o.Name,this.descLabel.string=o.Info}cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u9053\u5177\u4e0d\u8db3"])},onClickBuy:function(){var e=this;this.isLookAd||(this.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u9053\u5177\u4e0d\u8db3"],function(t){e.onAdClose(t)}))},onAdClose:function(e){this.isLookAd=!1,e&&(2==this.itemId||3==this.itemId?cc.pvz.PlayerData.updateAdBuyBankTimes(2==this.itemId?0:1):cc.pvz.PlayerData.updateAdBuyToolTimes(this.toolId),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},[this.rewardData],cc.pvz.GameConfig.UIFromType["\u9053\u5177\u4e0d\u8db3"],this.callBack),cc.popupManager.removePopup(this))},onCloseUI:function(){this.isLookAd||cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIAdGame2:[function(e,t){"use strict";cc._RF.push(t,"4c669kOTrxK/LplQeLeAMd8","UIAdGame2"),cc.Class({extends:cc.Component,properties:{timeLabel:cc.Label},initBy:function(e){this.ui=e},onClickClose:function(){cc.popupManager.removePopup(this)},onClickAd:function(){var e=this;cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u65e0\u5c3d\u706b\u529b"],function(t){t&&(e.ui.enterGame2(),cc.popupManager.removePopup(e))})},update:function(){var e=(cc.player.game2t||-1)+18e5-Date.now();this.timeLabel.string=cc.pvz.utils.formatSeconds2(Math.floor(e/1e3))}}),cc._RF.pop()},{}],UIFund:[function(e,t){"use strict";cc._RF.push(t,"aadb1zjTaNPYp4j50uxmlxf","UIFund");var i=e("../../scripts/PrefabInfo");cc.Class({extends:cc.Component,properties:{rowPrefab:i,fundsJsonFile:cc.JsonAsset,scorll:cc.ScrollView,barRoot:cc.Node,lineRoot:cc.Node,coinLabel:cc.Label,diamondLabel:cc.Label,panel:cc.Node},onLoad:function(){this.barRoot.zIndex=cc.macro.MIN_ZINDEX,this.lineRoot.parent.zIndex=cc.macro.MAX_ZINDEX},updateItemInfo:function(){var e=cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"]);this.coinLabel.string=cc.pvz.utils.formatItemNum(e);var t=cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"]);this.diamondLabel.string=cc.pvz.utils.formatItemNum(t)},initBy:function(){var e=this;this.panel.scale=this.node.width/720,this.scorll.node.height=this.scorll.node.height/this.panel.scale,this.roots=[];var t=this.fundsJsonFile.json.length;this.fundsJsonFile.json.forEach(function(i,o){cc.player.level<=i.need&&o<t&&(t=o);var a=new cc.Node;a.height=e.rowPrefab.prefab.height,a.parent=e.rowPrefab.root,e.roots[o]=a}),this.fillItems(0,7),this.rowPrefab.root.height=this.fundsJsonFile.json.length*this.rowPrefab.prefab.height,this.barRoot.y=(.5-t)*this.rowPrefab.prefab.height,this.lineRoot.y=(this.fundsJsonFile.json.length-t)*this.rowPrefab.prefab.height,this.updateItemInfo(),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u57fa\u91d1"])},fillItems:function(e,t){for(var i=this,o=Math.min(t,this.fundsJsonFile.json.length),a=function(){var e=i.fundsJsonFile.json[s],t=cc.player.level<=e.need,o=i.rowPrefab.addNodeTo(i.roots[s]);cc.find("name",o).getComponent(cc.Label).string=e.need+"\u5173",["item","itemAd","itemAd2"].forEach(function(i,a){var s=e["reward"+(a+1)],c=cc.find(i,o);c.getComponent("RewardItem").initRewardItem({itemId:s[0],count:s[1],toolId:-1},!1);var n=!t&&cc.pvz.PlayerData.hasFundGet(e.ID,a);cc.find("lock",c).active=t,cc.find("open",c).active=!t&&!n,cc.find("finish",c).active=!t&&n,c.getComponent(cc.Button).clickEvents[0].customEventData=e.ID+","+a})},s=e,c=o;s<c;s++)a();this.beginIndex=e,this.endIndex=o},onScrollEvent:function(e){var t=Math.floor(e.content.y/this.rowPrefab.prefab.height)+7;this.endIndex<t&&this.endIndex<this.fundsJsonFile.json.length&&this.fillItems(this.endIndex,this.endIndex+1)},onClickGetFund:function(e,t){var i=this,o=t.split(","),a=parseInt(o[0]),s=parseInt(o[1]);if(!cc.pvz.PlayerData.hasFundGet(a,s)){var c=function(){cc.pvz.PlayerData.setFundGetted(a,s);var t=e.target.getComponent("RewardItem");cc.find("open",t.node).active=!1,cc.find("finish",t.node).active=!0,cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!0,scale:!1},[{itemId:t.itemId,count:t.count,toolId:-1}],cc.pvz.GameConfig.UIFromType["\u57fa\u91d1"],function(){i.updateItemInfo(),cc.MainControl.updateItemInfo()},function(e){return e===cc.pvz.GameConfig.ItemType["\u94bb\u77f3"]?i.diamondLabel.node.convertToWorldSpaceAR(cc.v2()):i.coinLabel.node.convertToWorldSpaceAR(cc.v2())})};s>0?cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u57fa\u91d1"],function(e){e&&c()}):c()}},onClickClose:function(){cc.popupManager.removePopup(this),cc.RedControl.refreshAllRedTip()}}),cc._RF.pop()},{"../../scripts/PrefabInfo":void 0}],UIPowerBuy:[function(e,t){"use strict";cc._RF.push(t,"e7fb2EcdSBMVoSZxVl/D2Bv","UIPowerBuy"),cc.Class({extends:cc.Component,properties:{buyTimesLabel:[cc.Label],priceLabel:cc.Label},initBy:function(e){this.fromType=e,this.isLookAd=!1,cc.pvz.PlayerData.checkAndResetPowetBuy(),this.refreshUIInfo(),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u4f53\u529b\u8d2d\u4e70"])},refreshUIInfo:function(){for(var e=0;e<2;e++)this.buyTimesLabel[e].string=cc.pvz.GameConfig.PowerBuyTip.replace("$",cc.pvz.PlayerData.getPowerBuyTimes(0==e));var t=3-cc.pvz.PlayerData.getPowerBuyTimes(!1);t=t<0?0:t>=3?2:t,this.diamondPrice=cc.pvz.GameConfig.PowerBuyPrices[t],this.priceLabel.string="x"+this.diamondPrice},onClickAdBuy:function(){var e=this;cc.pvz.PlayerData.getPowerBuyTimes(!0)<=0?cc.popupManager.showToast("\u4eca\u65e5\u514d\u8d39\u6b21\u6570\u5df2\u7528\u5b8c"):this.isLookAd||(this.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u4f53\u529b\u8d2d\u4e70"],function(t){e.onAdClose(t)}))},onAdClose:function(e){this.isLookAd=!1,e&&(cc.pvz.PlayerData.updatePowerBuyTimes(!0,1),this.refreshUIInfo(),this.refreshAddPower(10))},onClickDiamondBuy:function(){cc.pvz.PlayerData.getPowerBuyTimes(!1)<=0?cc.popupManager.showToast("\u4eca\u65e5\u8d2d\u4e70\u6b21\u6570\u5df2\u7528\u5b8c"):cc.pvz.PlayerData.isItemEnough(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],this.diamondPrice)?(cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],-this.diamondPrice),cc.pvz.PlayerData.updatePowerBuyTimes(!1,1),this.refreshUIInfo(),this.refreshAddPower(15)):cc.popupManager.showToast("\u94bb\u77f3\u4e0d\u8db3\uff01")},refreshAddPower:function(e){cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u8d2d\u4e70\u4f53\u529bn\u6b21"],1),cc.pvz.PlayerData.addPower(e,!0),this.fromType==cc.pvz.GameConfig.UIFromType["\u6311\u6218\u526f\u672c"]&&(cc.UIActLevelInfo.updateItemInfo(),cc.UIActLevelInfo.checkPowerInfo()),cc.MainControl.updateItemInfo(),cc.MainControl.checkPowerInfo(),cc.popupManager.showEffectFly(cc.pvz.GameConfig.ItemType["\u4f53\u529b"],cc.MainControl.getItemEffectPos(cc.pvz.GameConfig.ItemType["\u4f53\u529b"])),cc.butler.playEffect(cc.MainControl.rewardSound),cc.RedControl.onCheckBattleRed(),cc.RedControl.onCheckMissionRed()},onCloseUI:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIPreGame:[function(e,t){"use strict";cc._RF.push(t,"6fccaRU2dJAkaIbqN8QNWjH","UIPreGame"),cc.Class({extends:cc.Component,properties:{lvLabel:cc.Label},initBy:function(e){this.closeCb=e},onClickStart:function(){cc.popupManager.removePopup(this),cc.pvz.runtimeData.initByPreData(),cc.director.loadScene("game1")},onClickClose:function(){cc.popupManager.removePopup(this),cc.pvz.runtimeData.removeData(),this.closeCb&&this.closeCb()}}),cc._RF.pop()},{}],UIRankMode:[function(e,t){"use strict";cc._RF.push(t,"e0048eBdXtNUaQg/1qcjJwm","UIRankMode"),cc.Class({extends:cc.Component,properties:{maxWaveLabel:cc.Label,tryCountLabel:cc.Label,rankDot:cc.Node,levelPlayerPanel:cc.Node},onLoad:function(){cc.UIRankMode=this},refreshLevelPlayerShow:function(){this.levelPlayerPanel.getComponent("LevelPlayer").initHeroShow()},initBy:function(){this.node.active=!0,cc.pvz.utils.fadeInBtn(this.node),cc.hasPopupType=cc.UIPage.Rank,this.maxWaveLabel.string=cc.tmpScore,this.tryCountLabel.string=cc.player.rankCount,this.rankDot.active=cc.tmpNewRecord,this.refreshLevelPlayerShow()},showFinish:function(){},onClickClose:function(){cc.hasPopupType=0,this.node.active=!1},onClickStart:function(){cc.player.rankCount<=0?cc.popupManager.showToast("\u4eca\u65e5\u6b21\u6570\u5df2\u7528\u5b8c"):cc.pvz.PlayerData.isEnoughArrayTool()?cc.pvz.PlayerData.getPower()<cc.pvz.GameConfig.BattlePower?cc.pvz.PlayerData.isHaveBuyPowerTimes()?cc.popupManager.popup("mainUI","powerbuy","UIPowerBuy",{ad:!1,scale:!0},cc.pvz.GameConfig.UIFromType["\u6392\u4f4d\u8d5b"]):cc.popupManager.showToast("\u4f53\u529b\u4e0d\u8db3"):(cc.player.rankCount--,cc.pvz.PlayerData.usePlayerPower(-cc.pvz.GameConfig.BattlePower),cc.MainControl.checkPowerInfo(),cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u53c2\u4e0e\u65e0\u5c3d\u6311\u6218\u8d5bN\u6b21"],1),cc.MainUI.setClubBtnVisible(!1),cc.pvz.runtimeData.init(2,-1),cc.director.loadScene("game1")):cc.popupManager.showToast("\u8fd8\u6709\u672a\u4e0a\u9635\u7684\u5361\u76ae\u5df4\u62c9\u54df\uff01")},onClickTip:function(){cc.popupManager.popup("rank","RankTipUI","UIRankTip",{ad:!1,scale:!1})},onClickLastRank:function(){cc.tmpNewRecord=!1,this.rankDot.active=!1,cc.popupManager.popup("rank","RankList","UIRankList",{ad:!1,scale:!1},this.node)},testUpload_1_5:function(){cc.pvz.cloud.uploadScore(cc.math.randomRangeInt(1,6),""+cc.math.randomRangeInt(1,14),function(){})},testUpload_6_10:function(){cc.pvz.cloud.uploadScore(cc.math.randomRangeInt(6,11),""+cc.math.randomRangeInt(1,14),function(){})}}),cc._RF.pop()},{}],UIReward:[function(e,t){"use strict";cc._RF.push(t,"c7576jyMIdBMZD68DvkmUF7","UIReward"),cc.Class({extends:cc.Component,properties:{baseItemNode:cc.Node,parentOnePanel:cc.Node,parentMorePanel:cc.Node,closeBtn:cc.Node,effectSpine:sp.Skeleton,bgSpine:sp.Skeleton,rewardSound:cc.AudioClip},onLoad:function(){cc.UIReward=this,this.baseItemNode.active=!1,this.effectSpine.node.active=!1},showEffectSpine:function(){var e=this;this.effectSpine.node.active=!0,this.effectSpine.setAnimation(0,"caidai",!1),this.effectSpine.setCompleteListener(function(){e.effectSpine.node.active=!1,e.effectSpine.setCompleteListener(null)})},initBy:function(e,t,i,o){var a=this;void 0===i&&(i=null),void 0===o&&(o=null),this.fromType=t,this.callBack=i,this.getItemEffectPosCb=o,this.closeBtn.active=!1,this.onCheckRewardData(e),this.bgSpine.setEventListener(function(e,t){"ShowItem"==t.data.name&&(a.initUIInfo(),a.showEffectSpine())}),this.bgSpine.setAnimation(0,"get1",!1),this.bgSpine.setCompleteListener(function(){a.bgSpine.setAnimation(0,"get2",!0),a.bgSpine.setCompleteListener(null)}),cc.butler.playEffect(this.rewardSound)},onCheckRewardData:function(e){this.rewardData=[],this.effectItemList=[];for(var t=0;t<e.length;t++){var i=e[t];i.itemId>=5&&i.itemId<=7?cc.pvz.utils.onCheckRandomTool(i,this.rewardData,this.fromType!=cc.pvz.GameConfig.UIFromType["\u7b7e\u5230"]):(this.rewardData.push(i),i.itemId>=2&&i.itemId<=4&&this.effectItemList.push(i.itemId))}},initUIInfo:function(){this.closeBtn.active=!0;var e,t=this.rewardData.length;e=t<=5?this.parentOnePanel:this.parentMorePanel,this.baseItemNode.active=!0,this.baseItemNode.parent=e,this.baseItemNode.position=cc.v2(0,0);var i=this.fromType!=cc.pvz.GameConfig.UIFromType["\u53cc\u500d\u7ed3\u7b97"];this.baseItemNode.getComponent("RewardItem").initRewardItem(this.rewardData[0],i);for(var o=1;o<t;o++){var a=cc.instantiate(this.baseItemNode);a.parent=e,a.getComponent("RewardItem").initRewardItem(this.rewardData[o],i)}},onCloseUI:function(){if(cc.popupManager.removePopup(this),this.fromType!=cc.pvz.GameConfig.UIFromType["\u53cc\u500d\u7ed3\u7b97"]){if(this.effectItemList.length>0)for(var e=-1,t=0;t<this.effectItemList.length;t++){for(var i=this.effectItemList[t],o=cc.math.randomRangeInt(1,4);-1!=e&&e==o;)o=cc.math.randomRangeInt(1,4);e=o,this.fromType==cc.pvz.GameConfig.UIFromType["\u65e5\u5e38\u4efb\u52a1"]||this.fromType==cc.pvz.GameConfig.UIFromType["\u5468\u5e38\u4efb\u52a1"]||this.fromType==cc.pvz.GameConfig.UIFromType["\u6210\u5c31"]?cc.popupManager.showEffectFly(i,cc.UITask.getItemEffectPos(i),o):this.fromType==cc.pvz.GameConfig.UIFromType["\u57fa\u91d1"]?cc.popupManager.showEffectFly(i,this.getItemEffectPosCb(i),o):cc.popupManager.showEffectFly(i,cc.MainControl.getItemEffectPos(i),o)}this.fromType===cc.pvz.GameConfig.UIFromType["\u5173\u5361\u5b9d\u7bb1"]&&cc.MainControl.checkPowerInfo(),this.callBack&&this.callBack(),cc.MainControl.updateItemInfo(),cc.RedControl.refreshAllRedTip()}else this.callBack&&this.callBack()}}),cc._RF.pop()},{}],UISet:[function(e,t){"use strict";cc._RF.push(t,"6fa40zqGBBAXrWCVB0pXhaH","UISet"),cc.Class({extends:cc.Component,properties:{musicBtn:cc.Node,soundBtn:cc.Node,uidLabel:cc.Label,saveNode:cc.Node,versionLabel:cc.Label},initBy:function(e){this.musicBtn.children[0].active=!cc.player.isMMute,this.musicBtn.children[1].active=cc.player.isMMute,this.soundBtn.children[0].active=!cc.player.isSMute,this.soundBtn.children[1].active=cc.player.isSMute,this.uidLabel.string=cc.pvz.cloud.uid,this.saveNode.active=0==e&&1==cc.player.guide1,this.saveNode.parent.getComponent(cc.Layout).updateLayout(),this.versionLabel&&(this.versionLabel.string="v"+cc.pvz.GameConst.GAME_VERSION),cc.pvz.TAUtils.trackSystemUI(4)},onSwitchMusic:function(){cc.butler.setMusicSwitch(!cc.player.isMMute),this.musicBtn.children[0].active=!cc.player.isMMute,this.musicBtn.children[1].active=cc.player.isMMute},onSwitchSound:function(){cc.butler.setSoundSwitch(!cc.player.isSMute),this.soundBtn.children[0].active=!cc.player.isSMute,this.soundBtn.children[1].active=cc.player.isSMute},onClickSave:function(){cc.player.guide1<1?cc.popupManager.showToast("\u5b8c\u6210\u6559\u5b66\u540e\u5f00\u542f"):Date.now()-cc.storageTime2<6e4?cc.popupManager.showToast("\u8bf7\u4e8e1\u5206\u949f\u540e\u518d\u4e0a\u4f20"):cc.pvz.PlayerData.saveDataToLocalOnline(function(e){cc.storageTime2=Date.now(),cc.popupManager.showToast(e?"\u5b58\u6863\u6210\u529f":"\u5b58\u6863\u5931\u8d25")})},onCloseUI:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIShare:[function(e,t){"use strict";cc._RF.push(t,"0c413O0xYdARItY6r0cRWvp","UIShare"),cc.Class({extends:cc.Component,properties:{btnSprite:cc.Sprite,gettedNode:cc.Node},initBy:function(){cc.pvz.PlayerData.checkAndResetShare();var e=cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],2e3),t=cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],25),i=cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["\u968f\u673a\u84dd\u8272\u788e\u7247"],6);this.rewardList=[e,t,i],this.gettedNode.active=cc.player.isShare},onClickShare:function(){var e=this;cc.player.isShare?cc.pvz.TAUtils.share(-1,function(){cc.popupManager.showToast("\u5206\u4eab\u6210\u529f")}):cc.pvz.TAUtils.share(0,function(t){t&&(cc.player.isShare||(cc.pvz.PlayerData.finishShare(),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!0,scale:!1},e.rewardList,cc.pvz.GameConfig.UIFromType["\u5206\u4eab\u5956\u52b1"],function(){cc.MainControl.updateItemInfo(),cc.RedControl.refreshAllRedTip(),cc.popupManager.removePopup(e)})))})},onCloseUI:function(){cc.MainControl.updateItemInfo(),cc.RedControl.refreshAllRedTip(),cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIShopBoxBuy:[function(e,t){"use strict";cc._RF.push(t,"aef5fdFr7VIBruIb8sJlU17","UIShopBoxBuy"),cc.Class({extends:cc.Component,properties:{boxAdBtnPanel:cc.Node,buyBtn:cc.Node,freeBtn:cc.Node,nameLabel:cc.Label,priceLabel:cc.Label,boxSprite:cc.Sprite,baseItemNode:cc.Node,rewardParent:cc.Node},initBy:function(e,t,i,o){var a;void 0===i&&(i=!1),void 0===o&&(o=null),this.boxId=e,this.shopBoxJson=t,this.isCanAdBuy=i,this.callBack=o,this.price=this.shopBoxJson["consume"+this.boxId],this.priceLabel.string=this.price,1==this.boxId?this.nameLabel.string="\u94f6\u8272\u5b9d\u7bb1":this.nameLabel.string="\u9ec4\u91d1\u5b9d\u7bb1",a=1==this.boxId?"12":"11",cc.pvz.utils.setSpriteFrame(this.boxSprite,"uiImage","shop/shop"+a),this.onCheckBoxAdBtnGray(!this.isCanAdBuy),this.onBoxRewardShow(),this.isCanAdBuy&&2==this.boxId&&cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5546\u5e97\u5b9d\u7bb1"])},onBoxRewardShow:function(){var e=this.shopBoxJson["box"+this.boxId],t=Math.floor(e.length/2),i=0;this.rewardData=[];for(var o=0;o<t;o++){var a=cc.pvz.utils.getRewardItem(e[i],e[i+1]);this.rewardData.push(a),i+=2}this.baseItemNode.getComponent("RewardItem").initBoxRewardItem(this.rewardData[0]);for(var s=1;s<t;s++){var c=cc.instantiate(this.baseItemNode);c.parent=this.rewardParent,c.getComponent("RewardItem").initBoxRewardItem(this.rewardData[s])}},onCheckBoxAdBtnGray:function(e){if(1==this.boxId)this.boxAdBtnPanel.active=!1,this.freeBtn.active=!e,this.buyBtn.active=e;else{for(var t=0;t<this.boxAdBtnPanel.childrenCount;t++)this.boxAdBtnPanel.children[t].getComponent(cc.Sprite).setMaterial(0,cc.JsonControl.materialList[e?1:0]);this.freeBtn.active=!1}},onClickAdBox:function(){var e=this;cc.UIShop.isLookAd||this.isCanAdBuy&&(1==this.boxId?this.onAdClose(!0):(cc.UIShop.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5546\u5e97\u5b9d\u7bb1"],function(t){e.onAdClose(t)})))},onAdClose:function(e){cc.UIShop.isLookAd=!1,e&&(cc.pvz.PlayerData.updateShopBoxDate(this.boxId,Date.now()),this.isCanAdBuy&&2==this.boxId&&cc.pvz.PlayerData.updateShopBoxExp(this.price),cc.popupManager.removePopup(this),cc.popupManager.popup("mainUI","ShopBoxEft","UIShopBoxReward",{ad:!1,scale:!0},this.boxId,this.rewardData,this.callBack))},onClickBuyBox:function(){if(!cc.UIShop.isLookAd)if(cc.pvz.PlayerData.isItemEnough(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],this.price))cc.pvz.PlayerData.updateShopBoxExp(this.price),cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],-this.price),cc.popupManager.removePopup(this),cc.popupManager.popup("mainUI","ShopBoxEft","UIShopBoxReward",{ad:!1,scale:!0},this.boxId,this.rewardData,function(){cc.UIShop.onChekBoxLvUp()});else if(cc.pvz.PlayerData.isHaveAdBuyBankTimes(1)){var e=cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"],100);cc.popupManager.popup("mainUI","adbuyUI","UIAdBuy",{ad:!1,scale:!0},e)}else cc.popupManager.showToast("\u94bb\u77f3\u4e0d\u8db3\uff01")},onCloseUI:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIShopBoxDetail:[function(e,t){"use strict";cc._RF.push(t,"cecc0YT8vNNeq5CIv0xuI2v","UIShopBoxDetail"),cc.Class({extends:cc.Component,properties:{iconSprite:cc.Sprite,tipLabel:cc.Label,baseCardNode:cc.Node,parentPanel:cc.Node},initBy:function(e){var t=cc.JsonControl.getItemJson(e),i=cc.pvz.GameConfig["Quality"+t.Quality+"Tools"],o=cc.pvz.PlayerData.getStageLevel();cc.pvz.utils.setSpriteFrame(this.iconSprite,"uiImage","shop/shop"+(e+15));var a,s=o<cc.pvz.GameConfig.ToolLockLevel[i[0]-1];this.baseCardNode.getComponent("RewardItem").initShopBoxToolItem(i[0],s),a=s?1:0;for(var c=1;c<i.length;c++){var n=cc.instantiate(this.baseCardNode);n.parent=this.parentPanel;var r=o<cc.pvz.GameConfig.ToolLockLevel[i[c]-1];n.getComponent("RewardItem").initShopBoxToolItem(i[c],r),r&&a++}var h=1/(i.length-a)*100;this.tipLabel.string=h.toFixed(2)+"%"},onCloseUI:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIShopBoxLvUp:[function(e,t){"use strict";cc._RF.push(t,"b99570aZpZAmqdpHWmdafyF","UIShopBoxLvUp"),cc.Class({extends:cc.Component,properties:{lvLabel:cc.Label,boxPanel1:cc.Node,boxPanel2:cc.Node,boxLabels1:[cc.Label],boxLabels2:[cc.Label],closeBtn:cc.Node},initBy:function(e,t){var i=this;this.closeBtn.active=!1,this.boxLv=e,this.shopBoxJson=t,this.lvLabel.string=""+this.boxLv,this.boxLvJson=this.shopBoxJson[this.boxLv-1],this.onBoxRewardShow(1,this.boxPanel1,this.boxLabels1),this.onBoxRewardShow(2,this.boxPanel2,this.boxLabels2),this.scheduleOnce(function(){cc.pvz.utils.fadeInBtn(i.closeBtn)},1)},onBoxRewardShow:function(e,t,i){for(var o=this.boxLvJson["show"+e],a=Math.floor(o.length/2),s=0,c=0;c<t.childrenCount;c++)c<a?(t.children[c].active=!0,i[c].string="+"+o[s+1]):t.children[c].active=!1,s+=2},onCloseUI:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIShopBoxReward:[function(e,t){"use strict";cc._RF.push(t,"64e05oAh8RHAZyr36OZ372A","UIShopBoxReward"),cc.Class({extends:cc.Component,properties:{boxSpine:sp.Skeleton,closeBtn:cc.Node,uiTip:cc.Node,baseItemNode:cc.Node,parentOnePanel:cc.Node,parentMorePanel:cc.Node},onLoad:function(){this.baseItemNode.active=!1,this.uiTip.active=!1,this.closeBtn.active=!1},initBy:function(e,t,i){var o=this;void 0===i&&(i=null);var a=e;this.callBack=i,this.onCheckRewardData(t),this.boxSpine.setEventListener(function(e,t){"kapai"==t.data.name&&o.onShowBoxReward()}),this.boxSpine.node.active=!0,this.boxSpine.setAnimation(0,"BX"+a+"_1",!1),this.boxSpine.setCompleteListener(function(){o.boxSpine.setAnimation(0,"BX"+a+"_2",!0),o.boxSpine.setCompleteListener(null)}),cc.butler.playEffect(cc.MainControl.rewardSound),2==a&&cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u9ad8\u7ea7\u5b9d\u7bb1\u62bd\u53d6\u88c5\u5907n\u6b21"],1)},onShowBoxReward:function(){var e=this;this.uiTip.active=!0;var t,i=this.rewardData.length;if(t=i<=5?this.parentOnePanel:this.parentMorePanel,this.baseItemNode.active=!0,this.baseItemNode.parent=t,i>5&&cc.pvz.utils.fadeInBtn(this.baseItemNode),this.baseItemNode.position=cc.v2(0,0),this.baseItemNode.getComponent("RewardItem").initRewardItem(this.rewardData[0],!0),i<=5)for(var o=1;o<i;o++){var a=cc.instantiate(this.baseItemNode);a.parent=t,a.getComponent("RewardItem").initRewardItem(this.rewardData[o],!0),o==i-1&&(this.closeBtn.active=!0)}else for(var s=function(o){setTimeout(function(){var a=cc.instantiate(e.baseItemNode);a.parent=t,cc.pvz.utils.fadeInBtn(a),a.getComponent("RewardItem").initRewardItem(e.rewardData[o],!0),o==i-1&&(e.closeBtn.active=!0)},40*(o-1)+120)},c=1;c<i;c++)s(c)},onCheckRewardData:function(e){this.rewardData=[],this.effectItemList=[];for(var t=0;t<e.length;t++){var i=e[t];i.itemId>=5&&i.itemId<=7?cc.pvz.utils.onCheckRandomTool(i,this.rewardData):(this.rewardData.push(i),i.itemId>=2&&i.itemId<=4&&this.effectItemList.push(i.itemId))}},onCloseUI:function(){if(cc.popupManager.removePopup(this),this.effectItemList.length>0)for(var e=-1,t=0;t<this.effectItemList.length;t++){for(var i=this.effectItemList[t],o=cc.math.randomRangeInt(1,4);-1!=e&&e==o;)o=cc.math.randomRangeInt(1,4);e=o,cc.popupManager.showEffectFly(i,cc.MainControl.getItemEffectPos(i),o)}this.callBack&&this.callBack(),cc.MainControl.updateItemInfo(),cc.RedControl.refreshAllRedTip()}}),cc._RF.pop()},{}],UIShopBoxTip:[function(e,t){"use strict";cc._RF.push(t,"3183bAXT1JNroKcDHSBCUvR","UIShopBoxTip"),cc.Class({extends:cc.Component,properties:{leftBtn:cc.Node,rightBtn:cc.Node,leftClose:cc.Node,rightClose:cc.Node,lvLabel:cc.Label,boxPanel1:cc.Node,boxPanel2:cc.Node,boxLabels1:[cc.Label],boxLabels2:[cc.Label]},initBy:function(e,t){this.boxLv=e,this.shopBoxJson=t,this.MaxBoxLv=this.shopBoxJson.length,this.lvLabel.string="Lv."+this.boxLv,this.leftClose.active=1==this.boxLv,this.rightClose.active=this.boxLv==this.MaxBoxLv,this.boxLvJson=this.shopBoxJson[this.boxLv-1],this.onBoxRewardShow(1,this.boxPanel1,this.boxLabels1),this.onBoxRewardShow(2,this.boxPanel2,this.boxLabels2)},onClickPage:function(e,t){if(parseInt(t)<0){if(1==this.boxLv)return;this.boxLv--}else{if(this.boxLv==this.MaxBoxLv)return;this.boxLv++}this.lvLabel.string="Lv."+this.boxLv,this.leftClose.active=1==this.boxLv,this.rightClose.active=this.boxLv==this.MaxBoxLv,this.boxLvJson=this.shopBoxJson[this.boxLv-1],this.onBoxRewardShow(1,this.boxPanel1,this.boxLabels1),this.onBoxRewardShow(2,this.boxPanel2,this.boxLabels2)},onBoxRewardShow:function(e,t,i){for(var o=this.boxLvJson["show"+e],a=Math.floor(o.length/2),s=0,c=0;c<t.childrenCount;c++)c<a?(t.children[c].active=!0,i[c].string="+"+o[s+1]):t.children[c].active=!1,s+=2},onCloseUI:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIShopBuy:[function(e,t){"use strict";cc._RF.push(t,"5cff3D7PN5BNoNr09dEW+3e","UIShopBuy"),cc.Class({extends:cc.Component,properties:{rewardItem:cc.Node,nameLabel:cc.Label,priceType:cc.Sprite,priceLabel:cc.Label,descLabel:cc.Label},initBy:function(e,t,i,o){void 0===o&&(o=!0),this.rewardData=e,this.priceData=t,this.callBack=i,this.isDailyShop=o,this.priceLabel.string=this.priceData[1];var a=cc.JsonControl.getItemJson(this.priceData[0]);if(cc.JsonControl.getItemIcon(this.priceType,a.Icon),this.rewardItem.getComponent("RewardItem").initRewardItem(this.rewardData,!1),this.itemId=this.rewardData.itemId,this.toolId=this.rewardData.toolId,this.itemId===cc.pvz.GameConfig.ItemType["\u56fa\u5b9a\u788e\u7247"]){var s=cc.JsonControl.getToolJson(this.toolId);this.nameLabel.string=s.name,this.descLabel.string=s.desc}else{var c=cc.JsonControl.getItemJson(this.itemId);this.nameLabel.string=c.Name,this.descLabel.string=c.Info}},onClickBuy:function(){if(cc.pvz.PlayerData.isItemEnough(this.priceData[0],this.priceData[1]))cc.pvz.PlayerData.changeItemNum(this.priceData[0],-this.priceData[1]),this.isDailyShop&&(cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u6bcf\u65e5\u5546\u5e97\u8d2d\u4e70n\u6b21\u7269\u54c1"],1),cc.RedControl.onCheckBattleRed()),cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},[this.rewardData],cc.pvz.GameConfig.UIFromType["\u6bcf\u65e5\u5546\u5e97"],this.callBack),cc.popupManager.removePopup(this);else{var e=2==this.priceData[0];if(cc.pvz.PlayerData.isHaveAdBuyBankTimes(e?0:1)){var t=cc.pvz.utils.getRewardItem(this.priceData[0],e?2500:100);cc.popupManager.popup("mainUI","adbuyUI","UIAdBuy",{ad:!1,scale:!0},t),cc.popupManager.removePopup(this)}else{var i;i=2==this.priceData[0]?"\u91d1\u5e01":"\u94bb\u77f3",cc.popupManager.showToast(i+"\u4e0d\u8db3\uff01")}}},onCloseUI:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIShop:[function(e,t){"use strict";cc._RF.push(t,"c0f5dD1vVhLwrvTe7JqJ8O5","UIShop");var i=cc.Class({name:"ShopData",properties:{itemId:1,count:1,toolId:-1,buyTimes:0,priceType:2,price:1,discount:1}});cc.Class({extends:cc.Component,properties:{shopJsonFile:cc.JsonAsset,shopBoxJsonFile:cc.JsonAsset,shopDailyPanel:cc.Node,refreshTimesLabel:cc.Label,shopCoinList:[cc.Node],boxLvLabel:cc.Label,boxLvBar:cc.ProgressBar,boxLvProgress:cc.Label,boxItemList:[cc.Node],scrollPanel:cc.ScrollView,redTips:[cc.Node]},onClickRefresh:function(){var e=this;this.isLookAd||(this.refreshTimes<=0?cc.popupManager.showToast("\u5237\u65b0\u6b21\u6570\u4e0d\u8db3\uff01"):(this.onStopShopScroll(),this.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u5546\u5e97\u5237\u65b0"],function(t){e.onAdClose(t)})))},onAdClose:function(e){this.isLookAd=!1,e&&(cc.pvz.PlayerData.updateShopTimes(cc.pvz.GameConfig.ShopTimesType["\u5546\u5e97\u5237\u65b0"]),this.refreshTimes=cc.pvz.PlayerData.getShopTimes(cc.pvz.GameConfig.ShopTimesType["\u5546\u5e97\u5237\u65b0"]),this.refreshTimesLabel.string=this.refreshTimes,this.initShopDailyData(!0))},onClickShopBoxTip:function(){this.isLookAd||(this.onStopShopScroll(),cc.popupManager.popup("mainUI","shopboxTip","UIShopBoxTip",{ad:!1,scale:!0},this.shopBoxData.lv,this.shopBoxJson))},onLoad:function(){cc.UIShop=this,this.isLookAd=!1,this.shopJson=this.shopJsonFile.json,this.shopBoxJson=this.shopBoxJsonFile.json},start:function(){this.scrollPanel.node.scale=Math.min(1.4,this.node.width/720),this.scrollPanel.node.height/=this.scrollPanel.node.scale},updateRedTip:function(){this.redTips[0].active=1==cc.pvz.PlayerData.getShopTimes(cc.pvz.GameConfig.ShopTimesType["\u94bb\u77f3\u514d\u8d39"]),this.redTips[1].active=7==cc.pvz.PlayerData.getShopTimes(cc.pvz.GameConfig.ShopTimesType["\u91d1\u5e01\u514d\u8d39"])},initBy:function(){cc.pvz.utils.fadeInBtn(this.node),this.node.active=!0,this.stageLevel=cc.pvz.PlayerData.getStageLevel(),cc.pvz.PlayerData.checkAndResetShop(),this.refreshTimes=cc.pvz.PlayerData.getShopTimes(cc.pvz.GameConfig.ShopTimesType["\u5546\u5e97\u5237\u65b0"]),this.refreshTimesLabel.string=this.refreshTimes,cc.pvz.PlayerData.isNewShopStatus()?this.initShopDailyData(!1):this.refreshShopUI(),this.updateRedTip(),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5546\u5e97\u5237\u65b0"]),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5546\u5e97\u5b9d\u7bb1"]),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5546\u5e97\u94bb\u77f3"]),cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["\u5546\u5e97\u91d1\u5e01"])},onStopShopScroll:function(){this.scrollPanel.stopAutoScroll()},onShopToCoin:function(){this.scrollPanel.scrollToBottom(.1)},onShopToDiamond:function(){this.scrollPanel.scrollToTop(.1)},initShopDailyData:function(e){void 0===e&&(e=!1);for(var t=e?1:0;t<6;t++){var o,a=t+1,s=this.shopJson[t];o=1==a?0:cc.pvz.utils.randomWeightIndex(s.wgt);var c=s.item[o];this.stageLevel<5&&7==c&&(o=cc.pvz.utils.randomWeightIndex([s.wgt[0],s.wgt[1]]),c=s.item[o]);var n=s["num"+(o+1)],r=n[cc.pvz.utils.randomWeightIndex(n)],h=10;s.discountWgt.length>0&&(h=s.discount[cc.pvz.utils.randomWeightIndex(s.discountWgt)]);var p=s.priceNum[o]*r*(h/10),l=new i;l.count=r,l.buyTimes=s.buyNum[0],l.priceType=s.priceItem[0],l.discount=h,l.price=Math.ceil(p),c>=5&&c<=7?(l.itemId=cc.pvz.GameConfig.ItemType["\u56fa\u5b9a\u788e\u7247"],l.toolId=this.onGetRandomTool(c)):(l.itemId=c,l.toolId=-1),e?cc.pvz.PlayerData.setShopData(a,l):cc.pvz.PlayerData.addShopData(a,l)}e?this.refreshDailyUI():(cc.pvz.PlayerData.changeShopStatus(),this.refreshShopUI())},onGetRandomTool:function(e){var t=cc.JsonControl.getItemJson(e),i=cc.pvz.utils.getOpenToolList(t.Quality);return i[cc.math.randomRangeInt(0,i.length)]},refreshShopUI:function(){this.refreshDailyUI(),this.initShopBoxUI(),this.initCoinShopUI()},refreshDailyUI:function(){for(var e=0;e<6;e++){var t=e+1;this.shopDailyPanel.children[e].getComponent("ShopDailyItem").initShopDailyItem(t,this.shopJson[e])}},initShopBoxUI:function(){var e=this;this.shopBoxData=cc.pvz.PlayerData.getShopBoxData(),this.shopBoxLvJson=this.shopBoxJson[this.shopBoxData.lv-1],this.boxLvLabel.string=""+this.shopBoxData.lv,cc.player.shopBoxData.lv>=10?(this.boxLvProgress.string="\u5df2\u6ee1\u7ea7",this.boxLvBar.progress=1):(this.boxLvProgress.string=this.shopBoxData.exp+"/"+this.shopBoxLvJson.exp,this.boxLvBar.progress=this.shopBoxData.exp/this.shopBoxLvJson.exp);for(var t=0;t<this.boxItemList.length;t++)this.boxItemList[t].getComponent("ShopBoxItem").initShopBoxItem(t+1,this.shopBoxLvJson,function(){e.onChekBoxLvUp()})},onChekBoxLvUp:function(){if(!(cc.player.shopBoxData.lv>=10)){this.shopBoxData=cc.pvz.PlayerData.getShopBoxData(),this.shopBoxLvJson=this.shopBoxJson[this.shopBoxData.lv-1];var e=this.shopBoxData.exp-this.shopBoxLvJson.exp;e>=0&&(cc.pvz.PlayerData.updateShopBoxlV(1,e),this.initShopBoxUI(),cc.popupManager.popup("mainUI","shopboxlveft","UIShopBoxLvUp",{ad:!1,scale:!0},this.shopBoxData.lv,this.shopBoxJson)),this.boxLvLabel.string=""+this.shopBoxData.lv,cc.player.shopBoxData.lv>=10?(this.boxLvProgress.string="\u5df2\u6ee1\u7ea7",this.boxLvBar.progress=1):(this.boxLvProgress.string=this.shopBoxData.exp+"/"+this.shopBoxLvJson.exp,this.boxLvBar.progress=this.shopBoxData.exp/this.shopBoxLvJson.exp)}},initCoinShopUI:function(){for(var e=0;e<3;e++){var t=e+7;this.shopCoinList[e].getComponent("ShopCoinItem").initShopCoinItem(t,this.shopJson[t-1])}},onCloseUI:function(){this.node.active=!1}}),cc._RF.pop()},{}],UISign:[function(e,t){"use strict";cc._RF.push(t,"0bc6cQ737dMiKmLOlxzVHqA","UISign"),cc.Class({extends:cc.Component,properties:{signJsonFile:cc.JsonAsset,baseSignItem:cc.Node,sevenSignItem:cc.Node,signPanel:cc.Node,signBtnPanel:cc.Node,finishBtn:cc.Node},initBy:function(){cc.UISign=this,this.signJson=this.signJsonFile.json,this.isLookAd=!1,cc.pvz.PlayerData.checkAndResetSign(),this.SignData=cc.pvz.PlayerData.getSignData(),this.refreshSignBtn(),this.initUIInfo()},initUIInfo:function(){var e=this;this.signItemList=[this.baseSignItem.getComponent("SignItem")];for(var t=0;t<5;t++){var i=cc.instantiate(this.baseSignItem);i.parent=this.signPanel.children[t+1],this.signItemList.push(i.getComponent("SignItem"))}this.signItemList.push(this.sevenSignItem.getComponent("SignItem"));var o=this.SignData.signDay,a=o%7;this.useSignDay=0==a?7:a;for(var s=function(){var t,i=c+1;t=o<=7?i:100+i;var a=e.signJson.find(function(e){return e.ID==t});e.signItemList[c].initSignItem(i,a,e.useSignDay)},c=0;c<7;c++)s()},refreshSignBtn:function(){this.isRewardSign=this.SignData.isReward,this.signBtnPanel.active=!this.isRewardSign,this.finishBtn.active=this.isRewardSign},onSignLogic:function(e){void 0===e&&(e=!1),cc.pvz.PlayerData.finishSignReward(),this.signItemList[this.useSignDay-1].onGetSignReward(e),this.refreshSignBtn()},onClickSign:function(){this.isLookAd||(this.isRewardSign?cc.UIRoot.showToast("\u4eca\u65e5\u5df2\u7b7e\u5230"):this.onSignLogic(!1))},onClickSignAd:function(){var e=this;this.isLookAd||(this.isRewardSign?cc.UIRoot.showToast("\u4eca\u65e5\u5df2\u7b7e\u5230"):(this.isLookAd=!0,cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["\u53cc\u500d\u7b7e\u5230"],function(t){e.onAdClose(t)})))},onAdClose:function(e){this.isLookAd=!1,e&&this.onSignLogic(!0)},onClickEndSign:function(){cc.popupManager.showToast("\u4eca\u65e5\u5df2\u7b7e\u5230")},onCloseUI:function(){this.isLookAd||cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UITask:[function(e,t){"use strict";cc._RF.push(t,"64a83LjrxpA6o6L3w0S3Z8i","UITask"),cc.TaskPage=cc.Enum({taskPage:1,achievePage:2}),cc.Class({extends:cc.Component,properties:{coinLabel:cc.Label,diamondLabel:cc.Label,boxBgSprite:cc.Sprite,scoreSprite:cc.Sprite,scoreLabel:cc.Label,boxScorePanel:cc.Node,boxSpinePanel:cc.Node,missionProBar:cc.ProgressBar,missionWeekProBar:cc.ProgressBar,missionPanel:cc.Node,missionScroll:cc.ScrollView,missionParent:cc.Node,baseMissionItem:cc.Node,achievePanel:cc.Node,achieveScroll:cc.ScrollView,achieveParent:cc.Node,baseAchieveItem:cc.Node,timesLabel:cc.Label,redTips:[cc.Node],boxPanel:cc.Node,rewardParent:cc.Node},initTimeShow:function(){if(this.isDayMission)this.lastTime=cc.pvz.utils.getTodayLastTimes();else{var e=cc.pvz.utils.getTodayLastTimes(),t=cc.pvz.utils.getCurDayInWeek();this.lastTime=7==t?e:e+86400*(7-t)}this.timesLabel.string=cc.pvz.utils.formatCDTime(this.lastTime),this.schedule(this.refreshTimeShow,1)},refreshTimeShow:function(){this.lastTime--,this.lastTime>0?this.timesLabel.string=cc.pvz.utils.formatCDTime(this.lastTime):this.unschedule(this.refreshTimeShow,this)},onCloseUI:function(){cc.MainControl.updateItemInfo(),cc.RedControl.refreshAllRedTip(),cc.popupManager.removePopup(this)},onToggleChange:function(e,t){var i=parseInt(t);i!=this.curPage&&(this.curPage=i,this["refreshPage"+i]())},initBy:function(e){void 0===e&&(e=1),cc.UITask=this,this.updateItemInfo(),this.curPage=e,this["refreshPage"+e](),this.redTips[0].active=cc.RedControl.onCheckDayMissionRed(),this.redTips[1].active=cc.RedControl.onCheckWeekMissionRed(),this.redTips[2].active=cc.RedControl.onCheckAchieveMissionRed(),this.stageLevel=cc.pvz.PlayerData.getStageLevel()},initBoxInfo:function(){this.scoreNum=cc.pvz.PlayerData.getItemNum(this.isDayMission?cc.pvz.GameConfig.ItemType["\u65e5\u5e38\u4efb\u52a1\u79ef\u5206"]:cc.pvz.GameConfig.ItemType["\u5468\u5e38\u4efb\u52a1\u79ef\u5206"]),this.scoreLabel.string=this.scoreNum,this.missionProBar.node.active=this.isDayMission,this.missionWeekProBar.node.active=!this.isDayMission,this.isDayMission?this.missionProBar.progress=this.scoreNum/this.BoxJson[this.BoxJson.length-1].score:this.missionWeekProBar.progress=this.scoreNum/this.BoxJson[this.BoxJson.length-1].score,cc.pvz.utils.setSpriteFrame(this.boxBgSprite,"uiImage","mission/bg"+(this.isDayMission?1:2)),cc.pvz.utils.setSpriteFrame(this.scoreSprite,"uiImage","item/item"+(this.isDayMission?50:51));for(var e=0;e<this.BoxJson.length;e++){var t;this.boxScorePanel.children[e].getComponent(cc.Label).string=this.BoxJson[e].score,t=(this.isDayMission?cc.pvz.PlayerData.getDayBoxData(this.BoxJson[e].ID).isReward:cc.pvz.PlayerData.getWeekBoxData(this.BoxJson[e].ID).isReward)?3:this.scoreNum>=this.BoxJson[e].score?2:1,this.boxSpinePanel.children[e].getComponent(sp.Skeleton).setAnimation(0,"libao"+t,!0)}},onClickBox:function(e,t){var i=this,o=parseInt(t),a=this.BoxJson[o-1];if((this.isDayMission?cc.pvz.PlayerData.getDayBoxData(a.ID):cc.pvz.PlayerData.getWeekBoxData(a.ID)).isReward)cc.popupManager.showToast("\u5956\u52b1\u5df2\u9886\u53d6");else{var s,c=this.scoreNum>=a.score,n=a.reward,r=Math.floor(n.length/2),h=0;this.rewardData=[];for(var p=0;p<r;p++){var l=n[h],d=n[h+1];l==cc.pvz.GameConfig.ItemType["\u91d1\u5e01"]&&(this.isDayMission?d+=50*(this.stageLevel-1):d+=100*(this.stageLevel-1));var v=cc.pvz.utils.getRewardItem(l,d);this.rewardData.push(v),h+=2}c?(this.boxPanel.active=!1,this.isDayMission?(cc.pvz.PlayerData.finishDayBoxReward(o),this.redTips[0].active=cc.RedControl.onCheckDayMissionRed()):(cc.pvz.PlayerData.finishWeekBoxReward(o),this.redTips[1].active=cc.RedControl.onCheckWeekMissionRed()),this.boxSpinePanel.children[o-1].getComponent(sp.Skeleton).setAnimation(0,"libao3",!0),s=this.isDayMission?cc.pvz.GameConfig.UIFromType["\u65e5\u5e38\u4efb\u52a1"]:cc.pvz.GameConfig.UIFromType["\u5468\u5e38\u4efb\u52a1"],cc.popupManager.popup("mainUI","getrewardUI","UIReward",{ad:!1,scale:!1},this.rewardData,s,function(){i.updateItemInfo()})):o!=this.curBoxId?(this.curBoxId=o,this.boxPanel.active=!0,this.refreshBoxPanelInfo(o)):this.boxPanel.active?this.boxPanel.active=!1:this.boxPanel.active=!0}},refreshBoxPanelInfo:function(e){var t=this.boxSpinePanel.children[e-1].position;this.boxPanel.position=cc.v2(t.x,this.boxPanel.position.y);for(var i=0;i<this.rewardParent.childrenCount;i++){var o=this.rewardParent.children[i];i<this.rewardData.length?(o.active=!0,o.getComponent("RewardItem").initBoxRewardItem(this.rewardData[i])):o.active=!1}},updateItemInfo:function(){var e=cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"]);this.coinLabel.string=cc.pvz.utils.formatItemNum(e);var t=cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["\u94bb\u77f3"]);this.diamondLabel.string=cc.pvz.utils.formatItemNum(t)},getItemEffectPos:function(e){return e===cc.pvz.GameConfig.ItemType["\u94bb\u77f3"]?this.diamondLabel.node.convertToWorldSpaceAR(cc.v2()):this.coinLabel.node.convertToWorldSpaceAR(cc.v2())},refreshPage1:function(){var e=this;this.missionPanel.active=!0,this.achievePanel.active=!1,this.boxPanel.active=!1,this.curBoxId=-1,cc.pvz.PlayerData.checkAndResetDayMission(),this.isDayMission=!0,this.BoxJson=cc.JsonControl.getDayMissionBoxJson(),this.initBoxInfo();var t=cc.JsonControl.getAllDayMissionJson().map(function(e){return e}).sort(function(e,t){var i,o=cc.pvz.PlayerData.getDayMissionData(e.func),a=e.need;i=o.isReward?2:o.pro>=a?0:1;var s=cc.pvz.PlayerData.getDayMissionData(t.func),c=t.need;return i-(s.isReward?2:s.pro>=c?0:1)}),i=t.length,o=i-this.missionParent.childrenCount;if(o>0)for(var a=0;a<o;a++)(n=cc.instantiate(this.baseMissionItem)).parent=this.missionParent;else for(var s=i;s<this.missionParent.childrenCount;s++)this.missionParent.children[s].active=!1;for(var c=0;c<i;c++){var n;(n=this.missionParent.children[c]).active=!0,n.getComponent("TaskItem").initMissionItem(!0,t[c],function(){e.initBoxInfo(),e.redTips[0].active=cc.RedControl.onCheckDayMissionRed()})}this.initTimeShow(),this.missionScroll.scrollToTop(.1)},refreshPage2:function(){var e=this;this.missionPanel.active=!0,this.achievePanel.active=!1,this.boxPanel.active=!1,this.curBoxId=-1,cc.pvz.PlayerData.checkAndResetWeekMission(),this.isDayMission=!1,this.BoxJson=cc.JsonControl.getWeekMissionBoxJson(),this.initBoxInfo();var t=cc.JsonControl.getAllWeekMissionJson().map(function(e){return e}).sort(function(e,t){var i,o=cc.pvz.PlayerData.getWeekMissionData(e.func),a=e.need;i=o.isReward?2:o.pro>=a?0:1;var s=cc.pvz.PlayerData.getWeekMissionData(t.func),c=t.need;return i-(s.isReward?2:s.pro>=c?0:1)}),i=t.length,o=i-this.missionParent.childrenCount;if(o>0)for(var a=0;a<o;a++)(n=cc.instantiate(this.baseMissionItem)).parent=this.missionParent;else for(var s=i;s<this.missionParent.childrenCount;s++)this.missionParent.children[s].active=!1;for(var c=0;c<i;c++){var n;(n=this.missionParent.children[c]).active=!0,n.getComponent("TaskItem").initMissionItem(!1,t[c],function(){e.initBoxInfo(),e.redTips[1].active=cc.RedControl.onCheckWeekMissionRed()})}this.initTimeShow(),this.missionScroll.scrollToTop(.1)},refreshPage3:function(){var e=this;this.missionPanel.active=!1,this.achievePanel.active=!0,this.boxPanel.active=!1,this.achieveList=[],this.AchieveJson=cc.JsonControl.getAllAchieveJson();for(var t=Math.floor(this.AchieveJson[this.AchieveJson.length-1].ID/100),i=[],o=0;o<t;o++)i.push(o+1);i.sort(function(e,t){var i=cc.pvz.PlayerData.getAchieveData(e),o=0;if(i.end)o=2;else{var a=100*e+i.lv,s=cc.JsonControl.getAchieveJson(a),c=cc.pvz.PlayerData.getAchieveProgress(s.func);o=s.need[0]<=c?0:1}var n=cc.pvz.PlayerData.getAchieveData(t),r=0;if(n.end)r=2;else{var h=100*t+n.lv,p=cc.JsonControl.getAchieveJson(h),l=cc.pvz.PlayerData.getAchieveProgress(p.func);r=p.need[0]<=l?0:1}return o-r});var a=t-this.achieveParent.childrenCount;if(a>0)for(var s=0;s<a;s++)cc.instantiate(this.baseAchieveItem).parent=this.achieveParent;else for(var c=t;c<this.achieveParent.childrenCount;c++)this.achieveParent.children[c].active=!1;for(var n=0;n<t;n++)this.achieveParent.children[n].getComponent("TaskItem").initAchieveMissionItem(i[n],function(){e.updateItemInfo(),e.redTips[2].active=cc.RedControl.onCheckAchieveMissionRed()});this.achieveScroll.scrollToTop(.1)}}),cc._RF.pop()},{}],UIToolInfo:[function(e,t){"use strict";cc._RF.push(t,"97621RrM+JH1JL+eygGsZOW","UIToolInfo"),cc.Class({extends:cc.Component,properties:{bgSprites:[cc.Sprite],toolCardNode:cc.Node,attrbibuteIcons:[cc.Sprite],attrNumLabels:[cc.Label],attrNameLabels:[cc.Label],attriNextLabels:[cc.Label],priceLabel:cc.Label,levelUpSpine:sp.Skeleton,lvBtn:cc.Node,maxTipNode:cc.Node,lockTipLabel:cc.Label,lockTipNode:cc.Node,skinBtn:cc.Node,baseSkillNode:cc.Node,skillParentPanel:cc.Node,lvBtnSprites:[cc.Sprite],actionLabel:cc.Label,actionBtnNode:cc.Node},onLoad:function(){this.levelUpSpine.node.active=!1},initBy:function(e,t,i,o){void 0===i&&(i=!1),void 0===o&&(o=null),this.ui=e,this.toolId=t,this.isLock=i,this.callBack=o,this.toolData=cc.pvz.PlayerData.getToolData(this.toolId),this.toolJson=cc.JsonControl.getToolJson(this.toolId),this.inLv=this.toolData.lv,this.toolCardItem=this.toolCardNode.getComponent("ToolCard"),this.toolCardItem.initToolCardItem(this.ui,this.toolId),this.maxTipNode.active=this.toolCardItem.isMaxLv,this.lvBtn.active=!this.isLock&&!this.toolCardItem.isMaxLv,this.lockTipLabel.node.active=this.isLock,this.lockTipLabel.string=cc.pvz.GameConfig.ToolLockTip.replace("$",cc.pvz.GameConfig.ToolLockLevel[this.toolId-1]),this.lockTipNode.active=this.isLock,this.skinBtn.active=!this.isLock,this.actionBtnNode.active=!this.isLock,this.actionBtnNode.active&&(-1==this.toolData.pos?this.actionLabel.string="\u4e0a\u9635":this.actionLabel.string="\u5378\u4e0b");for(var a=0;a<this.bgSprites.length;a++)this.bgSprites[a].setMaterial(0,cc.JsonControl.materialList[this.isLock?1:0]);this.initAttributeInfo(),this.initSkillInfo(),this.toolCardItem.isMaxLv||this.isLock||this.refreshLvInfo(),2==cc.tempGuideIndex&&this.scheduleOnce(this.startGuide,.42)},startGuide:function(){if(2==cc.tempGuideIndex){var e=cc.find("back",this.node),t=cc.MainControl.btnNodeList[2],i=cc.find("btn/battlePanel/btn_start",cc.MainUI.node);cc.guideManager.showGuide(0,[{tip:"\u6d88\u8017\u788e\u7247\u548c\u91d1\u5e01\u80fd\u4f7f\u5361\u76ae\u5df4\u62c9\u53d8\u5f97\u66f4\u5f3a\uff01",focus:this.lvBtn,btn:this.lvBtn.name},{tip:"\u5173\u5361\u4e2d\u83b7\u5f97\u66f4\u591a\u5361\u76ae\u5df4\u62c9\u788e\u7247",focus:e,btn:e.name},{tip:"\u524d\u65b9\u602a\u517d\u4eec\u6b63\u5728\u63a5\u8fd1\uff0c\u8d76\u7d27\u8fc7\u53bb\u770b\u770b\uff01",focus:t,btn:t.name},{tip:"\u8ba9\u602a\u517d\u4eec\u770b\u770b\u4f60\u7684\u5389\u5bb3\uff0c\u5f00\u59cb\u6218\u6597\u5427\uff01",focus:i,btn:i.name}],function(e,t){e?cc.tempGuideIndex=3:1==t&&(cc.player.guide1=1,cc.pvz.PlayerData.onDataChanged())})}},refreshLvInfo:function(){var e=cc.JsonControl.getToolLvUpJson(this.toolData.lv),t=this.toolJson.quality;this.priceCoin=e["coins"+t],this.priceLabel.string=""+this.priceCoin,this.priceFrag=e["sp"+t],this.isEnoughCoin=cc.pvz.PlayerData.isItemEnough(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],this.priceCoin);for(var i=0;i<this.lvBtnSprites.length;i++)this.lvBtnSprites[i].setMaterial(0,cc.JsonControl.materialList[this.isEnoughCoin?0:1])},initSkillInfo:function(){this.baseSkillNode.getComponent("ToolSkillInfo").initSkillInfo(this.toolId,1,this.toolData.lv,this.isLock);for(var e=1;e<5;e++){var t=cc.instantiate(this.baseSkillNode);t.parent=this.skillParentPanel,t.active=!0,t.getComponent("ToolSkillInfo").initSkillInfo(this.toolId,e+1,this.toolData.lv,this.isLock)}},initAttributeInfo:function(){for(var e=0;e<this.attrbibuteIcons.length;e++){var t=this.toolJson["attributetype"+(e+1)];cc.JsonControl.getToolAttriIcon(this.attrbibuteIcons[e],t),this.attrNameLabels[e].string=cc.pvz.GameConfig.ToolAttriNameList[t-1]}for(var i=0;i<this.attrNumLabels.length;i++)this.attrNumLabels[i].string=this.getAttributeNums(i)},getAttributeNums:function(e){var t,i="";switch(t=0==this.toolData.lv?1:this.toolData.lv,e){case 0:i=""+this.toolJson.Atk;break;case 1:if(3==this.toolId||10==this.toolId)if(i=this.toolJson.cdtxt[t-1]+"\u79d2",this.toolJson.cdtxt.length>t){this.attriNextLabels[2].node.active=!0;var o=this.toolJson.cdtxt[t-1]-this.toolJson.cdtxt[t];o=cc.pvz.utils.foramtAttributeNum(o),this.attriNextLabels[2].string="-"+o}else this.attriNextLabels[2].node.active=!1;else i=this.toolJson.cdtxt+(8==this.toolId||6==this.toolId?"\u79d2":""),this.attriNextLabels[2].node.active=!1;break;case 2:case 3:var a=this.toolJson["attributetype"+(e-1)],s=this.toolJson["attribute"+(e-1)],c=0;if(1==s.length)c=s[0],this.attriNextLabels[e-2].node.active=!1;else if(c=s[t-1],s.length>t){var n=s[t]-c;n=cc.pvz.utils.foramtAttributeNum(n),this.attriNextLabels[e-2].node.active=!0,this.attriNextLabels[e-2].string="+"+n+(9==a?"%":"")}else this.attriNextLabels[e-2].node.active=!1;i=c+(9==a?"%":"")}return i},showLvUpSpine:function(){var e=this;this.levelUpSpine.node.active=!0,this.levelUpSpine.setAnimation(0,"zb_sj",!1),this.levelUpSpine.setCompleteListener(function(){e.levelUpSpine.node.active=!1,e.levelUpSpine.setCompleteListener(null)}),cc.butler.playEffect(cc.MainControl.lvUpSound)},refreshLevelUp:function(){this.maxTipNode.active=this.toolCardItem.isMaxLv,this.lvBtn.active=!this.toolCardItem.isMaxLv;for(var e=0;e<this.attrNumLabels.length;e++)this.attrNumLabels[e].string=this.getAttributeNums(e);for(var t=0;t<5;t++)this.skillParentPanel.children[t].getComponent("ToolSkillInfo").initSkillInfo(this.toolId,t+1,this.toolData.lv);this.toolCardItem.isMaxLv||this.refreshLvInfo()},onClickLvUp:function(){var e=this;if(this.isEnoughCoin)if(this.toolCardItem.isEnoughFrag)this.showLvUpSpine(),cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u5347\u7ea7\u4efb\u610f\u88c5\u59071\u6b21"],1),cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u88c5\u5907\u603b\u7b49\u7ea7n"]),cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["\u88c5\u5907\u6700\u9ad8\u7b49\u7ea7\u8fbe\u5230n"]),cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],-this.priceCoin),cc.pvz.PlayerData.updateToolFragCount(this.toolId,-this.priceFrag),cc.pvz.PlayerData.updateToolLv(this.toolId,1),this.toolCardItem.onLvUpRefreshCard(),this.refreshLevelUp(),cc.MainControl.updateItemInfo(),cc.RedControl.refreshAllRedTip();else if(cc.pvz.PlayerData.isHaveAdBuyToolTimes(this.toolId)){var t=cc.pvz.utils.getRewardToolItem(this.toolId,cc.pvz.GameConfig.AdBuyTooldCounts[this.toolJson.quality-2]);cc.popupManager.popup("mainUI","adbuyUI","UIAdBuy",{ad:!1,scale:!0},t,function(){e.toolCardItem.onLvUpRefreshCard()})}else cc.popupManager.showToast("\u788e\u7247\u4e0d\u8db3\uff01");else if(cc.pvz.PlayerData.isHaveAdBuyBankTimes(0)){var i=cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],2500);cc.popupManager.popup("mainUI","adbuyUI","UIAdBuy",{ad:!1,scale:!0},i,function(){e.isEnoughCoin=cc.pvz.PlayerData.isItemEnough(cc.pvz.GameConfig.ItemType["\u91d1\u5e01"],e.priceCoin);for(var t=0;t<e.lvBtnSprites.length;t++)e.lvBtnSprites[t].setMaterial(0,cc.JsonControl.materialList[e.isEnoughCoin?0:1])})}else cc.popupManager.showToast("\u91d1\u5e01\u4e0d\u8db3\uff01")},onClickUpDown:function(){-1==this.toolData.pos?this.ui.onClickUp(this):this.ui.onClickDown(this.toolId),cc.UITool.isChangeArray=!0,this.onCloseUI()},onClickSkin:function(){cc.popupManager.popup("mainUI","plantskin","UIToolSkin",{ad:!1,scale:!0},this.toolId)},onCloseUI:function(){this.inLv!=this.toolData.lv&&(cc.RedControl.onCheckToolLvRed(),cc.RedControl.onCheckBattleRed()),this.callBack&&this.callBack(),cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UIToolSkin:[function(e,t){"use strict";cc._RF.push(t,"d29ff5k0C9OW5XsgTE8XMoO","UIToolSkin"),cc.Class({extends:cc.Component,properties:{skinTipLabl:cc.Label,nameLabel:cc.Label,spine:sp.Skeleton,leftBtn:cc.Node,rightBtn:cc.Node},initBy:function(e){var t=this;this.toolId=e,this.toolJson=cc.JsonControl.getToolJson(this.toolId),this.nameLabel.string=this.toolJson.name,this.maxLv=5;var i=cc.pvz.PlayerData.getToolData(this.toolId);this.modelIndex=cc.pvz.utils.getLevelInterval(i.lv),cc.pvz.utils.useBundleAsset("actors","kapi/hero"+this.toolId,sp.SkeletonData,function(e){t.spine.skeletonData=e,t.showCurPage()})},showCurPage:function(){this.leftBtn.active=this.modelIndex>1,this.rightBtn.active=this.modelIndex<this.maxLv,this.skinTipLabl.string=cc.pvz.GameConfig.ToolSkinTip.replace("$",this.modelIndex),this.spine.setAnimation(0,"stand"+this.modelIndex,!0)},onClickPage:function(e,t){parseInt(t)<0?this.modelIndex--:this.modelIndex++,this.showCurPage()},onCloseUI:function(){cc.popupManager.removePopup(this)}}),cc._RF.pop()},{}],UITool:[function(e,t){"use strict";cc._RF.push(t,"608d17HJiJFJa+OLsyNRs1l","UITool");var i=e("./ToolCard");cc.Class({extends:cc.Component,properties:{topTools:cc.Node,scrollPanel:cc.ScrollView,replaceRoot:cc.Node,baseToolCard:cc.Node,openPanel:cc.Node,openTip:cc.Node,line:cc.Node,baseLockCard:cc.Node,lockPanel:cc.Node,replaceItem:i,lockList:[cc.Node],lockTops:[cc.Sprite]},onLoad:function(){cc.UITool=this,this.scrollPanel.node.active=!0,this.replaceRoot.active=!1},initBy:function(){var e=this;cc.pvz.utils.fadeInBtn(this.node),this.node.active=!0,this.isChangeArray=!1,this.refreshLockArrayShow(),this.initToolItemData(),1==cc.tempGuideIndex&&setTimeout(function(){var t=e.topTools.children[0];cc.guideManager.showGuide(0,[{tip:"\u9009\u62e9\u7ec3\u4e60\u751f",focus:t,btn:"item",y:-200}],function(e){e&&(cc.tempGuideIndex=2)})})},refreshLockArrayShow:function(){this.stageLevel=cc.pvz.PlayerData.getStageLevel(),this.lockList[0].active=this.stageLevel<=cc.pvz.GameConfig.ArrayPlaceOpLv[0],this.lockList[1].active=this.stageLevel<=cc.pvz.GameConfig.ArrayPlaceOpLv[1],this.usePosCount=6,this.stageLevel>cc.pvz.GameConfig.ArrayPlaceOpLv[1]?(this.usePosCount=8,cc.pvz.utils.setSpriteFrame(this.lockTops[1],"uiImage","plant/zwdi"),cc.pvz.utils.setSpriteFrame(this.lockTops[0],"uiImage","plant/zwdi")):this.stageLevel>cc.pvz.GameConfig.ArrayPlaceOpLv[0]&&(this.usePosCount=7,cc.pvz.utils.setSpriteFrame(this.lockTops[0],"uiImage","plant/zwdi"))},initToolItemData:function(){var e=this;this.toPlaceId=-1,this.OpenToolList=[],this.LockToolList=[],this.baseToolCard.active=!1,this.baseLockCard.active=!1;for(var t=new Array(8).fill(-1),i=0;i<cc.pvz.GameConfig.MaxToolCount;i++){var o=i+1;if(cc.pvz.GameConfig.ToolLockLevel[i]<this.stageLevel){var a=cc.player.toolData[o].pos;-1!=a?t[a]=o:this.OpenToolList.push(o)}else this.LockToolList.push(o)}this.baseToolCard.position=cc.Vec2.ZERO,this.topTools.children.forEach(function(i,o){var a=cc.find("item",i);if(-1==t[o])a&&a.destroy();else{if(!a){a=cc.instantiate(e.baseToolCard);var s=e.topTools.children[o];cc.find("black",s).active=!1,a.parent=s,a.active=!0}a.getComponent("ToolCard").initToolCardItem(e,t[o])}}),this.initOpenToolItem(),this.initLockToolItem()},initOpenToolItem:function(){var e=this.OpenToolList.length,t=this.openPanel.childrenCount,i=e-t;if(this.openTip.active=e>0,this.openPanel.active=e>0,!(e<=0))if(i>0){for(var o=0;o<t;o++){var a=this.openPanel.children[o];a.active=!0,a.getComponent("ToolCard").initToolCardItem(this,this.OpenToolList[o])}for(var s=t;s<e;s++){var c=cc.instantiate(this.baseToolCard);c.parent=this.openPanel,c.active=!0,c.getComponent("ToolCard").initToolCardItem(this,this.OpenToolList[s])}}else{for(var n=0;n<e;n++){var r=this.openPanel.children[n];r.active=!0,r.getComponent("ToolCard").initToolCardItem(this,this.OpenToolList[n])}for(var h=e;h<t;h++)this.openPanel.children[h].active=!1}},initLockToolItem:function(){this.line.active=this.LockToolList.length>0;var e=this.LockToolList.length,t=this.lockPanel.childrenCount;if(e-t>0){for(var i=0;i<t;i++){var o=this.lockPanel.children[i];o.active=!0,o.getComponent("ToolLockCard").initToolLockCard(this,this.LockToolList[i])}for(var a=t;a<e;a++){var s=cc.instantiate(this.baseLockCard);s.parent=this.lockPanel,s.active=!0,s.getComponent("ToolLockCard").initToolLockCard(this,this.LockToolList[a])}}else{for(var c=0;c<e;c++){var n=this.lockPanel.children[c];n.active=!0,n.getComponent("ToolLockCard").initToolLockCard(this,this.LockToolList[c])}for(var r=e;r<t;r++)this.lockPanel.children[r].active=!1}},onCloseUI:function(){-1!=this.toPlaceId&&this.onClickCancelUp(),this.node.active=!1},onClickCard:function(e){var t=this;if(-1==this.toPlaceId)cc.popupManager.popup("mainUI","plantInfo","UIToolInfo",{ad:!1,scale:!0},this,e.toolId,!1,function(){e.onLvUpRefreshCard()});else{var i=cc.player.toolData[e.toolId].pos;if(-1!=i){var o=this.replaceItem.node,a=e.node,s=o.convertToWorldSpaceAR(cc.Vec2.ZERO),c=this.node.convertToNodeSpaceAR(s),n=a.convertToWorldSpaceAR(cc.Vec2.ZERO),r=this.node.convertToNodeSpaceAR(n),h=cc.instantiate(o);h.position=c,h.parent=this.node,h.runAction(cc.sequence(cc.moveTo(.24,r),cc.destroySelf(),cc.callFunc(function(){t.putOnByPos(i)}))),this.replaceRoot.active=!1}}},onClickUp:function(e){this.toPlaceId=e.toolId;for(var t=new Set(new Array(this.usePosCount).fill(0).map(function(e,t){return t})),i=0;i<cc.pvz.GameConfig.MaxToolCount;i++){var o=cc.player.toolData[i+1].pos;-1!=o&&t.delete(o)}if(t.size>0){var a=t.values().next().value;this.putOnByPos(a),this.openTip.active=this.openPanel.childrenCount>0,this.openPanel.active=this.openPanel.childrenCount>0}else{this.scrollPanel.node.active=!1,this.replaceRoot.active=!0,this.replaceItem.initToolCardItem(this,e.toolId);for(var s=0;s<this.topTools.childrenCount;s++){var c=this.topTools.children[s];if(6==s&&this.stageLevel<=cc.pvz.GameConfig.ArrayPlaceOpLv[0])break;if(7==s&&this.stageLevel<=cc.pvz.GameConfig.ArrayPlaceOpLv[1])break;c.getComponent(cc.Animation).play("plantputon")}}},onClickCancelUp:function(){this.toPlaceId=-1,this.scrollPanel.node.active=!0,this.replaceRoot.active=!1,this.topTools.children.forEach(function(e){return e.getComponent(cc.Animation).stop()})},putDownToolById:function(e){var t=this.topTools.children.find(function(t){var i=cc.find("item",t);return i&&i.getComponent("ToolCard").toolId==e});cc.find("item",t).parent=this.openPanel,cc.find("black",t).active=!0},putOnByPos:function(e,t){var i=this;if(void 0===t&&(t=!1),-1!=this.toPlaceId&&(console.log(" change array "+e),!(e>=this.usePosCount))){for(var o=0;o<cc.pvz.GameConfig.MaxToolCount;o++)cc.player.toolData[o+1].pos==e&&(cc.player.toolData[o+1].pos=-1,this.putDownToolById(o+1));cc.player.toolData[this.toPlaceId].pos=e,cc.pvz.PlayerData.onDataChanged();var a=this.topTools.children[e];if(!t){var s=this.openPanel.children.find(function(e){return e.getComponent("ToolCard").toolId==i.toPlaceId});s.position=cc.Vec2.ZERO,s.parent=a}cc.find("black",a).active=!1,this.onClickCancelUp()}},onClickDown:function(e){cc.player.toolData[e].pos=-1,cc.pvz.PlayerData.onDataChanged(),this.putDownToolById(e),this.openTip.active=this.openPanel.childrenCount>0,this.openPanel.active=this.openPanel.childrenCount>0},onClickPlace:function(e,t){var i=parseInt(t);this.putOnByPos(i)},onCardDragEnded:function(e,t){var i=this,o=e.node.getBoundingBoxToWorld(),a=this.topTools.getBoundingBoxToWorld();cc.Intersection.rectRect(o,a)&&this.topTools.children.forEach(function(e){if(e.getBoundingBoxToWorld().contains(t)){var o=cc.find("item",e);if(o){var a=o.getComponent("ToolCard"),s=cc.player.toolData[a.toolId].pos;return void i.putOnByPos(s)}}})}}),cc._RF.pop()},{"./ToolCard":"ToolCard"}],WxClubBtn:[function(e,t){"use strict";cc._RF.push(t,"a1950quHwdEz7m80YGWSKH3","WxClubBtn"),cc.Class({extends:cc.Component,properties:{url:""},onLoad:function(){var e=this;cc.sys.platform==cc.sys.WECHAT_GAME&&setTimeout(function(){e.createBtn()})},createBtn:function(){if(cc.popupManager.nonePopupUI())if(cc.sys.platform==cc.sys.WECHAT_GAME)if(this.clubBtn)this.setVisible(!0);else{var e;e=wx.getWindowInfo?wx.getWindowInfo():wx.getSystemInfoSync();var t=cc.view.getViewportRect(),i=this.node.getBoundingBoxToWorld(),o=cc.view.getScaleX();i.x+=t.x/o,i.y+=t.y/o;var a=cc.view.getDevicePixelRatio(),s=o/a,c=cc.view.getScaleY()/a,n={type:"image",image:this.url,style:{left:i.x*s,top:e.windowHeight-(i.y+i.height)*c,width:i.width*s,height:i.height*c}};this.clubBtn=wx.createGameClubButton(n),this.clubBtn.show()}else console.log("createBtn")},setVisible:function(e){e?this.clubBtn?this.clubBtn.show():this.createBtn():this.clubBtn&&this.clubBtn.hide()}}),cc._RF.pop()},{}]},{},["ActLevelItem","Dragable","EffectFly","LevelMap","LevelPlayer","MainControl","MainUI","RedControl","ShopBoxItem","ShopCoinItem","ShopDailyItem","SignItem","TaskItem","ToolCard","ToolLockCard","ToolSkillInfo","UIActLevel","UIActLevelInfo","UIAdBuy","UIAdGame2","UIFund","UIPowerBuy","UIPreGame","UIRankMode","UIReward","UISet","UIShare","UIShop","UIShopBoxBuy","UIShopBoxDetail","UIShopBoxLvUp","UIShopBoxReward","UIShopBoxTip","UIShopBuy","UISign","UITask","UITool","UIToolInfo","UIToolSkin","WxClubBtn"]);