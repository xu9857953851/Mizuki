window.__require=function t(e,n,o){function _(i,c){if(!n[i]){if(!e[i]){var r=i.split("/");if(r=r[r.length-1],!e[r]){var d="function"==typeof __require&&__require;if(!c&&d)return d(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+i+"'")}i=r}var l=n[i]={exports:{}};e[i][0].call(l.exports,function(t){return _(e[i][1][t]||t)},l,l.exports,t,e,n,o)}return n[i].exports}for(var a="function"==typeof __require&&__require,i=0;i<o.length;i++)_(o[i]);return _}({LuckyWheel:[function(t,e,n){"use strict";cc._RF.push(e,"03e9abWTn9Ot6EJeGul3Jpc","LuckyWheel");var o=__extends,_=__decorate;Object.defineProperty(n,"__esModule",{value:!0}),n.LuckyWheel=void 0;var a=t("ChannelManager"),i=t("GameManager"),c=t("GameModule"),r=t("Utils"),d=cc._decorator,l=d.ccclass,s=d.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.close_btn=null,e.rotate_node=null,e.draw_btn=null,e.video_draw_btn=null,e.left_count_lbl=null,e.light_node=null,e}return o(e,t),e.prototype.onEnable=function(){i.gm.channel.show_banner_ad(a.BANNER_AD_TYPE.ALL),this.update_view(),this.rotate_node.rotation=360/i.gm.const.LUCKY_WHEEL_REWARD_ARRAY.length*i.gm.data.lucky_wheel_data.lastRewardIndex},e.prototype.onDisable=function(){i.gm.channel.hide_banner_ad(a.BANNER_AD_TYPE.ALL)},e.prototype.editor_on_button_click_handler=function(t){var e=this,n=this,o=i.gm.data.lucky_wheel_data;t.target==this.close_btn.node?i.gm.ui.async_hide_module(i.gm.const.LuckyWheel):t.target==this.video_draw_btn.node?o.left_lucky_wheel_video_count>0?i.gm.channel.show_video_ad(function(){e.video_draw_btn.interactable=!1,e.close_btn.interactable=!1,r.Utils.set_sprite_state(e.video_draw_btn.node,cc.Sprite.State.GRAY),r.Utils.set_sprite_state(e.close_btn.node,cc.Sprite.State.GRAY),n.draw()},this):i.gm.ui.show_notice("\u6b21\u6570\u4e0d\u8db3"):t.target==this.draw_btn.node&&o.left_lucky_wheel_free_count>0&&(this.draw_btn.interactable=!1,this.close_btn.interactable=!1,this.draw())},e.prototype.update_view=function(){var t=i.gm.data.lucky_wheel_data;this.left_count_lbl.string=cc.js.formatStr("\u514d\u8d39\u62bd\u5956(%d/%d)",t.left_lucky_wheel_video_count,i.gm.const.MAX_LUCKY_WHEEL_VIDEO_COUNT),t.left_lucky_wheel_free_count>0?(this.draw_btn.interactable=!0,this.draw_btn.node.active=!0,this.video_draw_btn.node.active=!1):t.left_lucky_wheel_video_count>0?(this.draw_btn.node.active=!1,this.video_draw_btn.interactable=!0,this.video_draw_btn.node.active=!0,r.Utils.set_sprite_state(this.video_draw_btn.node,cc.Sprite.State.NORMAL)):(this.video_draw_btn.interactable=!1,this.video_draw_btn.node.active=!0,this.draw_btn.node.active=!1),this.close_btn.interactable=!0,r.Utils.set_sprite_state(this.close_btn.node,cc.Sprite.State.NORMAL)},e.prototype.random_index=function(){for(var t=0,e=0,n=0;n<i.gm.const.LUCKY_WHEEL_REWARD_ARRAY.length;n++)e+=i.gm.const.LUCKY_WHEEL_REWARD_ARRAY[n].weight;var o=Math.random()*e,_=0;for(n=0;n<i.gm.const.LUCKY_WHEEL_REWARD_ARRAY.length;n++)if((_+=i.gm.const.LUCKY_WHEEL_REWARD_ARRAY[n].weight)>o){t=n;break}return t},e.prototype.draw=function(){var t=this,e=i.gm.data.lucky_wheel_data,n=360/i.gm.const.LUCKY_WHEEL_REWARD_ARRAY.length,o=this.random_index(),_=360-e.lastRewardIndex*n+1080+o*n;this.light_node.active=!1,this.light_node.opacity=255,this.rotate_node.rotation=e.lastRewardIndex*n,this.rotate_node.runAction(cc.sequence(cc.rotateBy(3.8,_).easing(cc.easeCubicActionOut()),cc.callFunc(function(){t.light_node.active=!0,t.light_node.runAction(cc.sequence(cc.blink(1,10),cc.callFunc(function(){t.light_node.opacity=255;var n=i.gm.const.LUCKY_WHEEL_REWARD_ARRAY[o];if(1==n.type)i.gm.data.warehouse_data.player_add_item(n.id,n.num),i.gm.ui.show_coin_fly(n.id,t.node.convertToWorldSpaceAR(cc.Vec3.ZERO));else if(2==n.type)i.gm.data.warehouse_data.player_add_item(n.id,n.num),(_=i.gm.config.get_row_data("PropConfigData",n.id.toString()))&&i.gm.ui.show_notice(cc.js.formatStr(i.gm.const.TEXT_6,_.name,n.num));else if(3==n.type){var _;i.gm.data.warehouse_data.player_add_item(n.id,n.num),(_=i.gm.config.get_row_data("PropConfigData",n.id.toString()))&&i.gm.ui.show_notice(cc.js.formatStr(i.gm.const.TEXT_6,_.name,n.num))}i.gm.data.lucky_wheel_data.lastRewardIndex=o,e.left_lucky_wheel_free_count>0?e.left_lucky_wheel_free_count--:e.left_lucky_wheel_video_count>0&&e.left_lucky_wheel_video_count--,e.async_write_data(),t.update_view()})))},this)))},_([s(cc.Button)],e.prototype,"close_btn",void 0),_([s(cc.Node)],e.prototype,"rotate_node",void 0),_([s(cc.Button)],e.prototype,"draw_btn",void 0),_([s(cc.Button)],e.prototype,"video_draw_btn",void 0),_([s(cc.Label)],e.prototype,"left_count_lbl",void 0),_([s(cc.Node)],e.prototype,"light_node",void 0),_([l],e)}(c.GameModule);n.LuckyWheel=u,cc._RF.pop()},{ChannelManager:void 0,GameManager:void 0,GameModule:void 0,Utils:void 0}]},{},["LuckyWheel"]);