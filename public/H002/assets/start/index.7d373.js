window.__require=function t(e,a,i){function o(_,r){if(!a[_]){if(!e[_]){var d=_.split("/");if(d=d[d.length-1],!e[d]){var s="function"==typeof __require&&__require;if(!r&&s)return s(d,!0);if(n)return n(d,!0);throw new Error("Cannot find module '"+_+"'")}_=d}var l=a[_]={exports:{}};e[_][0].call(l.exports,function(t){return o(e[_][1][t]||t)},l,l.exports,t,e,a,i)}return a[_].exports}for(var n="function"==typeof __require&&__require,_=0;_<i.length;_++)o(i[_]);return o}({Balloon:[function(t,e,a){"use strict";cc._RF.push(e,"710e2WbY8pGKo+z4melbM1+","Balloon");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.Balloon=void 0;var n=t("GameManager"),_=t("NodePoolItem"),r=cc._decorator,d=r.ccclass,s=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ballon_btn=null,e}return i(e,t),e.prototype.editor_on_button_click_handler=function(t){if(t.target==this.ballon_btn.node){if(n.gm.data.sign_data.balloon_state<=0)return;n.gm.ui.show_panel(n.gm.const.SkyBox),this.node.x=-600}},o([s(cc.Button)],e.prototype,"ballon_btn",void 0),o([d],e)}(_.NodePoolItem);a.Balloon=l,cc._RF.pop()},{GameManager:void 0,NodePoolItem:void 0}],BoxItem:[function(t,e,a){"use strict";cc._RF.push(e,"3f0d2dQ3ntOXaBfNhbb6sA9","BoxItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.BoxItem=void 0;var n=t("Constants"),_=t("GameManager"),r=t("ListViewItem"),d=t("Utils"),s=cc._decorator,l=s.ccclass,c=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.count_lbl=null,e.icon_sprite=null,e.blue_bg_node=null,e.star_part=null,e.lizi_part=null,e.glow_7_sprite=null,e.glow_9_sprite=null,e._is_full=!0,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){var e=this;this._data=t,this.star_part.node.active=!1,this.lizi_part.node.active=!1,this.glow_7_sprite.node.active=!1,this.glow_9_sprite.node.active=!1,this.blue_bg_node.active=!1,this.scheduleOnce(function(){e.update_view()},.2*t.index)},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){_.gm.audio.play_effect("open_box"),this.blue_bg_node.scale=0,this.blue_bg_node.active=!0,this.node.getComponent(cc.Animation).play("item_open",0),this.star_part.node.active=!0,this.lizi_part.node.active=!0,this.glow_7_sprite.node.active=!0,this.glow_9_sprite.node.active=!0,this.star_part.resetSystem(),this.lizi_part.resetSystem(),this._data.id>11e3&&this._data.id<11100?d.Utils.async_set_sprite_frame(this.icon_sprite,n.BundleName.COMMON,"res/show/"+this._data.id):this._data.id>11100&&this._data.id<11200?d.Utils.async_set_sprite_frame(this.icon_sprite,n.BundleName.COMMON,"res/show/"+(this._data.id-100)):d.Utils.async_set_sprite_frame(this.icon_sprite,n.BundleName.COMMON,"res/show/"+this._data.id);var t=_.gm.config.get_row_data("PropConfigData",this._data.id.toString());this.count_lbl.string=t.name+"x"+this._data.count},e.prototype.onDisable=function(){this.icon_sprite.spriteFrame=null,this.count_lbl.string="",this.star_part.stopSystem(),this.lizi_part.stopSystem(),this.node.getComponent(cc.Animation).stop("item_open"),this.unscheduleAllCallbacks()},o([c(cc.Label)],e.prototype,"count_lbl",void 0),o([c(cc.Sprite)],e.prototype,"icon_sprite",void 0),o([c(cc.Node)],e.prototype,"blue_bg_node",void 0),o([c(cc.ParticleSystem)],e.prototype,"star_part",void 0),o([c(cc.ParticleSystem)],e.prototype,"lizi_part",void 0),o([c(cc.Sprite)],e.prototype,"glow_7_sprite",void 0),o([c(cc.Sprite)],e.prototype,"glow_9_sprite",void 0),o([l],e)}(r.ListViewItem);a.BoxItem=p,cc._RF.pop()},{Constants:void 0,GameManager:void 0,ListViewItem:void 0,Utils:void 0}],BuildingItem:[function(t,e,a){"use strict";cc._RF.push(e,"93fe7K1JLxKAIw2M5fljab/","BuildingItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.BuildingItem=void 0;var n=t("Constants"),_=t("GameManager"),r=t("NodePoolItem"),d=t("PolygonButton"),s=t("TiledMapUtils"),l=t("Utils"),c=t("SkillItem"),p=cc._decorator,g=p.ccclass,u=p.property,h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.grid_spr=null,e.arrow_array=[],e.arrow_m_node=null,e.arrow_reverse_m_node=null,e.arrow_n_node=null,e.arrow_reverse_n_node=null,e.building_spr=null,e.building_2_spr=null,e.name_lbl=null,e.hero_spr=null,e.hp_prg=null,e.avatar_node=null,e.hero_btn=null,e.skill_mask_spr=null,e.polygon_btn=null,e.skill_anim=null,e.building_anim=null,e.create_node=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.node.width=s.TiledMapUtils.tile_size.width*this._data.grid_length.x,this.node.height=s.TiledMapUtils.tile_size.height*this._data.grid_length.y,this.polygon_btn.polygon.points[0]=cc.v2(0,0),this.polygon_btn.polygon.points[1]=cc.v2(this.node.width/2,this.node.height/2),this.polygon_btn.polygon.points[2]=cc.v2(0,this.node.height),this.polygon_btn.polygon.points[3]=cc.v2(-this.node.width/2,this.node.height/2),this.avatar_node.position=cc.v3(0,this.building_spr.node.position.y+this.node.height-27),this.hp_prg.node.active=!1,this.hp_prg.node.position=cc.v3(0,this.node.height+10),this.name_lbl.node.position=cc.v3(0,this.node.height+40),l.Utils.async_set_sprite_frame(this.grid_spr,n.BundleName.START,cc.js.formatStr("res/grid/%dx%d",this._data.grid_length.x,this._data.grid_length.y)),this.building_spr.node.opacity=255,this.avatar_node.opacity=255,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.on_touch_start_handler,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.on_touch_move_handler,this),this.node.on(cc.Node.EventType.TOUCH_END,this.on_touch_end_handler,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.on_touch_end_handler,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.on_touch_start_handler,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.on_touch_move_handler,this),this.node.off(cc.Node.EventType.TOUCH_END,this.on_touch_end_handler,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.on_touch_end_handler,this),this.building_anim.node.active=!0},e.prototype.on_touch_start_handler=function(){var t=this;_.gm.data.start_data.is_finger_operation&&this._data.id>0&&this._data.anger>=this._data.max_anger?this.anger_skill():(this._data.is_editing||(this._data.is_editing=!0,_.gm.ui.start.scene.building_mask_node.active=!0,_.gm.ui.start.scene.map_grid_node.active=!0,this.node.parent=_.gm.ui.start.scene.building_mask_node,_.gm.ui.start.scene.building_mask_node.off(cc.Node.EventType.TOUCH_END,this.on_hide_building_mask,this),_.gm.ui.start.scene.building_mask_node.on(cc.Node.EventType.TOUCH_END,this.on_hide_building_mask,this),this.update_view(),this.building_anim.once(cc.Animation.EventType.FINISHED,function(){t._data.is_editing&&t.building_anim.play("building_stay")}),this.building_anim.play("building_open")),_.gm.audio.play_effect("building_select"))},e.prototype.on_hide_building_mask=function(){if(this.building_anim.play("building_close"),_.gm.ui.start.scene.building_mask_node.off(cc.Node.EventType.TOUCH_END,this.on_hide_building_mask,this),_.gm.ui.start.scene.building_mask_node.active=!1,_.gm.ui.start.scene.map_grid_node.active=!1,this._data.color_hex==_.gm.const.GRID_COLOR_RED){this._data.color_hex=_.gm.const.GRID_COLOR_GREEN;var t=s.TiledMapUtils.grid_point_to_tiled_map_point(this._data.origin_point);t=s.TiledMapUtils.tiled_map_point_to_local_point(t);var e=s.TiledMapUtils.tile_size,a=Math.ceil(this.node.width/e.width)*e.height;t=t.sub(cc.v3(0,a)),this.node.position=t}else if(this._data.temp_origin_point){this._data.origin_point=this._data.temp_origin_point,this._data.temp_origin_point=null;var i=[cc.v3(12,10),cc.v3(12,9),cc.v3(13,9),cc.v3(13,10)];if(!_.gm.data.guide_data.is_finish_all)for(var o=0;o<i.length;o++)this._data.origin_point.equals(i[o])&&_.gm.ui.start.scene.guide_grid_node.active&&_.gm.ui.emit("guide_drag_hero_complete")}this._data.is_editing=!1,this.node.parent=_.gm.ui.start.scene.building_parent_node,this.node.zIndex=s.TiledMapUtils.grid_point_to_z_index(this._data.origin_point,this._data.grid_length),this.update_view(),_.gm.audio.play_effect("building_drag"),_.gm.data.start_data.async_write_data()},e.prototype.on_touch_move_handler=function(t){if(0!=this._data.id){var e=this.node.convertToWorldSpaceAR(t.getDelta());if(!(_.gm.ui.start.hero_node.convertToNodeSpaceAR(e).y<=_.gm.ui.start.hero_node.height)){var a=cc.v3(t.getDelta()).add(this.node.position);this.node.position=a,this.check_collision()}}},e.prototype.play_building_create_effect=function(){var t=this;this.building_anim.node.active=!1,0==this.create_node.childrenCount&&_.gm.pool.async_get(n.BundleName.START,"prefabs/building_create_anim",r.NodePoolItem,function(e){if(0==t.create_node.childrenCount){t.create_node.addChild(e.node);var a=e.getComponent(cc.Animation);l.Utils.play_normal_anim(a,"jianzao",function(){_.gm.pool.put(a.node),t.building_anim.node.active=!0,t.building_anim.play("building_open")})}else _.gm.pool.put(e.node)})},e.prototype.check_collision=function(){var t,e=s.TiledMapUtils.tile_size,a=s.TiledMapUtils.map_size,i=this.data.grid_length.x*e.height,o=this.node.position.add(cc.v3(0,i));o=s.TiledMapUtils.local_point_to_tiled_map_point(o),this._data.temp_origin_point=s.TiledMapUtils.tiled_map_point_to_grid_point(o);var n=_.gm.const.GRID_COLOR_GREEN;t:for(var r=0;r<this._data.grid_length.y;r++)for(var d=0;d<this._data.grid_length.x;d++)if((t=cc.v2(this._data.temp_origin_point.x+d,this._data.temp_origin_point.y+r)).y>=0&&t.y<a.height&&t.x>=0&&t.x<a.width){if(s.TiledMapUtils.grid_state_array[t.y][t.x]){n=_.gm.const.GRID_COLOR_RED;break t}for(var l=void 0,c=void 0,p=0;p<_.gm.ui.start.building_item_array.length;p++)if((l=_.gm.ui.start.building_item_array[p])&&l!=this&&(c=l.data,this.check_building_collision(this._data,c))){n=_.gm.const.GRID_COLOR_RED;break t}var g=void 0,u=void 0;for(p=0;p<_.gm.ui.start.trapping_item_array.length;p++)if((g=_.gm.ui.start.trapping_item_array[p])&&(u=g.data)&&this.check_building_collision(this._data,u)){n=_.gm.const.GRID_COLOR_RED;break t}}return n!=this._data.color_hex&&(this._data.color_hex=n,this.draw_bound(n)),n==_.gm.const.GRID_COLOR_RED},e.prototype.check_building_collision=function(t,e){for(var a,i=[],o=[],n=0;n<t.grid_length.y;n++)for(var _=0;_<t.grid_length.x;_++)i.push(cc.v3(t.temp_origin_point.x+_,t.temp_origin_point.y+n));for(n=0;n<e.grid_length.y;n++)for(_=0;_<e.grid_length.x;_++)o.push(cc.v3(e.origin_point.x+_,e.origin_point.y+n));for(var r=0;r<i.length;r++){a=i[r];for(var d=0;d<o.length;d++)if(a.equals(o[d]))return!0}return!1},e.prototype.on_touch_end_handler=function(){if(0!=this._data.id){var t=s.TiledMapUtils.tile_size,e=this.node.position.sub(cc.v3(0,0)),a=Math.ceil(this.node.width/t.width)*t.height,i=e.add(cc.v3(0,a));i=s.TiledMapUtils.local_point_to_tiled_map_point(i),this._data.temp_origin_point=s.TiledMapUtils.tiled_map_point_to_grid_point(i),cc.log(JSON.stringify(this._data.temp_origin_point)),i=s.TiledMapUtils.grid_point_to_tiled_map_point(this._data.temp_origin_point),i=(i=s.TiledMapUtils.tiled_map_point_to_local_point(i)).sub(cc.v3(0,a)),this.node.position=i,_.gm.data.start_data.async_write_data(),this.on_hide_building_mask()}else this.on_hide_building_mask()},e.prototype.update_view=function(){if(this._data.is_editing){this.grid_spr.node.active=!0,this.draw_bound(this._data.color_hex),this.name_lbl.node.active=!0,this.arrow_m_node.active=0!=this._data.id,this.arrow_reverse_m_node.active=0!=this._data.id,this.arrow_n_node.active=0!=this._data.id,this.arrow_reverse_n_node.active=0!=this._data.id;var t=cc.v2(Math.floor(this._data.grid_length.x*s.TiledMapUtils.tile_size.width/4),Math.floor(this._data.grid_length.y*s.TiledMapUtils.tile_size.height/4));this.arrow_m_node.position=cc.v3(t.x,t.y).add(cc.v3(20,-20)),this.arrow_reverse_m_node.position=cc.v3(-t.x,3*t.y).add(cc.v3(-20,20)),this.arrow_n_node.position=cc.v3(-t.x,t.y).add(cc.v3(-20,-20)),this.arrow_reverse_n_node.position=cc.v3(t.x,3*t.y).add(cc.v3(20,20))}else this.grid_spr.node.active=!1,this.name_lbl.node.active=!1,this.arrow_m_node.active=!1,this.arrow_reverse_m_node.active=!1,this.arrow_n_node.active=!1,this.arrow_reverse_n_node.active=!1;if(this._data.id>0){this.avatar_node.active=!this._data.is_editing;var e=_.gm.config.get_row_data("HeroConfigData",this._data.id.toString());this.name_lbl.string=e.name+" LV. "+this._data.lv,this.skill_mask_spr.node.active=!0,this.skill_mask_spr.fillRange=this._data.anger/this._data.max_anger,this.hero_btn.enabled=this._data.anger>=this._data.max_anger,this.hero_spr.node.active=!0,l.Utils.async_set_sprite_frame(this.hero_spr,n.BundleName.START,"res/hero/avatar_"+this._data.id),this.skill_anim.play(this._data.anger>=this._data.max_anger?"hero_attack":"hero_normal"),e.building_id>0&&(l.Utils.async_set_sprite_frame(this.building_spr,n.BundleName.COMMON,cc.js.formatStr("res/building/%d_%d",e.building_id,_.gm.data.start_data.map_id)),l.Utils.async_set_sprite_frame(this.building_2_spr,n.BundleName.COMMON,cc.js.formatStr("res/building/%d_%d",e.building_id,_.gm.data.start_data.map_id)))}else this.name_lbl.string="\u57fa\u5730 LV. "+this._data.lv,l.Utils.async_set_sprite_frame(this.building_spr,n.BundleName.COMMON,cc.js.formatStr("res/building/%d_%d",_.gm.const.HOME_BUILDING_ID,_.gm.data.start_data.map_id)),l.Utils.async_set_sprite_frame(this.building_2_spr,n.BundleName.COMMON,cc.js.formatStr("res/building/%d_%d",_.gm.const.HOME_BUILDING_ID,_.gm.data.start_data.map_id)),this.avatar_node.active=!1,this.skill_mask_spr.node.active=!1,this.hero_spr.node.active=!1,this.hero_spr.spriteFrame=null,this.skill_anim.play("hero_normal");this._data.max_hp>0&&(this.hp_prg.progress=this._data.hp/this._data.max_hp)},e.prototype.draw_bound=function(t){var e=cc.color().fromHEX(t);this.grid_spr.node.color=e;for(var a=0;a<this.arrow_array.length;a++)this.arrow_array[a].node.color=t==_.gm.const.GRID_COLOR_RED?cc.Color.RED:cc.Color.WHITE},e.prototype.reset=function(){},e.prototype.editor_on_button_click_handler=function(t){t.target==this.hero_btn.node&&_.gm.data.start_data.is_finger_operation&&this._data.id>0&&this._data.anger>=this._data.max_anger&&this.anger_skill()},e.prototype.anger_skill=function(){var t=this;if(!(this._data.anger<this._data.max_anger)){var e=this._data,a=_.gm.config.get_row_data("HeroConfigData",e.id.toString()),i=_.gm.config.get_row_data("SkillConfigData",a.skill_id.toString()),o=_.gm.data.start_data.get_attack(this._data),r=_.gm.ui.start.get_single_attack_enemy(this.center_position,i.skill_range,1);if(r.length>0){var d=r[0];_.gm.pool.async_get(n.BundleName.START,"prefabs/skill_item",c.SkillItem,function(e){_.gm.ui.start.scene.skill_parent_node.addChild(e.node,1),_.gm.ui.start.skill_array.push(e),e.play_skill_prepare(d,t,i,function(){t._data.id>0&&_.gm.pool.async_get(n.BundleName.START,"prefabs/skill_item",c.SkillItem,function(e){_.gm.ui.start.scene.skill_parent_node.addChild(e.node),_.gm.ui.start.skill_array.push(e),e.set_anger_skill_target(d,t,o)})})}),this._data.anger=0,this._data.last_attack_time=_.gm.data.total_time,_.gm.data.hero_data.async_write_data(),this.update_view()}}},e.prototype.change_hp=function(t){this._data&&(t>0?this._data.hp+=Math.min(this._data.max_hp-this._data.hp,t):this._data.hp-=Math.min(-t,this._data.hp),this.hp_prg.node.active=!0,this.unschedule(this.hide_hp_bar),this.schedule(this.hide_hp_bar,1,0),this.update_view())},e.prototype.hide_hp_bar=function(){this.hp_prg.node.active=!1},Object.defineProperty(e.prototype,"attack_position",{get:function(){var t=this.hero_spr.node.convertToWorldSpaceAR(cc.Vec3.ZERO);return _.gm.ui.start.scene.building_parent_node.convertToNodeSpaceAR(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center_position",{get:function(){var t=this._data?this._data.grid_length.y/2*s.TiledMapUtils.tile_size.height:this.node.height/2;return this.node.position.add(cc.v3(0,t))},enumerable:!1,configurable:!0}),o([u(cc.Sprite)],e.prototype,"grid_spr",void 0),o([u([cc.Sprite])],e.prototype,"arrow_array",void 0),o([u(cc.Node)],e.prototype,"arrow_m_node",void 0),o([u(cc.Node)],e.prototype,"arrow_reverse_m_node",void 0),o([u(cc.Node)],e.prototype,"arrow_n_node",void 0),o([u(cc.Node)],e.prototype,"arrow_reverse_n_node",void 0),o([u(cc.Sprite)],e.prototype,"building_spr",void 0),o([u(cc.Sprite)],e.prototype,"building_2_spr",void 0),o([u(cc.Label)],e.prototype,"name_lbl",void 0),o([u(cc.Sprite)],e.prototype,"hero_spr",void 0),o([u(cc.ProgressBar)],e.prototype,"hp_prg",void 0),o([u(cc.Node)],e.prototype,"avatar_node",void 0),o([u(cc.Button)],e.prototype,"hero_btn",void 0),o([u(cc.Sprite)],e.prototype,"skill_mask_spr",void 0),o([u(d.PolygonButton)],e.prototype,"polygon_btn",void 0),o([u(cc.Animation)],e.prototype,"skill_anim",void 0),o([u(cc.Animation)],e.prototype,"building_anim",void 0),o([u(cc.Node)],e.prototype,"create_node",void 0),o([g],e)}(r.NodePoolItem);a.BuildingItem=h,cc._RF.pop()},{Constants:void 0,GameManager:void 0,NodePoolItem:void 0,PolygonButton:void 0,SkillItem:"SkillItem",TiledMapUtils:void 0,Utils:void 0}],EnemyHintItem:[function(t,e,a){"use strict";cc._RF.push(e,"c3ba6Gl2o9InLBUEGVvHMH6","EnemyHintItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.EnemyHintItem=void 0;var n=t("GameManager"),_=t("GameObject"),r=cc._decorator,d=r.ccclass,s=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.enemy_hint_lbl=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){var t=this;this.enemy_hint_lbl.string=this._data.toString(),this.unscheduleAllCallbacks(),this.scheduleOnce(function(){t.node.active=!1},n.gm.const.ENEMY_HINT_TIME)},e.prototype.reset=function(){this.enemy_hint_lbl.string="",this.unscheduleAllCallbacks()},o([s(cc.Label)],e.prototype,"enemy_hint_lbl",void 0),o([d],e)}(_.GameObject);a.EnemyHintItem=l,cc._RF.pop()},{GameManager:void 0,GameObject:void 0}],EnemyItem:[function(t,e,a){"use strict";cc._RF.push(e,"3442d5ze7xH2pYqqyKoJMt1","EnemyItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.EnemyItem=void 0;var n=t("Constants"),_=t("ConfigData"),r=t("GameManager"),d=t("GraphicsUtils"),s=t("NodePoolItem"),l=t("TaskManager"),c=t("NumBoomItem"),p=t("NumItem"),g=cc._decorator,u=g.ccclass,h=g.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hp_prg=null,e.enemy_node=null,e.lower_node=null,e.middle_node=null,e.upper_node=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){var t=this;0==this.enemy_node.childrenCount&&r.gm.pool.async_get(n.BundleName.START,"prefabs/enemy_"+this._data.id,s.NodePoolItem,function(e){0==t.enemy_node.childrenCount&&(t.enemy_node.addChild(e.node),t.node.setContentSize(e.node.getContentSize()),t.enemy_node.setContentSize(e.node.getContentSize()),t._anim=e.getComponent(cc.Animation),t.hp_prg.node.active=!0,t.hp_prg.node.position=cc.v3(0,e.node.height+10),t.middle_node.position=cc.v3(0,e.node.height/2),d.GraphicsUtils.draw_circle(t.node,cc.Color.BLACK,cc.Vec3.ZERO,2))}),this._data.max_hp>0&&(this.hp_prg.progress=this._data.hp/this._data.max_hp)},e.prototype.update_angle=function(t){if(t<0?t=t%(2*Math.PI)+2*Math.PI:t>=2*Math.PI&&(t%=2*Math.PI),this._data.walk_angle=t,this._anim&&this._data.id>0){var e="",a=1;t>=0&&t<Math.PI/2?(e="b_walk",a=-1):t>=Math.PI/2&&t<Math.PI?(e="b_walk",a=1):t>=Math.PI&&t<3*Math.PI/2?(e="z_walk",a=1):t>=3*Math.PI/2&&t<2*Math.PI&&(e="z_walk",a=-1),(!this._anim.currentClip||this._anim.currentClip&&this._anim.currentClip.name!=e)&&this._anim.play(e),this._anim.node.scaleX!=a&&(this._anim.node.scaleX=a),this._anim.currentClip&&this._anim.currentClip.speed!=r.gm.data.start_data.speed_scale&&(this._anim.currentClip.speed=r.gm.data.start_data.speed_scale)}},e.prototype.attack=function(){var t=this,e=this._data.walk_angle;if(this._anim&&this._data.id>0){var a="",i="",o=1;e>=0&&e<Math.PI/2?(a="b_attack",i="b_stay",o=-1):e>=Math.PI/2&&e<Math.PI?(a="b_attack",i="b_stay",o=1):e>=Math.PI&&e<3*Math.PI/2?(a="z_attack",i="z_stay",o=1):e>=3*Math.PI/2&&e<2*Math.PI&&(a="z_attack",i="z_stay",o=-1),(!this._anim.currentClip||this._anim.currentClip&&this._anim.currentClip.name!=a)&&(this._anim.once(cc.Animation.EventType.FINISHED,function(){t._anim.play(i)}),this._anim.play(a)),this._anim.node.scaleX!=o&&(this._anim.node.scaleX=o),this._anim.currentClip&&this._anim.currentClip.speed!=r.gm.data.start_data.speed_scale&&(this._anim.currentClip.speed=r.gm.data.start_data.speed_scale)}},e.prototype.unuse=function(){t.prototype.unuse.call(this),r.gm.pool.put_children(this.lower_node),r.gm.pool.put_children(this.middle_node),r.gm.pool.put_children(this.upper_node),r.gm.pool.put_children(this.enemy_node)},e.prototype.change_hp=function(t,e){void 0===e&&(e=0),this._data&&(0==t.id||1==t.id?this._data.hp-=Math.min(t.num,this._data.hp):2==t.id&&(this._data.hp+=Math.min(this._data.max_hp-this._data.hp,t.num)),this.update_view(),this.show_num(t))},e.prototype.show_num=function(t){var e=this;1==t.id?r.gm.pool.async_get(n.BundleName.START,"prefabs/num_boom_item",c.NumBoomItem,function(a){a.data=t,a.node.position=e.node.position.add(cc.v3(0,e.node.height/2+10)),r.gm.ui.start.scene.text_node.addChild(a.node,100)}):r.gm.pool.async_get(n.BundleName.START,"prefabs/num_item",p.NumItem,function(a){a.data=t,a.node.position=e.node.position.add(cc.v3(0,e.node.height/2+10)),r.gm.ui.start.scene.text_node.addChild(a.node,100)})},Object.defineProperty(e.prototype,"hit_position",{get:function(){return this.node.position.add(cc.v3(0,this.node.height/2))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"death_position",{get:function(){return this.node.position},enumerable:!1,configurable:!0}),e.prototype.add_buff_data=function(t){for(var e,a=this._data,i=0;i<a.buff_data_array.length;i++)if((e=a.buff_data_array[i]).id==t.id&&e.start_time!=t.start_time){a.buff_data_array.splice(i,1);break}a.buff_data_array.push(t)},e.prototype.remove_buff_data=function(t){var e=this._data,a=e.buff_data_array.indexOf(t);a>-1&&e.buff_data_array.splice(a,1)},e.prototype.check_enemy_buff=function(t){var e=this._data;if(null!=e){for(var a,i,o=e.buff_data_array.length-1;o>=0;o--)a=e.buff_data_array[o],i=Math.floor((t-a.start_time)/a.valid_time),(a.is_start&&0==i&&0==a.trigger_count||i>a.trigger_count)&&this.buff_change_attribute(a);for(var n=0,_=e.buff_data_array.length-1;_>=0;_--)(a=e.buff_data_array[_]).trigger_count==a.max_trigger_count&&a.is_end?(e.buff_data_array.splice(_,1),n++):a.trigger_count>a.max_trigger_count&&!a.is_end&&(e.buff_data_array.splice(_,1),n++);n>0&&(e.speed_scale=this.get_buff_speed_scale()),this.update_buff_view()}},e.prototype.buff_change_attribute=function(t){var e=this,a=this._data;if(!(null==a||a.hp<=0)){if(t.trigger_count<t.max_trigger_count)if(t.id==_.SkillEffectId.FIRE||t.id==_.SkillEffectId.POISON)this.change_hp(new p.NumItemData(0,t.damage));else if(t.id==_.SkillEffectId.ICE||t.id==_.SkillEffectId.SLOWER||t.id==_.SkillEffectId.DIZZINESS||t.id==_.SkillEffectId.CHARM||t.id==_.SkillEffectId.RETREAT)a.speed_scale=this.get_buff_speed_scale();else if(t.id==_.SkillEffectId.KILL)Math.random()<t.config.trigger_ratio&&this.change_hp(new p.NumItemData(0,a.hp));else if(t.id!=_.SkillEffectId.ADD_ANGER)return void console.error("\u672a\u77e5\u7684buff\u7c7b\u578b");if(t.trigger_count++,this._data.hp<=0){var i=this.death_position;r.gm.pool.async_get(n.BundleName.START,r.gm.const.ENEMY_DEATH_PREFAB_URL,s.NodePoolItem,function(t){var a=t.getComponent(cc.Animation);t.node.position=i,r.gm.ui.start.scene.death_node.addChild(a.node),a.once(cc.Animation.EventType.FINISHED,function(){r.gm.pool.put(a.node)}),a.play(),r.gm.data.warehouse_data.player_add_item(n.RewardIdEnum.GOLD,r.gm.data.start_data.get_gold(e._data.drop_gold)),r.gm.ui.show_coin_fly(n.RewardIdEnum.GOLD,a.node.convertToWorldSpaceAR(cc.Vec3.ZERO)),r.gm.ui.start.update_tab_view(r.gm.ui.start.tab_type)}),r.gm.data.enemy_death_count++,l.TaskManager.instance.checkTask(n.TaskConditionTypeEnum.TASK_CONDITION_KILL_ENEMY_COUNT,1),r.gm.data.enemy_death_count>=r.gm.data.enemy_total_count&&r.gm.ui.start.fight_success();var o=r.gm.ui.start.enemy_alive_array,d=o.indexOf(this);d>-1&&o.splice(d,1),r.gm.pool.put(this.node)}}},e.prototype.get_buff_speed_scale=function(){var t=this._data,e=1;if(t)for(var a=0;a<t.buff_data_array.length;a++)e*=t.buff_data_array[a].speed_scale;return e},e.prototype.update_buff_view=function(){var t=this,e=this._data;if(null!=e)if(e.buff_data_array.length>0){var a=e.buff_data_array[e.buff_data_array.length-1];if(this._loading_buff_data&&this._loading_buff_data.id==a.id)return;for(var i=void 0,o=[].concat(this.upper_node.children,this.middle_node.children,this.lower_node.children),_=o.length-1;_>=0;_--)(i=o[_]).name!=r.gm.const.BUFF_ID_RES_MAP[a.config.skill_effect_id].prefab_name&&r.gm.pool.put(i);var d=r.gm.const.BUFF_ID_RES_MAP[a.config.skill_effect_id].prefab_name;0==o.length&&""!=d&&(this._loading_buff_data=a,r.gm.pool.async_get(n.BundleName.START,"prefabs/effects/"+d,s.NodePoolItem,function(e){var i=t.get_buff_parent_node(a.config);i.childrenCount,t._loading_buff_data&&a.id==t._loading_buff_data.id?(i.addChild(e.node),t._loading_buff_data=null):r.gm.pool.put(e.node)}))}else r.gm.pool.put_children(this.lower_node),r.gm.pool.put_children(this.middle_node),r.gm.pool.put_children(this.upper_node)},e.prototype.get_buff_parent_node=function(t){var e=this.middle_node;switch(t.skill_effect_id){case _.SkillEffectId.FIRE:case _.SkillEffectId.POISON:e=this.middle_node;break;case _.SkillEffectId.DIZZINESS:case _.SkillEffectId.CHARM:e=this.upper_node;break;case _.SkillEffectId.SLOWER:case _.SkillEffectId.ICE:e=this.lower_node}return e},o([h(cc.ProgressBar)],e.prototype,"hp_prg",void 0),o([h(cc.Node)],e.prototype,"enemy_node",void 0),o([h(cc.Node)],e.prototype,"lower_node",void 0),o([h(cc.Node)],e.prototype,"middle_node",void 0),o([h(cc.Node)],e.prototype,"upper_node",void 0),o([u],e)}(s.NodePoolItem);a.EnemyItem=m,cc._RF.pop()},{ConfigData:void 0,Constants:void 0,GameManager:void 0,GraphicsUtils:void 0,NodePoolItem:void 0,NumBoomItem:"NumBoomItem",NumItem:"NumItem",TaskManager:void 0}],FightFail:[function(t,e,a){"use strict";cc._RF.push(e,"b0e1dZa64BDzqJ8P3xMnSTo","FightFail");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.FightFail=void 0;var n=t("ChannelManager"),_=t("Constants"),r=t("TaskData"),d=t("GameManager"),s=t("GameModule"),l=t("ListView"),c=t("Utils"),p=t("NetUtils"),g=cc._decorator,u=g.ccclass,h=g.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.window_anim=null,e.times_spr=null,e.result_reward_list=null,e.video_reward_btn=null,e.video_money_num_lbl=null,e.times_reward_lbl=null,e.reward_btn=null,e.money_num_lbl=null,e.tt_video_reward_btn=null,e.tt_video_money_num_lbl=null,e}return i(e,t),e.prototype.onEnable=function(){d.gm.channel.show_banner_ad(n.BANNER_AD_TYPE.ALL),d.gm.audio.play_effect("fail"),this.window_anim.play(),d.gm.channel.get_channel_name()==n.ChannelManager.TT_GAME?(this.video_reward_btn.node.active=!1,this.tt_video_reward_btn.node.active=!0):(this.video_reward_btn.node.active=!0,this.tt_video_reward_btn.node.active=!1),this.update_view()},e.prototype.update_view=function(){for(var t=d.gm.data.start_data.level_id,e=0,a=Math.max(1,d.gm.data.start_data.level_id-4);a<=t;a++)e+=d.gm.config.get_row_data("LevelConfigData",a.toString()).total_gold;this._base_money=Math.floor(.4*e),this.money_num_lbl.string="+"+this._base_money,this.video_money_num_lbl.string="+"+d.gm.const.FAIL_TIMES_REWARD*this._base_money,this.tt_video_money_num_lbl.string="+"+d.gm.const.FAIL_TIMES_REWARD*this._base_money,this.times_reward_lbl.string=cc.js.formatStr("\u83b7\u5f97%d\u500d\u5956\u52b1",d.gm.const.FAIL_TIMES_REWARD),this._data_array=d.gm.ui.start.random_fight_result_reward(),this.result_reward_list.setData(this._data_array),c.Utils.async_set_sprite_frame(this.times_spr,_.BundleName.START,"res/result/times_"+d.gm.const.FAIL_TIMES_REWARD)},e.prototype.onDisable=function(){d.gm.channel.hide_banner_ad(n.BANNER_AD_TYPE.ALL),d.gm.audio.stop_effect("fail"),this.result_reward_list.reset()},e.prototype.editor_on_button_click_handler=function(t){var e=this;if(t.target==this.reward_btn.node){var a=new r.BoxItemData;a.id=_.RewardIdEnum.GOLD,a.count=this._base_money,d.gm.ui.set_module_args(d.gm.const.ReceiveReward.key,{reward_list:[a],video_times:d.gm.const.FAIL_TIMES_REWARD,callback:function(t){e.get_reward(t)}}),d.gm.ui.show_panel(d.gm.const.ReceiveReward)}else t.target==this.video_reward_btn.node?d.gm.channel.show_video_ad(function(){var t=c.Utils.math_random(!0,0,e._data_array.length),a=e._data_array[t];d.gm.data.warehouse_data.player_add_item(a.id,a.count);var i=e.result_reward_list.getItem(t);d.gm.ui.start.fly_hero_piece(i.node),e.get_reward(d.gm.const.FAIL_TIMES_REWARD),p.ReportData.instance.report_point(17),p.ReportData.instance.report_once_point(717)},this):t.target==this.tt_video_reward_btn.node&&d.gm.channel.show_video_ad(function(){var t=c.Utils.math_random(!0,0,e._data_array.length),a=e._data_array[t];d.gm.data.warehouse_data.player_add_item(a.id,a.count);var i=e.result_reward_list.getItem(t);d.gm.ui.start.fly_hero_piece(i.node),e.get_reward(d.gm.const.FAIL_TIMES_REWARD),p.ReportData.instance.report_point(17),p.ReportData.instance.report_once_point(717)},this)},e.prototype.get_reward=function(t){var e=Math.max(1,d.gm.data.start_data.level_id-4),a=this._base_money*t;d.gm.data.warehouse_data.player_add_item(_.RewardIdEnum.GOLD,a),d.gm.ui.show_coin_fly(_.RewardIdEnum.GOLD,this.money_num_lbl.node.convertToWorldSpaceAR(cc.Vec3.ZERO)),d.gm.data.start_data.last_level_id=d.gm.data.start_data.level_id,d.gm.data.start_data.level_id=e,d.gm.data.start_data.async_write_data(),d.gm.ui.async_hide_module(d.gm.const.FightFail),d.gm.ui.start.fight_reset(),d.gm.ui.start.fight_start()},o([h(cc.Animation)],e.prototype,"window_anim",void 0),o([h(cc.Sprite)],e.prototype,"times_spr",void 0),o([h(l.ListView)],e.prototype,"result_reward_list",void 0),o([h(cc.Button)],e.prototype,"video_reward_btn",void 0),o([h(cc.Label)],e.prototype,"video_money_num_lbl",void 0),o([h(cc.Label)],e.prototype,"times_reward_lbl",void 0),o([h(cc.Button)],e.prototype,"reward_btn",void 0),o([h(cc.Label)],e.prototype,"money_num_lbl",void 0),o([h(cc.Button)],e.prototype,"tt_video_reward_btn",void 0),o([h(cc.Label)],e.prototype,"tt_video_money_num_lbl",void 0),o([u],e)}(s.GameModule);a.FightFail=m,cc._RF.pop()},{ChannelManager:void 0,Constants:void 0,GameManager:void 0,GameModule:void 0,ListView:void 0,NetUtils:void 0,TaskData:void 0,Utils:void 0}],FightSuccess:[function(t,e,a){"use strict";cc._RF.push(e,"aa803pk7jNPaad7hHo+bAvP","FightSuccess");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.FightSuccess=void 0;var n=t("ChannelManager"),_=t("Constants"),r=t("TaskData"),d=t("GameManager"),s=t("GameModule"),l=t("ListView"),c=t("TaskManager"),p=t("Utils"),g=t("NetUtils"),u=cc._decorator,h=u.ccclass,m=u.property,v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.window_anim=null,e.times_spr=null,e.result_reward_list=null,e.video_reward_btn=null,e.tt_video_reward_btn=null,e.video_money_num_lbl=null,e.tt_video_money_num_lbl=null,e.times_reward_lbl=null,e.reward_btn=null,e.money_num_lbl=null,e}return i(e,t),e.prototype.onEnable=function(){d.gm.channel.show_banner_ad(n.BANNER_AD_TYPE.ALL),d.gm.ui.on("module-show",this.on_module_show,this),d.gm.audio.play_effect("success");var t=d.gm.config.get_row_data("LevelConfigData",d.gm.data.start_data.level_id.toString());if(t){if(t.box_reward_array.length>0){for(var e=[],a=void 0,i=0;i<t.box_reward_array.length;i++)if((a=t.box_reward_array[i]).reward_id>0)if(a.reward_id<1e4){var o=d.gm.config.get_row_data_array("PoolConfigData",a.reward_id.toString());d.gm.data.setRandomReward(o,e)}else{var s=new r.BoxItemData;s.id=a.reward_id,s.count=a.reward_value,s.index=e.length,e.push(s)}this.window_anim.once(cc.Animation.EventType.FINISHED,function(){d.gm.ui.set_module_args(d.gm.const.OpenBox.key,{list:e,type:_.StoreTypeEnum.StoreTypeFree}),d.gm.ui.show_panel(d.gm.const.OpenBox)})}var l=void 0;for(i=0;i<t.reward_array.length;i++)(l=t.reward_array[i]).reward_id==_.RewardIdEnum.DIAMOND&&(this._base_money=l.reward_value)}this.window_anim.play(),this.update_view()},e.prototype.onDisable=function(){d.gm.channel.hide_banner_ad(n.BANNER_AD_TYPE.ALL),d.gm.audio.stop_effect("success"),d.gm.ui.off("module-show",this.on_module_show,this)},e.prototype.on_module_show=function(){d.gm.ui.get_top_module()!=d.gm.ui.fight_success&&d.gm.channel.hide_banner_ad(n.BANNER_AD_TYPE.ALL)},e.prototype.update_view=function(){this.money_num_lbl.string="+"+this._base_money,d.gm.channel.get_channel_name()==n.ChannelManager.TT_GAME?(this.tt_video_money_num_lbl.string="+"+d.gm.data.start_data.success_times_reward*this._base_money,this.video_reward_btn.node.active=!1,this.tt_video_reward_btn.node.active=!0):(this.video_money_num_lbl.string="+"+d.gm.data.start_data.success_times_reward*this._base_money,this.times_reward_lbl.string=cc.js.formatStr("\u83b7\u5f97%d\u500d\u5956\u52b1",d.gm.data.start_data.success_times_reward),this.video_reward_btn.node.active=!0,this.tt_video_reward_btn.node.active=!1),this._data_array=d.gm.ui.start.random_fight_result_reward(),this.result_reward_list.setData(this._data_array),p.Utils.async_set_sprite_frame(this.times_spr,_.BundleName.START,"res/result/times_"+d.gm.data.start_data.success_times_reward)},e.prototype.editor_on_button_click_handler=function(t){var e=this;t.target==this.reward_btn.node?(this.next_level(1),d.gm.data.start_data.success_times_reward<d.gm.const.MAX_SUCCESS_TIMES_REWARD&&(d.gm.data.start_data.success_times_reward++,d.gm.data.start_data.async_write_data())):t.target==this.video_reward_btn.node?d.gm.channel.show_video_ad(function(){var t=p.Utils.math_random(!0,0,e._data_array.length),a=e._data_array[t];d.gm.data.warehouse_data.player_add_item(a.id,a.count);var i=e.result_reward_list.getItem(t);d.gm.ui.start.fly_hero_piece(i.node),e.next_level(d.gm.data.start_data.success_times_reward),d.gm.data.start_data.success_times_reward=d.gm.const.MIN_SUCCESS_TIMES_REWARD,g.ReportData.instance.report_point(16),g.ReportData.instance.report_once_point(716)},this):t.target==this.tt_video_reward_btn.node&&d.gm.channel.show_video_ad(function(){var t=p.Utils.math_random(!0,0,e._data_array.length),a=e._data_array[t];d.gm.data.warehouse_data.player_add_item(a.id,a.count);var i=e.result_reward_list.getItem(t);d.gm.ui.start.fly_hero_piece(i.node),e.next_level(d.gm.data.start_data.success_times_reward),d.gm.data.start_data.success_times_reward=d.gm.const.MIN_SUCCESS_TIMES_REWARD,g.ReportData.instance.report_point(16),g.ReportData.instance.report_once_point(716)},this)},e.prototype.next_level=function(t){var e=this;d.gm.channel.trackLevelData(d.gm.data.start_data.level_id.toString(),"reward","0"),d.gm.data.warehouse_data.player_add_item(_.RewardIdEnum.DIAMOND,this._base_money*t),d.gm.ui.show_coin_fly(_.RewardIdEnum.DIAMOND,this.money_num_lbl.node.convertToWorldSpaceAR(cc.Vec3.ZERO));var a=d.gm.config.get_row_data("LevelConfigData",d.gm.data.start_data.level_id.toString());a&&(a.box_reward_array.length>0?(d.gm.data.lucky_wheel_data.left_lucky_wheel_free_count=d.gm.const.MAX_LUCKY_WHEEL_FREE_COUNT,d.gm.data.lucky_wheel_data.left_lucky_wheel_video_count=d.gm.const.MAX_LUCKY_WHEEL_VIDEO_COUNT,d.gm.data.lucky_wheel_data.async_write_data(),d.gm.ui.show_panel(d.gm.const.LuckyWheel),d.gm.ui.on(d.gm.ui.MODULE_HIDE,function t(a){a==d.gm.ui.lucky_wheel&&(d.gm.ui.off(d.gm.ui.MODULE_HIDE,t,e),e.go_next_level())},this)):this.go_next_level())},e.prototype.go_next_level=function(){d.gm.data.start_data.level_id<d.gm.const.MAX_LEVEL_COUNT?(d.gm.ui.async_hide_module(d.gm.const.FightSuccess),d.gm.data.start_data.last_level_id=d.gm.data.start_data.level_id,d.gm.data.start_data.level_id++,c.TaskManager.instance.checkTask(_.TaskConditionTypeEnum.TASK_CONDITION_PASS_LEVEL,1),d.gm.data.start_data.async_write_data(),d.gm.ui.start.fight_reset(),d.gm.ui.start.fight_start()):(d.gm.ui.show_notice("\u5df2\u7ecf\u901a\u5173\u6240\u6709\u5173\u5361"),d.gm.audio.play_effect("error"),d.gm.ui.async_hide_module(d.gm.const.FightSuccess),d.gm.ui.start.fight_reset(),d.gm.ui.start.fight_start())},o([m(cc.Animation)],e.prototype,"window_anim",void 0),o([m(cc.Sprite)],e.prototype,"times_spr",void 0),o([m(l.ListView)],e.prototype,"result_reward_list",void 0),o([m(cc.Button)],e.prototype,"video_reward_btn",void 0),o([m(cc.Button)],e.prototype,"tt_video_reward_btn",void 0),o([m(cc.Label)],e.prototype,"video_money_num_lbl",void 0),o([m(cc.Label)],e.prototype,"tt_video_money_num_lbl",void 0),o([m(cc.Label)],e.prototype,"times_reward_lbl",void 0),o([m(cc.Button)],e.prototype,"reward_btn",void 0),o([m(cc.Label)],e.prototype,"money_num_lbl",void 0),o([h],e)}(s.GameModule);a.FightSuccess=v,cc._RF.pop()},{ChannelManager:void 0,Constants:void 0,GameManager:void 0,GameModule:void 0,ListView:void 0,NetUtils:void 0,TaskData:void 0,TaskManager:void 0,Utils:void 0}],GetMoney:[function(t,e,a){"use strict";cc._RF.push(e,"300d84zyz1HGLzyqlMXOXdK","GetMoney");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.GetMoney=void 0;var n=t("ChannelManager"),_=t("Constants"),r=t("GameManager"),d=t("GameModule"),s=t("Utils"),l=t("NetUtils"),c=cc._decorator,p=c.ccclass,g=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.show_spr=null,e.title_spr=null,e.icon_spr=null,e.count_lbl=null,e.close_btn=null,e.no_thanks_btn=null,e.get_btn=null,e.tt_get_btn=null,e._money_count=0,e}return i(e,t),e.prototype.onEnable=function(){if(this.args=r.gm.ui.get_module_args(r.gm.const.GetMoney.key),this.args.data==_.RewardIdEnum.GOLD){for(var t=r.gm.data.start_data.level_id,e=0,a=Math.max(1,r.gm.data.start_data.level_id-4);a<=t;a++)e+=r.gm.config.get_row_data("LevelConfigData",a.toString()).total_gold;this._money_count=Math.floor(.5*e)}else this.args.data==_.RewardIdEnum.DIAMOND?this._money_count=50:this.args.data==_.RewardIdEnum.PART&&(this._money_count=1e4);this.count_lbl.string="+"+this._money_count,s.Utils.async_set_sprite_frame(this.icon_spr,_.BundleName.START,"res/get_money/icon/"+this.args.data),s.Utils.async_set_sprite_frame(this.title_spr,_.BundleName.START,"res/get_money/title/"+this.args.data),s.Utils.async_set_sprite_frame(this.show_spr,_.BundleName.START,"res/get_money/show/"+this.args.data),r.gm.channel.get_channel_name()==n.ChannelManager.TT_GAME?(this.get_btn.node.active=!1,this.tt_get_btn.node.active=!0):(this.get_btn.node.active=!0,this.tt_get_btn.node.active=!1)},e.prototype.onDisable=function(){this.icon_spr.spriteFrame=null,this.show_spr.spriteFrame=null,this.title_spr.spriteFrame=null,this.count_lbl.string=""},e.prototype.editor_on_button_click_handler=function(t){var e=this;t.target==this.close_btn.node||t.target==this.no_thanks_btn.node?r.gm.ui.async_hide_module(r.gm.const.GetMoney):t.target==this.get_btn.node?r.gm.channel.show_video_ad(function(){r.gm.data.warehouse_data.player_add_item(e.args.data,e._money_count),r.gm.ui.show_coin_fly(e.args.data,e.get_btn.node.convertToWorldSpaceAR(cc.Vec3.ZERO)),r.gm.ui.async_hide_module(r.gm.const.GetMoney),e.args.data==_.RewardIdEnum.DIAMOND?(l.ReportData.instance.report_point(9),l.ReportData.instance.report_once_point(709)):e.args.data==_.RewardIdEnum.GOLD&&(l.ReportData.instance.report_point(14),l.ReportData.instance.report_once_point(714))},this):t.target==this.tt_get_btn.node&&r.gm.channel.show_video_ad(function(){r.gm.data.warehouse_data.player_add_item(e.args.data,e._money_count),r.gm.ui.show_coin_fly(e.args.data,e.get_btn.node.convertToWorldSpaceAR(cc.Vec3.ZERO)),r.gm.ui.async_hide_module(r.gm.const.GetMoney),e.args.data==_.RewardIdEnum.DIAMOND?(l.ReportData.instance.report_point(9),l.ReportData.instance.report_once_point(709)):e.args.data==_.RewardIdEnum.GOLD&&(l.ReportData.instance.report_point(14),l.ReportData.instance.report_once_point(714))},this)},o([g(cc.Sprite)],e.prototype,"show_spr",void 0),o([g(cc.Sprite)],e.prototype,"title_spr",void 0),o([g(cc.Sprite)],e.prototype,"icon_spr",void 0),o([g(cc.Label)],e.prototype,"count_lbl",void 0),o([g(cc.Button)],e.prototype,"close_btn",void 0),o([g(cc.Button)],e.prototype,"no_thanks_btn",void 0),o([g(cc.Button)],e.prototype,"get_btn",void 0),o([g(cc.Button)],e.prototype,"tt_get_btn",void 0),o([p],e)}(d.GameModule);a.GetMoney=u,cc._RF.pop()},{ChannelManager:void 0,Constants:void 0,GameManager:void 0,GameModule:void 0,NetUtils:void 0,Utils:void 0}],HeroItem:[function(t,e,a){"use strict";cc._RF.push(e,"b8147EMhDRNNITU5eHFEb9U","HeroItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.HeroItem=void 0;var n=t("Constants"),_=t("GameManager"),r=t("ListViewItem"),d=t("TaskManager"),s=t("Utils"),l=t("NetUtils"),c=cc._decorator,p=c.ccclass,g=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hero_bg_spr=null,e.color_spr=null,e.hero_spr=null,e.name_lbl=null,e.hero_lock_node=null,e.people_node=null,e.active_condition_lbl=null,e.count_lbl=null,e.money_spr=null,e.money_lbl=null,e.buy_btn=null,e.upgrade_anim=null,e.money_sf_array=[],e.video_btn=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){if(this._data&&this._data.id>0){var t=_.gm.config.get_row_data("HeroConfigData",this._data.id.toString());t&&(this.name_lbl.string=t.name);var e=_.gm.data.warehouse_data.get_item_count(this._data.id)>0;s.Utils.async_set_sprite_frame(this.hero_bg_spr,n.BundleName.START,"res/hero/bg_color_"+this._data.star),s.Utils.async_set_sprite_frame(this.color_spr,n.BundleName.START,"res/hero/avatar_color_"+this._data.star),s.Utils.async_set_sprite_frame(this.hero_spr,n.BundleName.START,"res/hero/avatar_"+this._data.id);var a=_.gm.config.get_row_data("HeroLevelConfigData",this._data.id.toString(),this._data.lv.toString());if(e){this.hero_lock_node.active=!1,this.people_node.active=!0,this.count_lbl.node.active=!0,this.count_lbl.string=_.gm.data.start_data.get_hero_count(this._data.id)+"/"+a.max_num;var i=_.gm.data.start_data.get_hero_count(this._data.id)>=a.max_num;this.count_lbl.node.color=i?cc.Color.RED:cc.Color.WHITE,this.buy_btn.node.active=!i,this.active_condition_lbl.node.active=i,i&&(this.active_condition_lbl.string=cc.js.formatStr("\u82f1\u96c4\u8fbe\u5230%d\u7ea7",a.add_hero_lv)),this.money_lbl.string=a.coin.toString(),this.money_spr.spriteFrame=this.money_sf_array[n.MoneyIndex.GOLD];var o=_.gm.data.start_data.get_all_hero_count(),r=_.gm.data.start_data.get_max_hero_count(),d=_.gm.data.start_data.get_hero_count(this._data.id)<a.max_num;_.gm.data.warehouse_data.gold_num<a.coin&&o<r&&d&&_.gm.data.guide_data.is_finish_all?(this.buy_btn.node.active=!1,this.video_btn.node.active=!0):(this.buy_btn.node.active=!this.active_condition_lbl.node.active,this.video_btn.node.active=!1)}else this.hero_lock_node.active=!0,this.people_node.active=!1,this.count_lbl.node.active=!1,this.active_condition_lbl.node.active=!_.gm.ui.start.is_complete_condition(t),this.active_condition_lbl.node.active&&(this.active_condition_lbl.string=cc.js.formatStr(_.gm.const.HERO_CONDITION_ARRAY[t.condition_type-1],t.condition_value)),this.buy_btn.node.active=_.gm.ui.start.is_complete_condition(t),this.money_lbl.string=t.money.toString(),this.money_spr.spriteFrame=this.money_sf_array[n.MoneyIndex.DIAMOND];this.check_red_point()}},e.prototype.check_red_point=function(){var t=this.buy_btn.node.getChildByName("red");t&&(t.active=_.gm.ui.start.has_hero_item_red(this._data))},e.prototype.reset=function(){},e.prototype.editor_on_button_click_handler=function(t){if(t.target==this.buy_btn.node){var e=_.gm.data.warehouse_data.get_item_count(this._data.id)>0,a=_.gm.config.get_row_data("HeroConfigData",this._data.id.toString()),i=_.gm.config.get_row_data("HeroLevelConfigData",this._data.id.toString(),this._data.lv.toString());if(a&&i)if(e){if(_.gm.data.start_data.get_all_hero_count()>=_.gm.data.start_data.get_max_hero_count())return _.gm.ui.start.show_notice("\u5347\u7ea7\u57fa\u5730\u589e\u52a0\u603b\u4eba\u6570\u4e0a\u9650"),void(_.gm.data.guide_data.is_end&&_.gm.ui.start.update_tab_view(n.HeroTabType.SCIENCE));if(_.gm.data.start_data.get_hero_count(this._data.id)>=i.max_num)return void _.gm.ui.start.show_notice("\u5347\u7ea7\u82f1\u96c4\u53ef\u4ee5\u589e\u52a0\u4eba\u6570\u4e0a\u9650");if(_.gm.data.warehouse_data.gold_num<i.coin)return _.gm.ui.set_module_args(_.gm.const.GetMoney.key,{data:n.RewardIdEnum.GOLD}),void _.gm.ui.show_panel(_.gm.const.GetMoney);_.gm.data.warehouse_data.player_del_item(n.RewardIdEnum.GOLD,i.coin),_.gm.ui.start.create_building_hero(this._data),this._data.has_buy_count++,_.gm.audio.play_effect("building_build"),this.update_view(),_.gm.ui.start.update_hero_num(),_.gm.ui.start.check_hero_red(),s.Utils.play_normal_anim(this.upgrade_anim,"hero_item_up"),_.gm.ui.start.play_people_change_anim()}else{if(_.gm.data.warehouse_data.diamond_num<a.money)return _.gm.ui.set_module_args(_.gm.const.GetMoney.key,{data:n.RewardIdEnum.DIAMOND}),void _.gm.ui.show_panel(_.gm.const.GetMoney);_.gm.data.warehouse_data.player_del_item(n.RewardIdEnum.DIAMOND,a.money),_.gm.data.warehouse_data.player_add_item(this._data.id,1),d.TaskManager.instance.checkTask(n.TaskConditionTypeEnum.TASK_CONDITION_UNLOCK_HERO_COUNT,1),_.gm.data.hero_data.async_write_data(),this.update_view(),_.gm.ui.start.check_hero_red(),_.gm.ui.start.show_notice("\u6fc0\u6d3b\u82f1\u96c4\u6210\u529f"),s.Utils.play_normal_anim(this.upgrade_anim,"hero_item_up"),l.ReportData.instance.report_once_point(this._data.id-11e3+800)}}else if(t.target==this.video_btn.node){var o=this;_.gm.channel.show_video_ad(function(){_.gm.ui.start.create_building_hero(o._data),o._data.has_buy_count++,_.gm.audio.play_effect("building_build"),o.update_view(),_.gm.ui.start.update_hero_num(),_.gm.ui.start.check_hero_red(),s.Utils.play_normal_anim(o.upgrade_anim,"hero_item_up"),_.gm.ui.start.play_people_change_anim()},this)}},o([g(cc.Sprite)],e.prototype,"hero_bg_spr",void 0),o([g(cc.Sprite)],e.prototype,"color_spr",void 0),o([g(cc.Sprite)],e.prototype,"hero_spr",void 0),o([g(cc.Label)],e.prototype,"name_lbl",void 0),o([g(cc.Node)],e.prototype,"hero_lock_node",void 0),o([g(cc.Node)],e.prototype,"people_node",void 0),o([g(cc.Label)],e.prototype,"active_condition_lbl",void 0),o([g(cc.Label)],e.prototype,"count_lbl",void 0),o([g(cc.Sprite)],e.prototype,"money_spr",void 0),o([g(cc.Label)],e.prototype,"money_lbl",void 0),o([g(cc.Button)],e.prototype,"buy_btn",void 0),o([g(cc.Animation)],e.prototype,"upgrade_anim",void 0),o([g([cc.SpriteFrame])],e.prototype,"money_sf_array",void 0),o([g(cc.Button)],e.prototype,"video_btn",void 0),o([p],e)}(r.ListViewItem);a.HeroItem=u,cc._RF.pop()},{Constants:void 0,GameManager:void 0,ListViewItem:void 0,NetUtils:void 0,TaskManager:void 0,Utils:void 0}],HeroPauseItem:[function(t,e,a){"use strict";cc._RF.push(e,"36a14uai2hJlqHhG5ATOyAJ","HeroPauseItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.HeroPauseItem=void 0;var n=t("Constants"),_=t("GameManager"),r=t("ListViewItem"),d=t("Utils"),s=cc._decorator,l=s.ccclass,c=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.color_spr=null,e.hero_spr=null,e.color_bar_spr=null,e.lv_lbl=null,e.damage_lbl=null,e.speed_lbl=null,e.range_lbl=null,e.crit_lbl=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){if(this._data&&this._data.id>0){d.Utils.async_set_sprite_frame(this.hero_spr,n.BundleName.COMMON,"res/hero/"+this._data.id),d.Utils.async_set_sprite_frame(this.color_spr,n.BundleName.COMMON,"res/hero/color_"+this._data.star),d.Utils.async_set_sprite_frame(this.color_bar_spr,n.BundleName.COMMON,"res/hero/color_bar_"+this._data.star),this.lv_lbl.string="LV."+this._data.lv;var t=_.gm.config.get_row_data("HeroLevelConfigData",this._data.id.toString(),this._data.lv.toString()),e=_.gm.config.get_row_data("HeroStarConfigData",this._data.id.toString(),this._data.star.toString());t&&e&&(this.damage_lbl.string=(e.attack+t.attack).toString(),this.speed_lbl.string=e.attack_interval.toString(),this.range_lbl.string=e.attack_range.toString(),this.crit_lbl.string=(100*e.crit).toFixed(1)+"%")}},e.prototype.reset=function(){this.lv_lbl.string="",this.damage_lbl.string="",this.speed_lbl.string="",this.range_lbl.string="",this.crit_lbl.string="",this.hero_spr.spriteFrame=null,this.color_spr.spriteFrame=null,this.color_bar_spr.spriteFrame=null},o([c(cc.Sprite)],e.prototype,"color_spr",void 0),o([c(cc.Sprite)],e.prototype,"hero_spr",void 0),o([c(cc.Sprite)],e.prototype,"color_bar_spr",void 0),o([c(cc.Label)],e.prototype,"lv_lbl",void 0),o([c(cc.Label)],e.prototype,"damage_lbl",void 0),o([c(cc.Label)],e.prototype,"speed_lbl",void 0),o([c(cc.Label)],e.prototype,"range_lbl",void 0),o([c(cc.Label)],e.prototype,"crit_lbl",void 0),o([l],e)}(r.ListViewItem);a.HeroPauseItem=p,cc._RF.pop()},{Constants:void 0,GameManager:void 0,ListViewItem:void 0,Utils:void 0}],HeroStarItem:[function(t,e,a){"use strict";cc._RF.push(e,"c575avmuOdNq4mNHte8NukE","HeroStarItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.HeroStarItem=void 0;var n=t("Constants"),_=t("GameManager"),r=t("ListViewItem"),d=t("Utils"),s=t("NetUtils"),l=cc._decorator,c=l.ccclass,p=l.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hero_bg_spr=null,e.color_spr=null,e.hero_spr=null,e.name_lbl=null,e.hero_lock_node=null,e.star_node_array=[],e.need_lv_lbl=null,e.money_lbl=null,e.upgrade_btn=null,e.money_node=null,e.upgrade_lbl=null,e.upgrade_anim=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){if(this._data&&this._data.id>0){var t=_.gm.config.get_row_data("HeroConfigData",this._data.id.toString());t&&(this.name_lbl.string=t.name);for(var e=0;e<this.star_node_array.length;e++)this.star_node_array[e].active=this._data.star>e;var a=_.gm.data.warehouse_data.get_item_count(this._data.id)>0;d.Utils.async_set_sprite_frame(this.hero_bg_spr,n.BundleName.START,"res/hero/bg_color_"+this._data.star),d.Utils.async_set_sprite_frame(this.color_spr,n.BundleName.START,"res/hero/avatar_color_"+this._data.star),d.Utils.async_set_sprite_frame(this.hero_spr,n.BundleName.START,"res/hero/avatar_"+this._data.id);var i=_.gm.config.get_row_data("HeroStarConfigData",this._data.id.toString(),this._data.star.toString());if(a){this.hero_lock_node.active=!1,this.upgrade_btn.node.active=this._data.lv>=i.need_lv,this.money_node.active=!0;var o=_.gm.data.warehouse_data.get_item_count(i.fragment_id);this.money_lbl.string=o+"/"+i.fragment_num,this.need_lv_lbl.node.active=this._data.lv<i.need_lv,this.need_lv_lbl.node.active&&(this.need_lv_lbl.string=cc.js.formatStr("\u7b49\u7ea7\u8fbe\u5230%d\u7ea7",i.need_lv)),this.upgrade_lbl.string=o<i.fragment_num?"\u524d\u5f80\u9886\u53d6":"\u5347\u661f"}else this.money_node.active=!1,this.hero_lock_node.active=!0,this.upgrade_btn.node.active=!1,this.need_lv_lbl.node.active=!0,this.need_lv_lbl.string=cc.js.formatStr(_.gm.const.HERO_CONDITION_ARRAY[t.condition_type-1],t.condition_value);this.check_red_point()}},e.prototype.check_red_point=function(){var t=this.upgrade_btn.node.getChildByName("red");t&&(t.active=_.gm.ui.start.has_hero_star_item_red(this._data))},e.prototype.reset=function(){},e.prototype.editor_on_button_click_handler=function(t){if(t.target==this.upgrade_btn.node){var e=_.gm.config.get_row_data("HeroStarConfigData",this._data.id.toString(),this._data.star.toString());if(e){if(this._data.lv<e.need_lv)return _.gm.ui.start.show_notice(cc.js.formatStr("\u7b49\u7ea7\u8fbe\u5230%d\u624d\u53ef\u5347\u661f",e.need_lv)),void _.gm.audio.play_effect("error");if(this._data.star>=e.max_star)return _.gm.ui.start.show_notice("\u5df2\u6ee1\u661f"),void _.gm.audio.play_effect("error");if(_.gm.data.warehouse_data.get_item_count(e.fragment_id)<e.fragment_num)return void _.gm.ui.show_panel(_.gm.const.Store);_.gm.data.warehouse_data.player_del_item(e.fragment_id,e.fragment_num),this._data.star++,_.gm.audio.play_effect("upgrade_star");var a=_.gm.data.start_data.hero_map[this._data.id];if(a)for(var i=0;i<a.length;i++)a[i].star=this._data.star;_.gm.data.hero_data.async_write_data(),_.gm.data.start_data.async_write_data(),this.update_view(),_.gm.ui.start.check_hero_red(),d.Utils.play_normal_anim(this.upgrade_anim,"hero_star_item_up"),s.ReportData.instance.report_once_point(10*(this._data.id-11e3+89)+this._data.star)}}},o([p(cc.Sprite)],e.prototype,"hero_bg_spr",void 0),o([p(cc.Sprite)],e.prototype,"color_spr",void 0),o([p(cc.Sprite)],e.prototype,"hero_spr",void 0),o([p(cc.Label)],e.prototype,"name_lbl",void 0),o([p(cc.Node)],e.prototype,"hero_lock_node",void 0),o([p([cc.Node])],e.prototype,"star_node_array",void 0),o([p(cc.Label)],e.prototype,"need_lv_lbl",void 0),o([p(cc.Label)],e.prototype,"money_lbl",void 0),o([p(cc.Button)],e.prototype,"upgrade_btn",void 0),o([p(cc.Node)],e.prototype,"money_node",void 0),o([p(cc.Label)],e.prototype,"upgrade_lbl",void 0),o([p(cc.Animation)],e.prototype,"upgrade_anim",void 0),o([c],e)}(r.ListViewItem);a.HeroStarItem=g,cc._RF.pop()},{Constants:void 0,GameManager:void 0,ListViewItem:void 0,NetUtils:void 0,Utils:void 0}],HeroUpgradeItem:[function(t,e,a){"use strict";cc._RF.push(e,"ca894nsysdPH67G517VXCoT","HeroUpgradeItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.HeroUpgradeItem=void 0;var n=t("Constants"),_=t("GameManager"),r=t("ListViewItem"),d=t("TaskManager"),s=t("Utils"),l=t("NetUtils"),c=cc._decorator,p=c.ccclass,g=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hero_bg_spr=null,e.color_spr=null,e.hero_spr=null,e.name_lbl=null,e.hero_lock_node=null,e.lv_lbl=null,e.money_lbl=null,e.upgrade_btn=null,e.condition_lbl=null,e.upgrade_anim=null,e.video_btn=null,e._last_click_time=0,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){if(this._data&&this._data.id>0){var t=_.gm.config.get_row_data("HeroConfigData",this._data.id.toString());t&&(this.name_lbl.string=t.name);var e=_.gm.data.warehouse_data.get_item_count(this._data.id)>0;s.Utils.async_set_sprite_frame(this.hero_bg_spr,n.BundleName.START,"res/hero/bg_color_"+this._data.star),s.Utils.async_set_sprite_frame(this.color_spr,n.BundleName.START,"res/hero/avatar_color_"+this._data.star),s.Utils.async_set_sprite_frame(this.hero_spr,n.BundleName.START,"res/hero/avatar_"+this._data.id);var a=_.gm.config.get_row_data("HeroLevelConfigData",this._data.id.toString(),this._data.lv.toString());this.lv_lbl.string=this._data.lv<a.max_lv?"Lv."+this._data.lv:"\u5df2\u6ee1\u7ea7",e?(this.hero_lock_node.active=!1,this.upgrade_btn.node.active=_.gm.data.start_data.home_lv>=a.unlock,this.money_lbl.string=a.money.toString(),this.condition_lbl.node.active=_.gm.data.start_data.home_lv<a.unlock,this.condition_lbl.node.active&&(this.condition_lbl.string=cc.js.formatStr("\u57fa\u5730\u8fbe\u5230%d\u7ea7",a.unlock)),_.gm.data.warehouse_data.gold_num<a.money&&_.gm.data.start_data.home_lv>=a.unlock&&this._data.lv<a.max_lv?(this.video_btn.node.active=!0,this.upgrade_btn.node.active=!1):(this.upgrade_btn.node.active=!0,this.video_btn.node.active=!1)):(this.hero_lock_node.active=!0,this.upgrade_btn.node.active=!1,this.condition_lbl.node.active=!0,this.condition_lbl.string=cc.js.formatStr(_.gm.const.HERO_CONDITION_ARRAY[t.condition_type-1],t.condition_value)),this.check_red_point()}},e.prototype.check_red_point=function(){var t=this.upgrade_btn.node.getChildByName("red");t&&(t.active=_.gm.ui.start.has_hero_upgrade_item_red(this._data))},e.prototype.reset=function(){},e.prototype.editor_on_button_click_handler=function(t){if(t.target==this.upgrade_btn.node){if(Date.now()-this._last_click_time<=300)return;this._last_click_time=Date.now();var e=_.gm.config.get_row_data("HeroLevelConfigData",this._data.id.toString(),this._data.lv.toString());if(e){if(_.gm.data.start_data.home_lv<e.unlock)return void _.gm.ui.start.show_notice(cc.js.formatStr("\u57fa\u5730\u8fbe\u5230%d\u7ea7\u624d\u53ef\u7ee7\u7eed\u5347\u7ea7",e.unlock));if(this._data.lv>=e.max_lv)return void _.gm.ui.start.show_notice("\u5df2\u6ee1\u7ea7");if(_.gm.data.warehouse_data.gold_num<e.money)return _.gm.ui.set_module_args(_.gm.const.GetMoney.key,{data:n.RewardIdEnum.GOLD}),void _.gm.ui.show_panel(_.gm.const.GetMoney);_.gm.data.warehouse_data.player_del_item(n.RewardIdEnum.GOLD,e.money),this._data.lv++,d.TaskManager.instance.checkTask(n.TaskConditionTypeEnum.TASK_CONDITION_HERO_LEVEL,1);var a=_.gm.data.start_data.hero_map[this._data.id];if(a)for(var i=0;i<a.length;i++)a[i].lv=this._data.lv;if(_.gm.data.hero_data.async_write_data(),_.gm.data.start_data.async_write_data(),this.update_view(),_.gm.ui.start.check_hero_red(),s.Utils.play_normal_anim(this.upgrade_anim,"hero_item_up"),l.ReportData.instance.report_once_point(1e3*(this._data.id-11e3)+this._data.lv),_.gm.data.start_data.level_id>1&&_.gm.data.guide_data.is_guide_upgrade_tab&&!_.gm.data.guide_data.is_guide_upgrade_hero){_.gm.data.guide_data.is_guide_upgrade_hero=!0,l.ReportData.instance.report_once_point(10090),_.gm.data.guide_data.async_write_data();var o=this.upgrade_btn.node.getChildByName("weak_guide");o&&_.gm.pool.put(o),_.gm.ui.start.check_guide_science()}}}else if(t.target==this.video_btn.node){var r=this;_.gm.channel.show_video_ad(function(){if(_.gm.config.get_row_data("HeroLevelConfigData",r._data.id.toString(),r._data.lv.toString())){r._data.lv++,d.TaskManager.instance.checkTask(n.TaskConditionTypeEnum.TASK_CONDITION_HERO_LEVEL,1);var t=_.gm.data.start_data.hero_map[r._data.id];if(t)for(var e=0;e<t.length;e++)t[e].lv=r._data.lv;if(_.gm.data.hero_data.async_write_data(),_.gm.data.start_data.async_write_data(),r.update_view(),_.gm.ui.start.check_hero_red(),s.Utils.play_normal_anim(r.upgrade_anim,"hero_item_up"),l.ReportData.instance.report_once_point(1e3*(r._data.id-11e3)+r._data.lv),_.gm.data.start_data.level_id>1&&_.gm.data.guide_data.is_guide_upgrade_tab&&!_.gm.data.guide_data.is_guide_upgrade_hero){_.gm.data.guide_data.is_guide_upgrade_hero=!0,l.ReportData.instance.report_once_point(10090),_.gm.data.guide_data.async_write_data();var a=r.upgrade_btn.node.getChildByName("weak_guide");a&&_.gm.pool.put(a),_.gm.ui.start.check_guide_science()}}},this)}},o([g(cc.Sprite)],e.prototype,"hero_bg_spr",void 0),o([g(cc.Sprite)],e.prototype,"color_spr",void 0),o([g(cc.Sprite)],e.prototype,"hero_spr",void 0),o([g(cc.Label)],e.prototype,"name_lbl",void 0),o([g(cc.Node)],e.prototype,"hero_lock_node",void 0),o([g(cc.Label)],e.prototype,"lv_lbl",void 0),o([g(cc.Label)],e.prototype,"money_lbl",void 0),o([g(cc.Button)],e.prototype,"upgrade_btn",void 0),o([g(cc.Label)],e.prototype,"condition_lbl",void 0),o([g(cc.Animation)],e.prototype,"upgrade_anim",void 0),o([g(cc.Button)],e.prototype,"video_btn",void 0),o([p],e)}(r.ListViewItem);a.HeroUpgradeItem=u,cc._RF.pop()},{Constants:void 0,GameManager:void 0,ListViewItem:void 0,NetUtils:void 0,TaskManager:void 0,Utils:void 0}],LevelNumItem:[function(t,e,a){"use strict";cc._RF.push(e,"dc717tV+/BFG5yutzcJfizW","LevelNumItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.LevelNumItem=void 0;var n=t("GameManager"),_=t("GameObject"),r=cc._decorator,d=r.ccclass,s=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.level_black_node=null,e.level_blue_node=null,e.level_arrow_node=null,e.level_box_node=null,e.level_lbl=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){this.level_arrow_node.active=this._data==n.gm.data.start_data.level_id,this.level_black_node.active=this._data<n.gm.data.start_data.level_id,this.level_blue_node.active=this._data>=n.gm.data.start_data.level_id,this.level_lbl.node.color=this._data>=n.gm.data.start_data.level_id?cc.Color.WHITE:cc.color().fromHEX("#ADADAD");var t=n.gm.config.get_row_data("LevelConfigData",this._data.toString());this.level_box_node.active=t&&t.box_reward_array.length>0,this.level_lbl.string=t&&t.box_reward_array.length>0?"":this._data.toString(),this.node.scale=this._data==n.gm.data.start_data.level_id?1.3:1},e.prototype.reset=function(){this.level_lbl.string="",this.level_box_node.active=!1,this.level_blue_node.active=!1,this.level_arrow_node.active=!1},o([s(cc.Node)],e.prototype,"level_black_node",void 0),o([s(cc.Node)],e.prototype,"level_blue_node",void 0),o([s(cc.Node)],e.prototype,"level_arrow_node",void 0),o([s(cc.Node)],e.prototype,"level_box_node",void 0),o([s(cc.Label)],e.prototype,"level_lbl",void 0),o([d],e)}(_.GameObject);a.LevelNumItem=l,cc._RF.pop()},{GameManager:void 0,GameObject:void 0}],NumBoomItem:[function(t,e,a){"use strict";cc._RF.push(e,"0813b4SgtJMbIPEmlY7kxQN","NumBoomItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.NumBoomItem=void 0;var n=t("NodePoolItem"),_=cc._decorator,r=_.ccclass,d=_.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.text_lbl=null,e.boom_anim=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){this.boom_anim.play("baoJi",0),cc.tween(this.node).hide().delay(this._data.delay).show().to(.5,{position:cc.v3(this.node.position.x+60,this.node.position.y+60),opacity:255}).removeSelf().start()},e.prototype.update_view=function(){var t=this._data,e=t.num.toString();1==t.id?e="-"+t.num:console.error("\u4e0d\u652f\u6301\u66b4\u51fb\u4e4b\u5916\u7684\u7c7b\u578b"),this.text_lbl.string=e},e.prototype.reset=function(){this._data=null,this.text_lbl.string="",cc.tween(this.node).stop()},e.prototype.unuse=function(){t.prototype.unuse.call(this),this.reset()},o([d(cc.Label)],e.prototype,"text_lbl",void 0),o([d(cc.Animation)],e.prototype,"boom_anim",void 0),o([r],e)}(n.NodePoolItem);a.NumBoomItem=s,cc._RF.pop()},{NodePoolItem:void 0}],NumItem:[function(t,e,a){"use strict";cc._RF.push(e,"942f4bPv99Htp+skXSLRQZm","NumItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.NumItemData=a.NumItem=void 0;var n=t("GameManager"),_=t("NodePoolItem"),r=cc._decorator,d=r.ccclass,s=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.text_lbl=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){cc.tween(this.node).hide().delay(this._data.delay).show().to(.5,{position:cc.v3(this.node.position.x,this.node.position.y+60),opacity:255}).removeSelf().start()},e.prototype.update_view=function(){var t=this._data,e=t.num.toString();switch(t.id){case 0:e="-"+t.num;break;case 1:e="\u66b4\u51fb -"+t.num;break;case 2:e="+"+t.num;break;default:console.error("NumItem\u4e0d\u5b58\u5728\u6570\u5b57\u7c7b\u578b")}this.text_lbl.node.color=c.NUM_COLOR_ARRAY[t.id],this.text_lbl.string=e},e.prototype.reset=function(){this._data=null,this.text_lbl.string="",cc.tween(this.node).stop()},e.prototype.unuse=function(){t.prototype.unuse.call(this),this.reset()},o([s(cc.Label)],e.prototype,"text_lbl",void 0),o([d],e)}(_.NodePoolItem);a.NumItem=l;var c=function(){function t(t,e,a){void 0===a&&(a=0),this.id=0,this.num=0,this.delay=0,this.id=t,this.num=e,this.delay=a}return t.NUM_COLOR_ARRAY=[n.gm.const.COLOR_RED,n.gm.const.COLOR_RED,cc.Color.GREEN,n.gm.const.COLOR_YELLOW],t}();a.NumItemData=c,cc._RF.pop()},{GameManager:void 0,NodePoolItem:void 0}],OpenBox:[function(t,e,a){"use strict";cc._RF.push(e,"d4ffc/XRIdJQbVr6isjCGFf","OpenBox");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.OpenBox=void 0;var n=t("Constants"),_=t("GameManager"),r=t("GameModule"),d=t("ListView"),s=t("Utils"),l=cc._decorator,c=l.ccclass,p=l.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.order_list=null,e.video_receive_btn=null,e.receive_btn=null,e.box_srite=null,e.box_open_srite=null,e.receive_lbl=null,e.open_animation=null,e.lizi_part=null,e.light_node=null,e._state=!1,e._open_state=!1,e}return i(e,t),e.prototype.onEnable=function(){this._state=!1,this._args=_.gm.ui.get_module_args(_.gm.const.OpenBox.key),this.node.getComponent(cc.Animation).play("openBox_open"),this.light_node.active=!1,this.update_view(),this._open_state=!1},e.prototype.onDisable=function(){this.order_list.reset(),this.node.getComponent(cc.Animation).stop("openBox_open"),this.open_animation.stop("box_open"),this.lizi_part.stopSystem()},e.prototype.update_view=function(t){void 0===t&&(t=!1),this._state?(this.receive_lbl.string="\u76f4\u63a5\u9886\u53d6",this.order_list.setData(this._args.list),this.order_list.scrollToTop(),this.video_receive_btn.node.active=!0):(this.receive_lbl.string="\u5f00  \u542f",this.video_receive_btn.node.active=!1),t||(this.box_open_srite.node.active=!1,s.Utils.async_set_sprite_frame(this.box_srite,n.BundleName.STORE,"res/"+this._args.type)),s.Utils.async_set_sprite_frame(this.box_open_srite,n.BundleName.STORE,"res/1_"+this._args.type)},e.prototype.editor_on_button_click_handler=function(t){var e=this;if(t.target==this.video_receive_btn.node)_.gm.channel.show_video_ad(function(){e.get_reward(2)},this);else if(t.target==this.receive_btn.node)if(this._state)this.get_reward(1);else{if(this._open_state)return;this._open_state=!0,this.open_animation.play("box_open"),this.lizi_part.resetSystem(),this.open_animation.once(cc.Animation.EventType.FINISHED,function(){e._state=!0,e.update_view(!0)}),this.scheduleOnce(function(){e.box_open_srite.node.active=!0,s.Utils.async_set_sprite_frame(e.box_srite,n.BundleName.STORE,"res/1_"+e._args.type)},.33)}},e.prototype.get_reward=function(t){for(var e=0;e<this._args.list.length;++e)_.gm.data.warehouse_data.player_add_item(this._args.list[e].id,this._args.list[e].count*t);_.gm.ui.async_hide_module(_.gm.const.OpenBox)},o([p(d.ListView)],e.prototype,"order_list",void 0),o([p(cc.Button)],e.prototype,"video_receive_btn",void 0),o([p(cc.Button)],e.prototype,"receive_btn",void 0),o([p(cc.Sprite)],e.prototype,"box_srite",void 0),o([p(cc.Sprite)],e.prototype,"box_open_srite",void 0),o([p(cc.Label)],e.prototype,"receive_lbl",void 0),o([p(cc.Animation)],e.prototype,"open_animation",void 0),o([p(cc.ParticleSystem)],e.prototype,"lizi_part",void 0),o([p(cc.Node)],e.prototype,"light_node",void 0),o([c],e)}(r.GameModule);a.OpenBox=g,cc._RF.pop()},{Constants:void 0,GameManager:void 0,GameModule:void 0,ListView:void 0,Utils:void 0}],PropItem:[function(t,e,a){"use strict";cc._RF.push(e,"2c3320lZbtNv7GQbStJ3qhW","PropItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.PropItem=void 0;var n=t("Constants"),_=t("GameManager"),r=t("ListViewItem"),d=t("Utils"),s=cc._decorator,l=s.ccclass,c=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.prop_spr=null,e.count_lbl=null,e.piece_node=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){var t=this._data,e=_.gm.config.get_row_data("PropConfigData",t.id.toString());e&&(d.Utils.async_set_sprite_frame(this.prop_spr,n.BundleName.COMMON,"res/show/"+e.icon_id),this.count_lbl.string=e.name+"x"+t.count,this.piece_node.active=t.id!=e.icon_id)},e.prototype.reset=function(){this._data=null},o([c(cc.Sprite)],e.prototype,"prop_spr",void 0),o([c(cc.Label)],e.prototype,"count_lbl",void 0),o([c(cc.Node)],e.prototype,"piece_node",void 0),o([l],e)}(r.ListViewItem);a.PropItem=p,cc._RF.pop()},{Constants:void 0,GameManager:void 0,ListViewItem:void 0,Utils:void 0}],ReceiveReward:[function(t,e,a){"use strict";cc._RF.push(e,"5ba3axBp3RLcImwTLDWDjzp","ReceiveReward");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.ReceiveReward=void 0;var n=t("GameManager"),_=t("GameModule"),r=t("ListView"),d=t("Utils"),s=cc._decorator,l=s.ccclass,c=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.reward_list=null,e.video_receive_btn=null,e.receive_btn=null,e.video_receive_lbl=null,e.receive_lbl=null,e}return i(e,t),e.prototype.onEnable=function(){this._args=n.gm.ui.get_module_args(n.gm.const.ReceiveReward.key),this.update_view()},e.prototype.onDisable=function(){this.reward_list.reset()},e.prototype.update_view=function(){this.reward_list.setData(this._args.reward_list),this.video_receive_lbl.string=d.Utils.number_to_chinese(this._args.video_times)+"\u500d\u9886\u53d6"},e.prototype.editor_on_button_click_handler=function(t){var e=this;t.target==this.video_receive_btn.node?n.gm.channel.show_video_ad(function(){e.get_reward(e._args.video_times)},this):t.target==this.receive_btn.node&&this.get_reward(1)},e.prototype.get_reward=function(t){n.gm.ui.async_hide_module(n.gm.const.ReceiveReward),this._args.callback&&this._args.callback(t)},o([c(r.ListView)],e.prototype,"reward_list",void 0),o([c(cc.Button)],e.prototype,"video_receive_btn",void 0),o([c(cc.Button)],e.prototype,"receive_btn",void 0),o([c(cc.Label)],e.prototype,"video_receive_lbl",void 0),o([c(cc.Label)],e.prototype,"receive_lbl",void 0),o([l],e)}(_.GameModule);a.ReceiveReward=p,cc._RF.pop()},{GameManager:void 0,GameModule:void 0,ListView:void 0,Utils:void 0}],ResultRewardItem:[function(t,e,a){"use strict";cc._RF.push(e,"2f61cPrV2VKQ7Af21FVgzDP","ResultRewardItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.ResultRewardItem=void 0;var n=t("Constants"),_=t("GameManager"),r=t("ListViewItem"),d=t("Utils"),s=cc._decorator,l=s.ccclass,c=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hero_spr=null,e.name_lbl=null,e.item_anim=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){var e=this;this._data=t;for(var a=0;a<this.node.childrenCount;a++)this.node.children[a].active=!1;this.scheduleOnce(function(){e.update_view()},.2*this._index+.52)},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){for(var t=0;t<this.node.childrenCount;t++)this.node.children[t].active=!0;var e=_.gm.config.get_row_data("PropConfigData",this._data.id.toString());e&&d.Utils.async_set_sprite_frame(this.hero_spr,n.BundleName.COMMON,"res/show/"+e.icon_id),this.name_lbl.string="X"+this._data.count,this.item_anim.play("item_open",0)},e.prototype.onDisable=function(){this.unscheduleAllCallbacks()},o([c(cc.Sprite)],e.prototype,"hero_spr",void 0),o([c(cc.Label)],e.prototype,"name_lbl",void 0),o([c(cc.Animation)],e.prototype,"item_anim",void 0),o([l],e)}(r.ListViewItem);a.ResultRewardItem=p,cc._RF.pop()},{Constants:void 0,GameManager:void 0,ListViewItem:void 0,Utils:void 0}],Scene:[function(t,e,a){"use strict";cc._RF.push(e,"d587cvTf51IOqXGXQ6bYgft","Scene");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.Scene=void 0;var n=t("Constants"),_=t("GameManager"),r=t("GameObject"),d=t("TiledMapUtils"),s=t("Utils"),l=t("BuildingItem"),c=t("TreeItem"),p=t("TreeStaticItem"),g=cc._decorator,u=g.ccclass,h=g.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.map_spr_array=[],e.map_grid_spr_array=[],e.tree_parent_node=null,e.map_grid_node=null,e.building_mask_node=null,e.building_parent_node=null,e.building_item_prefab=null,e.trapping_parent_node=null,e.night_mask_spr=null,e.skill_parent_node=null,e.enemy_parent_node=null,e.text_node=null,e.death_node=null,e.enemy_spawn_array=[],e.guide_enemy_spawn_node=null,e.guide_grid_node=null,e._is_import=!1,e}return i(e,t),e.prototype.onEnable=function(){this.node.on(cc.Node.EventType.TOUCH_MOVE,this.on_touch_move_handler,this)},e.prototype.onDisable=function(){this.node.off(cc.Node.EventType.TOUCH_MOVE,this.on_touch_move_handler,this)},e.prototype.fight_start=function(){var t,e=this;this.night_mask_spr.node.active=_.gm.data.start_data.level_id>2&&_.gm.data.start_data.level_id%2==1,this.night_mask_spr.node.active&&null==this.night_mask_spr.spriteFrame&&s.Utils.async_set_sprite_frame(this.night_mask_spr,n.BundleName.START,"res/night_mask");for(var a=_.gm.data.start_data.map_id,i=0;i<this.map_spr_array.length;i++)t=this.map_spr_array[i],(_.gm.data.guide_data.is_end||0!=i&&3!=i)&&s.Utils.async_set_sprite_frame(t,n.BundleName.START,cc.js.formatStr("res/map/map_%d_%d",a,i));for(i=0;i<this.map_grid_spr_array.length;i++)null==(t=this.map_grid_spr_array[i]).spriteFrame&&s.Utils.async_set_sprite_frame(t,n.BundleName.START,"res/map_grid_"+i);this._is_import&&_.gm.data.start_data.last_map_id==a||(this.tree_parent_node.childrenCount>0&&_.gm.pool.put_children(this.tree_parent_node),s.Utils.async_get_bundle(n.BundleName.START,function(t){t.load(cc.js.formatStr("res/map/map_%d/tiled_map",a),cc.JsonAsset,function(t,a){d.TiledMapUtils.import(cc.Camera.findCamera(e.node),a.json,cc.size(1440,1580),cc.Canvas.instance.node.getContentSize()),e.update_view(),e._is_import?e.scheduleOnce(function(){e.async_load_tree_array()}):e.scheduleOnce(function(){e.async_load_tree_array()},2),e._is_import=!0})}))},e.prototype.async_load_tree_array=function(){for(var t=this,e=function(e){var a=d.TiledMapUtils.tree_static_data_array[e];_.gm.pool.async_get(n.BundleName.START,"prefabs/tree_static_item",p.TreeStaticItem,function(e){e.data=a,t.tree_parent_node.addChild(e.node)})},a=0;a<d.TiledMapUtils.tree_static_data_array.length;a++)e(a);var i=function(e){var a=d.TiledMapUtils.tree_data_array[e];_.gm.pool.async_get(n.BundleName.START,"prefabs/tree_item",c.TreeItem,function(e){e.data=a,t.tree_parent_node.addChild(e.node)})};for(a=0;a<d.TiledMapUtils.tree_data_array.length;a++)i(a)},e.prototype.get_grid_state_array=function(){for(var t,e,a=JSON.parse(JSON.stringify(d.TiledMapUtils.grid_state_array)),i=0;i<_.gm.ui.start.building_item_array.length;i++)if((t=_.gm.ui.start.building_item_array[i])&&t.data)for(var o=(r=t.data).origin_point.y;o<r.origin_point.y+r.grid_length.y;o++)for(var n=r.origin_point.x;n<r.origin_point.x+r.grid_length.x;n++)a[o][n]=!0;for(i=0;i<_.gm.ui.start.trapping_item_array.length;i++){var r;if((e=_.gm.ui.start.trapping_item_array[i])&&e.data)for(o=(r=e.data).origin_point.y;o<r.origin_point.y+r.grid_length.y;o++)for(n=r.origin_point.x;n<r.origin_point.x+r.grid_length.x;n++)a[o][n]=!0}return a},e.prototype.find_space_grid=function(t){for(var e=this.get_grid_state_array(),a=cc.size(Math.floor(d.TiledMapUtils.map_size.width/2),Math.floor(d.TiledMapUtils.map_size.height/2)),i=cc.v3(2,2),o=a.height-1,n=a.width-1;o>=0&&n>=0;o--,n--){for(var _=[],r=a.height-o,s=a.width-n,l=0;l<=r;l++)for(var c=0;c<=s;c++)0==l||l==r?_.push(cc.v3(c+n,l+o).add(i)):0!=c&&c!=s||_.push(cc.v3(c+n,l+o).add(i));for(c=0;c<_.length;c++)if(this.has_space_grid(e,_[c],t))return _[c];cc.log(JSON.stringify(_))}return null},e.prototype.has_space_grid=function(t,e,a){for(var i=e.y;i<e.y+a.y;i++)for(var o=e.x;o<e.x+a.x;o++)if(t[i][o])return!1;return!0},e.prototype.update_view=function(){var t=this,e=_.gm.data.start_data.hero_map;for(var a in e){var i=e[a];if(i&&i.length>0)for(var o=function(e){var a=i[e],o=_.gm.ui.start.find_building_item(a);if(o||_.gm.pool.async_get(n.BundleName.START,"prefabs/building_item",l.BuildingItem,function(e){(o=e).node.name=cc.js.formatStr("building_item_%d_%d",a.id,a.obj_id),_.gm.ui.start.building_item_array.push(e),t.building_parent_node.addChild(e.node)}),o){o.data=a,o.node.zIndex=d.TiledMapUtils.grid_point_to_z_index(a.origin_point,a.grid_length);var r=d.TiledMapUtils.grid_point_to_tiled_map_point(a.origin_point),s=d.TiledMapUtils.tiled_map_point_to_local_point(r),c=d.TiledMapUtils.tile_size,p=a.grid_length.y*c.height;o.node.position=s.sub(cc.v3(0,p))}},r=0;r<i.length;r++)o(r)}},e.prototype.on_touch_move_handler=function(t){if(_.gm.data.guide_data.is_end){var e=cc.v3(t.getDelta()).add(this.node.position),a=d.TiledMapUtils.max_visible_offset;e.x<-a.width?e.x=-a.width:e.x>a.width&&(e.x=a.width),e.y<-a.height?e.y=-a.height:e.y>a.height&&(e.y=a.height),this.node.position=e,this.night_mask_spr.node.position=e.mul(-1),_.gm.ui.map_drag_node.position=e}},o([h([cc.Sprite])],e.prototype,"map_spr_array",void 0),o([h([cc.Sprite])],e.prototype,"map_grid_spr_array",void 0),o([h(cc.Node)],e.prototype,"tree_parent_node",void 0),o([h(cc.Node)],e.prototype,"map_grid_node",void 0),o([h(cc.Node)],e.prototype,"building_mask_node",void 0),o([h(cc.Node)],e.prototype,"building_parent_node",void 0),o([h(cc.Prefab)],e.prototype,"building_item_prefab",void 0),o([h(cc.Node)],e.prototype,"trapping_parent_node",void 0),o([h(cc.Sprite)],e.prototype,"night_mask_spr",void 0),o([h(cc.Node)],e.prototype,"skill_parent_node",void 0),o([h(cc.Node)],e.prototype,"enemy_parent_node",void 0),o([h(cc.Node)],e.prototype,"text_node",void 0),o([h(cc.Node)],e.prototype,"death_node",void 0),o([h([cc.Node])],e.prototype,"enemy_spawn_array",void 0),o([h(cc.Node)],e.prototype,"guide_enemy_spawn_node",void 0),o([h(cc.Node)],e.prototype,"guide_grid_node",void 0),o([u],e)}(r.GameObject);a.Scene=m,cc._RF.pop()},{BuildingItem:"BuildingItem",Constants:void 0,GameManager:void 0,GameObject:void 0,TiledMapUtils:void 0,TreeItem:"TreeItem",TreeStaticItem:"TreeStaticItem",Utils:void 0}],ScienceItem:[function(t,e,a){"use strict";cc._RF.push(e,"6bf073WMRRDVpQ8J9PXT0av","ScienceItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.ScienceItem=void 0;var n=t("Constants"),_=t("ConfigData"),r=t("GameManager"),d=t("ListViewItem"),s=t("TaskManager"),l=t("Utils"),c=t("NetUtils"),p=t("TextItem"),g=cc._decorator,u=g.ccclass,h=g.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.science_spr=null,e.name_lbl=null,e.lock_node=null,e.lv_lbl=null,e.money_lbl=null,e.upgrade_btn=null,e.condition_lbl=null,e.add_people_node=null,e.add_people_lbl=null,e.upgrade_anim=null,e.video_btn=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){if(this._data&&this._data.id>0){var t=r.gm.config.get_row_data("ScienceConfigData",this._data.id.toString(),this._data.lv.toString());t&&(this._data.id==_.ScienceType.HOME?(this.name_lbl.string=t.name,this.upgrade_btn.node.active=!0):(this.name_lbl.string=t.name+cc.js.formatStr(" +%d%",t.value/100),this.upgrade_btn.node.active=!1),this.lock_node.active=!1,this.condition_lbl.node.active=!1,this.money_lbl.string=t.money_num.toString(),l.Utils.async_set_sprite_frame(this.science_spr,n.BundleName.COMMON,"res/science/"+this._data.id),this.lv_lbl.string=this._data.lv<t.max_lv?"Lv."+this._data.lv:"\u5df2\u6ee1\u7ea7",this._data.id==_.ScienceType.HOME&&this._data.lv<t.max_lv?(this.add_people_node.active=!0,this.add_people_lbl.string=cc.js.formatStr("%d\u7ea7",t.add_persons-this._data.lv)):this.add_people_node.active=!1,this._data.lv>=t.max_lv?this.video_btn.node.active=!1:r.gm.data.warehouse_data.gold_num<t.money_num?this.video_btn.node.active=!0:this.video_btn.node.active=!1),this.check_red_point()}},e.prototype.check_red_point=function(){var t=this.upgrade_btn.node.getChildByName("red");t&&(t.active=r.gm.ui.start.has_science_item_red(this._data))},e.prototype.reset=function(){},e.prototype.editor_on_button_click_handler=function(t){var e=r.gm.config.get_row_data("ScienceConfigData",this._data.id.toString(),this._data.lv.toString());if(t.target==this.upgrade_btn.node){if(e){if(this._data.lv>=e.max_lv)return void r.gm.ui.start.show_notice("\u5df2\u6ee1\u7ea7");if(r.gm.data.warehouse_data.gold_num<e.money_num)return r.gm.ui.set_module_args(r.gm.const.GetMoney.key,{data:n.RewardIdEnum.GOLD}),void r.gm.ui.show_panel(r.gm.const.GetMoney);r.gm.data.warehouse_data.player_del_item(n.RewardIdEnum.GOLD,e.money_num);for(var a=0;a<r.gm.data.start_data.science_data_array.length;a++)r.gm.data.start_data.science_data_array[a].lv++;if(this._data.lv>=e.add_persons&&r.gm.ui.start.play_people_change_anim(),this._data.id==_.ScienceType.HOME&&(r.gm.data.start_data.home_building_data.lv=this._data.lv),r.gm.data.start_data.async_write_data(),r.gm.ui.start.update_tab_view(n.HeroTabType.SCIENCE),r.gm.ui.start.check_hero_red(),l.Utils.play_normal_anim(this.upgrade_anim,"hero_item_up"),c.ReportData.instance.report_once_point(1e3*(this._data.id+19)+this._data.lv),this._data.id==_.ScienceType.HOME&&(s.TaskManager.instance.checkTask(n.TaskConditionTypeEnum.TASK_CONDITION_BASE_BUILDING_LEVEL,1),r.gm.data.start_data.level_id>1&&r.gm.data.guide_data.is_guide_upgrade_tab&&r.gm.data.guide_data.is_guide_upgrade_hero&&r.gm.data.guide_data.is_guide_science_tab&&!r.gm.data.guide_data.is_guide_science_home)){r.gm.data.guide_data.is_guide_science_home=!0,c.ReportData.instance.report_once_point(10110),r.gm.data.guide_data.async_write_data();var i=this.upgrade_btn.node.getChildByName("weak_guide");i&&r.gm.pool.put(i)}var o=function(t){var e=r.gm.data.start_data.science_data_array[t];r.gm.pool.async_get(n.BundleName.START,"prefabs/text_item",p.TextItem,function(a){var i=r.gm.config.get_row_data("ScienceConfigData",e.id.toString(),e.lv.toString());if(i){var o=i.name+cc.js.formatStr(" +%d%",i.value/100);a.data=new p.TextItemData(o,cc.v3(0,200),cc.Color.GREEN,.2*(t-1));var _=r.gm.ui.get_layer_node(n.LayerType.DRAG),d=r.gm.ui.start.text_start_node.convertToWorldSpaceAR(cc.Vec3.ZERO),s=_.convertToNodeSpaceAR(d);a.node.position=s,_.addChild(a.node)}else r.gm.pool.put(a.node)})};for(a=1;a<r.gm.data.start_data.science_data_array.length;a++)o(a)}}else if(t.target==this.video_btn.node){var d=this;r.gm.channel.show_video_ad(function(){for(var t=0;t<r.gm.data.start_data.science_data_array.length;t++)r.gm.data.start_data.science_data_array[t].lv++;if(d._data.lv>=e.add_persons&&r.gm.ui.start.play_people_change_anim(),d._data.id==_.ScienceType.HOME&&(r.gm.data.start_data.home_building_data.lv=d._data.lv),r.gm.data.start_data.async_write_data(),r.gm.ui.start.update_tab_view(n.HeroTabType.SCIENCE),r.gm.ui.start.check_hero_red(),l.Utils.play_normal_anim(d.upgrade_anim,"hero_item_up"),c.ReportData.instance.report_once_point(1e3*(d._data.id+19)+d._data.lv),d._data.id==_.ScienceType.HOME&&(s.TaskManager.instance.checkTask(n.TaskConditionTypeEnum.TASK_CONDITION_BASE_BUILDING_LEVEL,1),r.gm.data.start_data.level_id>1&&r.gm.data.guide_data.is_guide_upgrade_tab&&r.gm.data.guide_data.is_guide_upgrade_hero&&r.gm.data.guide_data.is_guide_science_tab&&!r.gm.data.guide_data.is_guide_science_home)){r.gm.data.guide_data.is_guide_science_home=!0,c.ReportData.instance.report_once_point(10110),r.gm.data.guide_data.async_write_data();var a=d.upgrade_btn.node.getChildByName("weak_guide");a&&r.gm.pool.put(a)}var i=function(t){var e=r.gm.data.start_data.science_data_array[t];r.gm.pool.async_get(n.BundleName.START,"prefabs/text_item",p.TextItem,function(a){var i=r.gm.config.get_row_data("ScienceConfigData",e.id.toString(),e.lv.toString());if(i){var o=i.name+cc.js.formatStr(" +%d%",i.value/100);a.data=new p.TextItemData(o,cc.v3(0,200),cc.Color.GREEN,.2*(t-1));var _=r.gm.ui.get_layer_node(n.LayerType.DRAG),d=r.gm.ui.start.text_start_node.convertToWorldSpaceAR(cc.Vec3.ZERO),s=_.convertToNodeSpaceAR(d);a.node.position=s,_!=a.node.parent&&_.addChild(a.node)}else r.gm.pool.put(a.node)})};for(t=1;t<r.gm.data.start_data.science_data_array.length;t++)i(t)},this)}},o([h(cc.Sprite)],e.prototype,"science_spr",void 0),o([h(cc.Label)],e.prototype,"name_lbl",void 0),o([h(cc.Node)],e.prototype,"lock_node",void 0),o([h(cc.Label)],e.prototype,"lv_lbl",void 0),o([h(cc.Label)],e.prototype,"money_lbl",void 0),o([h(cc.Button)],e.prototype,"upgrade_btn",void 0),o([h(cc.Label)],e.prototype,"condition_lbl",void 0),o([h(cc.Node)],e.prototype,"add_people_node",void 0),o([h(cc.Label)],e.prototype,"add_people_lbl",void 0),o([h(cc.Animation)],e.prototype,"upgrade_anim",void 0),o([h(cc.Button)],e.prototype,"video_btn",void 0),o([u],e)}(d.ListViewItem);a.ScienceItem=m,cc._RF.pop()},{ConfigData:void 0,Constants:void 0,GameManager:void 0,ListViewItem:void 0,NetUtils:void 0,TaskManager:void 0,TextItem:"TextItem",Utils:void 0}],ShowTrap:[function(t,e,a){"use strict";cc._RF.push(e,"a5ed4srGshHr7gDyoQ8ma5q","ShowTrap");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.ShowTrap=void 0;var n=t("Constants"),_=t("GameManager"),r=t("GameModule"),d=t("Utils"),s=cc._decorator,l=s.ccclass,c=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.trap_sprite=null,e.name_lbl=null,e.intro_lbl=null,e.title1_node=null,e.title2_node=null,e}return i(e,t),e.prototype.onEnable=function(){this._args=_.gm.ui.get_module_args(_.gm.const.ShowTrap.key),this.update_view()},e.prototype.update_view=function(){var t=_.gm.config.get_row_data("PropConfigData",this._args.id+"");this.name_lbl.string=t.name;var e=_.gm.config.get_row_data("TrapConfigData",this._args.id+"","1");this.intro_lbl.string=e.desc,d.Utils.async_set_sprite_frame(this.trap_sprite,n.BundleName.COMMON,"res/show/"+this._args.id),this.title1_node.active=!this._args.isNew,this.title2_node.active=this._args.isNew},e.prototype.editor_on_button_click_handler=function(){_.gm.ui.async_hide_module(_.gm.const.ShowTrap)},o([c(cc.Sprite)],e.prototype,"trap_sprite",void 0),o([c(cc.Label)],e.prototype,"name_lbl",void 0),o([c(cc.Label)],e.prototype,"intro_lbl",void 0),o([c(cc.Node)],e.prototype,"title1_node",void 0),o([c(cc.Node)],e.prototype,"title2_node",void 0),o([l],e)}(r.GameModule);a.ShowTrap=p,cc._RF.pop()},{Constants:void 0,GameManager:void 0,GameModule:void 0,Utils:void 0}],SkillItem:[function(t,e,a){"use strict";cc._RF.push(e,"2d42aA2QQ5NzqMieheSb+PF","SkillItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.SkillItemData=a.SkillItem=void 0;var n=t("NodePoolItem"),_=t("GameManager"),r=t("ConfigData"),d=t("Constants"),s=t("NumItem"),l=t("StartData"),c=t("Utils"),p=t("TaskManager"),g=t("GraphicsUtils"),u=cc._decorator,h=u.ccclass;u.property;var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._is_move=!1,e._speed=0,e}var a;return i(e,t),a=e,Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!1,configurable:!0}),e.prototype.reset=function(){g.GraphicsUtils.clear_graph(this.node),this._data=null,this._is_move=!1,this._building_item=null,this._enemy_item=null,this._speed=0,this._skill_node=null,this._callback=null,this.node.stopAllActions(),_.gm.pool.put_children(this.node)},e.prototype.unuse=function(){t.prototype.unuse.call(this),this.reset()},e.prototype.reuse=function(){t.prototype.reuse.call(this),g.GraphicsUtils.clear_graph(this.node)},e.prototype.update=function(t){if(this._is_move)if(this._enemy_item.is_can_use){var e=this._building_item.attack_position,a=this._enemy_item.hit_position,i=a.sub(e),o=Math.atan2(i.y,i.x)/Math.PI*180-90;this._skill_node.angle=o;var n=this._skill_node.position.add(i.normalize().mulSelf(t*this._speed));n.sub(e).mag()>i.mag()?(this._skill_node.position=a,this._is_move=!1,this._callback&&this._callback()):this._skill_node.position=n}else this._is_move=!1,this._callback&&this._callback()},e.prototype.set_attack_target=function(t,e,a){var i=this,o=e.data,s=_.gm.config.get_row_data("HeroConfigData",o.id.toString()),l=_.gm.config.get_row_data("SkillConfigData",s.attack_id.toString());l.audio_name&&_.gm.audio.play_effect(l.audio_name);var c=_.gm.data.start_data.get_attack_range(o);l.skill_type==r.SkillTypeNew.FLY?_.gm.pool.async_get(d.BundleName.START,"prefabs/effects/"+l.skill_name,n.NodePoolItem,function(n){var d=n.getComponent(cc.Animation);i.node.addChild(d.node);var p=e.attack_position,u=t.hit_position,h=u.sub(p),m=Math.atan2(h.y,h.x)/Math.PI*180-90;d.node.position=p,d.node.angle=m,d.play(),i._is_move=!0,i._building_item=e,i._enemy_item=t,i._speed=s.fly_speed*_.gm.data.start_data.speed_scale,i._skill_node=d.node,g.GraphicsUtils.draw_line(i.node,cc.Color.BLUE,p,u,1,c),i._callback=function(){i._callback=null,i._building_item=null,i._enemy_item=null,i._skill_node=null,_.gm.pool.put(d.node);var e=_.gm.data.start_data.get_crit(o),n=Math.random()<e;if(n&&(a*=2),l.type==r.SkillType.SINGLE_ATTACK)t.data?i.set_target_hit(l,t,n?1:0,a):i.put_to_pool();else if(l.type==r.SkillType.MULTI_ATTACK){g.GraphicsUtils.draw_circle(i.node,cc.Color.BLUE,t.node.position,l.skill_range);var s=_.gm.ui.start.get_fixed_range_attack_enemy_array(t.node.position,l.hit_range);if(s.length>0)for(var c=0;c<s.length;c++){var p=s[c];p.data&&i.set_target_hit(l,p,n?1:0,a)}}i.put_to_pool()}}):l.skill_type==r.SkillTypeNew.IMMEDIATE?_.gm.pool.async_get(d.BundleName.START,"prefabs/effects/"+l.skill_name,n.NodePoolItem,function(n){var d=l.skill_pos==r.SkillPos.ENEMY?t.hit_position:e.attack_position,s=l.skill_pos==r.SkillPos.ENEMY?l.hit_range:_.gm.data.start_data.get_attack_range(o),c=n.getComponent(cc.Animation);i.node.addChild(c.node),c.node.position=d,c.node.scale=2*s/c.node.height,g.GraphicsUtils.draw_circle(i.node,cc.Color.BLUE,d,s),_.gm.ui.start.play_skill_anim(i,c,l,function(){g.GraphicsUtils.draw_circle(i.node,cc.Color.GREEN,d,s);var t=_.gm.data.start_data.get_crit(o),e=Math.random()<t;e&&(a*=2);var n=_.gm.ui.start.get_fixed_range_attack_enemy_array(d,s);if(n.length>0)for(var r=0;r<n.length;r++){var c=n[r];c.data&&i.set_target_hit(l,c,e?1:0,a)}else i.put_to_pool()})}):l.skill_type==r.SkillTypeNew.LINE&&_.gm.pool.async_get(d.BundleName.START,"prefabs/effects/"+l.skill_name,n.NodePoolItem,function(n){var d=n.getComponent(cc.Animation);i.node.addChild(d.node);var s=e.attack_position,c=t.hit_position,p=c.sub(s),u=Math.atan2(p.y,p.x)/Math.PI*180-90;d.node.position=s;var h=p.mag(),m=_.gm.data.start_data.get_attack_range(o);l.type==r.SkillType.SINGLE_ATTACK?d.node.scaleY=h/d.node.height:l.type==r.SkillType.MULTI_ATTACK&&(d.node.scaleY=m/d.node.height),d.node.angle=u,g.GraphicsUtils.draw_circle(i.node,cc.Color.BLUE,s,m),_.gm.ui.start.play_skill_anim(i,d,l,function(){var e=_.gm.data.start_data.get_crit(o),n=Math.random()<e;if(n&&(a*=2),l.type==r.SkillType.SINGLE_ATTACK)t.data?i.set_target_hit(l,t,n?1:0,a):i.put_to_pool();else if(l.type==r.SkillType.MULTI_ATTACK){g.GraphicsUtils.draw_line(i.node,cc.Color.BLUE,s,c,l.hit_range,m);var d=_.gm.ui.start.get_line_range_attack_enemy_array(s,t,l.hit_range,m),p=0;if(d.length>0)for(var u=0;u<d.length;u++){var h=d[u];h.data&&(i.set_target_hit(l,h,n?1:0,a),p++)}0==p&&i.put_to_pool()}})})},e.prototype.play_skill_prepare=function(t,e,a,i){var o=this;a.skill_prepare_name?_.gm.pool.async_get(d.BundleName.START,"prefabs/effects/"+a.skill_prepare_name,n.NodePoolItem,function(n){var r=n.getComponent(cc.Animation);o.node.addChild(r.node);var d=e.attack_position,s=t.hit_position.sub(d),l=Math.atan2(s.y,s.x)/Math.PI*180-90;r.node.position=d,r.node.angle=l,r.once(cc.Animation.EventType.FINISHED,function(){_.gm.pool.put(r.node),o.put_to_pool()}),r.play(),o.scheduleOnce(function(){i()},a.fire_time)}):i()},e.prototype.set_anger_skill_target=function(t,e,a){var i=this,o=e.data,s=_.gm.config.get_row_data("HeroConfigData",o.id.toString()),l=_.gm.config.get_row_data("SkillConfigData",s.skill_id.toString());l.audio_name&&_.gm.audio.play_effect(l.audio_name);var c=Math.floor(l.damage_ratio*a);_.gm.pool.async_get(d.BundleName.START,"prefabs/effects/"+l.skill_name,n.NodePoolItem,function(a){if(l.skill_type==r.SkillTypeNew.FLY){var o=a.getComponent(cc.Animation);i.node.addChild(o.node);var p=e.attack_position,u=t.hit_position,h=u.sub(p),m=Math.atan2(h.y,h.x)/Math.PI*180-90;o.node.position=p,o.node.angle=m,o.play(),i._is_move=!0,i._building_item=e,i._enemy_item=t,i._speed=s.fly_speed*_.gm.data.start_data.speed_scale,i._skill_node=o.node,g.GraphicsUtils.draw_line(i.node,cc.Color.BLUE,p,u,1,l.skill_range),i._callback=function(){if(i._callback=null,i._building_item=null,i._enemy_item=null,i._skill_node=null,_.gm.pool.put(o.node),l.type==r.SkillType.SINGLE_ATTACK)t.data&&i.set_anger_skill_target_hit(l,t,0,c);else if(l.type==r.SkillType.MULTI_ATTACK){g.GraphicsUtils.draw_circle(i.node,cc.Color.GREEN,cc.Vec3.ZERO,l.skill_range);var e=_.gm.ui.start.get_fixed_range_attack_enemy_array(t.node.position,l.hit_range);if(e.length>0)for(var a=0;a<e.length;a++){var n=e[a];n.data&&i.set_anger_skill_target_hit(l,n,0,c)}}i.put_to_pool()}}else if(l.skill_type==r.SkillTypeNew.IMMEDIATE){var v=a.getComponent(cc.Animation);i.node.addChild(v.node);var y=l.skill_pos==r.SkillPos.ENEMY?t.hit_position:e.attack_position;v.node.position=y;var f=l.skill_pos==r.SkillPos.ENEMY?l.hit_range:l.skill_range;v.node.height>0&&(v.node.scale=2*f/v.node.height),g.GraphicsUtils.draw_circle(i.node,cc.Color.BLUE,y,l.skill_range),_.gm.ui.start.play_skill_anim(i,v,l,function(){var t=_.gm.ui.start.get_fixed_range_attack_enemy_array(y,f);if(t.length>0)for(var e=0;e<t.length;e++){var a=t[e];a.data&&i.set_anger_skill_target_hit(l,a,0,c)}else i.put_to_pool()})}else l.skill_type==r.SkillTypeNew.LINE&&_.gm.pool.async_get(d.BundleName.START,"prefabs/effects/"+l.skill_name,n.NodePoolItem,function(a){var o=a.getComponent(cc.Animation);i.node.addChild(o.node);var n=e.attack_position,d=t.hit_position,s=d.sub(n);s.mag();var p=Math.atan2(s.y,s.x)/Math.PI*180-90;o.node.position=n,o.node.angle=p,g.GraphicsUtils.draw_circle(i.node,cc.Color.BLUE,n,l.skill_range),_.gm.ui.start.play_skill_anim(i,o,l,function(){if(l.type==r.SkillType.SINGLE_ATTACK)t.data?i.set_target_hit(l,t,0,c):i.put_to_pool();else if(l.type==r.SkillType.MULTI_ATTACK){g.GraphicsUtils.draw_line(i.node,cc.Color.BLUE,n,d,l.hit_range,l.skill_range);var e=_.gm.ui.start.get_line_range_attack_enemy_array(n,t,l.hit_range,l.skill_range),a=0;if(e.length>0)for(var o=0;o<e.length;o++){var s=e[o];s.data&&(i.set_target_hit(l,s,0,c),a++)}0==a&&i.put_to_pool()}})})})},e.prototype.set_target_hit=function(t,e,i,o){if(!(e.data.hp<=0))if(t.hit_name&&_.gm.pool.async_get(d.BundleName.START,"prefabs/skill_item",a,function(a){_.gm.ui.start.scene.skill_parent_node.addChild(a.node),_.gm.ui.start.skill_array.push(a);var i="prefabs/effects/"+t.hit_name;_.gm.pool.async_get(d.BundleName.START,i,n.NodePoolItem,function(t){var i=t.getComponent(cc.Animation);a.node.addChild(i.node),i.node.position=e.hit_position,i.once(cc.Animation.EventType.FINISHED,function(){_.gm.pool.put(i.node),a.put_to_pool()}),i.play()})}),e.change_hp(new s.NumItemData(i,c.Utils.damage_float(o,_.gm.const.MIN_DAMAGE_RATIO,_.gm.const.MAX_DAMAGE_RATIO))),e.data.hp<=0){var g=e.death_position;_.gm.pool.async_get(d.BundleName.START,_.gm.const.ENEMY_DEATH_PREFAB_URL,n.NodePoolItem,function(t){var a=t.getComponent(cc.Animation);t.node.position=g,_.gm.ui.start.scene.death_node.addChild(a.node),a.once(cc.Animation.EventType.FINISHED,function(){_.gm.pool.put(a.node)}),a.play(),_.gm.data.warehouse_data.player_add_item(d.RewardIdEnum.GOLD,_.gm.data.start_data.get_gold(e.data.drop_gold)),_.gm.ui.show_coin_fly(d.RewardIdEnum.GOLD,a.node.convertToWorldSpaceAR(cc.Vec3.ZERO)),_.gm.ui.start.update_tab_view(_.gm.ui.start.tab_type)}),_.gm.data.enemy_death_count++,p.TaskManager.instance.checkTask(d.TaskConditionTypeEnum.TASK_CONDITION_KILL_ENEMY_COUNT,1),_.gm.data.enemy_death_count>=_.gm.data.enemy_total_count&&_.gm.ui.start.fight_success();var u=_.gm.ui.start.enemy_alive_array,h=u.indexOf(e);h>-1&&u.splice(h,1),_.gm.pool.put(e.node)}else for(var m=void 0,v=0;v<t.effect_array.length;v++)if(m=t.effect_array[v],Math.random()<m.trigger_ratio){var y=new l.BuffItemData;switch(y.id=m.skill_effect_id,y.id){case r.SkillEffectId.FIRE:y.damage=Math.ceil(m.value/1e4*o),y.speed_scale=1,y.max_trigger_count=3,y.is_start=!1,y.is_end=!0;break;case r.SkillEffectId.ICE:y.damage=0,y.speed_scale=0,y.max_trigger_count=1,y.is_start=!0,y.is_end=!1;break;case r.SkillEffectId.SLOWER:y.damage=0,y.speed_scale=.5,y.max_trigger_count=1,y.is_start=!0,y.is_end=!1;break;case r.SkillEffectId.DIZZINESS:case r.SkillEffectId.CHARM:y.damage=0,y.speed_scale=0,y.max_trigger_count=1,y.is_start=!0,y.is_end=!1;break;case r.SkillEffectId.POISON:y.damage=Math.ceil(m.value/1e4*o),y.speed_scale=1,y.max_trigger_count=3,y.is_start=!1,y.is_end=!0;break;case r.SkillEffectId.KILL:y.damage=0,y.speed_scale=1,y.max_trigger_count=1,y.is_start=!0,y.is_end=!0;break;case r.SkillEffectId.RETREAT:y.damage=0,y.speed_scale=-.8,y.max_trigger_count=1,y.is_start=!0,y.is_end=!1;break;case r.SkillEffectId.ADD_ANGER:y.damage=0,y.speed_scale=1,y.max_trigger_count=1,y.is_start=!0,y.is_end=!0;break;default:cc.error("\u672a\u5b9e\u73b0\u6216\u8005\u672a\u77e5\u7684\u6280\u80fd\u6548\u679cid")}y.start_time=_.gm.data.total_time,y.valid_time=m.duration/1e3,y.trigger_count=0,y.config=m,e.add_buff_data(y)}},e.prototype.set_anger_skill_target_hit=function(t,e,i,o){if(!(e.data.hp<=0)&&(t.hit_name&&_.gm.pool.async_get(d.BundleName.START,"prefabs/skill_item",a,function(a){_.gm.ui.start.scene.skill_parent_node.addChild(a.node),_.gm.ui.start.skill_array.push(a);var i="prefabs/effects/"+t.hit_name;_.gm.pool.async_get(d.BundleName.START,i,n.NodePoolItem,function(i){var o=i.getComponent(cc.Animation);_.gm.const.SKILL_HIT_SCALE_ARRAY.indexOf(t.id)>-1&&(o.node.scale=e.data.is_boss?1:.5),o.node.position=e.hit_position,a.node.addChild(o.node),o.once(cc.Animation.EventType.FINISHED,function(){_.gm.pool.put(o.node),a.put_to_pool()}),o.play()})}),e.change_hp(new s.NumItemData(i,c.Utils.damage_float(o,_.gm.const.MIN_DAMAGE_RATIO,_.gm.const.MAX_DAMAGE_RATIO)),t.id),e.data.hp<=0)){var r=e.death_position;_.gm.pool.async_get(d.BundleName.START,_.gm.const.ENEMY_DEATH_PREFAB_URL,n.NodePoolItem,function(t){var a=t.getComponent(cc.Animation);t.node.position=r,_.gm.ui.start.scene.death_node.addChild(a.node),a.once(cc.Animation.EventType.FINISHED,function(){_.gm.pool.put(a.node)}),a.play(),_.gm.data.warehouse_data.player_add_item(d.RewardIdEnum.GOLD,_.gm.data.start_data.get_gold(e.data.drop_gold)),_.gm.ui.show_coin_fly(d.RewardIdEnum.GOLD,a.node.convertToWorldSpaceAR(cc.Vec3.ZERO)),_.gm.ui.start.update_tab_view(_.gm.ui.start.tab_type)}),_.gm.data.enemy_death_count++,p.TaskManager.instance.checkTask(d.TaskConditionTypeEnum.TASK_CONDITION_KILL_ENEMY_COUNT,1),_.gm.data.enemy_death_count>=_.gm.data.enemy_total_count&&_.gm.ui.start.fight_success();var l=_.gm.ui.start.enemy_alive_array,g=l.indexOf(e);g>-1&&l.splice(g,1),_.gm.pool.put(e.node)}},e.prototype.put_to_pool=function(){this.reset();var t=_.gm.ui.start.skill_array,e=t.indexOf(this);if(e>-1){var a=t.splice(e,1)[0];_.gm.pool.put(a.node)}},a=o([h],e)}(n.NodePoolItem);a.SkillItem=m,a.SkillItemData=function(){this.id=0,this.type=0,this.skill_damage=0,this.move_speed=100},cc._RF.pop()},{ConfigData:void 0,Constants:void 0,GameManager:void 0,GraphicsUtils:void 0,NodePoolItem:void 0,NumItem:"NumItem",StartData:void 0,TaskManager:void 0,Utils:void 0}],SkyBox:[function(t,e,a){"use strict";cc._RF.push(e,"dceebNDNQlKspMBGz/YgnAb","SkyBox");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.SkyBox=void 0;var n=t("ChannelManager"),_=t("GameManager"),r=t("GameModule"),d=t("ListView"),s=t("NetUtils"),l=cc._decorator,c=l.ccclass,p=l.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.close_btn=null,e.get_btn=null,e.tt_get_btn=null,e.no_thanks_btn=null,e.reward_list=null,e._prop_data_array=[],e}return i(e,t),e.prototype.onEnable=function(){_.gm.channel.show_banner_ad(n.BANNER_AD_TYPE.ALL),this._prop_data_array=[];var t=_.gm.config.get_row_data_array("PoolConfigData","1001");_.gm.data.setRandomReward(t,this._prop_data_array),this.reward_list.setData(this._prop_data_array),_.gm.channel.get_channel_name()==n.ChannelManager.TT_GAME?(this.get_btn.node.active=!1,this.tt_get_btn.node.active=!0):(this.get_btn.node.active=!0,this.tt_get_btn.node.active=!1)},e.prototype.onDisable=function(){_.gm.channel.hide_banner_ad(n.BANNER_AD_TYPE.ALL),this.reward_list.reset()},e.prototype.editor_on_button_click_handler=function(t){var e=this;t.target==this.close_btn.node||t.target==this.no_thanks_btn.node?_.gm.ui.async_hide_module(_.gm.const.SkyBox):t.target==this.get_btn.node?_.gm.channel.show_video_ad(function(){_.gm.ui.set_module_args(_.gm.const.OpenBox.key,{list:e._prop_data_array,type:1}),_.gm.ui.show_panel(_.gm.const.OpenBox),_.gm.ui.async_hide_module(_.gm.const.SkyBox),s.ReportData.instance.report_point(15),s.ReportData.instance.report_once_point(715)},this):t.target==this.tt_get_btn.node&&_.gm.channel.show_video_ad(function(){_.gm.ui.set_module_args(_.gm.const.OpenBox.key,{list:e._prop_data_array,type:1}),_.gm.ui.show_panel(_.gm.const.OpenBox),_.gm.ui.async_hide_module(_.gm.const.SkyBox),s.ReportData.instance.report_point(15),s.ReportData.instance.report_once_point(715)},this)},o([p(cc.Button)],e.prototype,"close_btn",void 0),o([p(cc.Button)],e.prototype,"get_btn",void 0),o([p(cc.Button)],e.prototype,"tt_get_btn",void 0),o([p(cc.Button)],e.prototype,"no_thanks_btn",void 0),o([p(d.ListView)],e.prototype,"reward_list",void 0),o([c],e)}(r.GameModule);a.SkyBox=g,cc._RF.pop()},{ChannelManager:void 0,GameManager:void 0,GameModule:void 0,ListView:void 0,NetUtils:void 0}],StartUI:[function(t,e,a){"use strict";cc._RF.push(e,"95791soi6RJzI43urteHm8w","StartUI");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.StartUI=void 0;var n=t("WeakGuide"),_=t("Constants"),r=t("GuideData"),d=t("DataManager"),s=t("GameManager"),l=t("ListView"),c=t("NodePoolItem"),p=t("NetUtils"),g=cc._decorator,u=g.ccclass,h=g.property,m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.record_node=null,e.agreement_node=null,e.hero_btn=null,e.shop_btn=null,e.sign_btn=null,e.task_btn=null,e.audio_on_btn=null,e.audio_off_btn=null,e.pause_btn=null,e.speed_x1_btn=null,e.speed_x2_btn=null,e.manual_btn=null,e.auto_btn=null,e.more_game_btn=null,e.trap_list=null,e.trap_sf_array=[],e.auto_attack_node=null,e.auto_attack_open_tog=null,e.auto_attack_close_tog=null,e.auto_attack_video_node=null,e.auto_attack_time_lbl=null,e.store_red_node=null,e.sign_red_node=null,e.task_red_node=null,e.ico_native=null,e.ico_layout_native=null,e}return i(e,t),e.prototype.onEnable=function(){this.update_view()},e.prototype.onDisable=function(){this.trap_list.reset()},e.prototype.update_view=function(){var t=this;if(this.manual_btn.node.active=this.auto_btn.node.active=!1,this.speed_x1_btn.node.active=!1,this.speed_x2_btn.node.active=!1,this.audio_on_btn.node.active=!s.gm.audio.mute,this.audio_off_btn.node.active=s.gm.audio.mute,this.record_node.active=s.gm.channel.is_video_share,s.gm.channel.is_video_share&&0==this.record_node.childrenCount&&s.gm.pool.async_get(_.BundleName.RECORD,"prefabs/record_entry",c.NodePoolItem,function(e){0==t.record_node.childrenCount?t.record_node.addChild(e.node):s.gm.pool.put(e.node)}),s.gm.data.start_data.max_pass_level_id>=s.gm.const.OPEN_AUTO_LEVEL_ID){this.auto_attack_node.active=!0,this.auto_attack_open_tog.isChecked=0==s.gm.data.start_data.is_finger_operation,this.auto_attack_close_tog.isChecked=1==s.gm.data.start_data.is_finger_operation,this.auto_attack_video_node.active=s.gm.data.guide_data.is_guide_auto_attack;var e=Math.ceil((s.gm.data.start_data.auto_attack_time-Date.now())/1e3);e>0?(this.auto_attack_time_lbl.node.active=!0,this.auto_attack_time_lbl.string=e.toString()):this.auto_attack_time_lbl.node.active=!1}else this.auto_attack_node.active=!1},e.prototype.fight_start=function(){this.trap_list.node.active=s.gm.data.start_data.max_pass_level_id>=1,this.trap_list.node.active&&this.trap_list.setData(s.gm.data.trap_data.trap_data_array),this.hero_btn.node.active=s.gm.data.start_data.max_pass_level_id>=1,this.shop_btn.node.active=s.gm.data.start_data.max_pass_level_id>=1,this.pause_btn.node.active=s.gm.data.start_data.max_pass_level_id>=1,this.check_guide_speed_x2(),this.check_sign_red(),this.check_task_red(),this.check_store_red(),this.check_guide_auto_attack()},e.prototype.check_guide_speed_x2=function(){if(s.gm.data.start_data.max_pass_level_id>=s.gm.const.OPEN_SPEED_LEVEL_ID&&!s.gm.data.guide_data.is_guide_speed_x2&&this.speed_x1_btn.node.activeInHierarchy){var t=this.speed_x1_btn.node,e=t.getChildByName("weak_guide");e||s.gm.pool.async_get(_.BundleName.COMMON,"prefabs/weak_guide",n.WeakGuide,function(a){(e=t.getChildByName("weak_guide"))||(a.data={tip_content:"\u70b9\u51fb\u63d0\u5347\u5173\u5361\u901f\u5ea6",tip_offset:cc.v3(-30,70),dir:r.Direction.LEFT,disappear_time:10,target:t,callback:function(){s.gm.data.guide_data.is_guide_speed_x2=!0,s.gm.data.guide_data.async_write_data()}},t.addChild(a.node))})}},e.prototype.check_guide_auto_attack=function(){s.gm.data.start_data.max_pass_level_id!=s.gm.const.OPEN_AUTO_LEVEL_ID||s.gm.data.guide_data.is_guide_auto_attack||s.gm.ui.start.show_weak_guide(this.auto_attack_open_tog.node,"\u70b9\u51fb\u5f00\u542f\u81ea\u52a8\u91ca\u653e\u6280\u80fd",!1,function(){s.gm.data.guide_data.is_guide_auto_attack=!0,s.gm.data.guide_data.async_write_data()})},e.prototype.check_store_red=function(){var t=Date.now()/1e3;this.store_red_node.active=!1;var e=s.gm.config.get_row_data("ShopConfigData",_.StoreTypeEnum.StoreTypeDiamond+"");e.num>s.gm.data.store_data.diamond_count&&s.gm.data.store_data.next_diamond_time>t&&(this.store_red_node.active=!0),(e=s.gm.config.get_row_data("ShopConfigData",_.StoreTypeEnum.StoreTypeFree+"")).num>s.gm.data.store_data.free_box_count&&s.gm.data.store_data.next_free_box_time>t&&(this.store_red_node.active=!0),(e=s.gm.config.get_row_data("ShopConfigData",_.StoreTypeEnum.StoreTypeClassic+"")).num>s.gm.data.store_data.classic_box_count&&(this.store_red_node.active=!0),(e=s.gm.config.get_row_data("ShopConfigData",_.StoreTypeEnum.StoreTypeGreate+"")).num>s.gm.data.store_data.greate_box_count&&s.gm.data.store_data.next_diamond_time>t&&(this.store_red_node.active=!0),(e=s.gm.config.get_row_data("ShopConfigData",_.StoreTypeEnum.StoreTypeLiandong+"")).num>s.gm.data.store_data.liandong_box_count&&(this.store_red_node.active=!0);for(var a=_.StoreTypeEnum.StoreTypeExchange1;a<_.StoreTypeEnum.StoreTypeExchange1+3;++a)if(s.gm.config.get_row_data("ShopConfigData",a+"").diamond<=s.gm.data.warehouse_data.diamond_num){this.store_red_node.active=!0;break}},e.prototype.check_task_red=function(){this.task_red_node.active=!1;for(var t=0;t<s.gm.data.task_data.daily_task_list.length;++t)if(s.gm.data.task_data.daily_task_list[t].state==_.TaskStateEnum.FINISH){this.task_red_node.active=!0;break}for(t=0;t<s.gm.data.task_data.achivement_list.length;++t)if(s.gm.data.task_data.achivement_list[t].state==_.TaskStateEnum.FINISH){this.task_red_node.active=!0;break}},e.prototype.check_sign_red=function(){this.sign_red_node.active=s.gm.data.sign_data.today_sign_state<=0},e.prototype.editor_on_button_click_handler=function(t){if(t.target==this.task_btn.node)s.gm.ui.show_panel(s.gm.const.Task);else if(t.target==this.hero_btn.node)s.gm.ui.show_panel(s.gm.const.Hero);else if(t.target==this.shop_btn.node)s.gm.ui.show_panel(s.gm.const.Store),p.ReportData.instance.report_once_point(708);else if(t.target==this.sign_btn.node)s.gm.ui.show_panel(s.gm.const.SignDay);else if(t.target==this.audio_on_btn.node)s.gm.audio.mute=!0,this.update_view(),s.gm.data.main_data.async_write_data();else if(t.target==this.audio_off_btn.node)s.gm.audio.mute=!1,this.update_view(),s.gm.data.main_data.async_write_data();else if(t.target==this.pause_btn.node)s.gm.data.fight_state=d.FightState.PAUSE,s.gm.ui.start.pause_node.active=!0,s.gm.ui.start.hero_pause_list.setData(s.gm.data.hero_data.hero_data_array),s.gm.ui.start.continue_btn.node.active=!0;else if(t.target==this.speed_x1_btn.node)s.gm.data.start_data.speed_scale=s.gm.const.FIGHT_SPEED_X2,s.gm.data.start_data.async_write_data(),this.speed_x1_btn.node.active=!1,this.speed_x2_btn.node.active=!0;else if(t.target==this.speed_x2_btn.node)s.gm.data.start_data.speed_scale=s.gm.const.FIGHT_SPEED_X1,s.gm.data.start_data.async_write_data(),this.speed_x1_btn.node.active=!0,this.speed_x2_btn.node.active=!1;else if(t.target==this.manual_btn.node)s.gm.data.start_data.auto_attack_time=Date.now()+s.gm.const.AUTO_ATTACK_TIME,s.gm.data.start_data.async_write_data(),this.manual_btn.node.active=!1,this.auto_btn.node.active=!0;else if(t.target==this.auto_btn.node)s.gm.data.start_data.auto_attack_time=0,s.gm.data.start_data.async_write_data(),this.manual_btn.node.active=!0,this.auto_btn.node.active=!1;else if(t.target==this.more_game_btn.node){s.gm.channel.show_app_box_ad();var e=this.more_game_btn.node.getChildByName("red");e&&(e.active=!1)}},e.prototype.editor_on_toggle_change_handler=function(t){if(this.auto_attack_open_tog==t)if(s.gm.data.guide_data.is_guide_auto_attack){if(s.gm.data.start_data.auto_attack_time>=Date.now())return void s.gm.ui.show_notice("\u5012\u8ba1\u65f6\u7ed3\u675f\u540e\u518d\u8bd5");s.gm.channel.show_video_ad(function(){s.gm.data.start_data.auto_attack_time=Date.now()+s.gm.const.AUTO_ATTACK_TIME,s.gm.data.start_data.async_write_data()},this)}else s.gm.data.start_data.auto_attack_time=Date.now()+s.gm.const.AUTO_ATTACK_TIME,s.gm.data.start_data.async_write_data(),s.gm.data.guide_data.is_guide_auto_attack=!0,s.gm.data.guide_data.async_write_data();else this.auto_attack_close_tog==t&&(s.gm.data.start_data.auto_attack_time=0,s.gm.data.start_data.async_write_data())},o([h(cc.Node)],e.prototype,"record_node",void 0),o([h(cc.Node)],e.prototype,"agreement_node",void 0),o([h(cc.Button)],e.prototype,"hero_btn",void 0),o([h(cc.Button)],e.prototype,"shop_btn",void 0),o([h(cc.Button)],e.prototype,"sign_btn",void 0),o([h(cc.Button)],e.prototype,"task_btn",void 0),o([h(cc.Button)],e.prototype,"audio_on_btn",void 0),o([h(cc.Button)],e.prototype,"audio_off_btn",void 0),o([h(cc.Button)],e.prototype,"pause_btn",void 0),o([h(cc.Button)],e.prototype,"speed_x1_btn",void 0),o([h(cc.Button)],e.prototype,"speed_x2_btn",void 0),o([h(cc.Button)],e.prototype,"manual_btn",void 0),o([h(cc.Button)],e.prototype,"auto_btn",void 0),o([h(cc.Button)],e.prototype,"more_game_btn",void 0),o([h(l.ListView)],e.prototype,"trap_list",void 0),o([h([cc.SpriteFrame])],e.prototype,"trap_sf_array",void 0),o([h(cc.Node)],e.prototype,"auto_attack_node",void 0),o([h(cc.Toggle)],e.prototype,"auto_attack_open_tog",void 0),o([h(cc.Toggle)],e.prototype,"auto_attack_close_tog",void 0),o([h(cc.Node)],e.prototype,"auto_attack_video_node",void 0),o([h(cc.Label)],e.prototype,"auto_attack_time_lbl",void 0),o([h(cc.Node)],e.prototype,"store_red_node",void 0),o([h(cc.Node)],e.prototype,"sign_red_node",void 0),o([h(cc.Node)],e.prototype,"task_red_node",void 0),o([h(cc.Node)],e.prototype,"ico_native",void 0),o([h(cc.Node)],e.prototype,"ico_layout_native",void 0),o([u],e)}(c.NodePoolItem);a.StartUI=m,cc._RF.pop()},{Constants:void 0,DataManager:void 0,GameManager:void 0,GuideData:void 0,ListView:void 0,NetUtils:void 0,NodePoolItem:void 0,WeakGuide:void 0}],Start:[function(t,e,a){"use strict";cc._RF.push(e,"74c0fHqoydDz4SfYVJ/Yz5l","Start");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.Start=void 0;var n=t("WeakGuide"),_=t("Constants"),r=t("SDKManager"),d=t("GuideData"),s=t("StartData"),l=t("WarehouseData"),c=t("DataManager"),p=t("GameManager"),g=t("GameModule"),u=t("GraphicsUtils"),h=t("ListView"),m=t("NodePoolItem"),v=t("TaskManager"),y=t("TiledMapUtils"),f=t("Timer"),b=t("Utils"),w=t("NetUtils"),k=t("BuildingItem"),T=t("EnemyHintItem"),I=t("EnemyItem"),S=t("LevelNumItem"),N=t("Scene"),M=t("SkillItem"),E=t("StartUI"),R=cc._decorator,C=R.ccclass,x=R.property,D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.start_ui_node=null,e.scene=null,e.gold_add_btn=null,e.gold_lbl=null,e.diamond_add_btn=null,e.diamond_lbl=null,e.gold_icon_node=null,e.diamond_icon_node=null,e.hero_node=null,e.hero_num_lbl=null,e.notice_lbl=null,e.tab_list=[],e.hero_list=null,e.hero_upgrade_list=null,e.hero_star_list=null,e.science_list=null,e.arrow_tab_node_array=[],e.level_prg=null,e.level_num_item_array=[],e.enemy_prg=null,e.flag_boss_anim=null,e.wave_node=null,e.wave_lbl=null,e.enemy_hint_item_array=[],e.pause_node=null,e.hero_pause_list=null,e.close_btn=null,e.continue_btn=null,e.balloon_parent_node=null,e.battle_open_parent_node=null,e.total_people_anim=null,e.text_start_node=null,e.guide_trap_node=null,e.start_ui=null,e._balloon_dir=1,e.enemy_alive_array=[],e.skill_array=[],e.building_item_array=[],e.trapping_item_array=[],e.is_scroll_start=!1,e.has_drag_node=!1,e._timer=new f.Timer,e._tab_type=_.HeroTabType.HERO,e}return i(e,t),Object.defineProperty(e.prototype,"tab_type",{get:function(){return this._tab_type},enumerable:!1,configurable:!0}),e.prototype.onLoad=function(){this.scheduleOnce(function(){v.TaskManager.instance.checkAll()})},e.prototype.onEnable=function(){w.ReportData.instance.report_once_point(10030),p.gm.data.event_emitter.on(l.WarehouseData.EVENT_DATA_CHANGE,this.on_update_warehouse_handler,this),this.fight_reset(),this.fight_start(),this.on_update_warehouse_handler(),this.update_view(),this.open_timer(),p.gm.audio.play_music("bg_music"),this.update_tab_view(_.HeroTabType.HERO),this.node.getChildByName("window").getChildByName("top_left_area").getChildByName("btn_yssz").active=!1},e.prototype.onDisable=function(){p.gm.data.event_emitter.off(l.WarehouseData.EVENT_DATA_CHANGE,this.on_update_warehouse_handler,this),this.hero_list.reset(),this._timer.is_running&&this._timer.stop()},e.prototype.show_start_ui=function(){this.start_ui||(p.gm.data.guide_data.is_end?this.load_start_ui():this.start_ui_node.active=!1)},e.prototype.load_start_ui=function(){var t=this;0==this.start_ui_node.childrenCount&&p.gm.pool.async_get(_.BundleName.START,"prefabs/start_ui",E.StartUI,function(e){0==t.start_ui_node.childrenCount?(t.start_ui=e,t.start_ui_node.addChild(e.node),t.start_ui_node.active=!0,t.start_ui.update_view(),t.start_ui.fight_start()):p.gm.pool.put(e.node)})},e.prototype.show_guide_trap=function(){var t=this;3==p.gm.data.start_data.level_id&&p.gm.data.start_data.max_pass_level_id<3&&0==this.guide_trap_node.childrenCount&&p.gm.pool.async_get(_.BundleName.START,"prefabs/guide_trap",m.NodePoolItem,function(e){0==t.guide_trap_node.childrenCount?(t.guide_trap_node.addChild(e.node),t.guide_trap_node.active=!0,b.Utils.align_with_parent(e.node),e.node.once(cc.Node.EventType.TOUCH_END,function(){p.gm.pool.put(e.node)})):p.gm.pool.put(e.node)})},e.prototype.check_hero_red=function(){for(var t=0;t<this.arrow_tab_node_array.length;t++)this.arrow_tab_node_array[t].active=!1;var e,a;for(t=0;t<p.gm.data.hero_data.hero_data_array.length;t++)e=p.gm.data.hero_data.hero_data_array[t],this.has_hero_item_red(e)&&(this.arrow_tab_node_array[0].active=!0),this.has_hero_upgrade_item_red(e)&&(this.arrow_tab_node_array[1].active=!0),this.has_hero_star_item_red(e)&&p.gm.data.guide_data.is_end&&(this.arrow_tab_node_array[2].active=!0);for(t=0;t<p.gm.data.start_data.science_data_array.length;t++)a=p.gm.data.start_data.science_data_array[t],this.has_science_item_red(a)&&p.gm.data.guide_data.is_end&&(this.arrow_tab_node_array[3].active=!0)},e.prototype.check_weak_guide=function(){if(0==p.gm.data.last_touch_end_time&&(p.gm.data.last_touch_end_time=Date.now()),p.gm.data.start_data.max_pass_level_id>=p.gm.const.MIN_NO_ACTION_GUIDE_LEVEL_ID&&p.gm.data.start_data.max_pass_level_id<p.gm.const.MAX_NO_ACTION_GUIDE_LEVEL_ID&&Date.now()-p.gm.data.last_touch_end_time>p.gm.const.NO_ACTION_TIME&&!p.gm.data.has_no_action_guide){for(var t=-1,e=-1,a=-1,i=-1,o=0;o<p.gm.data.hero_data.hero_data_array.length;o++){var n=p.gm.data.hero_data.hero_data_array[o];t<0&&p.gm.data.start_data.get_all_hero_count()<p.gm.data.start_data.get_max_hero_count()&&this.can_buy_hero(n)&&(t=o),e<0&&this.has_hero_star_item_red(n)&&(e=o),i<0&&this.has_hero_upgrade_item_red(n)&&(i=o)}var r,d=void 0;for(o=0;o<p.gm.data.start_data.science_data_array.length;o++)if(d=p.gm.data.start_data.science_data_array[o],a<0&&this.has_science_item_red(d)){a=o;break}if(t>-1)return p.gm.data.has_no_action_guide=!0,void(this.tab_list[_.HeroTabType.HERO].isChecked?(this.hero_list.scrollToIndex(t,.1),(r=this.hero_list.getItem(t))&&this.show_weak_guide(r.buy_btn.node,"",!0,function(){})):this.show_weak_guide(this.tab_list[_.HeroTabType.HERO].node,"",!0,function(){}));if(e>-1)return p.gm.data.has_no_action_guide=!0,void(this.tab_list[_.HeroTabType.UPGRADE_STAR].isChecked?(this.hero_star_list.scrollToIndex(e,.1),(r=this.hero_star_list.getItem(e))&&this.show_weak_guide(r.upgrade_btn.node,"",!0,function(){})):this.show_weak_guide(this.tab_list[_.HeroTabType.UPGRADE_STAR].node,"",!0,function(){}));if(a>-1)return p.gm.data.has_no_action_guide=!0,void(this.tab_list[_.HeroTabType.SCIENCE].isChecked?(this.science_list.scrollToIndex(a,.1),(r=this.science_list.getItem(a))&&this.show_weak_guide(r.upgrade_btn.node,"",!0,function(){})):this.show_weak_guide(this.tab_list[_.HeroTabType.SCIENCE].node,"",!0,function(){}));if(i>-1)return p.gm.data.has_no_action_guide=!0,void(this.tab_list[_.HeroTabType.UPGRADE].isChecked?(this.hero_upgrade_list.scrollToIndex(i,.1),(r=this.hero_upgrade_list.getItem(i))&&this.show_weak_guide(r.upgrade_btn.node,"",!0,function(){})):this.show_weak_guide(this.tab_list[_.HeroTabType.UPGRADE].node,"",!0,function(){}))}},e.prototype.clear_weak_guide=function(){for(var t=p.gm.data.weak_guide_array.length-1;t>=0;t--){var e=p.gm.data.weak_guide_array.splice(t,1)[0];p.gm.pool.put(e.node)}},e.prototype.can_buy_hero=function(t){var e=p.gm.data.warehouse_data.get_item_count(t.id)>0,a=p.gm.config.get_row_data("HeroLevelConfigData",t.id.toString(),t.lv.toString());return e&&p.gm.data.warehouse_data.gold_num>=a.coin&&p.gm.data.start_data.get_hero_count(t.id)<a.max_num},e.prototype.has_hero_item_red=function(t){var e=p.gm.data.warehouse_data.get_item_count(t.id)>0,a=p.gm.config.get_row_data("HeroConfigData",t.id.toString()),i=p.gm.config.get_row_data("HeroLevelConfigData",t.id.toString(),t.lv.toString());return e?p.gm.data.warehouse_data.gold_num>=i.coin&&p.gm.data.start_data.get_hero_count(t.id)<i.max_num:p.gm.data.warehouse_data.diamond_num>=a.money},e.prototype.has_hero_upgrade_item_red=function(t){var e=p.gm.data.warehouse_data.get_item_count(t.id)>0,a=p.gm.config.get_row_data("HeroLevelConfigData",t.id.toString(),t.lv.toString());return e&&p.gm.data.start_data.home_lv>=a.unlock&&p.gm.data.warehouse_data.gold_num>=a.money},e.prototype.has_hero_star_item_red=function(t){var e=p.gm.data.warehouse_data.get_item_count(t.id)>0,a=p.gm.config.get_row_data("HeroStarConfigData",t.id.toString(),t.star.toString());return e&&t.lv>=a.need_lv&&p.gm.data.warehouse_data.get_item_count(a.fragment_id)>=a.fragment_num},e.prototype.has_science_item_red=function(t){var e=p.gm.config.get_row_data("ScienceConfigData",t.id.toString(),t.lv.toString());return p.gm.data.start_data.home_lv>=e.unlock&&p.gm.data.warehouse_data.gold_num>=e.money_num},e.prototype.check_red_point=function(){this.start_ui&&(this.start_ui.check_task_red(),this.start_ui.check_sign_red()),this.check_hero_red()},e.prototype.editor_on_button_click_handler=function(t){t.target==this.diamond_add_btn.node?(p.gm.ui.set_module_args(p.gm.const.GetMoney.key,{data:_.RewardIdEnum.DIAMOND}),p.gm.ui.show_panel(p.gm.const.GetMoney)):t.target==this.gold_add_btn.node?(p.gm.ui.set_module_args(p.gm.const.GetMoney.key,{data:_.RewardIdEnum.GOLD}),p.gm.ui.show_panel(p.gm.const.GetMoney)):t.target==this.continue_btn.node?(p.gm.data.fight_state=c.FightState.RUN,this.pause_node.active=!1,this.continue_btn.node.active=!1):t.target==this.close_btn.node&&(this.pause_node.active=!1)},e.prototype.editor_on_toggle_changed_handler=function(t){if(this._tab_type=this.tab_list.indexOf(t),this._tab_type==_.HeroTabType.UPGRADE&&p.gm.data.start_data.level_id>1&&!p.gm.data.guide_data.is_guide_upgrade_tab)p.gm.data.guide_data.is_guide_upgrade_tab=!0,w.ReportData.instance.report_once_point(10080),p.gm.data.guide_data.async_write_data(),(e=this.tab_list[_.HeroTabType.UPGRADE].node.getChildByName("weak_guide"))&&p.gm.pool.put(e),this.check_guide_upgrade_hero();else if(this._tab_type==_.HeroTabType.SCIENCE&&p.gm.data.start_data.level_id>1&&p.gm.data.guide_data.is_guide_upgrade_tab&&p.gm.data.guide_data.is_guide_upgrade_hero&&!p.gm.data.guide_data.is_guide_science_tab){var e;p.gm.data.guide_data.is_guide_science_tab=!0,w.ReportData.instance.report_once_point(10100),p.gm.data.guide_data.async_write_data(),(e=this.tab_list[_.HeroTabType.SCIENCE].node.getChildByName("weak_guide"))&&p.gm.pool.put(e),this.check_guide_science_home()}this.update_tab_view(this._tab_type)},e.prototype.update_hero_num=function(){var t=p.gm.data.start_data.get_all_hero_count(),e=p.gm.data.start_data.get_max_hero_count();this.hero_num_lbl.string=cc.js.formatStr("%d/%d",t,e),this.hero_num_lbl.node.color=t<e?p.gm.const.HERO_NUM_COLOR:cc.Color.RED},e.prototype.update_tab_view=function(t){this._tab_type=t;for(var e=0;e<this.tab_list.length;e++)this.tab_list[e].isChecked=t==e;this.hero_list.node.active=t==_.HeroTabType.HERO,this.hero_upgrade_list.node.active=t==_.HeroTabType.UPGRADE,this.hero_star_list.node.active=t==_.HeroTabType.UPGRADE_STAR,this.science_list.node.active=t==_.HeroTabType.SCIENCE,t==_.HeroTabType.HERO?this.hero_list.setData(p.gm.data.hero_data.hero_data_array):t==_.HeroTabType.UPGRADE?this.hero_upgrade_list.setData(p.gm.data.hero_data.hero_data_array):t==_.HeroTabType.UPGRADE_STAR?this.hero_star_list.setData(p.gm.data.hero_data.hero_data_array):t==_.HeroTabType.SCIENCE&&this.science_list.setData(p.gm.data.start_data.science_data_array.slice(0,1)),this.update_hero_num()},e.prototype.auto_pause=function(){p.gm.data.start_data.is_auto_pause_fight&&(p.gm.data.record_fight_state=p.gm.data.fight_state,p.gm.data.fight_state=c.FightState.PAUSE)},e.prototype.resume_auto_pause=function(){p.gm.data.start_data.is_auto_pause_fight&&(p.gm.data.fight_state=p.gm.data.record_fight_state,p.gm.data.record_fight_state=c.FightState.NONE)},e.prototype.update=function(t){p.gm.data.fight_state==c.FightState.RUN&&y.TiledMapUtils.is_init&&(t*=p.gm.data.start_data.speed_scale,p.gm.data.total_time+=t,this.check_spawn_enemy(),this.update_enemy_array(t),this.check_trap_attack_enemy(),this.check_hero_attack_enemy(),this.update_enemy_buff(),this.update_view()),this.update_balloon(t)},e.prototype.check_trap_attack_enemy=function(){for(var t=this,e=function(e){var i=p.gm.ui.start.trapping_item_array[e];if(!cc.isValid(i))return{value:void 0};var o=i.data,n=p.gm.config.get_row_data("TrapConfigData",o.id.toString(),o.lv.toString());if(n)if(13001==n.id&&0==o.attack_time){var r=p.gm.config.get_row_data("SkillConfigData",n.skill_id.toString());(d=a.get_single_attack_enemy(i.center_position,r.skill_range,1)).length>0&&p.gm.pool.async_get(_.BundleName.START,"prefabs/skill_item",M.SkillItem,function(t){p.gm.ui.start.scene.skill_parent_node.addChild(t.node),p.gm.ui.start.skill_array.push(t),p.gm.pool.async_get(_.BundleName.START,"prefabs/effects/"+r.skill_name,m.NodePoolItem,function(a){var n=a.getComponent(cc.Animation);t.node.addChild(n.node),n.node.position=i.center_position,p.gm.ui.start.play_skill_anim(t,n,r,function(){if(cc.isValid(i)){u.GraphicsUtils.draw_circle(t.node,cc.Color.BLUE,i.center_position,r.hit_range);var a=p.gm.ui.start.get_fixed_range_attack_enemy_array(i.center_position,r.hit_range);if(a.length>0)for(var o=0;o<a.length;o++){var n=a[o];n.data&&t.set_target_hit(r,n,0,Math.floor(p.gm.data.start_data.hero_max_attack*r.damage_ratio))}p.gm.ui.start.trapping_item_array.splice(e,1),p.gm.pool.put(i.node)}}),o.attack_time=p.gm.data.total_time,i.update_view()})})}else if(13004==n.id){var d,s=p.gm.config.get_row_data("SkillConfigData",n.skill_id.toString());if(0==o.attack_time)p.gm.pool.async_get(_.BundleName.START,"prefabs/skill_item",M.SkillItem,function(a){p.gm.ui.start.scene.skill_parent_node.addChild(a.node),p.gm.ui.start.skill_array.push(a),u.GraphicsUtils.draw_circle(a.node,cc.Color.BLUE,i.center_position,s.skill_range),p.gm.pool.async_get(_.BundleName.START,"prefabs/effects/"+s.skill_name,m.NodePoolItem,function(o){var n=o.getComponent(cc.Animation);a.node.addChild(n.node),n.node.position=i.center_position,t.scheduleOnce(function(){var o;n.stop(),p.gm.pool.put(n.node),a.put_to_pool(),p.gm.ui.start.trapping_item_array.indexOf(i)>-1&&p.gm.ui.start.trapping_item_array.splice(e,1);for(var _=0;_<t.enemy_alive_array.length;_++)(o=t.enemy_alive_array[_]).data&&o.data.attack_trapping_item==i&&(o.data.attack_trapping_item=null);p.gm.pool.put(i.node)},s.skill_anim_time),n.play()}),o.attack_time=p.gm.data.total_time,i.update_view()});else if((d=p.gm.ui.start.get_fixed_range_attack_enemy_array(i.center_position,s.hit_range)).length>0)for(var l=0;l<d.length;l++){var c=d[l];c.data&&c.data.attack_trapping_item!=i&&(c.data.attack_trapping_item=i)}}},a=this,i=p.gm.ui.start.trapping_item_array.length-1;i>=0;i--){var o=e(i);if("object"==typeof o)return o.value}},e.prototype.check_hero_attack_enemy=function(){for(var t=this,e=function(e){var i=p.gm.ui.start.building_item_array[e],o=i.data;if(0==o.id||o.hp<=0)return"continue";var n=p.gm.data.start_data.get_attack_interval(o),r=p.gm.data.start_data.get_attack_range(o),d=p.gm.data.start_data.get_attack(o),s=p.gm.data.start_data.get_attack_count(o);if(p.gm.data.total_time-o.last_attack_time>n){if(o.anger>=o.max_anger&&!p.gm.data.start_data.is_finger_operation)return i.anger_skill(),{value:void 0};var l=a.get_single_attack_enemy(i.center_position,r,s);if(l.length>0){var c=l[0];p.gm.pool.async_get(_.BundleName.START,"prefabs/skill_item",M.SkillItem,function(e){t.scene.skill_parent_node.addChild(e.node,1),t.skill_array.push(e);var a=p.gm.config.get_row_data("HeroConfigData",o.id.toString()),n=p.gm.config.get_row_data("SkillConfigData",a.attack_id.toString());e.play_skill_prepare(c,i,n,function(){for(var e=function(e){var a=l[e];p.gm.pool.async_get(_.BundleName.START,"prefabs/skill_item",M.SkillItem,function(e){o.id>0&&(t.scene.skill_parent_node.addChild(e.node),t.skill_array.push(e),e.set_attack_target(a,i,d))})},a=0;a<l.length;a++)e(a)})}),o.last_attack_time=p.gm.data.total_time;var g=p.gm.config.get_row_data("HeroLevelConfigData",o.id.toString(),o.lv.toString());g&&(o.anger+=Math.min(g.anger,o.max_anger-o.anger),o.anger>=o.max_anger&&!p.gm.data.guide_data.is_end&&p.gm.ui.emit("anger_skill",i)),p.gm.data.start_data.async_write_data(),i.update_view()}}},a=this,i=0;i<p.gm.ui.start.building_item_array.length;i++){var o=e(i);if("object"==typeof o)return o.value}},e.prototype.update_enemy_buff=function(){for(var t,e=0;e<this.enemy_alive_array.length;e++)(t=this.enemy_alive_array[e]).data,t.check_enemy_buff(p.gm.data.total_time)},e.prototype.get_single_attack_enemy=function(t,e,a){for(var i,o,n,_,r,d,s=[],l=[],c=0;c<this.enemy_alive_array.length;c++)(n=(_=(o=this.enemy_alive_array[c]).node.position.sub(t)).mag())<e&&(r=Math.atan2(_.y,_.x)/Math.PI*180,l.push({distance:n,angle:r,enemy_item:o}));if((l=b.Utils.sort_by_props(l,{distance:"ascending"})).length>0&&(i=l[0],s.push(i.enemy_item)),a>1&&l.length>1)for(c=1;c<l.length;c++)if(d=l[c],Math.abs(d.angle-i.angle)<p.gm.const.SHOOT_RANGE/2&&(s.push(d.enemy_item),s.length>=a))return s;return s},e.prototype.get_fixed_range_attack_enemy_array=function(t,e){for(var a,i=[],o=0;o<this.enemy_alive_array.length;o++)(a=this.enemy_alive_array[o]).node.position.sub(t).mag()<e&&i.push(a);return i},e.prototype.get_line_range_attack_enemy_array=function(t,e,a,i){var o,n=[],_=e.node.position.sub(t),r=Math.atan2(_.y,_.x),d=[],s=cc.v3(i*Math.cos(r),i*Math.sin(r)).add(t);d.push(cc.v2(t.x+a*Math.cos(r+Math.PI/2),t.y+a*Math.sin(r+Math.PI/2))),d.push(cc.v2(t.x+a*Math.cos(r+3*Math.PI/2),t.y+a*Math.sin(r+3*Math.PI/2))),d.push(cc.v2(s.x+a*Math.cos(r+3*Math.PI/2),s.y+a*Math.sin(r+3*Math.PI/2))),d.push(cc.v2(s.x+a*Math.cos(r+Math.PI/2),s.y+a*Math.sin(r+Math.PI/2))),n.push(e);for(var l=0;l<this.enemy_alive_array.length;l++)if((o=this.enemy_alive_array[l])!=e){var c=o.node.position;cc.Intersection.pointInPolygon(cc.v2(c.x,c.y),d)&&n.push(o)}return n},e.prototype.update_enemy_array=function(t){for(var e,a,i=function(i){if(!(e=o.enemy_alive_array[i])||!e.node)return"continue";o.update_enemy_target(e);var n=(a=e.data).speed*a.speed_scale*t,_=e.node.position,r=cc.Vec3.ZERO;if(a.attack_trapping_item)r=a.attack_trapping_item.center_position;else{if(!a.attack_building_item||!a.attack_building_item.node)return"continue";r=a.offset.add(a.attack_building_item.node.position)}var d=r.sub(_).mag();if(d>0){var s,l;s=Math.atan2(r.y-_.y,r.x-_.x),e.update_angle(s),l=n>=d?r:_.add(cc.v3(Math.cos(s)*n,Math.sin(s)*n)),e.node.position=l;var c=y.TiledMapUtils.local_point_to_tiled_map_point(l);a.origin_point=y.TiledMapUtils.tiled_map_point_to_grid_point(c),e.node.zIndex=y.TiledMapUtils.grid_point_to_z_index(a.origin_point,a.grid_length)}else if(p.gm.data.total_time-a.last_attack_time>a.attack_interval&&(e.attack(),a.attack_building_item)){var g=a.attack_building_item,u=g.data;if(g.change_hp(-a.attack),u.hp<=0)if(0==u.id)p.gm.ui.start.fight_fail();else{for(var h=o.enemy_alive_array.length-1;h>=0;h--){var m=o.enemy_alive_array[h].data;m.attack_building_item==g&&(m.attack_building_item=null,m.attack_trapping_item=null)}for(h=o.building_item_array.length-1;h>=0;h--)g==o.building_item_array[h]&&o.building_item_array.splice(h,1);for(var v=p.gm.data.start_data.hero_map[u.id],f=v.length-1;f>=0;f--)u==v[f]&&v.splice(f,1);p.gm.data.start_data.async_write_data(),p.gm.audio.play_effect("building_destroy"),b.Utils.play_normal_anim(g.building_anim,"building_damage",function(){p.gm.pool.put(g.node)})}a.last_attack_time=p.gm.data.total_time}},o=this,n=this.enemy_alive_array.length-1;n>=0;n--)i(n)},e.prototype.check_spawn_enemy=function(){for(var t=this;p.gm.data.enemy_appear_array.length>0;){var e=p.gm.data.enemy_appear_array[0];if(!(p.gm.data.total_time>=e.time))return;if(this.spawn_enemy(e),p.gm.data.current_wave_count=e.wave_count,0==e.wave_enemy_index){var a=this.enemy_hint_item_array[e.way_in_index];a.node.active=!0,a.data=e.wave_enemy_count,this.wave_node.active=!0,this.wave_lbl.string=e.wave_count.toString(),this.flag_boss_anim.play(),this.scheduleOnce(function(){t.wave_node.active=!1,t.flag_boss_anim.stop()},p.gm.const.ENEMY_HINT_TIME)}p.gm.data.enemy_appear_array.shift()}},e.prototype.get_home_building_item=function(){for(var t,e=0;e<p.gm.ui.start.building_item_array.length;e++)if((t=p.gm.ui.start.building_item_array[e]).data&&0==t.data.id)return t},e.prototype.find_building_item=function(t){for(var e,a=0;a<p.gm.ui.start.building_item_array.length;a++)if((e=p.gm.ui.start.building_item_array[a]).data&&e.data===t)return e},e.prototype.spawn_enemy=function(t){var e,a=this;e=p.gm.data.guide_data.is_end?this.scene.enemy_spawn_array[t.way_in_index]:this.scene.guide_enemy_spawn_node;var i=cc.v3((Math.random()-.5)*e.width+e.x,(Math.random()-.5)*e.height+e.y),o=p.gm.config.get_row_data("EnemyConfigData",t.enemy_id.toString());p.gm.pool.async_get(_.BundleName.START,"prefabs/enemy_item",I.EnemyItem,function(e){e.node.position=i;var n=y.TiledMapUtils.local_point_to_tiled_map_point(i),_=y.TiledMapUtils.tiled_map_point_to_grid_point(n),r=new s.EnemyItemData;r.index=t.index,r.id=t.enemy_id,r.hp=r.max_hp=t.hp,r.wave_count=t.wave_count,r.boss_monster_index=t.boss_monster_index,r.is_boss=2==o.is_boss,r.speed_scale=1,r.speed=o.move_speed,r.way_in_index=t.way_in_index,r.attack=t.attack,r.drop_gold=t.drop_gold,r.origin_point=_,r.grid_length=cc.v3(1,1),r.attack_interval=o.attack_interval/1e3,e.data=r,a.enemy_alive_array.push(e),a.scene.enemy_parent_node.addChild(e.node,y.TiledMapUtils.grid_point_to_z_index(r.origin_point,r.grid_length)),a.update_enemy_target(e),r.is_boss&&0==t.boss_monster_index&&a.show_enemy_boss_appear()})},e.prototype.show_enemy_boss_appear=function(){var t=this;p.gm.audio.play_effect("enemy_boss_appear"),0==this.battle_open_parent_node.childrenCount&&p.gm.pool.async_get(_.BundleName.START,"prefabs/battle_open_anim",m.NodePoolItem,function(e){if(0==t.battle_open_parent_node.childrenCount){t.battle_open_parent_node.active=!0,t.battle_open_parent_node.addChild(e.node);var a=e.getComponent(cc.Animation);a&&b.Utils.play_normal_anim(a,"battleOpen",function(){p.gm.pool.put(a.node),p.gm.pool.clear(_.BundleName.START,"prefabs/battle_open_anim"),t.battle_open_parent_node.active=!1})}else p.gm.pool.put(e.node)})},e.prototype.update_enemy_target=function(t){if(t){var e,a=t.data;if(p.gm.ui.start.building_item_array.length>0){for(var i=[],o=0;o<p.gm.ui.start.building_item_array.length;o++){var n=p.gm.ui.start.building_item_array[o];if(n){var _=n.node.position.sub(t.node.position).mag();n.data&&n.data.hp>0&&i.push({distance:_,building_item:n})}}(i=b.Utils.sort_by_props(i,{distance:"ascending"})).length>0&&(e=i[0].building_item)}if(e||(e=this.get_home_building_item()),a.attack_building_item!=e&&e){var r=e.node.getContentSize(),d=cc.v2(0,0),s=cc.v2(r.width/2,r.height/2),l=cc.v2(0,r.height),c=cc.v2(-r.width/2,r.height/2),g=cc.v3((Math.random()-.5)*r.width,Math.random()*r.height);switch(a.way_in_index){case 2:case 1:g.y=Math.floor((.5*Math.random()+.5)*r.height),g.x=Math.floor(((s.x-l.x)*g.y+(l.x*s.y-s.x*l.y))/(s.y-l.y));break;case 0:case 7:g.y=Math.floor((.5*Math.random()+.5)*r.height),g.x=Math.floor(((c.x-l.x)*g.y+(l.x*c.y-c.x*l.y))/(c.y-l.y));break;case 3:case 4:g.y=Math.floor(.5*Math.random()*r.height),g.x=Math.floor(((s.x-d.x)*g.y+(d.x*s.y-s.x*d.y))/(s.y-d.y));break;case 5:case 6:g.y=Math.floor(.5*Math.random()*r.height),g.x=Math.floor(((c.x-d.x)*g.y+(d.x*c.y-c.x*d.y))/(c.y-d.y))}a.offset=g,a.attack_building_item=e}}},e.prototype.fight_start=function(){var t;p.gm.data.fight_state=c.FightState.RUN,p.gm.data.enemy_appear_array=p.gm.data.generate_enemy_appear_array(p.gm.data.start_data.level_id),p.gm.data.enemy_total_count=p.gm.data.enemy_appear_array.length;for(var e=0;e<p.gm.ui.start.building_item_array.length;e++)p.gm.ui.start.building_item_array[e].update_view();for(this.scene.fight_start(),this.start_ui&&this.start_ui.fight_start(),e=2;e<this.tab_list.length;e++)(t=this.tab_list[e]).enabled=p.gm.data.start_data.max_pass_level_id>=1,b.Utils.set_sprite_state(t.node,p.gm.data.start_data.max_pass_level_id>=1?cc.Sprite.State.NORMAL:cc.Sprite.State.GRAY);this.tab_list[2].enabled=p.gm.data.start_data.max_pass_level_id>=1,this.tab_list[3].enabled=p.gm.data.start_data.max_pass_level_id>=1,this.check_guide_upgrade(),this.check_guide_science(),this.show_start_ui(),this.show_guide_trap(),this.check_red_point(),p.gm.data.guide_data.is_finish_all||1!=p.gm.data.start_data.level_id||this.show_enemy_boss_appear(),3!=p.gm.data.start_data.max_pass_level_id||p.gm.data.start_data.has_pop_sign_module||(p.gm.ui.show_panel(p.gm.const.SignDay),p.gm.data.start_data.has_pop_sign_module=!0,p.gm.data.start_data.async_write_data()),p.gm.channel.trackLevelData(p.gm.data.start_data.level_id.toString(),"join","0")},e.prototype.check_guide_upgrade=function(){if(p.gm.data.start_data.level_id>1&&!p.gm.data.guide_data.is_guide_upgrade_tab){var t=this.tab_list[_.HeroTabType.UPGRADE].node,e=t.getChildByName("weak_guide");e||p.gm.pool.async_get(_.BundleName.COMMON,"prefabs/weak_guide",n.WeakGuide,function(a){(e=t.getChildByName("weak_guide"))||(a.node.position=cc.v3(0,23),a.data={tip_content:"\u70b9\u51fb\u5347\u7ea7\u82f1\u96c4",tip_offset:cc.v3(0,23),dir:d.Direction.RIGHT,disappear_time:0,target:t,callback:function(){}},t.addChild(a.node))})}},e.prototype.check_guide_upgrade_hero=function(){var t=this.hero_upgrade_list.getItem(0);if(t){var e=t.upgrade_btn.node,a=e.getChildByName("weak_guide");a||p.gm.pool.async_get(_.BundleName.COMMON,"prefabs/weak_guide",n.WeakGuide,function(t){(a=e.getChildByName("weak_guide"))||(t.data={tip_content:"\u5347\u7ea7\u653b\u51fb\u3001\u653b\u901f\u3001\u5c04\u7a0b\u7b49\u5c5e\u6027",tip_offset:cc.v3(-40,50),dir:d.Direction.RIGHT,disappear_time:0,target:e,callback:function(){}},e.addChild(t.node))})}else this.scheduleOnce(this.check_guide_upgrade_hero,.5)},e.prototype.check_guide_science=function(){p.gm.data.start_data.level_id>1&&p.gm.data.guide_data.is_guide_upgrade_tab&&p.gm.data.guide_data.is_guide_upgrade_hero&&!p.gm.data.guide_data.is_guide_science_tab&&this.show_weak_guide(this.tab_list[_.HeroTabType.SCIENCE].node,"\u70b9\u51fb\u5347\u7ea7\u5efa\u7b51\u5c5e\u6027",!1)},e.prototype.show_weak_guide=function(t,e,a,i){void 0===i&&(i=null);var o=t.getChildByName("weak_guide");o||p.gm.pool.async_get(_.BundleName.COMMON,"prefabs/weak_guide",n.WeakGuide,function(n){(o=t.getChildByName("weak_guide"))||(n.node.position=cc.v3(0,23),n.data={tip_content:e,tip_offset:cc.v3(-50,23),dir:d.Direction.RIGHT,disappear_time:0,target:t,callback:i},t.addChild(n.node),a&&p.gm.data.weak_guide_array.push(n))})},e.prototype.check_guide_science_home=function(){var t=this.science_list.getItem(0);if(t){var e=t.upgrade_btn.node,a=e.getChildByName("weak_guide");a||p.gm.pool.async_get(_.BundleName.COMMON,"prefabs/weak_guide",n.WeakGuide,function(t){(a=e.getChildByName("weak_guide"))||(t.data={tip_content:"\u5347\u7ea7\u53ef\u589e\u52a0\u82f1\u96c4\u6570",tip_offset:cc.v3(0,40),dir:d.Direction.RIGHT,disappear_time:0,target:e,callback:function(){}},e.addChild(t.node))})}else this.scheduleOnce(this.check_guide_science_home,.5)},e.prototype.fight_success=function(){var t=this;p.gm.data.fight_state=c.FightState.SUCCESS,p.gm.config.get_row_data("LevelConfigData",p.gm.data.start_data.level_id.toString())&&(p.gm.data.start_data.level_id>p.gm.data.start_data.max_pass_level_id&&(p.gm.data.start_data.max_pass_level_id=p.gm.data.start_data.level_id,w.ReportData.instance.report_once_point(p.gm.data.start_data.max_pass_level_id+100)),p.gm.data.start_data.async_write_data()),this.update_view(),p.gm.channel.trackLevelData(p.gm.data.start_data.level_id.toString(),"complete",p.gm.data.total_time.toString()),this.scheduleOnce(function(){p.gm.ui.hide_upper_module(p.gm.const.Start),p.gm.ui.show_panel(p.gm.const.FightSuccess),t.fight_clear()},1)},e.prototype.fight_fail=function(){var t=this;p.gm.data.guide_data.is_finish_all||1!=p.gm.data.start_data.level_id||(p.gm.data.guide_data.current_guide_id=p.gm.data.guide_data.MAX_GUIDE_ID+1,p.gm.data.guide_data.async_write_data()),p.gm.channel.trackLevelData(p.gm.data.start_data.level_id.toString(),"fail",p.gm.data.total_time.toString()),p.gm.audio.play_effect("building_destroy");var e=this.get_home_building_item();e.node.active&&(p.gm.audio.play_effect("building_destroy"),b.Utils.play_normal_anim(e.building_anim,"building_damage",function(){e.node.active=!1,p.gm.ui.hide_upper_module(p.gm.const.Start),p.gm.ui.show_panel(p.gm.const.FightFail),t.fight_clear()}));for(var a=this.enemy_alive_array.length-1;a>=0;a--){var i=this.enemy_alive_array[a].data;i.attack_building_item=null,i.attack_trapping_item=null}for(a=this.building_item_array.length-1;a>=0;a--){var o=this.building_item_array[a],n=o.data;if(o!=e){this.building_item_array.splice(a,1);for(var _=p.gm.data.start_data.hero_map[n.id],r=_.length-1;r>=0;r--)n==_[r]&&_.splice(r,1);p.gm.pool.put(o.node)}}p.gm.data.start_data.async_write_data(),p.gm.data.fight_state=c.FightState.FAIL,this.update_view()},e.prototype.fight_reset=function(){p.gm.data.fight_state=c.FightState.NONE,p.gm.data.total_time=0,p.gm.data.enemy_death_count=0,this.fight_clear()},e.prototype.fight_clear=function(){var t,e;this.scene.node.position=cc.Vec3.ZERO,this.scene.night_mask_spr.node.position=cc.Vec3.ZERO;var a=p.gm.data.start_data.hero_map;for(var i in a){var o=a[i];if(o&&o.length>0)for(var n=0;n<o.length;n++)(t=o[n]).max_hp=p.gm.data.start_data.get_max_hp(t),t.anger=0,t.last_attack_time=0,0==t.id&&t.hp<=0&&(t.hp=t.max_hp,this.recover_building()),t.is_editing=!1}for(this.scene.building_mask_node.active=!1,this.scene.map_grid_node.active=!1,n=0;n<p.gm.ui.start.building_item_array.length;n++)(e=p.gm.ui.start.building_item_array[n]).node.parent=this.scene.building_parent_node,e.node.active=!0,e.update_view();for(n=this.trapping_item_array.length-1;n>=0;n--){var _=this.trapping_item_array.splice(n,1)[0];cc.isValid(_)&&p.gm.pool.put(_.node)}for(n=this.enemy_alive_array.length-1;n>=0;n--){var r=this.enemy_alive_array.splice(n,1)[0];p.gm.pool.put(r.node)}for(n=this.skill_array.length-1;n>=0;n--){var d=this.skill_array.splice(n,1)[0];p.gm.pool.put(d.node)}p.gm.data.start_data.async_write_data(),this.update_view()},e.prototype.recover_building=function(){var t=this;this.scheduleOnce(function(){for(var e,a=0;a<p.gm.data.hero_data.hero_data_array.length;a++)e=p.gm.data.hero_data.hero_data_array[a],p.gm.data.warehouse_data.get_item_count(e.id)>0&&t.create_building_hero(e);t.get_home_building_item().play_building_create_effect()},1)},e.prototype.update_view=function(){var t;this.start_ui&&this.start_ui.update_view(),this.enemy_prg.progress=(p.gm.data.enemy_total_count-p.gm.data.enemy_appear_array.length)/p.gm.data.enemy_total_count;var e=p.gm.data.start_data.level_id;t=e<3?1:e>p.gm.const.MAX_LEVEL_COUNT-2?p.gm.const.MAX_LEVEL_COUNT-4:e-2;for(var a=0;a<this.level_num_item_array.length;a++)this.level_num_item_array[a].data=t+a;this.level_prg.progress=(e-t)/4,u.GraphicsUtils.show_debug_draw&&this.show_debug_grid(),this.check_weak_guide()},e.prototype.open_timer=function(){var t=this;this._timer.is_running||this._timer.start(function(){t.check_balloon(),t.start_ui&&t.start_ui.check_store_red()},1e3,0)},e.prototype.check_balloon=function(){var t=this;if(p.gm.data.start_data.level_id%3==0){if(this.balloon_parent_node.active=!0,0==this.balloon_parent_node.childrenCount&&p.gm.pool.async_get(_.BundleName.START,"prefabs/balloon",m.NodePoolItem,function(e){0==t.balloon_parent_node.childrenCount?t.balloon_parent_node.addChild(e.node):p.gm.pool.put(e.node)}),p.gm.data.sign_data.balloon_state>0)return;Math.floor(Date.now()/1e3)>=p.gm.data.sign_data.next_balloon_time&&(p.gm.data.sign_data.balloon_state=1)}else this.balloon_parent_node.active=!1,this.balloon_parent_node.childrenCount>0&&(p.gm.pool.put_children(this.balloon_parent_node),p.gm.pool.clear(_.BundleName.START,"prefabs/balloon"))},e.prototype.update_balloon=function(t){if(!(p.gm.data.sign_data.balloon_state<=0)&&(this.balloon_parent_node.x+=30*t,this.balloon_parent_node.y>360?this._balloon_dir=-1:this.balloon_parent_node.y<300&&(this._balloon_dir=1),this.balloon_parent_node.y+=15*t*this._balloon_dir,this.balloon_parent_node.x>=600)){p.gm.data.sign_data.balloon_state=0,this.balloon_parent_node.x=-600,this.balloon_parent_node.y=330;var e=Math.floor(Date.now()/1e3);p.gm.data.sign_data.next_balloon_time=e+30}},e.prototype.create_building_hero=function(t){var e=this,a=new s.HeroItemData;a.id=t.id,a.lv=t.lv,a.star=t.star;var i,o=p.gm.config.get_row_data("HeroConfigData",t.id.toString()),n=p.gm.config.get_row_data("HeroLevelConfigData",t.id.toString(),t.lv.toString());a.color_hex=p.gm.const.GRID_COLOR_GREEN,a.max_hp=p.gm.data.start_data.get_max_hp(a),a.hp=a.max_hp,a.max_count=n.max_num;var r=o.grid_length.split("|");a.grid_length=cc.v3(parseInt(r[0]),parseInt(r[1])),t.id==p.gm.const.FIRST_HERO_ID&&t.has_buy_count<2?(i=0==t.has_buy_count?cc.v3(12,10):cc.v3(10,10),a.anger=80):i=p.gm.ui.start.scene.find_space_grid(a.grid_length),a.origin_point=i||cc.v3(16,16),a.obj_id=t.has_buy_count;var d=p.gm.data.start_data.hero_map[t.id];d||(d=[],p.gm.data.start_data.hero_map[t.id]=d),d.push(a),p.gm.data.start_data.async_write_data();var l=p.gm.ui.start.find_building_item(a);l||p.gm.pool.async_get(_.BundleName.START,"prefabs/building_item",k.BuildingItem,function(t){(l=t).node.name=cc.js.formatStr("building_item_%d_%d",a.id,a.obj_id),p.gm.ui.start.building_item_array.push(t),t.node.parent!=e.scene.building_parent_node&&e.scene.building_parent_node.addChild(t.node),l.data=a,l.node.zIndex=y.TiledMapUtils.grid_point_to_z_index(a.origin_point,a.grid_length);var i=y.TiledMapUtils.grid_point_to_tiled_map_point(a.origin_point),o=y.TiledMapUtils.tiled_map_point_to_local_point(i),n=y.TiledMapUtils.tile_size,_=a.grid_length.y*n.height;l.node.position=o.sub(cc.v3(0,_)),l.play_building_create_effect()})},e.prototype.on_update_warehouse_handler=function(){this.gold_lbl.string=p.gm.data.warehouse_data.gold_num.toString(),this.diamond_lbl.string=p.gm.data.warehouse_data.diamond_num.toString(),this.hero_list.setData(p.gm.data.hero_data.hero_data_array),p.gm.ui.start.check_hero_red()},e.prototype.play_skill_anim=function(t,e,a,i){a.skill_anim_loop?p.gm.ui.start.scheduleOnce(function(){e.stop(),p.gm.pool.put(e.node),t.put_to_pool()},a.skill_anim_time):e.once(cc.Animation.EventType.FINISHED,function(){p.gm.pool.put(e.node),t.put_to_pool()}),a.fly_time>0?p.gm.ui.start.scheduleOnce(function(){i()},a.fly_time):e.once(cc.Animation.EventType.FINISHED,function(){i()}),e.play()},e.prototype.is_complete_condition=function(t){return 1==t.condition_type?p.gm.data.start_data.max_pass_level_id>=t.condition_value:2==t.condition_type&&p.gm.data.start_data.home_lv>=t.condition_value},e.prototype.play_people_change_anim=function(){b.Utils.play_normal_anim(this.total_people_anim,"total_people")},e.prototype.random_fight_result_reward=function(){var t=[],e=p.gm.config.get_row_data_array("PoolConfigData",p.gm.const.RESULT_REWARD_POOL_ID.toString());do{var a=[];if(p.gm.data.setRandomReward(e,a),a.length>0){for(var i=a[0],o=!1,n=t.length-1;n>=0;n--)if(i.id==t[n].id){o=!0;break}o||t.push(i)}}while(t.length<4);return t},e.prototype.show_notice=function(t){this.notice_lbl.node.active=!0,this.notice_lbl.string=t,this.unschedule(this.hide_notice),this.scheduleOnce(this.hide_notice,2.5)},e.prototype.hide_notice=function(){this.notice_lbl.node.active=!1},e.prototype.fly_hero_piece=function(t){var e=p.gm.ui.get_layer_node(_.LayerType.TOP),a=t.convertToWorldSpaceAR(cc.Vec3.ZERO),i=e.convertToNodeSpaceAR(a),o=cc.instantiate(t);o.position=i,o.parent=e;var n=this.tab_list[2].node.convertToWorldSpaceAR(cc.Vec3.ZERO),r=e.convertToNodeSpaceAR(n);o.runAction(cc.sequence(cc.spawn(cc.moveTo(.6,r.x,r.y),cc.scaleTo(.6,.3)),cc.callFunc(function(){o.destroy()})))},e.prototype.show_debug_grid=function(){if(y.TiledMapUtils.map_size){u.GraphicsUtils.draw_bound_start(this.scene.node,cc.color().fromHEX(p.gm.const.GRID_COLOR_RED));for(var t=p.gm.ui.start.scene.get_grid_state_array(),e=0;e<y.TiledMapUtils.map_size.height;e++)for(var a=0;a<y.TiledMapUtils.map_size.width;a++)t[e][a]&&u.GraphicsUtils.draw_bound(this.scene.node,this.get_grid_vec_array(a,e));u.GraphicsUtils.draw_bound_end(this.scene.node)}},e.prototype.get_grid_vec_array=function(t,e){var a=y.TiledMapUtils.tile_size,i=[],o=y.TiledMapUtils.grid_point_to_tiled_map_point(cc.v3(t,e));return o=y.TiledMapUtils.tiled_map_point_to_local_point(o),i.push(o),i.push(cc.v3(o.x+a.width/2,o.y-a.height/2)),i.push(cc.v3(o.x,o.y-a.height)),i.push(cc.v3(o.x-a.width/2,o.y-a.height/2)),i},e.prototype.click_btn_yysz=function(){r.SDKManager.instance.showPersonalWindow()},o([x(cc.Node)],e.prototype,"start_ui_node",void 0),o([x(N.Scene)],e.prototype,"scene",void 0),o([x(cc.Button)],e.prototype,"gold_add_btn",void 0),o([x(cc.Label)],e.prototype,"gold_lbl",void 0),o([x(cc.Button)],e.prototype,"diamond_add_btn",void 0),o([x(cc.Label)],e.prototype,"diamond_lbl",void 0),o([x(cc.Node)],e.prototype,"gold_icon_node",void 0),o([x(cc.Node)],e.prototype,"diamond_icon_node",void 0),o([x(cc.Node)],e.prototype,"hero_node",void 0),o([x(cc.Label)],e.prototype,"hero_num_lbl",void 0),o([x(cc.Label)],e.prototype,"notice_lbl",void 0),o([x([cc.Toggle])],e.prototype,"tab_list",void 0),o([x(h.ListView)],e.prototype,"hero_list",void 0),o([x(h.ListView)],e.prototype,"hero_upgrade_list",void 0),o([x(h.ListView)],e.prototype,"hero_star_list",void 0),o([x(h.ListView)],e.prototype,"science_list",void 0),o([x([cc.Node])],e.prototype,"arrow_tab_node_array",void 0),o([x(cc.ProgressBar)],e.prototype,"level_prg",void 0),o([x([S.LevelNumItem])],e.prototype,"level_num_item_array",void 0),o([x(cc.ProgressBar)],e.prototype,"enemy_prg",void 0),o([x(cc.Animation)],e.prototype,"flag_boss_anim",void 0),o([x(cc.Node)],e.prototype,"wave_node",void 0),o([x(cc.Label)],e.prototype,"wave_lbl",void 0),o([x([T.EnemyHintItem])],e.prototype,"enemy_hint_item_array",void 0),o([x(cc.Node)],e.prototype,"pause_node",void 0),o([x(h.ListView)],e.prototype,"hero_pause_list",void 0),o([x(cc.Button)],e.prototype,"close_btn",void 0),o([x(cc.Button)],e.prototype,"continue_btn",void 0),o([x(cc.Node)],e.prototype,"balloon_parent_node",void 0),o([x(cc.Node)],e.prototype,"battle_open_parent_node",void 0),o([x(cc.Animation)],e.prototype,"total_people_anim",void 0),o([x(cc.Node)],e.prototype,"text_start_node",void 0),o([x(cc.Node)],e.prototype,"guide_trap_node",void 0),o([C],e)}(g.GameModule);a.Start=D,cc._RF.pop()},{BuildingItem:"BuildingItem",Constants:void 0,DataManager:void 0,EnemyHintItem:"EnemyHintItem",EnemyItem:"EnemyItem",GameManager:void 0,GameModule:void 0,GraphicsUtils:void 0,GuideData:void 0,LevelNumItem:"LevelNumItem",ListView:void 0,NetUtils:void 0,NodePoolItem:void 0,SDKManager:void 0,Scene:"Scene",SkillItem:"SkillItem",StartData:void 0,StartUI:"StartUI",TaskManager:void 0,TiledMapUtils:void 0,Timer:void 0,Utils:void 0,WarehouseData:void 0,WeakGuide:void 0}],TextItem:[function(t,e,a){"use strict";cc._RF.push(e,"2857amp5qtBDKUXJQUHhPwf","TextItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.TextItemData=a.TextItem=void 0;var n=t("GameManager"),_=t("NodePoolItem"),r=cc._decorator,d=r.ccclass,s=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.text_lbl=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.onEnable=function(){var t=this;cc.tween(this.node).hide().delay(this._data.delay).show().to(1,{position:cc.v3(this.node.position.x+this._data.offset.x,this.node.position.y+this._data.offset.y),opacity:255}).delay(.2).call(function(){n.gm.pool.put(t.node)}).start()},e.prototype.update_view=function(){var t=this._data;this.text_lbl.node.color=t.color,this.text_lbl.string=t.text},e.prototype.reset=function(){this._data=null,this.text_lbl.string="",cc.tween(this.node).stop()},e.prototype.unuse=function(){t.prototype.unuse.call(this),this.reset()},o([s(cc.Label)],e.prototype,"text_lbl",void 0),o([d],e)}(_.NodePoolItem);a.TextItem=l,a.TextItemData=function(t,e,a,i){void 0===i&&(i=0),this.text=t,this.offset=e,this.color=a,this.delay=i},cc._RF.pop()},{GameManager:void 0,NodePoolItem:void 0}],TrapItem:[function(t,e,a){"use strict";cc._RF.push(e,"dd165izPDNOBasAnJq1HPTl","TrapItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.TrapItem=void 0;var n=t("Constants"),_=t("ConfigData"),r=t("Draggable"),d=t("GameManager"),s=t("GraphicsUtils"),l=t("ListViewItem"),c=t("NodePoolItem"),p=t("TiledMapUtils"),g=t("NetUtils"),u=t("SkillItem"),h=t("TrappingItem"),m=cc._decorator,v=m.ccclass,y=m.property,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.trap_spr=null,e.num_lbl=null,e.lock_node=null,e.draggable=null,e.video_btn=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.on_drag_start_handler=function(t){var e=this;if(this._data){var a=d.gm.config.get_row_data("TrapConfigData",this._data.id.toString(),this._data.lv.toString());if(a)if(a.type==_.TrapType.SKILL){var i=cc.instantiate(this.trap_spr.node);i.parent=null,this.draggable.setDragNode(i,t)}else a.type==_.TrapType.BUILDING&&(d.gm.pool.async_get(n.BundleName.START,"prefabs/trapping_item",h.TrappingItem,function(a){e._drag_node=a.node,a.data=cc.instantiate(e._data),a.node.parent=d.gm.ui.map_drag_node;var i=a.node.parent.convertToNodeSpaceAR(t.detail.getLocation());a.node.setPosition(i)}),d.gm.ui.start.scene.map_grid_node.active=!0);g.ReportData.instance.report_point(this.data.id-13e3),g.ReportData.instance.report_once_point(this.data.id-13e3+700)}},e.prototype.on_drag_move_handler=function(t){if(this._data){var e=d.gm.config.get_row_data("TrapConfigData",this._data.id.toString(),this._data.lv.toString());if(e)if(e.type==_.TrapType.SKILL){var a=this.draggable.getDragNode(),i=d.gm.config.get_row_data("SkillConfigData",e.skill_id.toString());s.GraphicsUtils.draw_circle(a,cc.Color.BLUE,cc.Vec3.ZERO,i.skill_range)}else if(e.type==_.TrapType.BUILDING&&this._drag_node&&this._drag_node.parent){var o=this._drag_node.parent.convertToNodeSpaceAR(t.detail.getLocation());this._drag_node.setPosition(o),this.check_collision()}}},e.prototype.check_collision=function(){var t=this._drag_node;if(!t)return!1;var e,a=t.getComponent(h.TrappingItem),i=a.data,o=p.TiledMapUtils.tile_size,n=p.TiledMapUtils.map_size,_=i.grid_length.x*o.height,r=t.position.add(cc.v3(0,_));r=p.TiledMapUtils.local_point_to_tiled_map_point(r),i.origin_point=p.TiledMapUtils.tiled_map_point_to_grid_point(r);var s=d.gm.const.GRID_COLOR_GREEN;t:for(var l=0;l<i.grid_length.y;l++)for(var c=0;c<i.grid_length.x;c++)if((e=cc.v2(i.origin_point.x+c,i.origin_point.y+l)).y>=0&&e.y<n.height&&e.x>=0&&e.x<n.width){if(p.TiledMapUtils.grid_state_array[e.y][e.x]){s=d.gm.const.GRID_COLOR_RED;break t}for(var g=void 0,u=void 0,m=0;m<d.gm.ui.start.building_item_array.length;m++)if((g=d.gm.ui.start.building_item_array[m])&&(u=g.data,this.check_building_collision(i,u))){s=d.gm.const.GRID_COLOR_RED;break t}var v=void 0,y=void 0;for(m=0;m<d.gm.ui.start.trapping_item_array.length;m++)if((v=d.gm.ui.start.trapping_item_array[m])&&(y=v.data)&&this.check_building_collision(i,y)){s=d.gm.const.GRID_COLOR_RED;break t}}return s!=i.color_hex&&(i.color_hex=s,a.draw_bound(s)),s==d.gm.const.GRID_COLOR_RED},e.prototype.check_building_collision=function(t,e){for(var a,i=[],o=[],n=0;n<t.grid_length.y;n++)for(var _=0;_<t.grid_length.x;_++)i.push(cc.v3(t.origin_point.x+_,t.origin_point.y+n));for(n=0;n<e.grid_length.y;n++)for(_=0;_<e.grid_length.x;_++)o.push(cc.v3(e.origin_point.x+_,e.origin_point.y+n));for(var r=0;r<i.length;r++){a=i[r];for(var d=0;d<o.length;d++)if(a.equals(o[d]))return!0}return!1},e.prototype.on_drag_end_handler=function(){if(this._data){var t=d.gm.config.get_row_data("TrapConfigData",this._data.id.toString(),this._data.lv.toString());if(t)if(t.type==_.TrapType.SKILL){var e=this.draggable.getDragNode().convertToWorldSpaceAR(cc.Vec3.ZERO),a=d.gm.ui.start.scene.node.convertToNodeSpaceAR(e);this.draggable.clearDragNode(),this._drag_node=null,d.gm.data.warehouse_data.player_del_item(this._data.id,1),d.gm.data.trap_data.async_write_data(),this.update_view(),d.gm.pool.async_get(n.BundleName.START,"prefabs/skill_item",u.SkillItem,function(e){d.gm.ui.start.scene.skill_parent_node.addChild(e.node),d.gm.ui.start.skill_array.push(e);var i=d.gm.config.get_row_data("SkillConfigData",t.skill_id.toString());s.GraphicsUtils.draw_circle(e.node,cc.Color.GREEN,a,i.hit_range),d.gm.pool.async_get(n.BundleName.START,"prefabs/effects/"+i.skill_name,c.NodePoolItem,function(t){var o=t.getComponent(cc.Animation);e.node.addChild(o.node),o.node.position=a,d.gm.ui.start.play_skill_anim(e,o,i,function(){var t=d.gm.ui.start.get_fixed_range_attack_enemy_array(a,i.hit_range);if(t.length>0)for(var o=0;o<t.length;o++){var n=t[o];n.data&&e.set_target_hit(i,n,0,Math.floor(d.gm.data.start_data.hero_max_attack*i.damage_ratio))}})})})}else if(t.type==_.TrapType.BUILDING){d.gm.ui.start.scene.map_grid_node.active=!1;var i=this._drag_node;if(i){i.parent=d.gm.ui.start.scene.building_parent_node;var o=i.getComponent(h.TrappingItem),r=o.data,l=p.TiledMapUtils.tile_size,g=i.position.sub(cc.v3(0,p.TiledMapUtils.half_tile_size.height));g=p.TiledMapUtils.local_point_to_tiled_map_point(g);var m=Math.ceil(i.width/l.width)*l.height,v=g.add(cc.v3(0,m));r.origin_point=p.TiledMapUtils.tiled_map_point_to_grid_point(v),v=(v=p.TiledMapUtils.grid_point_to_tiled_map_point(r.origin_point)).sub(cc.v3(0,m)),v=p.TiledMapUtils.tiled_map_point_to_local_point(v),i.position=v,i.zIndex=p.TiledMapUtils.grid_point_to_z_index(r.origin_point,r.grid_length),d.gm.data.start_data.async_write_data(),this.check_collision(),r.color_hex==d.gm.const.GRID_COLOR_GREEN?(r.can_move=!1,o.update_view(),d.gm.ui.start.trapping_item_array.push(o),this._drag_node=null,d.gm.data.warehouse_data.player_del_item(this._data.id,1),d.gm.data.trap_data.async_write_data(),this.update_view()):(this._drag_node=null,d.gm.pool.put(i))}}}},e.prototype.bind_event=function(t){t?(this.draggable.enabled=!0,this.node.on("drag-start",this.on_drag_start_handler,this),this.node.on("drag-move",this.on_drag_move_handler,this),this.node.on("drag-end",this.on_drag_end_handler,this)):(this.draggable.enabled=!1,this.node.off("drag-start",this.on_drag_start_handler,this),this.node.off("drag-move",this.on_drag_move_handler,this),this.node.off("drag-end",this.on_drag_end_handler,this))},e.prototype.update_view=function(){if(this._data&&this._data.id>0)if(this._data.is_unlock){var t=d.gm.data.warehouse_data.get_item_count(this._data.id),e=this._data.id-13001;this.trap_spr.spriteFrame=d.gm.ui.start.start_ui.trap_sf_array[e],this.num_lbl.string=cc.js.formatStr("%d/%d",t,this._data.max_num),this.video_btn.node.active=t<=0,this.lock_node.active=!1,this.node.active=!0,this.bind_event(t>0)}else this.trap_spr.spriteFrame=null,this.num_lbl.string="",this.lock_node.active=!0,this.node.active=!1,this.bind_event(!1)},e.prototype.editor_on_button_click_handler=function(t){var e=this;t.target==this.video_btn.node&&d.gm.channel.show_video_ad(function(){d.gm.data.warehouse_data.player_add_item(e._data.id,e._data.max_num),e.update_view(),d.gm.data.trap_data.async_write_data(),g.ReportData.instance.report_point(e.data.id-13e3+4)},this)},o([y(cc.Sprite)],e.prototype,"trap_spr",void 0),o([y(cc.Label)],e.prototype,"num_lbl",void 0),o([y(cc.Node)],e.prototype,"lock_node",void 0),o([y(r.Draggable)],e.prototype,"draggable",void 0),o([y(cc.Button)],e.prototype,"video_btn",void 0),o([v],e)}(l.ListViewItem);a.TrapItem=f,cc._RF.pop()},{ConfigData:void 0,Constants:void 0,Draggable:void 0,GameManager:void 0,GraphicsUtils:void 0,ListViewItem:void 0,NetUtils:void 0,NodePoolItem:void 0,SkillItem:"SkillItem",TiledMapUtils:void 0,TrappingItem:"TrappingItem"}],TrappingItem:[function(t,e,a){"use strict";cc._RF.push(e,"c85d1ehw+ZOFYkJPDFWRrkW","TrappingItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.TrappingItem=void 0;var n=t("Constants"),_=t("GameManager"),r=t("GraphicsUtils"),d=t("NodePoolItem"),s=t("TiledMapUtils"),l=t("Utils"),c=cc._decorator,p=c.ccclass,g=c.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.grid_spr=null,e.arrow_array=[],e.arrow_m_node=null,e.arrow_reverse_m_node=null,e.arrow_n_node=null,e.arrow_reverse_n_node=null,e.building_spr=null,e.name_lbl=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.node.width=s.TiledMapUtils.tile_size.width*this._data.grid_length.x,this.node.height=s.TiledMapUtils.tile_size.height*this._data.grid_length.y,this.name_lbl.node.position=cc.v3(0,this.node.height+40),l.Utils.async_set_sprite_frame(this.grid_spr,n.BundleName.START,cc.js.formatStr("res/grid/%dx%d",this._data.grid_length.x,this._data.grid_length.y)),this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){if(this._data.can_move){this.grid_spr.node.active=!0,this.draw_bound(this._data.color_hex);var t=_.gm.config.get_row_data("TrapConfigData",this._data.id.toString(),this._data.lv.toString());if(t){this.name_lbl.string=t.name+" LV. "+this._data.lv;var e=_.gm.config.get_row_data("SkillConfigData",t.skill_id.toString());r.GraphicsUtils.draw_circle(this.node,cc.Color.BLUE,this.center_position,e.skill_range)}this.arrow_m_node.active=0!=this._data.id,this.arrow_reverse_m_node.active=0!=this._data.id,this.arrow_n_node.active=0!=this._data.id,this.arrow_reverse_n_node.active=0!=this._data.id;var a=cc.v2(Math.floor(this._data.grid_length.x*s.TiledMapUtils.tile_size.width/4),Math.floor(this._data.grid_length.y*s.TiledMapUtils.tile_size.height/4));this.arrow_m_node.position=cc.v3(a.x,a.y).add(cc.v3(10,-10)),this.arrow_reverse_m_node.position=cc.v3(-a.x,3*a.y).add(cc.v3(-10,10)),this.arrow_n_node.position=cc.v3(-a.x,a.y).add(cc.v3(-10,-10)),this.arrow_reverse_n_node.position=cc.v3(a.x,3*a.y).add(cc.v3(10,10))}else this.grid_spr.node.active=!1,this.name_lbl.node.active=!1,this.arrow_m_node.active=!1,this.arrow_reverse_m_node.active=!1,this.arrow_n_node.active=!1,this.arrow_reverse_n_node.active=!1;this._data.id>0&&(0==this._data.attack_time?(this.building_spr.node.active=!0,l.Utils.async_set_sprite_frame(this.building_spr,n.BundleName.COMMON,"res/show/"+this._data.id)):this.building_spr.node.active=!1)},e.prototype.draw_bound=function(t){var e=cc.color().fromHEX(t);this.grid_spr.node.color=e;for(var a=0;a<this.arrow_array.length;a++)this.arrow_array[a].node.color=t==_.gm.const.GRID_COLOR_RED?cc.Color.RED:cc.Color.WHITE},e.prototype.reset=function(){},Object.defineProperty(e.prototype,"center_position",{get:function(){var t=this._data?this._data.grid_length.y/2*s.TiledMapUtils.tile_size.height:this.node.height/2;return this.node.position.add(cc.v3(0,t))},enumerable:!1,configurable:!0}),o([g(cc.Sprite)],e.prototype,"grid_spr",void 0),o([g([cc.Sprite])],e.prototype,"arrow_array",void 0),o([g(cc.Node)],e.prototype,"arrow_m_node",void 0),o([g(cc.Node)],e.prototype,"arrow_reverse_m_node",void 0),o([g(cc.Node)],e.prototype,"arrow_n_node",void 0),o([g(cc.Node)],e.prototype,"arrow_reverse_n_node",void 0),o([g(cc.Sprite)],e.prototype,"building_spr",void 0),o([g(cc.Label)],e.prototype,"name_lbl",void 0),o([p],e)}(d.NodePoolItem);a.TrappingItem=u,cc._RF.pop()},{Constants:void 0,GameManager:void 0,GraphicsUtils:void 0,NodePoolItem:void 0,TiledMapUtils:void 0,Utils:void 0}],TreeItem:[function(t,e,a){"use strict";cc._RF.push(e,"1c521FPB/VMxrlF2QncQNOC","TreeItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.TreeItem=void 0;var n=t("Constants"),_=t("NodePoolItem"),r=t("TiledMapUtils"),d=t("Utils"),s=cc._decorator,l=s.ccclass,c=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tree_spr=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){var t=this._data;d.Utils.async_set_sprite_frame(this.tree_spr,n.BundleName.START,t.texture_url),this.node.zIndex=r.TiledMapUtils.grid_point_to_z_index(t.grid_pos,t.grid_length);var e=r.TiledMapUtils.grid_point_to_tiled_map_point(t.grid_pos),a=r.TiledMapUtils.tiled_map_point_to_local_point(e),i=r.TiledMapUtils.tile_size,o=t.grid_length.y*i.height;this.node.position=a.sub(cc.v3(0,o))},e.prototype.reset=function(){this._data=null},o([c(cc.Sprite)],e.prototype,"tree_spr",void 0),o([l],e)}(_.NodePoolItem);a.TreeItem=p,cc._RF.pop()},{Constants:void 0,NodePoolItem:void 0,TiledMapUtils:void 0,Utils:void 0}],TreeStaticItem:[function(t,e,a){"use strict";cc._RF.push(e,"97ec03qXcNADJRtytMa27mm","TreeStaticItem");var i=__extends,o=__decorate;Object.defineProperty(a,"__esModule",{value:!0}),a.TreeStaticItem=void 0;var n=t("Constants"),_=t("NodePoolItem"),r=t("Utils"),d=cc._decorator,s=d.ccclass,l=d.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tree_spr=null,e}return i(e,t),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.update_view()},enumerable:!1,configurable:!0}),e.prototype.update_view=function(){var t=this._data;r.Utils.async_set_sprite_frame(this.tree_spr,n.BundleName.START,t.texture_url),this.node.setContentSize(t.size),this.node.setPosition(t.position)},e.prototype.reset=function(){this._data=null},o([l(cc.Sprite)],e.prototype,"tree_spr",void 0),o([s],e)}(_.NodePoolItem);a.TreeStaticItem=c,cc._RF.pop()},{Constants:void 0,NodePoolItem:void 0,Utils:void 0}]},{},["Balloon","BoxItem","BuildingItem","EnemyHintItem","EnemyItem","FightFail","FightSuccess","GetMoney","HeroItem","HeroPauseItem","HeroStarItem","HeroUpgradeItem","LevelNumItem","NumBoomItem","NumItem","OpenBox","PropItem","ReceiveReward","ResultRewardItem","Scene","ScienceItem","ShowTrap","SkillItem","SkyBox","Start","StartUI","TextItem","TrapItem","TrappingItem","TreeItem","TreeStaticItem"]);